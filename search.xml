<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>SpiderKeeperçš„ä½¿ç”¨</title>
    <url>/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/e3a9efd8beb4131a7ebda45b43bf4cd.png" class="">  

<a id="more"></a>

<h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p><code>pip install scrapy</code><br><code>pip install scrapyd</code><br><code>pip install scrapyd-client</code><br><code>pip install spiderkeeper</code></p>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿›å…¥åˆ°æ–‡ä»¶å¤¹åï¼Œè¾“å…¥scrapydå¯åŠ¨scrapydæœåŠ¡ï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">E:\Django+Scrapy\mypro\spiderpro&gt;scrapyd</span><br><span class="line">2020-05-04T20:02:33+0800 [-] Loading c:\users\administrator\appdata\local\programs\python\python37\lib\site-packages\scrapyd\txapp.py...</span><br><span class="line">2020-05-04T20:02:33+0800 [-] Scrapyd web console available at http:&#x2F;&#x2F;127.0.0.1:6800&#x2F;</span><br><span class="line">2020-05-04T20:02:33+0800 [-] Loaded.</span><br><span class="line">2020-05-04T20:02:33+0800 [twisted.application.app.AppLogger#info] twistd 19.7.0 (c:\users\administrator\appdata\local\programs\python\python37\python.exe 3.7.0) starting up.</span><br><span class="line">2020-05-04T20:02:33+0800 [twisted.application.app.AppLogger#info] reactor class: twisted.internet.selectreactor.SelectReactor.</span><br><span class="line">2020-05-04T20:02:33+0800 [-] Site starting on 6800</span><br><span class="line">2020-05-04T20:02:33+0800 [twisted.web.server.Site#info] Starting factory &lt;twisted.web.server.Site object at 0x000001ED926976D8&gt;</span><br><span class="line">2020-05-04T20:02:33+0800 [Launcher] Scrapyd 1.2.1 started: max_proc&#x3D;48, runner&#x3D;&#39;scrapyd.runner&#39;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†å¯åŠ¨spiderkeeperï¼Œå‘½ä»¤è¡Œè¾“å…¥spiderkeeperï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">E:\Django+Scrapy\mypro\spiderpro&gt;spiderkeeper</span><br><span class="line">c:\users\administrator\appdata\local\programs\python\python37\lib\site-packages\flask_restful_swagger\swagger.py:14: ExtDeprecationWarning: Importing flask.ext.restful is deprecated, use flask_restful instead.</span><br><span class="line">  from flask.ext.restful import Resource, fields</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">INFO in run [c:\users\administrator\appdata\local\programs\python\python37\lib\site-packages\SpiderKeeper\run.py:22]:</span><br><span class="line">SpiderKeeper startd on 0.0.0.0:5000 username:admin&#x2F;password:admin with scrapyd servers:http:&#x2F;&#x2F;localhost:6800</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">2020-05-04 19:03:15,108 - SpiderKeeper.app - INFO - SpiderKeeper startd on 0.0.0.0:5000 username:admin&#x2F;password:admin with scrapyd servers:http:&#x2F;&#x2F;localhost:6800</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€æµè§ˆå™¨è®¿é—®spiderkeeperçš„åœ°å€ï¼Œæˆ‘è¿™é‡Œæ˜¯127.0.0.1:5000ï¼Œç„¶åè¾“å…¥ç”¨æˆ·åã€å¯†ç ï¼Œé»˜è®¤éƒ½æ˜¯admin </p>
<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/5728077-56dcdfd61bbce401.png" class="">  

<p>è‡³æ­¤ï¼Œç¯å¢ƒå‡†å¤‡å®Œæ¯•ã€‚ </p>
<h3 id="éƒ¨ç½²çˆ¬è™«"><a href="#éƒ¨ç½²çˆ¬è™«" class="headerlink" title="éƒ¨ç½²çˆ¬è™«"></a>éƒ¨ç½²çˆ¬è™«</h3><p>æˆ‘çš„çˆ¬è™«ç¨‹åºæ˜¯åœ¨è‡ªå·±çš„windowsç”µè„‘ä¸Šçš„ï¼Œæ‰“å¼€å‘½ä»¤è¡Œè¿›å…¥åˆ°çˆ¬è™«æ ¹ç›®å½•ï¼š æ‰§è¡Œå‘½ä»¤ï¼š<code>scrapyd-deploy --build-egg output.egg</code>ç”Ÿæˆeggæ–‡ä»¶ã€‚ </p>
<p>ç„¶ååœ¨spiderkeeperå¯è§†åŒ–ç•Œé¢ç‚¹å‡»<code>creat project</code>: </p>
<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/5728077-1a070e0774f35681.png" class="">  

<p>éšä¾¿è¾“å…¥ä¸€ä¸ªåå­—ï¼š </p>
<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/1588594163.png" class="">  

<p>ç‚¹å‡»åˆ›å»ºï¼Œè·³åˆ°è¿™ä¸ªç•Œé¢ï¼š </p>
<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/1588594399.png" class="">  

<p>ä¸Šä¼ eggæ–‡ä»¶ï¼š </p>
<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/1588594926.png" class="">  

<p>ä¸è¦å¿˜è®°ç‚¹å‡»æäº¤</p>
<p>æ­¤æ—¶ï¼Œéƒ¨ç½²å®Œæˆã€‚</p>
<h3 id="è¿è¡Œçˆ¬è™«"><a href="#è¿è¡Œçˆ¬è™«" class="headerlink" title="è¿è¡Œçˆ¬è™«"></a>è¿è¡Œçˆ¬è™«</h3><p>éƒ¨ç½²å®Œåï¼Œç‚¹å‡» Dashboard è¿™ä¸ªæŒ‰é’®ï¼Œå†é€‰æ‹© spiderproé¡¹ç›®ï¼Œç„¶åç‚¹å‡» RunOnce æŒ‰é’®åˆ›å»ºçˆ¬è™«ï¼š </p>
<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/1588595047.png" class="">  

<p>è¿™é‡Œå‚æ•°éƒ½é»˜è®¤å³å¯ï¼š </p>
<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/1588595111.png" class="">  

<p>ç‚¹å‡»åˆ›å»ºçˆ¬è™«æŒ‰é’®ï¼šç„¶ååˆ·æ–°ç½‘é¡µ</p>
<img src="/2020/05/04/SpiderKeeper%E7%9A%84%E4%BD%BF%E7%94%A8/1588595204(1).png" class="">  

<p>è‡³æ­¤ï¼Œçˆ¬è™«è¿è¡Œå®Œæ¯•ã€‚ </p>
<p>æŸ¥çœ‹æ—¥å¿—ç‚¹ log å³å¯ï¼Œåœæ­¢çˆ¬è™«ç‚¹ stop å³å¯ï¼Œå…¶ä»–æ“ä½œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/DormyMo/SpiderKeeper" target="_blank" rel="noopener">https://github.com/DormyMo/SpiderKeeper</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>scrapyd-deployé”™è¯¯</title>
    <url>/2020/05/04/scrapyd-deploy%E9%94%99%E8%AF%AF/</url>
    <content><![CDATA[<h4 id="â€˜scrapyd-deployâ€™-ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶"><a href="#â€˜scrapyd-deployâ€™-ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶" class="headerlink" title="â€˜scrapyd-deployâ€™ ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶"></a>â€˜scrapyd-deployâ€™ ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶</h4><p>åœ¨ç¼–å†™å¥½ python çˆ¬è™«ç¨‹åºï¼Œå‡†å¤‡éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ä¸Šæ—¶ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ scrapyd-deploy mmbuy -p spiderpro</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä¸Šè¿°éƒ¨ç½²çš„ä»£ç æ—¶ï¼ŒæŠ¥é”™ï¼š </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'scrapyd-deploy'</span> ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>



<a id="more"></a>

<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p><strong>1.</strong>  æ‰¾åˆ° Python çš„å®‰è£…è·¯å¾„ï¼Œè¿›å…¥ Scripts æ–‡ä»¶å¤¹ã€‚</p>
<p><strong>2.</strong>  åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œscrapy.bat å’Œ scrapyd-deploy.bat ï¼ˆæ–°å»º txt æ–‡æœ¬æ–‡æ¡£ï¼Œç„¶åæ›´æ”¹åç¼€åä¸º .batï¼‰</p>
<img src="/2020/05/04/scrapyd-deploy%E9%94%99%E8%AF%AF/20181124215946769.png" class="">  

<p><strong>3.</strong>  ç¼–è¾‘ scrapy.bat ï¼ˆå³é”® â€”&gt; ç¼–è¾‘ï¼‰ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜ã€‚ï¼ˆæ³¨ï¼šè·¯å¾„æ”¹æˆè‡ªå·±ç”µè„‘çš„è·¯å¾„ï¼‰ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">C:\Users\Administrator\AppData\Local\Programs\Python\Python37\python.exe C:\Users\Administrator\AppData\Local\Programs\Python\Python37\Scripts\scrapy %*</span><br></pre></td></tr></table></figure>

<p><strong>4.</strong>  åŒæ ·ï¼Œç¼–è¾‘ scrapyd-deploy.bat ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜ã€‚ï¼ˆæ³¨ï¼šè·¯å¾„æ”¹æˆè‡ªå·±ç”µè„‘çš„è·¯å¾„ï¼‰ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">C:\Users\Administrator\AppData\Local\Programs\Python\Python37\python.exe C:\Users\Administrator\AppData\Local\Programs\Python\Python37\Scripts\scrapyd-deploy %*</span><br></pre></td></tr></table></figure>

<p><strong>5.</strong>  ä¸¤ä¸ªæ–‡ä»¶ä¿å­˜ä¹‹åï¼Œé‡æ–°è¿è¡Œéƒ¨ç½²æŒ‡ä»¤ï¼ŒæˆåŠŸã€‚ </p>
<p><strong>6.</strong>  åœ¨è¿™é‡Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œå°±æ˜¯æœ‰äººçš„ Python è·¯å¾„å¹¶éå…¨è‹±æ–‡ï¼Œè·¯å¾„ä¸­ä¼šæœ‰ç©ºæ ¼ã€æˆ–è€…ä¸­æ–‡ï¼Œå¯èƒ½ä¼šæŠ¥é”™ã€‚</p>
<p>â€‹     è¿™ä¸ªé—®é¢˜è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨å¸¦æœ‰ç©ºæ ¼ / ä¸­æ–‡çš„è·¯å¾„ä¸¤è¾¹æ‰“åŒå¼•å·ï¼ˆè‹±æ–‡åŒå¼•å·ï¼‰å³å¯ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">&quot;C:\ç”¨æˆ·\Administrator\AppData\Local\Programs\Python\Python37\python.exe&quot; C:\Users\Administrator\AppData\Local\Programs\Python\Python37\Scripts\scrapyd-deploy %*</span><br></pre></td></tr></table></figure>

<p><strong>7.</strong>å¯ä»¥æµ‹è¯•ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">C:\Users\Administrator&gt;scrapyd-deploy -h</span><br><span class="line">C:\Users\Administrator\AppData\Local\Programs\Python\Python37\Scripts\scrapyd-deploy:23: ScrapyDeprecationWarning: Module &#96;scrapy.utils.http&#96; is deprecated, Please import from &#96;w3lib.http&#96; instead.</span><br><span class="line">  from scrapy.utils.http import basic_auth_header</span><br><span class="line">Usage: scrapyd-deploy [options] [ [target] | -l | -L &lt;target&gt; ]</span><br><span class="line"></span><br><span class="line">Deploy Scrapy project to Scrapyd server</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -p PROJECT, --project&#x3D;PROJECT</span><br><span class="line">                        the project name in the target</span><br><span class="line">  -v VERSION, --version&#x3D;VERSION</span><br><span class="line">                        the version to deploy. Defaults to current timestamp</span><br><span class="line">  -l, --list-targets    list available targets</span><br><span class="line">  -a, --deploy-all-targets</span><br><span class="line">                        deploy all targets</span><br><span class="line">  -d, --debug           debug mode (do not remove build dir)</span><br><span class="line">  -L TARGET, --list-projects&#x3D;TARGET</span><br><span class="line">                        list available projects on TARGET</span><br><span class="line">  --egg&#x3D;FILE            use the given egg, instead of building it</span><br><span class="line">  --build-egg&#x3D;FILE      only build the egg, don&#39;t deploy it</span><br></pre></td></tr></table></figure>

<p><strong>è¿™æ ·å°±æˆåŠŸäº†</strong></p>
<h4 id="åœ¨æ‰§è¡Œå‘½ä»¤ï¼šscrapyd-deployæ—¶é‡æŠ¥é”™ï¼š"><a href="#åœ¨æ‰§è¡Œå‘½ä»¤ï¼šscrapyd-deployæ—¶é‡æŠ¥é”™ï¼š" class="headerlink" title="åœ¨æ‰§è¡Œå‘½ä»¤ï¼šscrapyd-deployæ—¶é‡æŠ¥é”™ï¼š"></a>åœ¨æ‰§è¡Œå‘½ä»¤ï¼šscrapyd-deployæ—¶é‡æŠ¥é”™ï¼š</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">E:\Django+Scrapy\mypro\spiderpro&gt;scrapyd-deploy demo -p spiderpro</span><br><span class="line">ScrapyDeprecationWarning: Module `scrapy.utils.http` <span class="keyword">is</span> deprecated, Please <span class="keyword">import</span> <span class="keyword">from</span> `w3lib.http` instead.</span><br><span class="line"><span class="keyword">from</span> scrapy.utils.http <span class="keyword">import</span> basic_auth_header</span><br></pre></td></tr></table></figure>

<p>  ä¹ä¸€çœ‹ä»¥ä¸ºæ˜¯è·¯å¾„é—®é¢˜å¯¼è‡´æ‰¾ä¸åˆ°scrapyé¡¹ç›®ï¼Œå…¶å®ä¸ç„¶ï¼ŒæŠ¥é”™å·²ç»è¯´æ˜ï¼Œç”±äºåº•å±‚scrapyd-deployçš„æ¨¡å—â€˜scrapy.utils.httpâ€™å·²ç»å¼ƒç”¨ï¼Œå»ºè®®æ›´æ–°ä¸º<code>w3lib.http</code>æ›¿ä»£ è§£å†³åŠæ³•å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹åº•å±‚ä»£ç å³å¯ï¼š </p>
<img src="/2020/05/04/scrapyd-deploy%E9%94%99%E8%AF%AF/1541850-20200222125238828-40383557.png" class="">  

<p>å†æ¬¡è¿è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">E:\Django+Scrapy\mypro\spiderpro&gt;scrapyd-deploy demo -p spiderpro</span><br><span class="line">Packing version <span class="number">1588585484</span></span><br><span class="line">Deploying to project <span class="string">"spiderpro"</span> <span class="keyword">in</span> http://localhost:<span class="number">6800</span>/addversion.json</span><br><span class="line">Server response (<span class="number">200</span>):</span><br><span class="line">&#123;<span class="string">"node_name"</span>: <span class="string">"PC-20200326UBAK"</span>, <span class="string">"status"</span>: <span class="string">"ok"</span>, <span class="string">"project"</span>: <span class="string">"spiderpro"</span>, <span class="string">"version"</span>: <span class="string">"1588585484"</span>, <span class="string">"spiders"</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<p>ğŸ˜Š</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Celery</title>
    <url>/2020/05/03/Celery/</url>
    <content><![CDATA[<h4 id="ä»€ä¹ˆæ˜¯Celery"><a href="#ä»€ä¹ˆæ˜¯Celery" class="headerlink" title="ä»€ä¹ˆæ˜¯Celery"></a>ä»€ä¹ˆæ˜¯Celery</h4><p>Celery æ˜¯ä¸€ä¸ª åŸºäºpythonå¼€å‘çš„åˆ†å¸ƒå¼å¼‚æ­¥æ¶ˆæ¯ä»»åŠ¡é˜Ÿåˆ—ï¼Œé€šè¿‡å®ƒå¯ä»¥è½»æ¾çš„å®ç°ä»»åŠ¡çš„å¼‚æ­¥å¤„ç† </p>
<h4 id="Celeryçš„ä¼˜ç‚¹"><a href="#Celeryçš„ä¼˜ç‚¹" class="headerlink" title="Celeryçš„ä¼˜ç‚¹"></a>Celeryçš„ä¼˜ç‚¹</h4><p>ç®€å•ï¼šä¸€æ—¦ç†Ÿæ‚‰celeryçš„å·¥ä½œæµç¨‹åï¼Œé…ç½®å’Œä½¿ç”¨è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ </p>
<p>é«˜å¯ç”¨ï¼šå½“ä»»åŠ¡æ‰§è¡Œå¤±è´¥æˆ–æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé“¾æ¥ä¸­æ–­ï¼Œceleryä¼šè‡ªåŠ¨å°è¯•é‡æ–°æ‰§è¡Œä»»åŠ¡ </p>
<p>å¿«é€Ÿï¼šä¸€ä¸ªå•è¿›ç¨‹çš„celeryæ²¡åˆ†é’Ÿå¯å¤„ç†ä¸Šç™¾ä¸‡ä¸ªä»»åŠ¡ </p>
<p>çµæ´»ï¼šå‡ ä¹celeryçš„å„ä¸ªç»„ä»¶éƒ½å¯ä»¥è¢«æ‰©å±•åŠè‡ªå®šåˆ¶ </p>
<a id="more"></a>

<h4 id="Celeryæ¶æ„"><a href="#Celeryæ¶æ„" class="headerlink" title="Celeryæ¶æ„"></a>Celeryæ¶æ„</h4><img src="/2020/05/03/Celery/2522678-d369b6a4c4265225.png" class="">  

<p>Celeryçš„æ¶æ„ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œæ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆmessage brokerï¼‰ï¼Œä»»åŠ¡æ‰§è¡Œå•å…ƒï¼ˆworkerï¼‰å’Œä»»åŠ¡æ‰§è¡Œç»“æœå­˜å‚¨ï¼ˆtask result storeï¼‰ç»„æˆã€‚ </p>
<h5 id="æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶"></a>æ¶ˆæ¯ä¸­é—´ä»¶</h5><p>Celeryæœ¬èº«ä¸æä¾›æ¶ˆæ¯æœåŠ¡ï¼Œä½†æ˜¯å¯ä»¥æ–¹ä¾¿çš„å’Œç¬¬ä¸‰æ–¹æä¾›çš„æ¶ˆæ¯ä¸­é—´ä»¶é›†æˆã€‚åŒ…æ‹¬ï¼ŒRabbitMQ, Redisç­‰ç­‰</p>
<h5 id="ä»»åŠ¡æ‰§è¡Œå•å…ƒ"><a href="#ä»»åŠ¡æ‰§è¡Œå•å…ƒ" class="headerlink" title="ä»»åŠ¡æ‰§è¡Œå•å…ƒ"></a>ä»»åŠ¡æ‰§è¡Œå•å…ƒ</h5><p>Workeræ˜¯Celeryæä¾›çš„ä»»åŠ¡æ‰§è¡Œçš„å•å…ƒï¼Œworkerå¹¶å‘çš„è¿è¡Œåœ¨åˆ†å¸ƒå¼çš„ç³»ç»ŸèŠ‚ç‚¹ä¸­ã€‚</p>
<h5 id="ä»»åŠ¡ç»“æœå­˜å‚¨"><a href="#ä»»åŠ¡ç»“æœå­˜å‚¨" class="headerlink" title="ä»»åŠ¡ç»“æœå­˜å‚¨"></a>ä»»åŠ¡ç»“æœå­˜å‚¨</h5><p>Task result storeç”¨æ¥å­˜å‚¨Workeræ‰§è¡Œçš„ä»»åŠ¡çš„ç»“æœï¼ŒCeleryæ”¯æŒä»¥ä¸åŒæ–¹å¼å­˜å‚¨ä»»åŠ¡çš„ç»“æœï¼ŒåŒ…æ‹¬AMQP, redisç­‰</p>
<h4 id="ç‰ˆæœ¬æ”¯æŒæƒ…å†µ"><a href="#ç‰ˆæœ¬æ”¯æŒæƒ…å†µ" class="headerlink" title="ç‰ˆæœ¬æ”¯æŒæƒ…å†µ"></a>ç‰ˆæœ¬æ”¯æŒæƒ…å†µ</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Celery version <span class="number">4.0</span> runs on</span><br><span class="line">        Python â¨<span class="number">2.7</span>, <span class="number">3.4</span>, <span class="number">3.5</span>â©</span><br><span class="line">        PyPy â¨<span class="number">5.4</span>, <span class="number">5.5</span>â©</span><br><span class="line">    This <span class="keyword">is</span> the last version to support Python <span class="number">2.7</span>, <span class="keyword">and</span> <span class="keyword">from</span> the next version (Celery <span class="number">5.</span>x) Python <span class="number">3.5</span> <span class="keyword">or</span> newer <span class="keyword">is</span> required.</span><br><span class="line"></span><br><span class="line">    If youâ€™re running an older version of Python, you need to be running an older version of Celery:</span><br><span class="line"></span><br><span class="line">        Python <span class="number">2.6</span>: Celery series <span class="number">3.1</span> <span class="keyword">or</span> earlier.</span><br><span class="line">        Python <span class="number">2.5</span>: Celery series <span class="number">3.0</span> <span class="keyword">or</span> earlier.</span><br><span class="line">        Python <span class="number">2.4</span> was Celery series <span class="number">2.2</span> <span class="keyword">or</span> earlier.</span><br><span class="line"></span><br><span class="line">    Celery <span class="keyword">is</span> a project <span class="keyword">with</span> minimal funding, so we donâ€™t support Microsoft Windows. Please donâ€™t open any issues related to that platform.</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Scrapyæ¡†æ¶</title>
    <url>/2020/05/02/Scrapy%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h4 id="1-scrapyå®‰è£…ä¸ç¯å¢ƒä¾èµ–"><a href="#1-scrapyå®‰è£…ä¸ç¯å¢ƒä¾èµ–" class="headerlink" title="1.scrapyå®‰è£…ä¸ç¯å¢ƒä¾èµ–"></a>1.scrapyå®‰è£…ä¸ç¯å¢ƒä¾èµ–</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.åœ¨å®‰è£…scrapyå‰éœ€è¦å®‰è£…å¥½ç›¸åº”çš„ä¾èµ–åº“, å†å®‰è£…scrapy, å…·ä½“å®‰è£…æ­¥éª¤å¦‚ä¸‹:</span></span><br><span class="line">    (<span class="number">1</span>).å®‰è£…lxmlåº“: pip install lxml</span><br><span class="line">    (<span class="number">2</span>).å®‰è£…wheel: pip install wheel</span><br><span class="line">    (<span class="number">3</span>).å®‰è£…twisted: pip install twistedæ–‡ä»¶è·¯å¾„</span><br><span class="line">    	(twistedéœ€ä¸‹è½½åæœ¬åœ°å®‰è£…,ä¸‹è½½åœ°å€:http://www.lfd.uci.edu/~gohlke/pythonlibs/<span class="comment">#twisted)</span></span><br><span class="line">    	(ç‰ˆæœ¬é€‰æ‹©å¦‚ä¸‹å›¾,ç‰ˆæœ¬åé¢æœ‰è§£é‡Š,è¯·æ ¹æ®è‡ªå·±å®é™…é€‰æ‹©)</span><br><span class="line">    (<span class="number">4</span>).å®‰è£…pywin32: pip install pywin32</span><br><span class="line">    	(æ³¨æ„:ä»¥ä¸Šå®‰è£…æ­¥éª¤ä¸€å®šè¦ç¡®ä¿æ¯ä¸€æ­¥å®‰è£…éƒ½æˆåŠŸ,æ²¡æœ‰æŠ¥é”™ä¿¡æ¯,å¦‚æœ‰æŠ¥é”™è‡ªè¡Œç™¾åº¦è§£å†³)</span><br><span class="line">    (<span class="number">5</span>).å®‰è£…scrapy: pip install scrapy</span><br><span class="line">    	(æ³¨æ„:ä»¥ä¸Šå®‰è£…æ­¥éª¤ä¸€å®šè¦ç¡®ä¿æ¯ä¸€æ­¥å®‰è£…éƒ½æˆåŠŸ,æ²¡æœ‰æŠ¥é”™ä¿¡æ¯,å¦‚æœ‰æŠ¥é”™è‡ªè¡Œç™¾åº¦è§£å†³)</span><br><span class="line">    (<span class="number">6</span>).æˆåŠŸéªŒè¯:åœ¨cmdå‘½ä»¤è¡Œè¾“å…¥scrapy,æ˜¾ç¤ºScrapy1<span class="number">.6</span><span class="number">.0</span>-no active project,è¯æ˜å®‰è£…æˆåŠŸ</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<img src="/2020/05/02/Scrapy%E6%A1%86%E6%9E%B6/1323490-20190610094141435-249109686.png" class="">  



<h4 id="2-åˆ›å»ºé¡¹ç›®"><a href="#2-åˆ›å»ºé¡¹ç›®" class="headerlink" title="2.åˆ›å»ºé¡¹ç›®"></a>2.åˆ›å»ºé¡¹ç›®</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªç›®å½•test</span><br><span class="line"><span class="number">2.</span>åœ¨testæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºçˆ¬è™«é¡¹ç›®ä¸ºspiderpro: scrapy startproject spiderpro</span><br><span class="line"><span class="number">3.</span>è¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹: cd spiderpro</span><br><span class="line"><span class="number">4.</span>åˆ›å»ºçˆ¬è™«æ–‡ä»¶: scrapy genspider çˆ¬è™«å åŸŸå</span><br></pre></td></tr></table></figure>

<h4 id="3-é¡¹ç›®ç›®å½•ä»‹ç»"><a href="#3-é¡¹ç›®ç›®å½•ä»‹ç»" class="headerlink" title="3.é¡¹ç›®ç›®å½•ä»‹ç»"></a>3.é¡¹ç›®ç›®å½•ä»‹ç»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">spiderpro</span><br><span class="line">ã€€ã€€spiderpro <span class="comment"># é¡¹ç›®ç›®å½•</span></span><br><span class="line">ã€€ã€€ã€€ã€€__init__</span><br><span class="line">ã€€ã€€ã€€ã€€spiders:çˆ¬è™«æ–‡ä»¶ç›®å½•</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€__init__</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€tests.py:çˆ¬è™«æ–‡ä»¶</span><br><span class="line">ã€€ã€€ã€€ã€€items.py:å®šä¹‰çˆ¬å–æ•°æ®æŒä¹…åŒ–çš„æ•°æ®ç»“æ„</span><br><span class="line">ã€€ã€€ã€€ã€€middlewares.py:å®šä¹‰ä¸­é—´ä»¶</span><br><span class="line">ã€€ã€€ã€€ã€€pipelines.py:ç®¡é“,æŒä¹…åŒ–å­˜å‚¨ç›¸å…³</span><br><span class="line">ã€€ã€€ã€€ã€€settings.py:é…ç½®æ–‡ä»¶</span><br><span class="line">ã€€ã€€venv:è™šæ‹Ÿç¯å¢ƒç›®å½•</span><br><span class="line">ã€€ scrapy.cfg: scrapyé¡¹ç›®é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p><strong>è¯´æ˜:</strong><br>ã€€ã€€(1).spiders:å…¶å†…åŒ…å«ä¸€ä¸ªä¸ªSpiderçš„å®ç°, æ¯ä¸ªSpideræ˜¯ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶<br>ã€€ã€€(2).items.py:å®ƒå®šä¹‰äº†Itemæ•°æ®ç»“æ„, çˆ¬å–åˆ°çš„æ•°æ®å­˜å‚¨ä¸ºå“ªäº›å­—æ®µ<br>ã€€ã€€(3).pipelines.py:å®ƒå®šä¹‰Item Pipelineçš„å®ç°<br>ã€€ã€€(4).settings.py:é¡¹ç›®çš„å…¨å±€é…ç½®<br>ã€€ã€€(5).middlewares.py:å®šä¹‰ä¸­é—´ä»¶, åŒ…æ‹¬çˆ¬è™«ä¸­é—´ä»¶å’Œä¸‹è½½ä¸­é—´ä»¶<br>ã€€ã€€(6).scrapy.cfg:å®ƒæ˜¯scrapyé¡¹ç›®çš„é…ç½®æ–‡ä»¶, å…¶å†…å®šä¹‰äº†é¡¹ç›®çš„é…ç½®è·¯å¾„, éƒ¨ç½²ç›¸å…³çš„ä¿¡æ¯ç­‰</p>
<h4 id="4-scrapyæ¡†æ¶ä»‹ç»-5å¤§æ ¸å¿ƒç»„ä»¶ä¸æ•°æ®æµå‘"><a href="#4-scrapyæ¡†æ¶ä»‹ç»-5å¤§æ ¸å¿ƒç»„ä»¶ä¸æ•°æ®æµå‘" class="headerlink" title="4.scrapyæ¡†æ¶ä»‹ç»: 5å¤§æ ¸å¿ƒç»„ä»¶ä¸æ•°æ®æµå‘"></a>4.scrapyæ¡†æ¶ä»‹ç»: 5å¤§æ ¸å¿ƒç»„ä»¶ä¸æ•°æ®æµå‘</h4><img src="/2020/05/02/Scrapy%E6%A1%86%E6%9E%B6/1323490-20190610094204518-1935146640.png" class="">  

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>).æ¶æ„:</span><br><span class="line"></span><br><span class="line">ã€€ã€€Scrapy Engine: è¿™æ˜¯å¼•æ“ï¼Œè´Ÿè´£Spidersã€ItemPipelineã€Downloaderã€Schedulerä¸­é—´çš„é€šè®¯ï¼Œä¿¡å·ã€æ•°æ®ä¼ é€’ç­‰ç­‰!</span><br><span class="line"></span><br><span class="line">ã€€ã€€Scheduler(è°ƒåº¦å™¨): å®ƒè´Ÿè´£æ¥å—å¼•æ“å‘é€è¿‡æ¥çš„requestsè¯·æ±‚ï¼Œå¹¶æŒ‰ç…§ä¸€å®šçš„æ–¹å¼è¿›è¡Œæ•´ç†æ’åˆ—ï¼Œå…¥é˜Ÿã€å¹¶ç­‰å¾…Scrapy Engine(å¼•æ“)æ¥è¯·æ±‚æ—¶ï¼Œäº¤ç»™å¼•æ“ã€‚</span><br><span class="line"></span><br><span class="line">ã€€ã€€Downloaderï¼ˆä¸‹è½½å™¨)ï¼šè´Ÿè´£ä¸‹è½½Scrapy Engine(å¼•æ“)å‘é€çš„æ‰€æœ‰Requestsè¯·æ±‚ï¼Œå¹¶å°†å…¶è·å–åˆ°çš„Responsesäº¤è¿˜ç»™Scrapy Engine(å¼•æ“)ï¼Œç”±å¼•æ“äº¤ç»™Spidersæ¥å¤„ç†ï¼Œ</span><br><span class="line"></span><br><span class="line">ã€€ã€€Spidersï¼šå®ƒè´Ÿè´£å¤„ç†æ‰€æœ‰Responses,ä»ä¸­åˆ†ææå–æ•°æ®ï¼Œè·å–Itemå­—æ®µéœ€è¦çš„æ•°æ®ï¼Œå¹¶å°†éœ€è¦è·Ÿè¿›çš„URLæäº¤ç»™å¼•æ“ï¼Œå†æ¬¡è¿›å…¥Scheduler(è°ƒåº¦å™¨)ï¼Œ</span><br><span class="line"></span><br><span class="line">ã€€ã€€Item Pipelineï¼šå®ƒè´Ÿè´£å¤„ç†Spidersä¸­è·å–åˆ°çš„Itemï¼Œå¹¶è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚å»é‡ï¼ŒæŒä¹…åŒ–å­˜å‚¨ï¼ˆå­˜æ•°æ®åº“ï¼Œå†™å…¥æ–‡ä»¶ï¼Œæ€»ä¹‹å°±æ˜¯ä¿å­˜æ•°æ®ç”¨çš„ï¼‰</span><br><span class="line"></span><br><span class="line">ã€€ã€€Downloader Middlewares(ä¸‹è½½ä¸­é—´ä»¶)ï¼šä½ å¯ä»¥å½“ä½œæ˜¯ä¸€ä¸ªå¯ä»¥è‡ªå®šä¹‰æ‰©å±•ä¸‹è½½åŠŸèƒ½çš„ç»„ä»¶</span><br><span class="line"></span><br><span class="line">ã€€ã€€Spider Middlewares(Spiderä¸­é—´ä»¶)ï¼šä½ å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥è‡ªå®šæ‰©å±•å’Œæ“ä½œå¼•æ“å’ŒSpidersä¸­é—´â€˜é€šä¿¡â€˜çš„åŠŸèƒ½ç»„ä»¶ï¼ˆæ¯”å¦‚è¿›å…¥Spidersçš„Responses;å’Œä»Spiderså‡ºå»çš„Requestsï¼‰</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="number">2</span>).å·¥ä½œæµ:</span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="number">1.</span>spiderå°†è¯·æ±‚å‘é€ç»™å¼•æ“, å¼•æ“å°†requestå‘é€ç»™è°ƒåº¦å™¨è¿›è¡Œè¯·æ±‚è°ƒåº¦</span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="number">2.</span>è°ƒåº¦å™¨æŠŠæ¥ä¸‹æ¥è¦è¯·æ±‚çš„requestå‘é€ç»™å¼•æ“, å¼•æ“ä¼ é€’ç»™ä¸‹è½½å™¨, ä¸­é—´ä¼šé€”å¾„ä¸‹è½½ä¸­é—´ä»¶</span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="number">3.</span>ä¸‹è½½æºå¸¦requestè®¿é—®æœåŠ¡å™¨, å¹¶å°†çˆ¬å–å†…å®¹responseè¿”å›ç»™å¼•æ“, å¼•æ“å°†responseè¿”å›ç»™spider</span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="number">4.</span>spiderå°†responseä¼ é€’ç»™è‡ªå·±çš„parseè¿›è¡Œæ•°æ®è§£æå¤„ç†åŠæ„å»ºitemä¸€ç³»åˆ—çš„å·¥ä½œ, æœ€åå°†itemè¿”å›ç»™å¼•æ“, å¼•æ“ä¼ é€’ä¸ªpipeline</span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="number">5.</span>pipeè·å–åˆ°itemåè¿›è¡Œæ•°æ®æŒä¹…åŒ–</span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="number">6.</span>ä»¥ä¸Šè¿‡ç¨‹ä¸æ–­å¾ªç¯ç›´è‡³çˆ¬è™«ç¨‹åºç»ˆæ­¢</span><br></pre></td></tr></table></figure>

<h4 id="5-ä½¿ç”¨scrapyæ¡†æ¶çˆ¬å–æ…¢æ…¢ä¹°"><a href="#5-ä½¿ç”¨scrapyæ¡†æ¶çˆ¬å–æ…¢æ…¢ä¹°" class="headerlink" title="5.ä½¿ç”¨scrapyæ¡†æ¶çˆ¬å–æ…¢æ…¢ä¹°"></a>5.ä½¿ç”¨scrapyæ¡†æ¶çˆ¬å–æ…¢æ…¢ä¹°</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éœ€æ±‚: çˆ¬å–æ…¢æ…¢ä¹°æ‰‹æœºæ¿å—,æ¯ä¸€æ¡çš„æ ‡é¢˜ã€å›¾ç‰‡ã€ä»·æ ¼ã€é”€å”®æ•°é‡,è§£æçˆ¬å–çš„ä¿¡æ¯æ•°æ®,å®šåˆ¶itemæ•°æ®å­˜å‚¨ç»“æ„,æœ€ç»ˆå°†æ•°æ®å­˜å‚¨äºMongoDBæ•°æ®åº“ä¸­.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé¡¹ç›®:</span></span><br><span class="line">scrapy startproject spiderpro <span class="comment"># åˆ›å»ºé¡¹ç›®</span></span><br><span class="line">cd spiderpro <span class="comment"># åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•</span></span><br><span class="line">scrapy genspider mmbuy http://www.manmanbuy.com <span class="comment"># åˆ›å»ºçˆ¬è™«æ–‡ä»¶, qsbk_hotä¸ºçˆ¬è™«å, www...comä¸ºçˆ¬å–èŒƒå›´</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpiderproItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">    title = scrapy.Field() 	<span class="comment"># æ ‡é¢˜</span></span><br><span class="line">    imgs = scrapy.Field()	<span class="comment">#å›¾ç‰‡</span></span><br><span class="line">    price = scrapy.Field()	<span class="comment">#ä»·æ ¼</span></span><br><span class="line">    number = scrapy.Field(	<span class="comment">#é”€å”®æ•°é‡</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># spideræ–‡ä»¶ä¸­å®šä¹‰è§£ææ•°æ®çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> ..items <span class="keyword">import</span> SpiderproItem</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MmbuySpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'mmbuy'</span></span><br><span class="line">    <span class="comment"># allowed_domains = ['baidu.com']	æ— ç”¨, å¯æ³¨é‡Šæ‰</span></span><br><span class="line">    start_urls = list(<span class="string">'http://www.manmanbuy.com/cpl_57_qz_0_0_0_0_0_0_0_0_0_0_0_%s.aspx'</span>%page <span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        </span><br><span class="line">        li_list = response.xpath(<span class="string">'//*[@id="ctl00_ContentPlaceMain_prolist"]/div[2]/ul'</span>)</span><br><span class="line">	    <span class="comment"># å¾ªç¯liæ ‡ç­¾ç»„æˆçš„åˆ—è¡¨, å…ˆå®ä¾‹åŒ–item, å†å–éœ€è¦çš„å­—æ®µ, å¹¶è¯¥itemå¯¹è±¡çš„ç›¸åº”å±æ€§èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> li_list:</span><br><span class="line">            <span class="comment"># å®ä¾‹åŒ–itemå¯¹è±¡</span></span><br><span class="line">            item = SpiderproItem()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># è§£æè·å–title(æ ‡é¢˜), price(ä»·æ ¼), number(é”€å”®æ•°é‡), imgs(å›¾ç‰‡)ç­‰ä¿¡æ¯</span></span><br><span class="line">            title = i.xpath(<span class="string">'.//div[@class="name"]/a/@title'</span>).extract_first()</span><br><span class="line">            price = i.xpath(<span class="string">'.//div[@class="price"]/text()'</span>).extract_first()</span><br><span class="line">            number = i.xpath(<span class="string">'.//div[@class="sales"]/span/text()'</span>).extract_first()</span><br><span class="line">            imgs = i.xpath(<span class="string">'.//div[@class="pic"]/a/img/@original'</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            item[<span class="string">'title'</span>] = title</span><br><span class="line">            item[<span class="string">'imgs'</span>] = imgs</span><br><span class="line">            item[<span class="string">'price'</span>] = price</span><br><span class="line">            item[<span class="string">'number'</span>] = number</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=imgs,callback=self.img_parse,meta=&#123;<span class="string">'item'</span>:item&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">img_parse</span><span class="params">(self,response)</span>:</span></span><br><span class="line">        content = response.body</span><br><span class="line">        item = response.meta[<span class="string">'item'</span>]</span><br><span class="line">        item[<span class="string">'imgs'</span>] = content</span><br><span class="line">        <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨pipelineä¸­å®šä¹‰ç®¡é“ç±»è¿›è¡Œæ•°æ®çš„å­˜å‚¨</span></span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpiderproPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment">#è¿æ¥MongoDBæ•°æ®åº“</span></span><br><span class="line">    conn = pymongo.MongoClient(<span class="string">"localhost"</span>, <span class="number">27017</span>)</span><br><span class="line">    db = conn.manmanbuy</span><br><span class="line">    table = db.mmy</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        <span class="comment"># å‘æ•°æ®åº“ä¸­å‡ºå…¥æ•°æ®</span></span><br><span class="line">        self.table.insert_one(dict(item))</span><br><span class="line">        <span class="comment"># æ­¤å¤„return itemæ˜¯ä¸ºäº†ä¸‹ä¸€ä¸ªç®¡é“ç±»èƒ½å¤Ÿæ¥æ”¶åˆ°itemè¿›è¡Œå­˜å‚¨</span></span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">ã€€ã€€</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self)</span>:</span></span><br><span class="line">ã€€ã€€ã€€ã€€<span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">ã€€ã€€ã€€ã€€self.conn.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­¤ç¤ºä¾‹ä¸­é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®çš„é¡¹, æ³¨æ„æ˜¯ä¸æ˜¯å…¨éƒ¨çš„é…ç½®, æ˜¯é’ˆå¯¹è¯¥é¡¹ç›®å¢åŠ æˆ–ä¿®æ”¹çš„é…ç½®é¡¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿½ç•¥robotsåè®®</span></span><br><span class="line">ROBOTSTXT_OBEY =<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># UAä¼ªè£…</span></span><br><span class="line">USER_AGENT = <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.87 Safari/537.36'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®¡é“ç±»çš„æ³¨å†Œé…ç½®</span></span><br><span class="line">ITEM_PIPELINES =&#123;</span><br><span class="line"><span class="string">'qsbk.pipelines.QsbkPipeline'</span>:<span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¿è¡Œçˆ¬è™«</span></span><br><span class="line">scrapy crawl mmbuy --no log		<span class="comment">#ä¸æ‰“å°æ—¥å¿—</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos7ä¸‹å®‰è£…MongoDB</title>
    <url>/2020/05/01/Centos7%E4%B8%8B%E5%AE%89%E8%A3%85MongoDB/</url>
    <content><![CDATA[<p>å®‰è£…å‰æ³¨æ„: æ­¤æ•™ç¨‹æ˜¯é€šè¿‡yumå®‰è£…çš„.ä»…é™64ä½centosç³»ç»Ÿ </p>
<p>å®‰è£…æ­¥éª¤ï¼š</p>
<p>1 ã€åˆ›å»ºä»“åº“æ–‡ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vi /etc/yum.repos.d/mongodb-org<span class="number">-3.4</span>.repo</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¤åˆ¶ä¸‹é¢é…ç½®,ä¿å­˜é€€å‡º </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[mongodb-org<span class="number">-3.4</span>]</span><br><span class="line">name=MongoDB Repository</span><br><span class="line">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/<span class="number">3.4</span>/x86_64/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgkey=https://www.mongodb.org/static/pgp/server<span class="number">-3.4</span>.asc</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>2ã€yumå®‰è£… </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">yum install -y mongodb-org</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰æƒé™å°±åœ¨å‰é¢åŠ ï¼šsudo</p>
<p>å®‰è£…å®Œæ¯•åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vi /etc/mongod.conf</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é…ç½®æ–‡ä»¶çš„ <code>bind_ip,</code> é»˜è®¤æ˜¯ <code>127.0.0.1 åªé™äºæœ¬æœºè¿æ¥</code>ã€‚æ‰€ä»¥å®‰è£…å®Œæˆåå¿…é¡»æŠŠè¿™ä¸ªä¿®æ”¹ä¸º 0.0.0.0 ,å¦åˆ™é€šè¿‡åˆ«çš„æœºå™¨æ˜¯æ²¡æ³•è¿æ¥çš„! </p>
<p>3ã€å¯åŠ¨ã€åœæ­¢ã€é‡å¯</p>
<p>MongoDBé»˜è®¤å°†æ•°æ®æ–‡ä»¶å­˜å‚¨åœ¨<code>/var/lib/mongo</code>ç›®å½•ï¼Œé»˜è®¤æ—¥å¿—æ–‡ä»¶åœ¨<code>/var/log/mongodb</code>ä¸­ã€‚å¦‚æœè¦ä¿®æ”¹,å¯ä»¥åœ¨ <code>/etc/mongod.conf</code> é…ç½®ä¸­æŒ‡å®šå¤‡ç”¨æ—¥å¿—å’Œæ•°æ®æ–‡ä»¶ç›®å½•ã€‚ </p>
<p>å¯åŠ¨å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">service mongod start</span><br></pre></td></tr></table></figure>

<p>åœæ­¢å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">service mongod stop</span><br></pre></td></tr></table></figure>

<p>é‡å¯å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">service mongod restart</span><br></pre></td></tr></table></figure>



<p>æŸ¥çœ‹mongoDBæ˜¯å¦å¯åŠ¨æˆåŠŸ:</p>
<p>å¯ä»¥é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;log&#x2F;mongodb&#x2F;mongod.log</span><br></pre></td></tr></table></figure>

<p> æ—¥å¿—æ–‡ä»¶åº”è¯¥ä¼šå‡ºç°å¦‚ä¸‹ä¸€å¥è¯´æ˜ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[initandlisten] waiting for connections on port &lt;port&gt;</span><br></pre></td></tr></table></figure>

<p>port æ˜¯mongodbè¿è¡Œç«¯å£</p>
<p>è®¾ç½®å¼€æœºå¯åŠ¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chkconfig mongod on</span><br></pre></td></tr></table></figure>

<p>4ã€ä½¿ç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># mongo</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## æŸ¥çœ‹æ•°æ®åº“</span></span><br><span class="line">&gt; show dbs;</span><br><span class="line"> </span><br><span class="line"><span class="comment">## æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬</span></span><br><span class="line">&gt; db.version();</span><br><span class="line"> </span><br><span class="line"><span class="comment">## å¸¸ç”¨å‘½ä»¤å¸®åŠ©</span></span><br><span class="line">&gt; db.help();</span><br></pre></td></tr></table></figure>

<p>5ã€å¸è½½ç§»é™¤MongoDB</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum erase $(rpm -qa | grep mongodb-org)</span><br></pre></td></tr></table></figure>

<p>6ã€ç§»é™¤æ•°æ®åº“æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rm -r /var/log/mongodb</span><br><span class="line">rm -r /var/lib/mongo</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>python3.7+Django2.0.4é…åˆvue.js2.0å®ç°åˆæ‹äº‘(upyun.com)å­˜å‚¨çš„å¼‚æ­¥æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</title>
    <url>/2020/04/22/python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E5%AE%9E%E7%8E%B0%E5%8F%88%E6%8B%8D%E4%BA%91-upyun-com-%E5%AD%98%E5%82%A8%E7%9A%84%E5%BC%82%E6%AD%A5%E6%8B%96%E6%8B%BD%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<p>æœ¬æ¬¡æ–‡ç« è®°å½•ä¸€ä¸‹ä½¿ç”¨python3.7+Django2.0.4é…åˆvue.js2.0å®ç°åˆæ‹äº‘(upyun.com)å­˜å‚¨çš„å¼‚æ­¥æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚ </p>
<p>é¦–å…ˆæ³¨å†Œåˆæ‹äº‘ upyun.cm</p>
<a id="more"></a>

<p>å…¶ååœ¨äº‘å­˜å‚¨æœåŠ¡ä¸­ç‚¹é€‰ï¼Œæ–°å»ºä¸€ä¸ªäº‘ç©ºé—´æœåŠ¡</p>
<img src="/2020/04/22/python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E5%AE%9E%E7%8E%B0%E5%8F%88%E6%8B%8D%E4%BA%91-upyun-com-%E5%AD%98%E5%82%A8%E7%9A%84%E5%BC%82%E6%AD%A5%E6%8B%96%E6%8B%BD%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD/20200321080307_31537.png" class="">  

<p>è®°å½•ä¸€ä¸‹æœåŠ¡åç§°ï¼Œå¦‚æœæ‰‹é‡Œæœ‰å¤‡æ¡ˆåŸŸåçš„è¯ï¼Œå¯ä»¥åˆ†ä¸€ä¸ªäºŒçº§åŸŸåå‡ºæ¥ç»‘å®šä¸€ä¸‹åŠ é€ŸåŸŸå</p>
<p>éšåç‚¹å‡»é…ç½®-ã€‹å­˜å‚¨ç®¡ç†ï¼Œæ–°å»ºä¸€ä¸ªæ“ä½œå‘˜ï¼Œè¿™é‡Œæ–°å»ºçš„æ—¶å€™ä¼šåˆ†é…ç»™ä½ ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç ï¼Œå…¶ä¸­å¯†ç åªèƒ½ç³»ç»Ÿç”Ÿæˆï¼Œè¿™é‡Œä¸€å®šè¦ä¿å­˜å¥½ã€‚</p>
<img src="/2020/04/22/python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E5%AE%9E%E7%8E%B0%E5%8F%88%E6%8B%8D%E4%BA%91-upyun-com-%E5%AD%98%E5%82%A8%E7%9A%84%E5%BC%82%E6%AD%A5%E6%8B%96%E6%8B%BD%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD/20200321090352_28544.png" class="">  

<p>okï¼Œç°åœ¨åˆæ‹äº‘çš„äº‘å­˜å‚¨æœåŠ¡å·²ç»é…ç½®å¥½ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨æ–°å»ºä¸€ä¸ªupload.vueç”¨æ¥é…ç½®ä¸Šä¼ é¡µé¢</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="javascript">	<span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"></span><br><span class="line">		data()&#123;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">			<span class="keyword">return</span>&#123;</span></span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line"><span class="actionscript">		<span class="comment">//ç›‘å¬å±æ€§</span></span></span><br><span class="line">		watch:&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;,</span><br><span class="line"><span class="actionscript">		<span class="comment">//è®¡ç®—å±æ€§</span></span></span><br><span class="line">		computed:&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;,</span><br><span class="line">		mounted () &#123;</span><br><span class="line"><span class="javascript">			<span class="keyword">let</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">'.upload'</span>);</span></span><br><span class="line"><span class="actionscript">    upload.addEventListener(<span class="string">'dragenter'</span>, <span class="keyword">this</span>.onDrag, <span class="literal">false</span>);</span></span><br><span class="line"><span class="actionscript">    upload.addEventListener(<span class="string">'dragover'</span>, <span class="keyword">this</span>.onDrag, <span class="literal">false</span>);</span></span><br><span class="line"><span class="actionscript">    upload.addEventListener(<span class="string">'drop'</span>, <span class="keyword">this</span>.onDrop, <span class="literal">false</span>);</span></span><br><span class="line">		&#125;,</span><br><span class="line"><span class="actionscript">		<span class="comment">//è‡ªå®šä¹‰æ–¹æ³•</span></span></span><br><span class="line">		methods:&#123;</span><br><span class="line"></span><br><span class="line">			onDrag (e) &#123;</span><br><span class="line">      e.stopPropagation();</span><br><span class="line">      e.preventDefault();</span><br><span class="line">    &#125;,</span><br><span class="line">    onDrop (e) &#123;</span><br><span class="line">      e.stopPropagation();</span><br><span class="line">      e.preventDefault();</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.upload_upyun(e.dataTransfer.files);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">			<span class="comment">//ä¸Šä¼ åˆæ‹äº‘</span></span></span><br><span class="line"><span class="actionscript">			upload_upyun:<span class="function"><span class="keyword">function</span><span class="params">(files)</span></span>&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">				<span class="comment">//è·å–æ–‡ä»¶å¯¹è±¡</span></span></span><br><span class="line"><span class="actionscript">				<span class="comment">//let file = e.target.files[0];</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">let</span> file = files[<span class="number">0</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">				<span class="comment">//å£°æ˜å‚æ•°</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">let</span> param = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="actionscript">				param.append(<span class="string">'file'</span>,file);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">				<span class="keyword">const</span> config = &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">				headers: &#123; <span class="string">'Content-Type'</span>: <span class="string">'multipart/form-data'</span> &#125;</span></span><br><span class="line"></span><br><span class="line">				&#125; </span><br><span class="line"></span><br><span class="line"><span class="actionscript">				<span class="keyword">this</span>.axios.post(<span class="string">'http://localhost:8000/uploadfile/'</span>, param, config)<span class="comment">// ä¸Šä¼ å›¾ç‰‡</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">				.then(<span class="function"><span class="keyword">function</span><span class="params">(response)</span> </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">					<span class="built_in">console</span>.log(response)</span></span><br><span class="line"></span><br><span class="line">				&#125;);</span><br><span class="line"></span><br><span class="line">						</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="css"><span class="selector-class">.upload</span> &#123;</span></span><br><span class="line">  margin: 100px auto;</span><br><span class="line">  width: 300px;</span><br><span class="line">  height: 150px;</span><br><span class="line"><span class="css">  <span class="selector-tag">border</span>: 2<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#f00</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œvueé¡µé¢æˆ‘ä»¬ä½¿ç”¨æ‹–æ‹½ä¸Šä¼ çš„æ–¹å¼ã€‚</p>
<p>å‰ç«¯é¡µé¢æå®šäº†ï¼Œæ­¤æ—¶æˆ‘ä»¬åˆ©ç”¨Djangoåšä¸€ä¸ªä¸Šä¼ æ¥å£ï¼Œç†è®ºä¸Šå¯ä»¥ç»•è¿‡æœåŠ¡ç«¯è¿›è¡Œä¸Šä¼ ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œæ¯”å¦‚ç­¾åå®¹æ˜“æ³„éœ²ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œåå°æ¥å£è™½ç„¶ä¸­è½¬ä¸€ä¸‹æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶ä¸å¯¹æ–‡ä»¶è¿›è¡Œå­˜å‚¨ï¼Œä½¿ç”¨chunksçš„æ–¹å¼åˆ†å—è¯»å–ç«‹åˆ»ä¸Šä¼ åˆæ‹äº‘</p>
<p>é¦–å…ˆå®‰è£…åˆæ‹äº‘sdk</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install upyun</span><br></pre></td></tr></table></figure>

<p>ç„¶åå»ºç«‹ä¸€ä¸ªè§†å›¾æ–‡ä»¶views.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#å®šä¹‰æ–‡ä»¶ä¸Šä¼ ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UploadFile</span><span class="params">(View)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line"></span><br><span class="line">        img = request.FILES.get(<span class="string">'file'</span>)</span><br><span class="line"></span><br><span class="line">        up = upyun.UpYun(<span class="string">'ä½ çš„ç©ºé—´åç§°'</span>, username=<span class="string">'æ“ä½œå‘˜è´¦å·'</span>, password=<span class="string">'æ“ä½œå‘˜å¯†ç '</span>)</span><br><span class="line"></span><br><span class="line">        headers = &#123; <span class="string">'x-gmkerl-rotate'</span>: <span class="string">'180'</span> &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> img.chunks():</span><br><span class="line">            res = up.put(<span class="string">'/touxiang1.jpg'</span>, chunk, checksum=<span class="literal">True</span>, headers=headers)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(json.dumps(&#123;<span class="string">'filename'</span>:img.name&#125;),content_type=<span class="string">'application/json'</span>)</span><br></pre></td></tr></table></figure>

<img src="/2020/04/22/python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E5%AE%9E%E7%8E%B0%E5%8F%88%E6%8B%8D%E4%BA%91-upyun-com-%E5%AD%98%E5%82%A8%E7%9A%84%E5%BC%82%E6%AD%A5%E6%8B%96%E6%8B%BD%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD/20200321090318_39902.png" class="">  

<p>å¯ä»¥çœ‹åˆ°æˆåŠŸä¸Šä¼ ï¼Œé‚£ä¹ˆå¦‚ä½•è®¿é—®å‘¢ï¼Œå¯ä»¥é€šè¿‡åˆ†é…çš„åŸŸåæˆ–è€…è‡ªå·±ç»‘å®šçš„åŸŸåç›´æ¥æ‹¼æ¥æ–‡ä»¶åœ°å€å³å¯ä»¥è®¿é—® </p>
<img src="/2020/04/22/python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E5%AE%9E%E7%8E%B0%E5%8F%88%E6%8B%8D%E4%BA%91-upyun-com-%E5%AD%98%E5%82%A8%E7%9A%84%E5%BC%82%E6%AD%A5%E6%8B%96%E6%8B%BD%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD/20200321090347_66412.png" class="">  

<p>è®¿é—®åœ°å€ï¼š<a href="http://123123123123.test.upcdn.net/%E4%BD%A0%E7%9A%84%E5%9B%BE%E7%89%87.jpg" target="_blank" rel="noopener">http://123123123123.test.upcdn.net/ä½ çš„å›¾ç‰‡.jpg</a> </p>
]]></content>
  </entry>
  <entry>
    <title>ä½¿ç”¨Python3.7+Django2.0.4é…åˆvue.js2.0çš„ç»„ä»¶é€’å½’æ¥å®ç°æ— é™çº§åˆ†ç±»(é€’å½’å±‚çº§ç»“æ„)</title>
    <url>/2020/04/06/%E4%BD%BF%E7%94%A8Python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E7%9A%84%E7%BB%84%E4%BB%B6%E9%80%92%E5%BD%92%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%97%A0%E9%99%90%E7%BA%A7%E5%88%86%E7%B1%BB-%E9%80%92%E5%BD%92%E5%B1%82%E7%BA%A7%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<p>æ‰€è°“çš„æ— é™æåˆ†ç±»æ˜¯å•¥ï¼Ÿå…¶å®ç®€å•ç‚¹è¯´å°±æ˜¯ä¸€ä¸ªäººç±»å¯ä»¥ç¹è¡å‡ºå¤šä¸ªåä»£ï¼Œç„¶åä¸€ä¸ªåä»£åˆå¯ä»¥åˆ†å¦å¤–å¤šä¸ªåä»£è¿™æ ·æ— é™ç¹è¡ä¸‹å»ï¼ˆå¯ä»¥æƒ³è±¡<a href="https://movie.douban.com/subject/26147417/" target="_blank" rel="noopener">ç¥å¥‡åŠ¨ç‰©åœ¨å“ªé‡Œ2</a>é‡Œé¢è±æ–¯ç‰¹å…°å¥‡çš„å®¶æ—æ—è°±ï¼‰ï¼Œå°±å¥½è±¡linuxç³»ç»Ÿä½ å¯ä»¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œåˆå¯ä»¥å»ºä¸€äº›ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹åº•ä¸‹è¿˜å¯ä»¥å»ºä¸€äº›æ–‡ä»¶å¤¹ä¸€æ ·ï¼Œéšåä½¿ç”¨treeå‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹æ–‡ä»¶å¤¹ç›®å½•å±‚çº§ã€‚</p>
<a id="more"></a>

<p>é‚£ä¹ˆè¿™ç§å±‚çº§ç»“æ„ä¹Ÿæˆä¸ºæ ‘ç»“æ„åœ¨æ—¥å¸¸çš„å¼€å‘éœ€æ±‚é‡Œä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ï¼Œæ¯”å¦‚ç¾å¤šå•†åŸç³»ç»Ÿçš„å•†å“åˆ†ç±»ï¼Œè¯¾ç¨‹çš„ç›®å½•ç« èŠ‚ï¼Œä»¥åŠä»¥åŠè®ºå›é‡Œçš„å¸–å­å›å¤ç­‰ç­‰ï¼Œæœ¬æ¬¡æˆ‘ä»¬åå°åˆ©ç”¨Djangoæ¥å†™ä¸€ä¸ªèƒ½å¤Ÿè¿”å›å±‚çº§ç»“æ„æ•°æ®çš„æ¥å£ï¼Œæ¥å£å°†è¯¥æ•°æ®ä»¥jsonçš„å½¢å¼è¿”å›å‰ç«¯ï¼Œå‰ç«¯ä½¿ç”¨vueçš„ç»„ä»¶é€’å½’æ¥å±•ç¤ºæ•°æ®ã€‚</p>
<p>é¦–å…ˆï¼Œæ‰“å¼€djangoé¡¹ç›®ä¸­çš„models.pyï¼Œæ–°å»ºä¸€ä¸ªç±»åˆ«çš„æ¨¡å‹ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥æœ€ç®€å•çš„parentidçš„å½¢å¼æ¥å»ºç«‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cate</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#ä¸»é”® é€šè¿‡å‚æ•°å£°æ˜ä¸»é”®</span></span><br><span class="line">    id = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment">#åˆ†ç±»åç§°</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">500</span>)</span><br><span class="line">    <span class="comment">#çˆ¶çº§id</span></span><br><span class="line">    pid = models.IntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#è¡¨å</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'cate'</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºæˆ‘ä»¬çš„é¡¹ç›®åŸºäºdrfæ¡†æ¶ï¼Œæ‰€ä»¥è¦å¢åŠ ä¸€ä¸ªåºåˆ—å™¨ç±»ï¼Œå¦‚æœä½ çš„é¡¹ç›®æ²¡æœ‰ç”¨drfï¼Œå¯ä»¥ç›´æ¥ç”¨jsonæ¨¡å—æ¥è¿›è¡Œåºåˆ—åŒ– </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> myapp.models <span class="keyword">import</span> Cate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CateSer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Cate</span><br><span class="line">        fields = <span class="string">"__all__"</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºdjangoåºåˆ—åŒ–å‡ºæ¥çš„ç±»ä¸å…·å¤‡å±‚çº§ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬æå‰å†™å¥½ä¸€ä¸ªç”¨æ¥é€’å½’çš„æ–¹æ³•ï¼š </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xTree</span><span class="params">(datas)</span>:</span></span><br><span class="line">    lists=[]</span><br><span class="line">    tree=&#123;&#125;</span><br><span class="line">    parent_id=<span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> datas:</span><br><span class="line">        item=i</span><br><span class="line">        tree[item[<span class="string">'id'</span>]]=item</span><br><span class="line">    root=<span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> datas:</span><br><span class="line">        obj=i</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> obj[<span class="string">'pid'</span>]:</span><br><span class="line">            root=tree[obj[<span class="string">'id'</span>]]</span><br><span class="line">            lists.append(root)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            parent_id=obj[<span class="string">'pid'</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'childlist'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree[parent_id]:   </span><br><span class="line">                tree[parent_id][<span class="string">'childlist'</span>]=[]</span><br><span class="line">            tree[parent_id][<span class="string">'childlist'</span>].append(tree[obj[<span class="string">'id'</span>]])</span><br><span class="line">    <span class="keyword">return</span> lists</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æˆ‘ä»¬å†™ä¸€ä¸ªè§†å›¾æ¥å£ï¼Œç”¨æ¥ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ® </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTree</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">#è·å–è®¢å•åˆ—è¡¨</span></span><br><span class="line">        catelist = Cate.objects.filter()</span><br><span class="line">        <span class="comment">#åºåˆ—åŒ–</span></span><br><span class="line">        catelist_ser = CateSer(catelist,many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        mylist= xTree(catelist_ser.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(mylist)</span><br></pre></td></tr></table></figure>

<p> è¯·åœ¨mysqlåº“é‡Œå­˜ä¸€äº›æµ‹è¯•æ•°æ® </p>
<img src="/2020/04/06/%E4%BD%BF%E7%94%A8Python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E7%9A%84%E7%BB%84%E4%BB%B6%E9%80%92%E5%BD%92%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%97%A0%E9%99%90%E7%BA%A7%E5%88%86%E7%B1%BB-%E9%80%92%E5%BD%92%E5%B1%82%E7%BA%A7%E7%BB%93%E6%9E%84/20200303114306_78562.png" class="">  

<p> æµ‹è¯•ä¸€ä¸‹æ¥å£ï¼Œçœ‹çœ‹æ˜¯å¦ä»¥jsonçš„å½¢å¼è¿”å›äº†å±‚çº§ç»“æ„ </p>
<img src="/2020/04/06/%E4%BD%BF%E7%94%A8Python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E7%9A%84%E7%BB%84%E4%BB%B6%E9%80%92%E5%BD%92%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%97%A0%E9%99%90%E7%BA%A7%E5%88%86%E7%B1%BB-%E9%80%92%E5%BD%92%E5%B1%82%E7%BA%A7%E7%BB%93%E6%9E%84/20200303114400_23346.png" class="">  

<p>ok,æ¥å£æ²¡æœ‰é—®é¢˜ï¼Œç°åœ¨æˆ‘ä»¬æŠŠç›®å…‰æŠ•å‘å‰ç«¯ï¼Œæ‰“å¼€vueé¡¹ç›®ï¼Œæ–°å»ºä¸€ä¸ªReply.vueç»„ä»¶</p>
<p>æ‰€è°“é€’å½’ç»„ä»¶: å°±æ˜¯ç»„ä»¶å¯ä»¥åœ¨å®ƒä»¬è‡ªå·±çš„æ¨¡æ¿ä¸­è°ƒç”¨è‡ªèº«ï¼Œä¸è¿‡å®ƒä»¬åªèƒ½é€šè¿‡ name é€‰é¡¹æ¥åšè¿™ä»¶äº‹ï¼Œä¾‹å¦‚ç»™ç»„ä»¶è®¾ç½®å±æ€§ name: â€˜Replyâ€™ï¼Œç„¶ååœ¨æ¨¡æ¿ä¸­å°±å¯ä»¥ä½¿ç”¨ Reply è°ƒç”¨è‡ªå·±è¿›è¡Œé€’å½’è°ƒç”¨äº†</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">"[data.id==0 ? 'root': '', 'reply']"</span>&gt;</span>&#123;&#123; data.name &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-if</span>=<span class="string">"data.childlist &amp;&amp; data.childlist.length&gt;0"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Reply</span> <span class="attr">v-for</span>=<span class="string">"child in data.childlist"</span> <span class="attr">:key</span>=<span class="string">"child.id"</span> <span class="attr">:data</span>=<span class="string">"child"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">        name: <span class="string">'Reply'</span>, <span class="comment">// é€’å½’ç»„ä»¶éœ€è¦è®¾ç½® name å±æ€§ï¼Œæ‰èƒ½åœ¨æ¨¡æ¿ä¸­è°ƒç”¨è‡ªå·±</span></span></span><br><span class="line"><span class="actionscript">        props:[<span class="string">'data'</span>],</span></span><br><span class="line">    &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> &gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.reply</span> &#123;</span></span><br><span class="line">        padding-left: 4px;</span><br><span class="line"><span class="css">        <span class="selector-tag">border-left</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#eee</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ul &#123;</span><br><span class="line">            padding-left: 20px;</span><br><span class="line">            list-style: none;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.root</span> &#123; <span class="attribute">display</span>: none; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  ç„¶ååœ¨å…¶ä»–ä»»æ„ç»„ä»¶ä¸­è°ƒç”¨è¯¥Reply.vueç»„ä»¶ï¼Œä¼ å…¥åˆšåˆšå†™å¥½çš„æ¥å£æ•°æ® </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">        <span class="tag">&lt;<span class="name">Reply</span> <span class="attr">:data</span>=<span class="string">"data"</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">       </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> &#123;config,formatXml&#125; <span class="keyword">from</span> <span class="string">'../config.js'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> mh_test <span class="keyword">from</span> <span class="string">'./mh_test.vue'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> Reply <span class="keyword">from</span> <span class="string">'./Reply.vue'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> md5 <span class="keyword">from</span> <span class="string">'js-md5'</span>;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">        data () &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line">                data:&#123;&#125;,</span><br><span class="line">                online: 0</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        components: &#123;</span><br><span class="line"><span class="actionscript">            <span class="comment">//'mh_test':mh_test</span></span></span><br><span class="line">            Reply</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">//é’©å­æ–¹æ³•</span></span></span><br><span class="line"><span class="actionscript">        mounted:<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.get_token();</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="actionscript">        <span class="comment">//ç»‘å®šäº‹ä»¶</span></span></span><br><span class="line">        methods:&#123;</span><br><span class="line"></span><br><span class="line">            get_token()&#123;</span><br><span class="line"></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.axios.get(<span class="string">'http://localhost:8000/mytree/'</span>).then(<span class="function">(<span class="params">result</span>) =&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">var</span> mytree = &#123;<span class="string">'id'</span>:<span class="number">0</span>,name:<span class="string">'123'</span>&#125;;</span></span><br><span class="line"><span class="actionscript">                    mytree[<span class="string">'childlist'</span>] = result.data;</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">this</span>.data = mytree;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="keyword">this</span>.data);</span></span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.on</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-id">#cdcbff</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.off</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-id">#fefdff</span>;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>æœ€åè¯·æ±‚é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°å±•ç¤ºçš„æ•ˆæœï¼š </p>
<img src="/2020/04/06/%E4%BD%BF%E7%94%A8Python3-7-Django2-0-4%E9%85%8D%E5%90%88vue-js2-0%E7%9A%84%E7%BB%84%E4%BB%B6%E9%80%92%E5%BD%92%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%97%A0%E9%99%90%E7%BA%A7%E5%88%86%E7%B1%BB-%E9%80%92%E5%BD%92%E5%B1%82%E7%BA%A7%E7%BB%93%E6%9E%84/20200303114749_87796.png" class="">  

<p>å½“ç„¶äº†ï¼Œvueç»„ä»¶ä¹Ÿå¯ä»¥é—´æ¥çš„è°ƒç”¨è‡ªå·±å®ç°é€’å½’ï¼Œè¿™æ¶‰åŠåˆ°ç»„ä»¶ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ï¼Œè¿™æ ·æ¯”è¾ƒéº»çƒ¦ï¼Œå¯è¯»æ€§ä¹Ÿé—´æ¥çš„é™ä½äº†ä¸å°‘ã€‚ </p>
]]></content>
  </entry>
  <entry>
    <title>ä½¿ç”¨python3.7+Vue.js2.0+Django2.0.4å¼‚æ­¥å‰ç«¯é€šè¿‡apiä¸Šä¼ æ–‡ä»¶åˆ°ä¸ƒç‰›äº‘äº‘ç«¯å­˜å‚¨</title>
    <url>/2020/04/02/%E4%BD%BF%E7%94%A8python3-7-Vue-js2-0-Django2-0-4%E5%BC%82%E6%AD%A5%E5%89%8D%E7%AB%AF%E9%80%9A%E8%BF%87api%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%83%E7%89%9B%E4%BA%91%E4%BA%91%E7%AB%AF%E5%AD%98%E5%82%A8/</url>
    <content><![CDATA[<p>é¦–å…ˆæ³¨å†Œä¸ƒç‰›äº‘ï¼šqiniu.comï¼Œè¿›å…¥ä½ çš„ä¸ƒç‰›äº‘è´¦å·ï¼Œæ‰“å¼€ç§˜é’¥é¡µï¼Œè®°å½•ä¸‹ä½ çš„akå’Œsk </p>
<img src="/2020/04/02/%E4%BD%BF%E7%94%A8python3-7-Vue-js2-0-Django2-0-4%E5%BC%82%E6%AD%A5%E5%89%8D%E7%AB%AF%E9%80%9A%E8%BF%87api%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%83%E7%89%9B%E4%BA%91%E4%BA%91%E7%AB%AF%E5%AD%98%E5%82%A8/20191215131202_22383.png" class="">  

<a id="more"></a>

<p>éšåæ–°å»ºä¸€ä¸ªäº‘å­˜å‚¨ç©ºé—´ï¼Œè¿™é‡Œç©ºé—´åå­—ä¸€å®šè¦è®°å½•ä¸€ä¸‹ï¼š </p>
<img src="/2020/04/02/%E4%BD%BF%E7%94%A8python3-7-Vue-js2-0-Django2-0-4%E5%BC%82%E6%AD%A5%E5%89%8D%E7%AB%AF%E9%80%9A%E8%BF%87api%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%83%E7%89%9B%E4%BA%91%E4%BA%91%E7%AB%AF%E5%AD%98%E5%82%A8/20191215131239_52781.png" class="">  

<p>æ­¤æ—¶æˆ‘ä»¬ç”¨djangoå†™ä¸€ä¸ªè·å–uptokençš„æ¥å£ï¼Œä½¿ç”¨drfæ¡†æ¶æ¥å†™ï¼Œæ³¨æ„åˆ«å¿˜äº†å®‰è£…ä¸ƒç‰›äº‘æ‰©å±• pip install qiniu </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸ƒç‰›äº‘token</span></span><br><span class="line"><span class="keyword">from</span> qiniu <span class="keyword">import</span> Auth</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QiNiu</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        q = Auth(<span class="string">'E2IZM3koC1GR1DUqJHactmixzdyZZhx0edBKqDsk'</span>,<span class="string">'GDnMkvRoE_kFhCSuvdqQj0VcNsRDOHzYJJ_bVd0_'</span>)</span><br><span class="line">        token = q.upload_token(<span class="string">'redinnovation'</span>)</span><br><span class="line">        print(token)</span><br><span class="line">        res = &#123;&#125;</span><br><span class="line">        res[<span class="string">'uptoken'</span>] = token</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(res)</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå¯åŠ¨djangoæœåŠ¡ï¼špython3 manage.py runserver</p>
<p>è®¿é—®djangoæœåŠ¡ï¼Œç¡®ä¿æ¯ä¸€æ¬¡éƒ½ä¼šç”Ÿæˆæ–°çš„token,è®¿é—®<a href="http://localhost:8000/uptoken/" target="_blank" rel="noopener">http://localhost:8000/uptoken/</a></p>
<img src="/2020/04/02/%E4%BD%BF%E7%94%A8python3-7-Vue-js2-0-Django2-0-4%E5%BC%82%E6%AD%A5%E5%89%8D%E7%AB%AF%E9%80%9A%E8%BF%87api%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%83%E7%89%9B%E4%BA%91%E4%BA%91%E7%AB%AF%E5%AD%98%E5%82%A8/20200224074610_64132.png" class="">  

<p>æ¥å£å·²ç»è°ƒè¯•å¥½ï¼Œå›åˆ°vue.jsé¡µé¢ï¼Œæ·»åŠ ä¸€ä¸ªä¸Šä¼ æ§ä»¶ </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;&#123; imgLoadPercent &#125;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> @<span class="attr">change</span>=<span class="string">"uploadInputchange"</span>  <span class="attr">id</span>=<span class="string">"uploadFileInput"</span> <span class="attr">type</span>=<span class="string">"file"</span> &gt;</span></span><br></pre></td></tr></table></figure>

<p>  è¿™é‡Œçš„imgLoadPercentæ˜¯ä¸Šä¼ è¿›åº¦çš„å±•ç¤º </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">          uptoken:&#39;&#39;,</span><br><span class="line">        imgLoadPercent:&#39;&#39;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p> ç„¶ååœ¨methodsé‡Œæ·»åŠ å‡ ä¸ªæ–¹æ³•ï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">get_token()&#123;</span><br><span class="line"></span><br><span class="line">         this.axios.get(&#39;http:&#x2F;&#x2F;localhost:8000&#x2F;uptoken&#x2F;&#39;).then((result) &#x3D;&gt;&#123;</span><br><span class="line">        console.log(result);</span><br><span class="line">        this.uptoken &#x3D; result.data.uptoken;</span><br><span class="line">        &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">    &#x2F;&#x2F;è§¦å‘input changeäº‹ä»¶</span><br><span class="line">    uploadInputchange()&#123;</span><br><span class="line">        let file &#x3D; document.getElementById(&quot;uploadFileInput&quot;).files[0];   &#x2F;&#x2F;é€‰æ‹©çš„å›¾ç‰‡æ–‡ä»¶</span><br><span class="line">        this.get_token();</span><br><span class="line">        this.uploadImgToQiniu(file);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F;ä¸Šä¼ å›¾ç‰‡åˆ°ä¸ƒç‰›</span><br><span class="line">    uploadImgToQiniu(file)&#123;</span><br><span class="line"></span><br><span class="line">        console.log(this.uptoken);</span><br><span class="line"></span><br><span class="line">        const axiosInstance &#x3D; this.axios.create(&#123;withCredentials: false&#125;);    &#x2F;&#x2F;withCredentials ç¦æ­¢æºå¸¦cookieï¼Œå¸¦cookieåœ¨ä¸ƒç‰›ä¸Šæœ‰å¯èƒ½å‡ºç°è·¨åŸŸé—®é¢˜</span><br><span class="line">        let data &#x3D; new FormData();</span><br><span class="line">        data.append(&#39;token&#39;,this.uptoken);     &#x2F;&#x2F;ä¸ƒç‰›éœ€è¦çš„token</span><br><span class="line">        data.append(&#39;file&#39;, file);</span><br><span class="line">        axiosInstance(&#123;</span><br><span class="line">            method: &#39;POST&#39;,</span><br><span class="line">            url: &#39;http:&#x2F;&#x2F;up-z1.qiniu.com&#x2F;&#39;,  &#x2F;&#x2F;ä¸Šä¼ åœ°å€ï¼ŒååŒ—çš„ç©ºé—´æ˜¯up-z1.qiniu.com</span><br><span class="line">            data: data,</span><br><span class="line">            timeout:30000,      &#x2F;&#x2F;è¶…æ—¶æ—¶é—´ï¼Œå› ä¸ºå›¾ç‰‡ä¸Šä¼ æœ‰å¯èƒ½éœ€è¦å¾ˆä¹…</span><br><span class="line">            onUploadProgress: (e)&#x3D;&gt; &#123;</span><br><span class="line">                &#x2F;&#x2F;imgLoadPercent æ˜¯ä¸Šä¼ è¿›åº¦ï¼Œå¯ä»¥ç”¨æ¥æ·»åŠ è¿›åº¦æ¡</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                var complete &#x3D; (e.loaded &#x2F; e.total);</span><br><span class="line"></span><br><span class="line">                if (complete &lt; 1) &#123;</span><br><span class="line">                </span><br><span class="line">                    this.imgLoadPercent &#x3D; (complete *100).toFixed(2)+ &#39;%&#39;;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;).then(data &#x3D;&gt;&#123;</span><br><span class="line">           console.log(data);</span><br><span class="line">           this.imgLoadPercent &#x3D; &#39;100%&#39;;</span><br><span class="line">        &#125;).catch(function(err) &#123;</span><br><span class="line">            &#x2F;&#x2F;ä¸Šä¼ å¤±è´¥</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>é€»è¾‘å°±æ˜¯æ¯ä¸€æ¬¡ä¸Šä¼ ä¹‹å‰ï¼Œè¯·æ±‚ä¸€æ¬¡åå°djangoçš„æ¥å£è·å–tokenï¼Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨å®é™…æ“ä½œä¸­ï¼ŒonUploadProgressè¿™ä¸ªæ–¹æ³•å¹¶ä¸èƒ½å®Œå…¨çš„çœŸå®å±•ç¤ºä¸Šä¼ è¿›åº¦ï¼Œå—é™äºç½‘ç»œæˆ–è€…åˆ«çš„å› ç´ å¯¼è‡´å®ƒä¼šæœ‰ä¸€å®šçš„æå‰é‡æˆ–è€…å»¶è¿Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªæ–¹æ³•å†…åšäº†ä¸€ä¸ªç±»ä¼¼å®‰æ…°å‰‚æŒ‰é’®çš„æ•ˆæœï¼Œå°±æ˜¯äººä¸ºé™åˆ¶å®ƒä¸ä¼šå˜ä¸º100%ï¼Œåªæœ‰å½“ä¸ƒç‰›äº‘è¿”å›ç»“æœçš„æ—¶å€™å†èµ‹å€¼ä¸º100%ã€‚</p>
<p>æœ€åï¼Œå¦‚æœä¸Šä¼ æˆåŠŸåï¼Œä¸ƒç‰›äº‘æ¥å£ä¼šè¿”å›æ–‡ä»¶çš„key</p>
<img src="/2020/04/02/%E4%BD%BF%E7%94%A8python3-7-Vue-js2-0-Django2-0-4%E5%BC%82%E6%AD%A5%E5%89%8D%E7%AB%AF%E9%80%9A%E8%BF%87api%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%83%E7%89%9B%E4%BA%91%E4%BA%91%E7%AB%AF%E5%AD%98%E5%82%A8/20200224075423_85752.png" class="">  

<p> é€šè¿‡urlå³å¯è®¿é—®ã€‚ </p>
]]></content>
  </entry>
  <entry>
    <title>Redisä¸»ä»å¤åˆ¶</title>
    <url>/2020/03/23/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
    <content><![CDATA[<p>å’ŒMysqlä¸»ä»å¤åˆ¶çš„åŸå› ä¸€æ ·ï¼ŒRedisè™½ç„¶è¯»å–å†™å…¥çš„é€Ÿåº¦éƒ½ç‰¹åˆ«å¿«ï¼Œä½†æ˜¯ä¹Ÿä¼šäº§ç”Ÿè¯»å‹åŠ›ç‰¹åˆ«å¤§çš„æƒ…å†µã€‚ä¸ºäº†åˆ†æ‹…è¯»å‹åŠ›ï¼ŒRedisæ”¯æŒä¸»ä»å¤åˆ¶ï¼ŒRedisçš„ä¸»ä»ç»“æ„å¯ä»¥é‡‡ç”¨ä¸€ä¸»å¤šä»æˆ–è€…çº§è”ç»“æ„ï¼ŒRedisä¸»ä»å¤åˆ¶å¯ä»¥æ ¹æ®æ˜¯å¦æ˜¯å…¨é‡åˆ†ä¸ºå…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥ã€‚</p>
<a id="more"></a>

<p>ä¸‹å›¾ä¸ºçº§è”ç»“æ„ã€‚ </p>
<p>æ³¨ï¼šredisä¸»èŠ‚ç‚¹MasteræŒ‚æ‰æ—¶ï¼Œè¿ç»´è®©ä»èŠ‚ç‚¹Slaveæ¥ç®¡ï¼ˆredisä¸»ä»é»˜è®¤æ— æ³•è‡ªåŠ¨åˆ‡æ¢ï¼Œéœ€è¦è¿ç»´æ‰‹åŠ¨åˆ‡æ¢ï¼‰ </p>
<img src="/2020/03/23/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1080958-20191008142005703-1179773131.png" class="">  

<h2 id="å…¨é‡åŒæ­¥"><a href="#å…¨é‡åŒæ­¥" class="headerlink" title="å…¨é‡åŒæ­¥"></a><strong>å…¨é‡åŒæ­¥</strong></h2><p>Rediså…¨é‡å¤åˆ¶ä¸€èˆ¬å‘ç”Ÿåœ¨Slaveåˆå§‹åŒ–é˜¶æ®µï¼Œè¿™æ—¶Slaveéœ€è¦å°†Masterä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½å¤åˆ¶ä¸€ä»½ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä»æœåŠ¡å™¨è¿æ¥ä¸»æœåŠ¡å™¨ï¼Œå‘é€SYNCå‘½ä»¤ï¼›</li>
<li>ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°SYNCå‘½ååï¼Œå¼€å§‹æ‰§è¡ŒBGSAVEå‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ï¼› </li>
<li>ä¸»æœåŠ¡å™¨BGSAVEæ‰§è¡Œå®Œåï¼Œå‘æ‰€æœ‰ä»æœåŠ¡å™¨å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ï¼›</li>
<li>ä»æœåŠ¡å™¨æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ï¼›  </li>
<li>ä¸»æœåŠ¡å™¨å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ä»æœåŠ¡å™¨å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼›  </li>
<li>ä»æœåŠ¡å™¨å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼› </li>
</ol>
<img src="/2020/03/23/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/907596-20180710175736785-1172070242.png" class="">  

<p>å®Œæˆä¸Šé¢å‡ ä¸ªæ­¥éª¤åå°±å®Œæˆäº†ä»æœåŠ¡å™¨æ•°æ®åˆå§‹åŒ–çš„æ‰€æœ‰æ“ä½œï¼Œä»æœåŠ¡å™¨æ­¤æ—¶å¯ä»¥æ¥æ”¶æ¥è‡ªç”¨æˆ·çš„è¯»è¯·æ±‚ã€‚ </p>
<h2 id="å¢é‡åŒæ­¥"><a href="#å¢é‡åŒæ­¥" class="headerlink" title="å¢é‡åŒæ­¥"></a><strong>å¢é‡åŒæ­¥</strong></h2><ol>
<li>ä¸»èŠ‚ç‚¹ä¼šå°†é‚£äº›å¯¹è‡ªå·±çŠ¶æ€äº§ç”Ÿä¿®æ”¹æ€§å½±å“çš„æŒ‡ä»¤è®°å½•åœ¨æœ¬åœ°å†…å­˜bufferä¸­ï¼Œç„¶åå¼‚æ­¥å°†bufferä¸­æŒ‡ä»¤åŒæ­¥åˆ°ä»èŠ‚ç‚¹</li>
<li>ä»èŠ‚ç‚¹ä¸€è¾¹æ‰§è¡ŒåŒæ­¥æŒ‡ä»¤è¾¾åˆ°ä¸»èŠ‚ç‚¹çŠ¶æ€ï¼Œä¸€è¾¹å‘ä¸»èŠ‚ç‚¹åé¦ˆè‡ªå·±åŒæ­¥åˆ°å“ªé‡Œï¼ˆåç§»é‡ï¼‰</li>
<li>å½“ç½‘ç»œçŠ¶æ€ä¸å¥½æ—¶ï¼Œä»èŠ‚ç‚¹æ— æ³•å’Œä¸»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ï¼Œå½“ç½‘ç»œæ¢å¤æ—¶éœ€è¦è¿›è¡Œå¿«ç…§åŒæ­¥</li>
</ol>
<h2 id="Redisä¸»ä»åŒæ­¥ç­–ç•¥"><a href="#Redisä¸»ä»åŒæ­¥ç­–ç•¥" class="headerlink" title="Redisä¸»ä»åŒæ­¥ç­–ç•¥"></a><strong>Redisä¸»ä»åŒæ­¥ç­–ç•¥</strong></h2><ol>
<li>ä¸»ä»åˆšåˆšè¿æ¥çš„æ—¶å€™ï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ï¼›å…¨åŒæ­¥ç»“æŸåï¼Œè¿›è¡Œå¢é‡åŒæ­¥ã€‚</li>
<li>å½“ç„¶ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œslave åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘èµ·å…¨é‡åŒæ­¥ã€‚</li>
<li>redis ç­–ç•¥æ˜¯ï¼Œæ— è®ºå¦‚ä½•ï¼Œé¦–å…ˆä¼šå°è¯•è¿›è¡Œå¢é‡åŒæ­¥ï¼Œå¦‚ä¸æˆåŠŸï¼Œè¦æ±‚ä»æœºè¿›è¡Œå…¨é‡åŒæ­¥ã€‚ </li>
</ol>
<h2 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a><strong>æ³¨æ„ç‚¹</strong></h2><p>å¦‚æœå¤šä¸ªSlaveæ–­çº¿äº†ï¼Œéœ€è¦é‡å¯çš„æ—¶å€™ï¼Œå› ä¸ºåªè¦Slaveå¯åŠ¨ï¼Œå°±ä¼šå‘é€syncè¯·æ±‚å’Œä¸»æœºå…¨é‡åŒæ­¥ï¼Œå½“å¤šä¸ªåŒæ—¶å‡ºç°çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´Master IOå‰§å¢å®•æœºã€‚</p>
<h2 id="ä¸»ä»å¤åˆ¶çš„ä¸€äº›ç‰¹ç‚¹ï¼š"><a href="#ä¸»ä»å¤åˆ¶çš„ä¸€äº›ç‰¹ç‚¹ï¼š" class="headerlink" title="ä¸»ä»å¤åˆ¶çš„ä¸€äº›ç‰¹ç‚¹ï¼š"></a><strong>ä¸»ä»å¤åˆ¶çš„ä¸€äº›ç‰¹ç‚¹ï¼š</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> é‡‡ç”¨å¼‚æ­¥å¤åˆ¶ï¼›</span><br><span class="line"><span class="number">2.</span> ä¸€ä¸ªä¸»rediså¯ä»¥å«æœ‰å¤šä¸ªä»redisï¼›</span><br><span class="line"><span class="number">3.</span> æ¯ä¸ªä»rediså¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»–ä»redisæœåŠ¡å™¨çš„è¿æ¥ï¼›</span><br><span class="line"><span class="number">4.</span> ä¸»ä»å¤åˆ¶å¯¹äºä¸»redisæœåŠ¡å™¨æ¥è¯´æ˜¯éé˜»å¡çš„ï¼Œè¿™æ„å‘³ç€å½“ä»æœåŠ¡å™¨åœ¨è¿›è¡Œä¸»ä»å¤åˆ¶åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œ</span><br><span class="line">   ä¸»redisä»ç„¶å¯ä»¥å¤„ç†å¤–ç•Œçš„è®¿é—®è¯·æ±‚ï¼›</span><br><span class="line"><span class="number">5.</span> ä¸»ä»å¤åˆ¶å¯¹äºä»redisæœåŠ¡å™¨æ¥è¯´ä¹Ÿæ˜¯éé˜»å¡çš„ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä½¿ä»redisåœ¨è¿›è¡Œä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­</span><br><span class="line">   ä¹Ÿå¯ä»¥æ¥å—å¤–ç•Œçš„æŸ¥è¯¢è¯·æ±‚ï¼Œåªä¸è¿‡è¿™æ—¶å€™ä»redisè¿”å›çš„æ˜¯ä»¥å‰è€çš„æ•°æ®ï¼Œ</span><br><span class="line">   å¦‚æœä½ ä¸æƒ³è¿™æ ·ï¼Œé‚£ä¹ˆåœ¨å¯åŠ¨redisæ—¶ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ï¼Œé‚£ä¹ˆä»redisåœ¨å¤åˆ¶åŒæ­¥è¿‡ç¨‹ä¸­</span><br><span class="line">   æ¥è‡ªå¤–ç•Œçš„æŸ¥è¯¢è¯·æ±‚éƒ½ä¼šè¿”å›é”™è¯¯ç»™å®¢æˆ·ç«¯ï¼›ï¼ˆè™½ç„¶è¯´ä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­</span><br><span class="line">   å¯¹äºä»redisæ˜¯éé˜»å¡çš„ï¼Œä½†æ˜¯å½“ä»redisä»ä¸»redisåŒæ­¥è¿‡æ¥æœ€æ–°çš„æ•°æ®åè¿˜éœ€è¦å°†æ–°æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œ</span><br><span class="line">   åœ¨åŠ è½½åˆ°å†…å­˜çš„è¿‡ç¨‹ä¸­æ˜¯é˜»å¡çš„ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…çš„è¯·æ±‚å°†ä¼šè¢«é˜»ï¼Œ</span><br><span class="line">   ä½†æ˜¯å³ä½¿å¯¹äºå¤§æ•°æ®é›†ï¼ŒåŠ è½½åˆ°å†…å­˜çš„æ—¶é—´ä¹Ÿæ˜¯æ¯”è¾ƒå¤šçš„ï¼‰ï¼›</span><br><span class="line"><span class="number">6.</span> ä¸»ä»å¤åˆ¶æé«˜äº†redisæœåŠ¡çš„æ‰©å±•æ€§ï¼Œé¿å…å•ä¸ªredisæœåŠ¡å™¨çš„è¯»å†™è®¿é—®å‹åŠ›è¿‡å¤§çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç»™ä¸º</span><br><span class="line">   æ•°æ®å¤‡ä»½åŠå†—ä½™æä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆï¼›</span><br><span class="line"><span class="number">7.</span> ä¸ºäº†ç¼–ç ä¸»redisæœåŠ¡å™¨å†™ç£ç›˜å‹åŠ›å¸¦æ¥çš„å¼€é”€ï¼Œå¯ä»¥é…ç½®è®©ä¸»redisä¸åœ¨å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œè€Œæ˜¯é€šè¿‡</span><br><span class="line">   è¿æ¥è®©ä¸€ä¸ªé…ç½®çš„ä»redisæœåŠ¡å™¨åŠæ—¶çš„å°†ç›¸å…³æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œ</span><br><span class="line">   ä¸è¿‡è¿™æ ·ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸»redisæœåŠ¡å™¨ä¸€æ—¦é‡å¯ï¼Œå› ä¸ºä¸»redisæœåŠ¡å™¨æ•°æ®ä¸ºç©ºï¼Œè¿™æ—¶å€™é€šè¿‡</span><br><span class="line">   ä¸»ä»åŒæ­¥å¯èƒ½å¯¼è‡´ä»redisæœåŠ¡å™¨ä¸Šçš„æ•°æ®ä¹Ÿè¢«æ¸…ç©ºï¼›</span><br></pre></td></tr></table></figure>

<h2 id="ä¸»ä»åŒæ­¥ä¸­éœ€è¦æ³¨æ„å‡ ä¸ªé—®é¢˜"><a href="#ä¸»ä»åŒæ­¥ä¸­éœ€è¦æ³¨æ„å‡ ä¸ªé—®é¢˜" class="headerlink" title="ä¸»ä»åŒæ­¥ä¸­éœ€è¦æ³¨æ„å‡ ä¸ªé—®é¢˜"></a><strong>ä¸»ä»åŒæ­¥ä¸­éœ€è¦æ³¨æ„å‡ ä¸ªé—®é¢˜</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> åœ¨ä¸Šé¢çš„å…¨é‡åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œmasterä¼šå°†æ•°æ®ä¿å­˜åœ¨rdbæ–‡ä»¶ä¸­ç„¶åå‘é€ç»™slaveæœåŠ¡å™¨ï¼Œä½†æ˜¯å¦‚æœmasterä¸Šçš„</span><br><span class="line">   ç£ç›˜ç©ºé—´æœ‰æ•ˆæ€ä¹ˆåŠå‘¢ï¼Ÿé‚£ä¹ˆæ­¤æ—¶å…¨éƒ¨åŒæ­¥å¯¹äºmasteræ¥è¯´</span><br><span class="line">   å°†æ˜¯ä¸€ä»½ååˆ†æœ‰å‹åŠ›çš„æ“ä½œäº†ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡æ— ç›˜å¤åˆ¶æ¥è¾¾åˆ°ç›®çš„ï¼Œç”±masterç›´æ¥å¼€å¯ä¸€ä¸ªsocketå°†</span><br><span class="line">   rdbæ–‡ä»¶å‘é€ç»™slaveæœåŠ¡å™¨ã€‚ï¼ˆæ— ç›˜å¤åˆ¶ä¸€èˆ¬åº”ç”¨åœ¨ç£ç›˜ç©ºé—´æœ‰é™ä½†æ˜¯ç½‘ç»œçŠ¶æ€è‰¯å¥½çš„æƒ…å†µä¸‹ï¼‰</span><br><span class="line"><span class="number">2.</span> ä¸»ä»å¤åˆ¶ç»“æ„ï¼Œä¸€èˆ¬slaveæœåŠ¡å™¨ä¸èƒ½è¿›è¡Œå†™æ“ä½œï¼Œä½†æ˜¯è¿™ä¸æ˜¯æ­»çš„ï¼Œä¹‹æ‰€ä»¥è¿™æ ·æ˜¯ä¸ºäº†æ›´å®¹æ˜“çš„ä¿è¯ä¸»å’Œå„ä¸ª</span><br><span class="line">   ä»ä¹‹é—´æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¦‚æœslaveæœåŠ¡å™¨ä¸Šæ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œ</span><br><span class="line">   é‚£ä¹ˆè¦ä¿è¯æ‰€æœ‰ä¸»ä»æœåŠ¡å™¨éƒ½èƒ½ä¸€è‡´ï¼Œå¯èƒ½åœ¨ç»“æ„ä¸Šå’Œå¤„ç†é€»è¾‘ä¸Šæ›´ä¸ºè´Ÿè´£ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è®©</span><br><span class="line">   ä»æœåŠ¡å™¨æ”¯æŒå†™æ“ä½œã€‚ï¼ˆä¸è¿‡æ‰€å¸¦æ¥çš„å½±å“è¿˜å¾—è‡ªå·±æ‰¿æ‹…å“¦ã€‚ã€‚ã€‚ï¼‰</span><br><span class="line"><span class="number">3.</span> ä¸»ä»æœåŠ¡å™¨ä¹‹é—´ä¼šå®šæœŸè¿›è¡Œé€šè¯ï¼Œä½†æ˜¯å¦‚æœmasterä¸Šè®¾ç½®äº†å¯†ç ï¼Œé‚£ä¹ˆå¦‚æœä¸ç»™slaveè®¾ç½®å¯†ç å°±ä¼šå¯¼è‡´</span><br><span class="line">   slaveä¸èƒ½è·Ÿmasterè¿›è¡Œä»»ä½•æ“ä½œï¼Œæ‰€ä»¥å¦‚æœä½ çš„masteræœåŠ¡å™¨ä¸Šæœ‰å¯†ç ï¼Œé‚£ä¹ˆä¹Ÿç»™slaveç›¸åº”çš„è®¾ç½®ä¸€ä¸‹</span><br><span class="line">   å¯†ç å§ï¼ˆé€šè¿‡è®¾ç½®é…ç½®æ–‡ä»¶ä¸­çš„masterauthï¼‰;</span><br><span class="line"><span class="number">4.</span> å…³äºslaveæœåŠ¡å™¨ä¸Šè¿‡æœŸé”®çš„å¤„ç†ï¼Œç”±masteræœåŠ¡å™¨è´Ÿè´£é”®çš„è¿‡æœŸåˆ é™¤å¤„ç†ï¼Œç„¶åå°†ç›¸å…³åˆ é™¤å‘½ä»¤å·²æ•°æ®åŒæ­¥</span><br><span class="line">   çš„æ–¹å¼åŒæ­¥ç»™slaveæœåŠ¡å™¨ï¼ŒslaveæœåŠ¡å™¨æ ¹æ®åˆ é™¤å‘½ä»¤åˆ é™¤æœ¬åœ°çš„keyã€‚</span><br></pre></td></tr></table></figure>

<h2 id="å½“ä¸»æœåŠ¡å™¨ä¸è¿›è¡ŒæŒä¹…åŒ–æ—¶å¤åˆ¶çš„å®‰å…¨æ€§"><a href="#å½“ä¸»æœåŠ¡å™¨ä¸è¿›è¡ŒæŒä¹…åŒ–æ—¶å¤åˆ¶çš„å®‰å…¨æ€§" class="headerlink" title="å½“ä¸»æœåŠ¡å™¨ä¸è¿›è¡ŒæŒä¹…åŒ–æ—¶å¤åˆ¶çš„å®‰å…¨æ€§"></a><strong>å½“ä¸»æœåŠ¡å™¨ä¸è¿›è¡ŒæŒä¹…åŒ–æ—¶å¤åˆ¶çš„å®‰å…¨æ€§</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">åœ¨è¿›è¡Œä¸»ä»å¤åˆ¶è®¾ç½®æ—¶ï¼Œå¼ºçƒˆå»ºè®®åœ¨ä¸»æœåŠ¡å™¨ä¸Šå¼€å¯æŒä¹…åŒ–ï¼Œå½“ä¸èƒ½è¿™ä¹ˆåšæ—¶ï¼Œæ¯”å¦‚è€ƒè™‘åˆ°å»¶è¿Ÿçš„é—®é¢˜ï¼Œ</span><br><span class="line">åº”è¯¥å°†å®ä¾‹é…ç½®ä¸ºé¿å…è‡ªåŠ¨é‡å¯ã€‚</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆä¸æŒä¹…åŒ–çš„ä¸»æœåŠ¡å™¨è‡ªåŠ¨é‡å¯éå¸¸å±é™©å‘¢ï¼Ÿ</span><br><span class="line">ä¸ºäº†æ›´å¥½çš„ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªå¤±è´¥çš„ä¾‹å­ï¼Œå…¶ä¸­ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨ä¸­æ•°æ®åº“éƒ½è¢«åˆ é™¤äº†ã€‚</span><br><span class="line"></span><br><span class="line">è®¾ç½®èŠ‚ç‚¹Aä¸ºä¸»æœåŠ¡å™¨ï¼Œå…³é—­æŒä¹…åŒ–ï¼ŒèŠ‚ç‚¹Bå’ŒCä»èŠ‚ç‚¹Aå¤åˆ¶æ•°æ®ã€‚</span><br><span class="line">è¿™æ—¶å‡ºç°äº†ä¸€ä¸ªå´©æºƒï¼Œä½†Rediså…·æœ‰è‡ªåŠ¨é‡å¯ç³»ç»Ÿï¼Œé‡å¯äº†è¿›ç¨‹ï¼Œå› ä¸ºå…³é—­äº†æŒä¹…åŒ–ï¼ŒèŠ‚ç‚¹é‡å¯ååªæœ‰ä¸€ä¸ªç©ºçš„æ•°æ®é›†</span><br><span class="line">èŠ‚ç‚¹Bå’ŒCä»èŠ‚ç‚¹Aè¿›è¡Œå¤åˆ¶ï¼Œç°åœ¨èŠ‚ç‚¹Aæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥èŠ‚ç‚¹Bå’ŒCä¸Šçš„å¤åˆ¶æ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</span><br><span class="line">å½“åœ¨é«˜å¯ç”¨ç³»ç»Ÿä¸­ä½¿ç”¨Redis Sentinelï¼Œå…³é—­äº†ä¸»æœåŠ¡å™¨çš„æŒä¹…åŒ–ï¼Œå¹¶ä¸”å…è®¸è‡ªåŠ¨é‡å¯ï¼Œè¿™ç§æƒ…å†µæ˜¯å¾ˆå±é™©çš„ã€‚</span><br><span class="line">æ¯”å¦‚ä¸»æœåŠ¡å™¨å¯èƒ½åœ¨å¾ˆçŸ­çš„æ—¶é—´å°±å®Œæˆäº†é‡å¯ï¼Œä»¥è‡³äºSentineléƒ½æ— æ³•æ£€æµ‹åˆ°è¿™æ¬¡å¤±è´¥ï¼Œé‚£ä¹ˆä¸Šé¢è¯´çš„è¿™ç§å¤±è´¥</span><br><span class="line">çš„æƒ…å†µå°±å‘ç”Ÿäº†ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ä¸»ä»å¤åˆ¶æ—¶å…³é—­äº†ä¸»æœåŠ¡å™¨æŒä¹…åŒ–åŠŸèƒ½çš„åœºæ™¯ä¸­ï¼Œéƒ½åº”è¯¥ç¦æ­¢å®ä¾‹è‡ªåŠ¨é‡å¯ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="Redisä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#Redisä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„" class="headerlink" title="Redisä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„"></a><strong>Redisä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">å¦‚æœè®¾ç½®äº†ä¸€ä¸ªä»æœåŠ¡å™¨ï¼Œåœ¨è¿æ¥æ—¶å®ƒå‘é€äº†ä¸€ä¸ªSYNCå‘½ä»¤ï¼Œä¸ç®¡å®ƒæ˜¯ç¬¬ä¸€æ¬¡è¿æ¥è¿˜æ˜¯å†æ¬¡è¿æ¥éƒ½æ²¡æœ‰å…³ç³»ã€‚</span><br><span class="line"> </span><br><span class="line">ç„¶åä¸»æœåŠ¡å™¨å¼€å§‹åå°å­˜å‚¨ï¼Œå¹¶ä¸”å¼€å§‹ç¼“å­˜æ–°è¿æ¥è¿›æ¥çš„ä¿®æ”¹æ•°æ®çš„å‘½ä»¤ã€‚å½“åå°å­˜å‚¨å®Œæˆåï¼Œä¸»æœåŠ¡å™¨æŠŠæ•°æ®æ–‡ä»¶</span><br><span class="line">å‘é€åˆ°ä»æœåŠ¡å™¨ï¼Œ</span><br><span class="line">ä»æœåŠ¡å™¨å°†å…¶ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œç„¶ååŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç„¶åä¸»æœåŠ¡å™¨æŠŠåˆšæ‰ç¼“å­˜çš„å‘½ä»¤å‘é€åˆ°ä»æœåŠ¡å™¨ã€‚è¿™æ˜¯ä½œä¸ºå‘½ä»¤æµ</span><br><span class="line">æ¥å®Œæˆçš„ï¼Œå¹¶ä¸”</span><br><span class="line">å’ŒRedisåè®®æœ¬èº«æ ¼å¼ç›¸åŒã€‚</span><br><span class="line"> </span><br><span class="line">ä½ å¯ä»¥é€šè¿‡telnetè‡ªå·±å°è¯•ä¸€ä¸‹ã€‚åœ¨RedisæœåŠ¡å™¨å·¥ä½œæ—¶è¿æ¥åˆ°Redisç«¯å£ï¼Œå‘é€SYNCå‘½ä»¤ï¼Œä¼šçœ‹åˆ°ä¸€ä¸ªæ‰¹é‡çš„ä¼ è¾“</span><br><span class="line">å¹¶ä¸”ä¸»æœåŠ¡å™¨æ¥æ”¶çš„æ¯ä¸€ä¸ªå‘½ä»¤éƒ½ä¼šé€šè¿‡telnetä¼šè¯é‡æ–°å‘é€ä¸€éã€‚</span><br><span class="line"> </span><br><span class="line">å½“ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ç”±äºæŸäº›åŸå› æ–­å¼€æ—¶ï¼Œä»æœåŠ¡å™¨å¯ä»¥è‡ªåŠ¨è¿›è¡Œé‡è¿æ¥ã€‚å½“æœ‰å¤šä¸ªä»æœåŠ¡å™¨åŒæ—¶è¯·æ±‚åŒæ­¥æ—¶ï¼Œ</span><br><span class="line">ä¸»æœåŠ¡å™¨åªè¿›è¡Œä¸€ä¸ªåå°å­˜å‚¨ã€‚</span><br><span class="line"> </span><br><span class="line">å½“è¿æ¥æ–­å¼€åˆé‡æ–°è¿ä¸Šä¹‹åï¼Œä¸€èˆ¬éƒ½ä¼šè¿›è¡Œä¸€ä¸ªå®Œæ•´çš„é‡æ–°åŒæ­¥ï¼Œä½†æ˜¯ä»Redis2<span class="number">.8</span>å¼€å§‹ï¼Œåªé‡æ–°åŒæ­¥ä¸€éƒ¨åˆ†ä¹Ÿå¯ä»¥ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="éƒ¨åˆ†é‡æ–°åŒæ­¥"><a href="#éƒ¨åˆ†é‡æ–°åŒæ­¥" class="headerlink" title="éƒ¨åˆ†é‡æ–°åŒæ­¥"></a>éƒ¨åˆ†é‡æ–°åŒæ­¥</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä»Redis <span class="number">2.8</span>å¼€å§‹ï¼Œå¦‚æœé­é‡è¿æ¥æ–­å¼€ï¼Œé‡æ–°è¿æ¥ä¹‹åå¯ä»¥ä»ä¸­æ–­å¤„ç»§ç»­è¿›è¡Œå¤åˆ¶ï¼Œè€Œä¸å¿…é‡æ–°åŒæ­¥ã€‚</span><br><span class="line"> </span><br><span class="line">å®ƒçš„å·¥ä½œåŸç†æ˜¯è¿™æ ·ï¼š</span><br><span class="line">ä¸»æœåŠ¡å™¨ç«¯ä¸ºå¤åˆ¶æµç»´æŠ¤ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºï¼ˆ<span class="keyword">in</span>-memory backlogï¼‰ã€‚ä¸»ä»æœåŠ¡å™¨éƒ½ç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡</span><br><span class="line">ï¼ˆreplication offsetï¼‰å’Œmaster run id ï¼Œ</span><br><span class="line">å½“è¿æ¥æ–­å¼€æ—¶ï¼Œä»æœåŠ¡å™¨ä¼šé‡æ–°è¿æ¥ä¸Šä¸»æœåŠ¡å™¨ï¼Œç„¶åè¯·æ±‚ç»§ç»­å¤åˆ¶ï¼Œå‡å¦‚ä¸»ä»æœåŠ¡å™¨çš„ä¸¤ä¸ªmaster run idç›¸åŒï¼Œ</span><br><span class="line">å¹¶ä¸”æŒ‡å®šçš„åç§»é‡åœ¨å†…å­˜ç¼“å†²åŒºä¸­è¿˜æœ‰æ•ˆï¼Œå¤åˆ¶å°±ä¼šä»ä¸Šæ¬¡ä¸­æ–­çš„ç‚¹å¼€å§‹ç»§ç»­ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¼šè¿›è¡Œ</span><br><span class="line">å®Œå…¨é‡æ–°åŒæ­¥ï¼ˆåœ¨<span class="number">2.8</span>ç‰ˆæœ¬ä¹‹å‰å°±æ˜¯ç›´æ¥è¿›è¡Œå®Œå…¨é‡æ–°åŒæ­¥ï¼‰ã€‚</span><br><span class="line">å› ä¸ºä¸»è¿è¡Œidä¸ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œå¦‚æœä»æœåŠ¡å™¨é‡å¯äº†çš„è¯å°±åªèƒ½è¿›è¡Œå®Œå…¨åŒæ­¥äº†ã€‚</span><br><span class="line"> </span><br><span class="line">éƒ¨åˆ†é‡æ–°åŒæ­¥è¿™ä¸ªæ–°ç‰¹æ€§å†…éƒ¨ä½¿ç”¨PSYNCå‘½ä»¤ï¼Œæ—§çš„å®ç°ä¸­ä½¿ç”¨SYNCå‘½ä»¤ã€‚Redis2<span class="number">.8</span>ç‰ˆæœ¬å¯ä»¥æ£€æµ‹å‡ºå®ƒæ‰€è¿æ¥çš„</span><br><span class="line">æœåŠ¡å™¨æ˜¯å¦æ”¯æŒPSYNCå‘½ä»¤ï¼Œä¸æ”¯æŒçš„è¯ä½¿ç”¨SYNCå‘½ä»¤ã€‚</span><br></pre></td></tr></table></figure>





<h2 id="æ— ç£ç›˜å¤åˆ¶"><a href="#æ— ç£ç›˜å¤åˆ¶" class="headerlink" title="æ— ç£ç›˜å¤åˆ¶"></a>æ— ç£ç›˜å¤åˆ¶</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">é€šå¸¸æ¥è®²ï¼Œä¸€ä¸ªå®Œå…¨é‡æ–°åŒæ­¥éœ€è¦åœ¨ç£ç›˜ä¸Šåˆ›å»ºä¸€ä¸ªRDBæ–‡ä»¶ï¼Œç„¶ååŠ è½½è¿™ä¸ªæ–‡ä»¶ä»¥ä¾¿ä¸ºä»æœåŠ¡å™¨å‘é€æ•°æ®ã€‚</span><br><span class="line"> </span><br><span class="line">å¦‚æœä½¿ç”¨æ¯”è¾ƒä½é€Ÿçš„ç£ç›˜ï¼Œè¿™ç§æ“ä½œä¼šç»™ä¸»æœåŠ¡å™¨å¸¦æ¥è¾ƒå¤§çš„å‹åŠ›ã€‚Redisä»<span class="number">2.8</span><span class="number">.18</span>ç‰ˆæœ¬å¼€å§‹å°è¯•æ”¯æŒæ— ç£ç›˜çš„å¤åˆ¶ã€‚</span><br><span class="line">ä½¿ç”¨è¿™ç§è®¾ç½®æ—¶ï¼Œå­è¿›ç¨‹ç›´æ¥å°†RDBé€šè¿‡ç½‘ç»œå‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä¸ä½¿ç”¨ç£ç›˜ä½œä¸ºä¸­é—´å­˜å‚¨ã€‚</span><br></pre></td></tr></table></figure>



<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä¸»ä»å¤åˆ¶çš„é…ç½®ååˆ†ç®€å•ï¼šæŠŠä¸‹é¢è¿™è¡ŒåŠ å…¥åˆ°ä»æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ä¸­å³å¯ã€‚</span><br><span class="line">slaveof <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">6379</span></span><br><span class="line"> </span><br><span class="line">å½“ç„¶ä½ éœ€è¦æŠŠå…¶ä¸­çš„<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">6379</span>æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ä¸»æœåŠ¡å™¨IPï¼ˆæˆ–è€…ä¸»æœºåhostnameï¼‰å’Œç«¯å£ã€‚å¦å¤–ä½ å¯ä»¥</span><br><span class="line">è°ƒç”¨SLAVEOFå‘½ä»¤ï¼Œ</span><br><span class="line">ä¸»æœåŠ¡å™¨å°±ä¼šå¼€å§‹ä¸ä»æœåŠ¡å™¨åŒæ­¥ã€‚</span><br><span class="line"> </span><br><span class="line">å…³äºéƒ¨åˆ†é‡æ–°åŒæ­¥ï¼Œè¿˜æœ‰ä¸€äº›é’ˆå¯¹å¤åˆ¶å†…å­˜ç¼“å†²åŒºçš„ä¼˜åŒ–å‚æ•°ã€‚æŸ¥çœ‹Redisä»‹è´¨ä¸­çš„Redis.confç¤ºä¾‹è·å¾—æ›´å¤šä¿¡æ¯ã€‚</span><br><span class="line"> </span><br><span class="line">ä½¿ç”¨repl-diskless-syncé…ç½®å‚æ•°æ¥å¯åŠ¨æ— ç£ç›˜å¤åˆ¶ã€‚ä½¿ç”¨repl-diskless-sync-delay å‚æ•°æ¥é…ç½®ä¼ è¾“å¼€å§‹</span><br><span class="line">çš„å»¶è¿Ÿæ—¶é—´ï¼Œä»¥ä¾¿ç­‰å¾…</span><br><span class="line">æ›´å¤šçš„ä»æœåŠ¡å™¨è¿æ¥ä¸Šæ¥ã€‚æŸ¥çœ‹Redisä»‹è´¨ä¸­çš„Redis.confç¤ºä¾‹è·å¾—æ›´å¤šä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="åªè¯»ä»æœåŠ¡å™¨"><a href="#åªè¯»ä»æœåŠ¡å™¨" class="headerlink" title="åªè¯»ä»æœåŠ¡å™¨"></a>åªè¯»ä»æœåŠ¡å™¨</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä»Redis <span class="number">2.6</span>å¼€å§‹ï¼Œä»æœåŠ¡å™¨æ”¯æŒåªè¯»æ¨¡å¼ï¼Œå¹¶ä¸”æ˜¯é»˜è®¤æ¨¡å¼ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯ç”±Redis.confæ–‡ä»¶ä¸­çš„</span><br><span class="line">slave-read-only å‚æ•°æ§åˆ¶çš„ï¼Œå¯ä»¥åœ¨è¿è¡Œä¸­é€šè¿‡CONFIG SETæ¥å¯ç”¨æˆ–è€…ç¦ç”¨ã€‚</span><br><span class="line"> </span><br><span class="line">åªè¯»çš„ä»æœåŠ¡å™¨ä¼šæ‹’ç»æ‰€æœ‰å†™å‘½ä»¤ï¼Œæ‰€ä»¥å¯¹ä»æœåŠ¡å™¨ä¸ä¼šæœ‰è¯¯å†™æ“ä½œã€‚ä½†è¿™ä¸è¡¨ç¤ºå¯ä»¥æŠŠä»æœåŠ¡å™¨å®ä¾‹æš´éœ²</span><br><span class="line">åœ¨å±é™©çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œ</span><br><span class="line">å› ä¸ºåƒDEBUGæˆ–è€…CONFIGè¿™æ ·çš„ç®¡ç†å‘½ä»¤è¿˜æ˜¯å¯ä»¥è¿è¡Œçš„ã€‚ä¸è¿‡ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨rename-commandå‘½ä»¤</span><br><span class="line">æ¥ä¸ºè¿™äº›å‘½ä»¤æ”¹åæ¥å¢åŠ å®‰å…¨æ€§ã€‚</span><br><span class="line"> </span><br><span class="line">ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆåªè¯»é™åˆ¶è¿˜å¯ä»¥è¢«è¿˜åŸï¼Œä½¿å¾—ä»æœåŠ¡å™¨è¿˜å¯ä»¥è¿›è¡Œå†™æ“ä½œã€‚è™½ç„¶å½“ä¸»ä»æœåŠ¡å™¨è¿›è¡Œ</span><br><span class="line">é‡æ–°åŒæ­¥æˆ–è€…ä»æœåŠ¡å™¨é‡å¯åï¼Œ</span><br><span class="line">è¿™äº›å†™æ“ä½œéƒ½ä¼šå¤±æ•ˆï¼Œè¿˜æ˜¯æœ‰ä¸€äº›ä½¿ç”¨åœºæ™¯ä¼šæƒ³ä»æœåŠ¡å™¨ä¸­å†™å…¥ä¸´æ—¶æ•°æ®çš„ï¼Œä½†å°†æ¥è¿™ä¸ªç‰¹æ€§å¯èƒ½ä¼šè¢«å»æ‰ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="é™åˆ¶æœ‰Nä¸ªä»¥ä¸Šä»æœåŠ¡å™¨æ‰å…è®¸å†™å…¥"><a href="#é™åˆ¶æœ‰Nä¸ªä»¥ä¸Šä»æœåŠ¡å™¨æ‰å…è®¸å†™å…¥" class="headerlink" title="é™åˆ¶æœ‰Nä¸ªä»¥ä¸Šä»æœåŠ¡å™¨æ‰å…è®¸å†™å…¥"></a>é™åˆ¶æœ‰Nä¸ªä»¥ä¸Šä»æœåŠ¡å™¨æ‰å…è®¸å†™å…¥</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä»Redis <span class="number">2.8</span>ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥é…ç½®ä¸»æœåŠ¡å™¨è¿æ¥Nä¸ªä»¥ä¸Šä»æœåŠ¡å™¨æ‰å…è®¸å¯¹ä¸»æœåŠ¡å™¨è¿›è¡Œå†™æ“ä½œã€‚</span><br><span class="line">ä½†æ˜¯ï¼Œå› ä¸ºRedisä½¿ç”¨çš„æ˜¯å¼‚æ­¥ä¸»ä»å¤åˆ¶ï¼Œ</span><br><span class="line">æ²¡åŠæ³•ç¡®ä¿ä»æœåŠ¡å™¨ç¡®å®æ”¶åˆ°äº†è¦å†™å…¥çš„æ•°æ®ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰ä¸€å®šçš„æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚</span><br><span class="line"> </span><br><span class="line">è¿™ä¸€ç‰¹æ€§çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="number">1</span>ï¼‰ä»æœåŠ¡å™¨æ¯ç§’é’Ÿpingä¸€æ¬¡ä¸»æœåŠ¡å™¨ï¼Œç¡®è®¤å¤„ç†çš„å¤åˆ¶æµæ•°é‡ã€‚</span><br><span class="line"><span class="number">2</span>ï¼‰ä¸»æœåŠ¡å™¨è®°ä½æ¯ä¸ªä»æœåŠ¡å™¨æœ€è¿‘ä¸€æ¬¡pingçš„æ—¶é—´ã€‚</span><br><span class="line"><span class="number">3</span>ï¼‰ç”¨æˆ·å¯ä»¥é…ç½®æœ€å°‘è¦æœ‰Nä¸ªæœåŠ¡å™¨æœ‰å°äºMç§’çš„ç¡®è®¤å»¶è¿Ÿã€‚</span><br><span class="line"><span class="number">4</span>ï¼‰å¦‚æœæœ‰Nä¸ªä»¥ä¸Šä»æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç¡®è®¤å»¶è¿Ÿå°äºMç§’ï¼Œä¸»æœåŠ¡å™¨æ¥å—å†™æ“ä½œã€‚</span><br><span class="line"> </span><br><span class="line">è¿˜å¯ä»¥æŠŠè¿™çœ‹åšæ˜¯CAPåŸåˆ™ï¼ˆä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹é”™æ€§ï¼‰ä¸ä¸¥æ ¼çš„ä¸€è‡´æ€§å®ç°ï¼Œè™½ç„¶ä¸èƒ½</span><br><span class="line">ç™¾åˆ†ç™¾ç¡®ä¿ä¸€è‡´æ€§ï¼Œä½†è‡³å°‘ä¿è¯äº†ä¸¢å¤±çš„æ•°æ®ä¸ä¼šè¶…è¿‡Mç§’å†…çš„æ•°æ®é‡ã€‚</span><br><span class="line"> </span><br><span class="line">å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œä¸»æœåŠ¡å™¨ä¼šæ‹’ç»å†™æ“ä½œå¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</span><br><span class="line"><span class="number">1</span>ï¼‰min-slaves-to-writeï¼ˆæœ€å°ä»æœåŠ¡å™¨æ•°ï¼‰</span><br><span class="line"><span class="number">2</span>ï¼‰min-slaves-max-lagï¼ˆä»æœåŠ¡å™¨æœ€å¤§ç¡®è®¤å»¶è¿Ÿï¼‰</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>RedisæŒä¹…åŒ–</title>
    <url>/2020/03/18/Redis%E6%8C%81%E4%B9%85%E5%8C%96/</url>
    <content><![CDATA[<h2 id="Rediså®˜ç½‘"><a href="#Rediså®˜ç½‘" class="headerlink" title="Rediså®˜ç½‘"></a>Rediså®˜ç½‘</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">https://redis.io/		<span class="comment">#å®˜æ–¹æ–‡æ¡£</span></span><br><span class="line">http://redis.cn/		<span class="comment">#ä¸­æ–‡æ–‡æ¡£</span></span><br></pre></td></tr></table></figure>





<h2 id="ä¸ºä»€ä¹ˆè¦åšæŒä¹…åŒ–å­˜å‚¨"><a href="#ä¸ºä»€ä¹ˆè¦åšæŒä¹…åŒ–å­˜å‚¨" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åšæŒä¹…åŒ–å­˜å‚¨?"></a>ä¸ºä»€ä¹ˆè¦åšæŒä¹…åŒ–å­˜å‚¨?</h2><p>æŒä¹…åŒ–å­˜å‚¨æ˜¯å°† Redis å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œå®ç°æ•°æ®çš„æ°¸ä¹…ä¿å­˜ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ Redis æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„ nosql æ•°æ®åº“ï¼Œå†…å­˜å­˜å‚¨å¾ˆå®¹æ˜“é€ æˆæ•°æ®çš„ä¸¢å¤±ï¼Œå› ä¸ºå½“æœåŠ¡å™¨å…³æœºç­‰ä¸€äº›å¼‚å¸¸æƒ…å†µéƒ½ä¼šå¯¼è‡´å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®ä¸¢å¤±ã€‚ </p>
<a id="more"></a>

<h2 id="æŒä¹…åŒ–å­˜å‚¨åˆ†ç±»"><a href="#æŒä¹…åŒ–å­˜å‚¨åˆ†ç±»" class="headerlink" title="æŒä¹…åŒ–å­˜å‚¨åˆ†ç±»"></a>æŒä¹…åŒ–å­˜å‚¨åˆ†ç±»</h2><p>åœ¨ Redis ä¸­ï¼ŒæŒä¹…åŒ–å­˜å‚¨åˆ†ä¸ºä¸¤ç§ã€‚ä¸€ç§æ˜¯ RDBæ•°æ®å¿«ç…§çš„æ–¹å¼ï¼Œå¦å¤–ä¸€ç§æ˜¯ AOFæ—¥å¿—è¿½åŠ çš„æ–¹å¼ã€‚ </p>
<h2 id="RDBæŒä¹…åŒ–åŸç†"><a href="#RDBæŒä¹…åŒ–åŸç†" class="headerlink" title="RDBæŒä¹…åŒ–åŸç†"></a><strong>RDBæŒä¹…åŒ–åŸç†</strong></h2><ol>
<li>RDBæŒä¹…åŒ–æ˜¯æŒ‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</li>
<li>å®é™…æ“ä½œè¿‡ç¨‹æ˜¯forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…ˆå°†æ•°æ®é›†å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸåï¼Œå†æ›¿æ¢ä¹‹å‰çš„æ–‡ä»¶ï¼Œç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ </li>
</ol>
<img src="/2020/03/18/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1080958-20180314095937765-220628310.png" class="">

<h2 id="RDBæŒä¹…åŒ–"><a href="#RDBæŒä¹…åŒ–" class="headerlink" title="RDBæŒä¹…åŒ–"></a>RDBæŒä¹…åŒ–</h2><h3 id="1-æ‰‹åŠ¨æ‰§è¡ŒæŒ‡ä»¤è§¦å‘-è¿›è¡Œå­˜å‚¨"><a href="#1-æ‰‹åŠ¨æ‰§è¡ŒæŒ‡ä»¤è§¦å‘-è¿›è¡Œå­˜å‚¨" class="headerlink" title="1. æ‰‹åŠ¨æ‰§è¡ŒæŒ‡ä»¤è§¦å‘, è¿›è¡Œå­˜å‚¨"></a>1. æ‰‹åŠ¨æ‰§è¡ŒæŒ‡ä»¤è§¦å‘, è¿›è¡Œå­˜å‚¨</h3><ul>
<li>saveã€€ã€€ã€€ã€€ã€€ã€€è¿™ä¸ªæŒ‡ä»¤ä¼šé˜»å¡redis, æ‰§è¡Œå®Œä¹‹å‰ä¸å†æ¥æ”¶å…¶ä»–å¤„ç†</li>
<li>bgsaveã€€ã€€ã€€ã€€ã€€è¿™ä¸ªæŒ‡ä»¤ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹å»å¤„ç†æŒä¹…åŒ–å­˜å‚¨, çº¿ä¸Šä½¿ç”¨</li>
</ul>
<h3 id="2-é…ç½®confæ–‡ä»¶è§¦å‘è‡ªåŠ¨å­˜å‚¨"><a href="#2-é…ç½®confæ–‡ä»¶è§¦å‘è‡ªåŠ¨å­˜å‚¨" class="headerlink" title="2. é…ç½®confæ–‡ä»¶è§¦å‘è‡ªåŠ¨å­˜å‚¨"></a>2. é…ç½®confæ–‡ä»¶è§¦å‘è‡ªåŠ¨å­˜å‚¨</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">daemonize yes                    <span class="comment">#åå°è¿è¡Œ</span></span><br><span class="line">bind <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>                   <span class="comment">#redisç»‘å®šåœ°å€</span></span><br><span class="line">port <span class="number">6379</span>                        <span class="comment">#ç«¯å£</span></span><br><span class="line">requirepass redhat                <span class="comment">#redisç™»å½•å¯†ç </span></span><br><span class="line">logfile /data/<span class="number">6379</span>/redis.log    <span class="comment">#æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">dir /data/<span class="number">6379</span>                  <span class="comment">#å®šä¹‰æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨ä½ç½®</span></span><br><span class="line"></span><br><span class="line">dbfilename  dbmp.rdb            <span class="comment">#rdbæŒä¹…åŒ–æ–‡ä»¶</span></span><br><span class="line">save <span class="number">900</span> <span class="number">1</span>                    </span><br><span class="line">save <span class="number">300</span> <span class="number">10</span>                        </span><br><span class="line">save <span class="number">60</span>  <span class="number">10000</span>                   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">save m n   å½“mç§’å, è¾¾åˆ°nä¸ªå­˜å‚¨, å°±æ‰§è¡ŒbgsaveæŒ‡ä»¤, è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</span><br><span class="line"></span><br><span class="line">å…¶ä»–å¯é€‰é…ç½®</span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yesã€€ã€€<span class="comment"># å½“bgsaveå‡ºç°é”™è¯¯æ—¶ï¼ŒRedisæ˜¯å¦åœæ­¢æ‰§è¡Œå†™å‘½ä»¤ï¼›è®¾ç½®ä¸ºyesï¼Œåˆ™å½“ç¡¬ç›˜å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥åŠæ—¶å‘ç°ï¼Œé¿å…æ•°æ®çš„å¤§é‡ä¸¢å¤±ï¼›è®¾ç½®ä¸ºnoï¼Œåˆ™Redisæ— è§†bgsaveçš„é”™è¯¯ç»§ç»­æ‰§è¡Œå†™å‘½ä»¤ï¼Œå½“å¯¹RedisæœåŠ¡å™¨çš„ç³»ç»Ÿ(å°¤å…¶æ˜¯ç¡¬ç›˜)ä½¿ç”¨äº†ç›‘æ§æ—¶ï¼Œè¯¥é€‰é¡¹è€ƒè™‘è®¾ç½®ä¸ºno</span></span><br><span class="line"></span><br><span class="line">rdbcompression yesã€€ã€€<span class="comment"># æ˜¯å¦å¼€å¯RDBæ–‡ä»¶å‹ç¼©</span></span><br><span class="line"></span><br><span class="line">rdbchecksum yesã€€ã€€ã€€ã€€<span class="comment"># æ˜¯å¦å¼€å¯RDBæ–‡ä»¶çš„æ ¡éªŒï¼Œåœ¨å†™å…¥æ–‡ä»¶å’Œè¯»å–æ–‡ä»¶æ—¶éƒ½èµ·ä½œç”¨ï¼›å…³é—­checksumåœ¨å†™å…¥æ–‡ä»¶å’Œå¯åŠ¨æ–‡ä»¶æ—¶å¤§çº¦èƒ½å¸¦æ¥10%çš„æ€§èƒ½æå‡ï¼Œä½†æ˜¯æ•°æ®æŸåæ—¶æ— æ³•å‘ç°</span></span><br></pre></td></tr></table></figure>

<h2 id="AOFæŒä¹…åŒ–åŸç†"><a href="#AOFæŒä¹…åŒ–åŸç†" class="headerlink" title="AOFæŒä¹…åŒ–åŸç†"></a><strong>AOFæŒä¹…åŒ–åŸç†</strong></h2><p>AOFæŒä¹…åŒ–ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„æ¯ä¸€ä¸ªå†™ã€åˆ é™¤æ“ä½œï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šè®°å½•ï¼Œä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶çœ‹åˆ°è¯¦ç»†çš„æ“ä½œè®°å½•ã€‚ </p>
<img src="/2020/03/18/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1080958-20180314100424696-1890061620.png" class="">

<h2 id="AOFæŒä¹…åŒ–"><a href="#AOFæŒä¹…åŒ–" class="headerlink" title="AOFæŒä¹…åŒ–"></a><strong>AOFæŒä¹…åŒ–</strong></h2><h2 id="1-è§¦å‘é…ç½®"><a href="#1-è§¦å‘é…ç½®" class="headerlink" title="1. è§¦å‘é…ç½®"></a>1. è§¦å‘é…ç½®</h2><ul>
<li>RedisæœåŠ¡é»˜è®¤å¼€å¯RDB, å…³é—­AOF; å¼€å¯AOFåªåœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ appendonly yes</li>
<li>å¯åŠ¨RedisæœåŠ¡æ—¶ä¼šä¼˜å…ˆåŠ è½½AOF</li>
</ul>
<h2 id="2-AOFçš„å¸¸è§é…ç½®"><a href="#2-AOFçš„å¸¸è§é…ç½®" class="headerlink" title="2. AOFçš„å¸¸è§é…ç½®"></a>2. AOFçš„å¸¸è§é…ç½®</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">appendonly no        <span class="comment"># æ˜¯å¦å¼€å¯AOF</span></span><br><span class="line"></span><br><span class="line">appendfilename <span class="string">"appendonly.aof"</span>    <span class="comment"># AOFæ–‡ä»¶å</span></span><br><span class="line"></span><br><span class="line">dir /data/<span class="number">6379</span>                  <span class="comment"># å®šä¹‰æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨ä½ç½®</span></span><br><span class="line"></span><br><span class="line">appendfsync everysec    <span class="comment"># æŒä¹…åŒ–ç­–ç•¥,æ¯ç§’éƒ½å­˜, alwaysæ€»æ˜¯</span></span><br><span class="line"></span><br><span class="line">no-appendfsync-on-rewrite no     <span class="comment"># AOFé‡å†™æœŸé—´æ˜¯å¦ç¦æ­¢fsyncï¼›å¦‚æœå¼€å¯è¯¥é€‰é¡¹ï¼Œå¯ä»¥å‡è½»æ–‡ä»¶é‡å†™æ—¶CPUå’Œç¡¬ç›˜çš„è´Ÿè½½ï¼ˆå°¤å…¶æ˜¯ç¡¬ç›˜ï¼‰ï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸¢å¤±AOFé‡å†™æœŸé—´çš„æ•°æ®ï¼›éœ€è¦åœ¨è´Ÿè½½å’Œå®‰å…¨æ€§ä¹‹é—´è¿›è¡Œå¹³è¡¡</span></span><br><span class="line"></span><br><span class="line">auto-aof-rewrite-percentage <span class="number">100</span>    <span class="comment"># æ‰§è¡ŒAOFé‡å†™æ—¶ï¼Œå½“å‰AOFå¤§å°(å³aof_current_size)å’Œä¸Šä¸€æ¬¡é‡å†™æ—¶AOFå¤§å°(aof_base_size)çš„æ¯”å€¼ã€‚</span></span><br><span class="line"></span><br><span class="line">auto-aof-rewrite-min-size <span class="number">64</span>mb     <span class="comment"># æ‰§è¡ŒAOFé‡å†™æ—¶ï¼Œæ–‡ä»¶çš„æœ€å°ä½“ç§¯ï¼Œé»˜è®¤å€¼ä¸º64MBã€‚</span></span><br><span class="line"></span><br><span class="line">aof-load-truncated yes    <span class="comment"># å¦‚æœAOFæ–‡ä»¶ç»“å°¾æŸåï¼ŒRediså¯åŠ¨æ—¶æ˜¯å¦ä»è½½å…¥AOFæ–‡ä»¶</span></span><br></pre></td></tr></table></figure>



<h2 id="RDBä¼˜ç¼ºç‚¹ä»‹ç»"><a href="#RDBä¼˜ç¼ºç‚¹ä»‹ç»" class="headerlink" title="RDBä¼˜ç¼ºç‚¹ä»‹ç»"></a><strong>RDBä¼˜ç¼ºç‚¹ä»‹ç»</strong></h2><h3 id="1-RDBä¼˜ç‚¹"><a href="#1-RDBä¼˜ç‚¹" class="headerlink" title="1. RDBä¼˜ç‚¹"></a><strong>1. RDBä¼˜ç‚¹</strong></h3><ol>
<li>æ•´ä¸ªRedisæ•°æ®åº“å°†åªåŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸€æ—¦ç³»ç»Ÿå‡ºç°ç¾éš¾æ€§æ•…éšœï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸å®¹æ˜“çš„è¿›è¡Œæ¢å¤ã€‚</li>
<li>æ€§èƒ½æœ€å¤§åŒ–ï¼Œå®ƒä»…éœ€è¦forkå‡ºå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹å®ŒæˆæŒä¹…åŒ–å·¥ä½œï¼Œæå¤§çš„é¿å…æœåŠ¡è¿›ç¨‹æ‰§è¡ŒIOæ“ä½œäº†ã€‚</li>
<li>ç›¸æ¯”äºAOFæœºåˆ¶ï¼Œå¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼ŒRDBçš„å¯åŠ¨æ•ˆç‡ä¼šæ›´é«˜</li>
</ol>
<h3 id="2-RDBç¼ºç‚¹"><a href="#2-RDBç¼ºç‚¹" class="headerlink" title="2. RDBç¼ºç‚¹"></a><strong>2. RDBç¼ºç‚¹</strong></h3><ol>
<li>RDBå®¹æ˜“ä¸¢æ•°æ®ï¼Œå› ä¸ºç³»ç»Ÿä¸€æ—¦åœ¨å®šæ—¶æŒä¹…åŒ–ä¹‹å‰å‡ºç°å®•æœºç°è±¡ï¼Œæ­¤å‰æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç£ç›˜çš„æ•°æ®éƒ½å°†ä¸¢</li>
<li>RDBé€šè¿‡forkå­è¿›ç¨‹æ¥å®ŒæˆæŒä¹…åŒ–çš„ï¼Œå¦‚æœå½“æ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨åœæ­¢æœåŠ¡å‡ ç™¾æ¯«ç§’ï¼Œç”šè‡³æ˜¯1ç§’é’Ÿã€‚</li>
</ol>
<h2 id="AOFä¼˜ç¼ºç‚¹ä»‹ç»"><a href="#AOFä¼˜ç¼ºç‚¹ä»‹ç»" class="headerlink" title="AOFä¼˜ç¼ºç‚¹ä»‹ç»"></a><strong>AOFä¼˜ç¼ºç‚¹ä»‹ç»</strong></h2><h3 id="1-AOFä¼˜ç‚¹"><a href="#1-AOFä¼˜ç‚¹" class="headerlink" title="1. AOFä¼˜ç‚¹"></a><strong>1. AOFä¼˜ç‚¹</strong></h3><ol>
<li>æ•°æ®å®‰å…¨æ€§é«˜ï¼ŒRedisä¸­æä¾›äº†3ä¸­åŒæ­¥ç­–ç•¥ï¼Œå³æ¯ç§’åŒæ­¥ã€æ¯ä¿®æ”¹åŒæ­¥å’Œä¸åŒæ­¥</li>
<li>ç”±äºè¯¥æœºåˆ¶å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥æ“ä½œé‡‡ç”¨çš„æ˜¯appendæ¨¡å¼ï¼Œå› æ­¤åœ¨å†™å…¥è¿‡ç¨‹ä¸­å³ä½¿å‡ºç°å®•æœºç°è±¡ï¼Œä¹Ÿä¸ä¼šç ´åæ—¥å¿—æ–‡ä»¶ä¸­å·²ç»å­˜åœ¨çš„å†…å®¹</li>
<li>å¦‚æœæ—¥å¿—è¿‡å¤§ï¼ŒRediså¯ä»¥è‡ªåŠ¨å¯ç”¨rewriteæœºåˆ¶ã€‚å³Redisä»¥appendæ¨¡å¼ä¸æ–­çš„å°†ä¿®æ”¹æ•°æ®å†™å…¥åˆ°è€çš„ç£ç›˜æ–‡ä»¶ä¸­</li>
<li>AOFåŒ…å«ä¸€ä¸ªæ ¼å¼æ¸…æ™°ã€æ˜“äºç†è§£çš„æ—¥å¿—æ–‡ä»¶ç”¨äºè®°å½•æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶å®Œæˆæ•°æ®çš„é‡å»º</li>
</ol>
<h3 id="2-AOFç¼ºç‚¹"><a href="#2-AOFç¼ºç‚¹" class="headerlink" title="2. AOFç¼ºç‚¹"></a><strong>2. AOFç¼ºç‚¹</strong></h3><ol>
<li>å¯¹äºç›¸åŒæ•°é‡çš„æ•°æ®é›†è€Œè¨€ï¼ŒAOFæ–‡ä»¶é€šå¸¸è¦å¤§äºRDBæ–‡ä»¶ï¼ŒRDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</li>
<li>AOFåœ¨è¿è¡Œæ•ˆç‡ä¸Šå¾€å¾€ä¼šæ…¢äºRDB</li>
</ol>
<h2 id="é€‰æ‹©AOFè¿˜æ˜¯RDBè¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–"><a href="#é€‰æ‹©AOFè¿˜æ˜¯RDBè¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–" class="headerlink" title="é€‰æ‹©AOFè¿˜æ˜¯RDBè¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–"></a>é€‰æ‹©AOFè¿˜æ˜¯RDBè¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–</h2><ol>
<li>é’ˆå¯¹ä¸åŒçš„æƒ…å†µæ¥é€‰æ‹©ï¼Œå»ºè®®ä½¿ç”¨ä¸¤ç§æ–¹å¼ç›¸ç»“åˆ. </li>
<li>é’ˆå¯¹æ•°æ®å®‰å…¨æ€§ã€å®Œæ•´æ€§è¦æ±‚é«˜çš„é‡‡ç”¨aofæ–¹å¼. </li>
<li>é’ˆå¯¹ä¸å¤ªé‡è¦çš„æ•°æ®å¯ä»¥ä½¿ç”¨rdbæ–¹å¼. </li>
<li>å¯¹äºæ•°æ®è¿›è¡Œå…¨é‡å¤‡ä»½ï¼Œä¾¿äºæ•°æ®å¤‡ä»½çš„å¯ä»¥é‡‡ç”¨rdbæ–¹å¼. </li>
</ol>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢å‘å¯¹è±¡</title>
    <url>/2020/03/10/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<h2 id="é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"><a href="#é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«" class="headerlink" title="é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"></a>é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«</h2><p>é¢å‘è¿‡ç¨‹æ˜¯<br>åˆ†æå‡ºè§£å†³é—®é¢˜æ‰€éœ€è¦çš„æ­¥éª¤ï¼Œç„¶åç”¨å‡½æ•°æŠŠè¿™äº›æ­¥éª¤ä¸€æ­¥ä¸€æ­¥å®ç°ï¼Œä½¿ç”¨çš„æ—¶å€™ä¸€ä¸ªä¸€ä¸ªä¾æ¬¡è°ƒç”¨å°±å¯ä»¥äº†<br>é¢å‘å¯¹è±¡æ˜¯<br>æŠŠæ„æˆé—®é¢˜äº‹åŠ¡åˆ†è§£æˆå„ä¸ªå¯¹è±¡ï¼Œå»ºç«‹å¯¹è±¡çš„ç›®çš„ä¸æ˜¯ä¸ºäº†å®Œæˆä¸€ä¸ªæ­¥éª¤ï¼Œè€Œæ˜¯ä¸ºäº†æå™æŸä¸ªäº‹ç‰©åœ¨æ•´ä¸ªè§£å†³é—®é¢˜çš„æ­¥éª¤ä¸­çš„è¡Œä¸º</p>
<a id="more"></a>

<p>å¯ä»¥æ‹¿ç”Ÿæ´»ä¸­çš„å®ä¾‹æ¥ç†è§£é¢å‘è¿‡ç¨‹ä¸é¢å‘å¯¹è±¡ï¼Œä¾‹å¦‚äº”å­æ£‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">é¢å‘è¿‡ç¨‹çš„è®¾è®¡æ€è·¯å°±æ˜¯ï¼š</span><br><span class="line">é¦–å…ˆåˆ†æé—®é¢˜çš„æ­¥éª¤ï¼š</span><br><span class="line"><span class="number">1</span>ã€å¼€å§‹æ¸¸æˆï¼Œ<span class="number">2</span>ã€é»‘å­å…ˆèµ°ï¼Œ<span class="number">3</span>ã€ç»˜åˆ¶ç”»é¢ï¼Œ<span class="number">4</span>ã€åˆ¤æ–­è¾“èµ¢ï¼Œ<span class="number">5</span>ã€è½®åˆ°ç™½å­ï¼Œ<span class="number">6</span>ã€ç»˜åˆ¶ç”»é¢ï¼Œ<span class="number">7</span>ã€åˆ¤æ–­è¾“èµ¢ï¼Œ<span class="number">8</span>ã€è¿”å›æ­¥éª¤<span class="number">2</span>ï¼Œ<span class="number">9</span>ã€è¾“å‡ºæœ€åç»“æœã€</span><br><span class="line">æŠŠä¸Šé¢æ¯ä¸ªæ­¥éª¤ç”¨ä¸åŒçš„æ–¹æ³•æ¥å®ç°</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">é¢å‘å¯¹è±¡çš„è®¾è®¡æ€è·¯å°±æ˜¯ï¼š</span><br><span class="line">æ•´ä¸ªäº”å­æ£‹å¯ä»¥åˆ†ä¸º<span class="number">1</span>ã€é»‘ç™½åŒæ–¹ï¼Œè¿™ä¸¤æ–¹çš„è¡Œä¸ºæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œ<span class="number">2</span>ã€æ£‹ç›˜ç³»ç»Ÿï¼Œè´Ÿè´£ç»˜åˆ¶ç”»é¢ï¼Œ<span class="number">3</span>ã€è§„åˆ™ç³»ç»Ÿï¼Œè´Ÿè´£åˆ¤å®šè¯¸å¦‚çŠ¯è§„ã€è¾“èµ¢ç­‰</span><br><span class="line">ç¬¬ä¸€ç±»å¯¹è±¡ï¼ˆç©å®¶å¯¹è±¡ï¼‰è´Ÿè´£æ¥å—ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å‘ŠçŸ¥ç¬¬äºŒç±»å¯¹è±¡ï¼ˆæ£‹ç›˜å¯¹è±¡ï¼‰æ£‹å­å¸ƒå±€çš„å˜åŒ–ï¼Œæ£‹ç›˜å¯¹è±¡æ¥æ”¶åˆ°äº†æ£‹å­çš„å˜åŒ–å°±è¦è´Ÿè´£åœ¨å±å¹•ä¸Š`é¢æ˜¾ç¤ºå‡ºè¿™ç§å˜åŒ–ï¼ŒåŒæ—¶åˆ©ç”¨ç¬¬ä¸‰ç±»å¯¹è±¡ï¼ˆè§„åˆ™ç³»ç»Ÿï¼‰æ¥å¯¹æ£‹å±€è¿›è¡Œåˆ¤å®š</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æ˜æ˜¾åœ°çœ‹å‡º é¢å‘å¯¹è±¡æ˜¯ä»¥åŠŸèƒ½æ¥åˆ’åˆ†é—®é¢˜ï¼Œè€Œä¸æ˜¯æ­¥éª¤ã€‚åŒæ ·æ˜¯ç»˜åˆ¶æ£‹å±€ï¼Œè¿™æ ·çš„è¡Œä¸ºåœ¨é¢å‘è¿‡ç¨‹çš„è®¾è®¡ä¸­åˆ†æ•£åœ¨äº†å¤šä¸ªæ­¥éª¤ä¸­ï¼Œå¾ˆå¯èƒ½å‡ºç°ä¸åŒçš„ç»˜åˆ¶ç‰ˆæœ¬ï¼Œå› ä¸ºé€šå¸¸è®¾è®¡äººå‘˜ä¼šè€ƒè™‘åˆ°å®é™…æƒ…å†µè¿›è¡Œå„ç§å„æ ·çš„ç®€åŒ–ã€‚è€Œé¢å‘å¯¹è±¡çš„è®¾è®¡ä¸­ï¼Œç»˜å›¾åªå¯èƒ½åœ¨æ£‹ç›˜å¯¹è±¡ä¸­å‡ºç°ï¼Œä»è€Œä¿è¯äº†ç»˜å›¾çš„ç»Ÿä¸€ ã€‚ </p>
<h3 id="é¢å‘è¿‡ç¨‹ç¼–ç¨‹æ€æƒ³ï¼š"><a href="#é¢å‘è¿‡ç¨‹ç¼–ç¨‹æ€æƒ³ï¼š" class="headerlink" title="é¢å‘è¿‡ç¨‹ç¼–ç¨‹æ€æƒ³ï¼š"></a>é¢å‘è¿‡ç¨‹ç¼–ç¨‹æ€æƒ³ï¼š</h3><p>é¢å‘è¿‡ç¨‹ç¼–ç¨‹å°±å¥½æ¯”æŠŠæ•´ä¸ªéœ€æ±‚çš„æ¯ä¸ªè¿‡ç¨‹å…·ä½“åŒ–ï¼Œæµç¨‹åŒ–ã€‚å…¶ä¸­ä¼˜ç¼ºç‚¹æ˜¯å¯è§åˆ†æ˜çš„ï¼š</p>
<p>ä¼˜ç‚¹ï¼šå¯ä»¥å°†å¤æ‚çš„é€»è¾‘ï¼Œç»è¿‡æ¯ä¸ªè¿‡ç¨‹åï¼Œå˜çš„ç®€å•æ˜äº†åŒ–ã€‚</p>
<p>ç¼ºç‚¹ï¼šå¯æ‹“å±•æ€§ï¼Œç»´æŠ¤æ€§ç­‰éƒ½éå¸¸çš„å·®ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ä¸€èˆ¬éƒ½æ˜¯åœ¨ä¸ç»å¸¸å˜åŠ¨çš„ç¨‹åºé‡Œï¼Œæ¯”å¦‚ç”µè„‘çš„æ“ä½œç³»ç»Ÿï¼Œè®¡ç®—å™¨ï¼ŒLinuxå…§æ ¸ï¼Œgitï¼Œä»¥åŠApache HTTP Server </p>
<h3 id="é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼š"><a href="#é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼š" class="headerlink" title="é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼š"></a>é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼š</h3><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œè¯´ç™½äº†å°±æ˜¯åœ¨å¯¹è±¡çš„åŸºç¡€ä¸Šæ¥å®Œæˆéœ€æ±‚ã€‚æ¢å¥è¯è¯´å°±æ˜¯å¯ä»¥ç«™åœ¨ä¸Šå¸è§†è§’æ¥ç¼–ç¨‹ï¼Œä½ éœ€è¦ä»€ä¹ˆå¯¹è±¡ï¼Œå°±å¯ä»¥åˆ›é€ ä»€ä¹ˆæ ·çš„å¯¹è±¡ã€‚è®©å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´ç›¸äº’è§£å†³ã€‚ä»ç®€å•çš„æ“ä½œè€…å˜æˆäº†æŒ‡æŒ¥è€…ã€‚</p>
<p>ä¼˜ç‚¹ï¼šæ‹“å±•æ€§ï¼Œç»´æŠ¤æ€§å¼ºï¼Œæ•ˆç‡é«˜ã€‚</p>
<p>ç¼ºç‚¹ï¼šä½¿å¾—ç¨‹åºæ›´åŠ çš„å¤æ‚åŒ–ï¼Œä¸å¯é¢„çŸ¥æ€§ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯ ç”¨æˆ·å±‚ï¼Œäº’è”ç½‘åº”ç”¨ï¼Œä¼ä¸šå†…éƒ¨è½¯ä»¶ï¼Œæ¸¸æˆç­‰ </p>
<h2 id="ç±»å’Œå¯¹è±¡"><a href="#ç±»å’Œå¯¹è±¡" class="headerlink" title="ç±»å’Œå¯¹è±¡"></a><strong>ç±»å’Œå¯¹è±¡</strong></h2><h3 id="1-ä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Ÿ</h3><p>å¯¹è±¡å°±æ˜¯å•ä¸ªå­˜åœ¨çš„äº‹ç‰©ï¼Œå¹¶ä¸”å…·æœ‰è‡ªå·±ç‰¹å¾ä¸è¡Œä¸ºã€‚ä¹Ÿå°±æ˜¯ç‰¹å¾å’Œç›¸å…³è¡Œä¸ºçš„ä¸€ä¸ªç»“åˆä½“</p>
<h3 id="2-ä»€ä¹ˆæ˜¯ç±»ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯ç±»ï¼Ÿ" class="headerlink" title="2.ä»€ä¹ˆæ˜¯ç±»ï¼Ÿ"></a>2.ä»€ä¹ˆæ˜¯ç±»ï¼Ÿ</h3><p>ç±»å…¶å®æ˜¯äººä»¬æ¥æŠ½è±¡å®šä¹‰çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒæŠŠæœ‰ç›¸åŒè¡Œä¸ºå’Œç›¸åŒç‰¹å¾çš„äº‹ç‰©æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶ç§°ä¹‹ä¸ºæŸç§ç±»ã€‚</p>
<h3 id="3-ç±»ä¸å¯¹è±¡çš„å…³ç³»"><a href="#3-ç±»ä¸å¯¹è±¡çš„å…³ç³»" class="headerlink" title="3.ç±»ä¸å¯¹è±¡çš„å…³ç³»"></a>3.ç±»ä¸å¯¹è±¡çš„å…³ç³»</h3><p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæ˜¯å…ˆæœ‰å¯¹è±¡ï¼Œå†æœ‰ç±»çš„ã€‚</p>
<p>è€Œåœ¨ç¨‹åºä¸­ï¼Œä½ å¿…é¡»å…ˆå®šä¹‰ä¸€ä¸ªç±»æ¥å‘Šè¯‰è®¡ç®—æœºè¿™ä¸ªå¯¹è±¡çš„ç‰¹å¾ä¸è¡Œä¸ºã€‚</p>
<h2 id="åˆ›å»ºç±»"><a href="#åˆ›å»ºç±»" class="headerlink" title="åˆ›å»ºç±»"></a>åˆ›å»ºç±»</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(object)</span>:</span>                    <span class="comment">#1ã€åœ¨å®šä¹‰ç±»æ—¶ç»§æ‰¿objectå°±æ˜¯æ–°å¼ç±»ï¼Œæ²¡æœ‰å°±æ˜¯å°±æ˜¯æ—§ç±»å¼</span></span><br><span class="line">    public_object = <span class="string">"public"</span>           <span class="comment">#2ã€åœ¨ç±»ä¾‹å®šä¹‰ä¸€ä¸ªå…¬æœ‰å±æ€§ï¼šæ‰€æœ‰å®ä¾‹éƒ½èƒ½è®¿é—®çš„å±æ€§å«â€œå…¬æœ‰å±æ€§â€</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,role,weapon,life_value=<span class="number">100</span>,money=<span class="number">15000</span>)</span>:</span>  <span class="comment">#æ„é€ å‡½æ•°==åˆå§‹åŒ–æ–¹æ³•ï¼šæ¨¡æ¿</span></span><br><span class="line">        self.name = name               <span class="comment">#3ã€æ™®é€šå±æ€§</span></span><br><span class="line">        self.__heart= <span class="string">"Normal"</span>         <span class="comment">#4ã€ç§æœ‰å±æ€§åœ¨å¤–é¢æ— æ³•è®¿é—®</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">shot</span><span class="params">(self)</span>:</span>                    <span class="comment">#5ã€ç±»çš„æ–¹æ³•</span></span><br><span class="line">        print(<span class="string">"%s is shooting..."</span>%self.name)</span><br></pre></td></tr></table></figure>

<p>åœ¨<strong>Python2</strong>ä¸­ï¼Œ<strong>åŸºç±»object</strong>ä¹¦å†™ä¸å¦ ä¼šå¯¹ç»“æœé€ æˆå¾ˆå¤§çš„å½±å“ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹æ¶‰åŠåˆ°<strong>æ–°å¼ç±»ã€ç»å…¸ç±»</strong>çš„é—®é¢˜ </p>
<p><a href="http://obsessed.top/2018/03/20/python2%E4%B8%8Epython3%E7%9A%84%E5%8C%BA%E5%88%AB/">å¯ä»¥æŸ¥çœ‹å¦ä¸€ç¯‡åšå®¢</a></p>
<p>è¯¦ç»†ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(object)</span>:</span>    <span class="comment">#åœ¨å®šä¹‰ç±»æ—¶ç»§æ‰¿objectå°±æ˜¯æ–°å¼ç±»ï¼Œæ²¡æœ‰å°±æ˜¯å°±æ˜¯æ—§ç±»å¼</span></span><br><span class="line">    public_object = <span class="string">"public"</span>   <span class="comment">#åœ¨ç±»ä¾‹å®šä¹‰ä¸€ä¸ªå…¬æœ‰å±æ€§ï¼šæ‰€æœ‰å®ä¾‹éƒ½èƒ½è®¿é—®çš„å±æ€§å«â€œå…¬æœ‰å±æ€§â€</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,role,weapon,life_value=<span class="number">100</span>,money=<span class="number">15000</span>)</span>:</span>  <span class="comment">#æ„é€ å‡½æ•°==åˆå§‹åŒ–æ–¹æ³•ï¼šæ¨¡æ¿</span></span><br><span class="line">        self.name = name    <span class="comment">#æ™®é€šå±æ€§</span></span><br><span class="line">        self.role = role</span><br><span class="line">        self.weapon = weapon</span><br><span class="line">        self.life_value = life_value</span><br><span class="line">        self.money = money</span><br><span class="line">        self.__heart= <span class="string">"Normal"</span>    <span class="comment">#ç§æœ‰å±æ€§åœ¨å¤–é¢æ— æ³•è®¿é—®</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">shot</span><span class="params">(self)</span>:</span>     <span class="comment">#ç±»çš„æ–¹æ³•</span></span><br><span class="line">        print(<span class="string">"%s is shooting..."</span>%self.name)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">got_shot</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"ah...,I got shot..."</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buy_gun</span><span class="params">(self,gun_name)</span>:</span></span><br><span class="line">        print(<span class="string">"%s just bought %s"</span> %(self.name,gun_name))</span><br><span class="line">        self.weapon = gun_name          <span class="comment">#åœ¨è´­ä¹°åè®©å®ä¾‹å€¼æ”¹å˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨ä¸‹é¢å®ä¾‹åŒ–å…¶å®å°±æ˜¯ä¼ å…¥ï¼š Role('r1','Alex','police','AK47') æŠŠr1ä¼ ç»™äº†self</span></span><br><span class="line"><span class="comment">#r1å°±æ˜¯å®ä¾‹åŒ–åäº§ç”Ÿçš„å½“å‰Roleç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥selfå°±æ˜¯å®ä¾‹æœ¬èº«</span></span><br><span class="line"><span class="comment">#æˆ‘ç†è§£r1å…¶å®å°±æ˜¯__init__å‡½æ•°çš„å†…å­˜åœ°å€</span></span><br><span class="line"><span class="comment">#æ‰€ä»¥åœ¨ä¸‹é¢å‡½æ•°ä¸­è°ƒç”¨self.nameå°±ç›¸å½“äºè°ƒç”¨r1.nameæ‰€ä»¥å¯ä»¥è°ƒç”¨</span></span><br><span class="line">r1 = Role(<span class="string">'Alex'</span>,<span class="string">'police'</span>,<span class="string">'AK47'</span>) <span class="comment">#ç”Ÿæˆä¸€ä¸ªè§’è‰²  åªè¦ä¸€å®ä¾‹åŒ–å°±ä¼šè‡ªåŠ¨è°ƒç”¨__init__</span></span><br><span class="line">r2 = Role(<span class="string">'Jack'</span>,<span class="string">'terrorist'</span>,<span class="string">'B22'</span>)  <span class="comment">#ç”Ÿæˆä¸€ä¸ªè§’è‰²</span></span><br><span class="line"></span><br><span class="line">r1.shot()</span><br><span class="line">print(r2.weapon)        <span class="comment">#åœ¨è°ƒç”¨r2.buy_gun('AK47')å‰æ˜¯ï¼šB22</span></span><br><span class="line">r2.buy_gun(<span class="string">'AK47'</span>)</span><br><span class="line">print(r2.weapon)        <span class="comment">#åœ¨è°ƒç”¨r2.buy_gun('AK47')åæ˜¯ï¼šAK47</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç§æœ‰å±æ€§</span></span><br><span class="line"><span class="comment"># print(r2.__heart)     #è¿™é‡Œçš„.__heartæ˜¯ç§æœ‰å±æ€§ï¼Œæ‰€ä»¥åœ¨å¤–éƒ¨æ— æ³•è®¿é—®</span></span><br><span class="line">print(r2._Role__heart)  <span class="comment">#å¼ºåˆ¶è®¿é—®ç§æœ‰å±æ€§çš„æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¬æœ‰å±æ€§</span></span><br><span class="line">print(r2.public_object) <span class="comment">#æ‰“å°å‡ºç±»çš„å…¬æœ‰å±æ€§</span></span><br><span class="line">Role.public_object = <span class="string">'change_public'</span>    <span class="comment">#ä»å…¨å±€æ”¹å˜ç±»çš„å…¬æœ‰å±æ€§ r1,r2çš„å…¬æœ‰å±æ€§éƒ½ä¼šå˜</span></span><br><span class="line">print(r2.public_object)  <span class="comment">#è¿™é‡Œæ‰“å°å¯ä»¥çœ‹å‡ºå…¬æœ‰å±æ€§å˜æˆç±»â€œchange_public"</span></span><br><span class="line">r2.public_object = <span class="string">"public_r2"</span>          <span class="comment">#æ”¹å˜r2å¯¹è±¡çš„å…¬æœ‰å±æ€§ï¼Œr1ä¸ä¼šå˜</span></span><br><span class="line">print(r2.public_object)                  <span class="comment">#æ‰“å°å‡ºæ”¹å˜åçš„r2å…¬æœ‰å±æ€§</span></span><br></pre></td></tr></table></figure>



<h2 id="é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§-å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€"><a href="#é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§-å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€" class="headerlink" title="é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§: å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€"></a>é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§: å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€</h2><h3 id="Encapsulation-å°è£…ï¼ˆéšè—å®ç°ç»†èŠ‚ï¼‰"><a href="#Encapsulation-å°è£…ï¼ˆéšè—å®ç°ç»†èŠ‚ï¼‰" class="headerlink" title="Encapsulation å°è£…ï¼ˆéšè—å®ç°ç»†èŠ‚ï¼‰"></a><strong>Encapsulation å°è£…ï¼ˆéšè—å®ç°ç»†èŠ‚ï¼‰</strong></h3><ol>
<li>åœ¨ç±»ä¸­å¯¹æ•°æ®çš„èµ‹å€¼ã€å†…éƒ¨è°ƒç”¨å¯¹å¤–éƒ¨ç”¨æˆ·æ˜¯é€æ˜çš„</li>
<li>è¿™ä½¿ç±»å˜æˆäº†ä¸€ä¸ªèƒ¶å›Šæˆ–å®¹å™¨ï¼Œé‡Œé¢åŒ…å«ç€ç±»çš„æ•°æ®å’Œæ–¹æ³•</li>
<li>ä½œç”¨ï¼š<ul>
<li>é˜²æ­¢æ•°æ®è¢«éšæ„ä¿®æ”¹ </li>
<li>ä½¿å¤–éƒ¨ç¨‹åºä¸éœ€è¦å…³æ³¨å¯¹è±¡å†…éƒ¨çš„æ„é€ ï¼Œåªéœ€è¦é€šè¿‡å¯¹å¤–æä¾›çš„æ¥å£è¿›è¡Œç›´æ¥è®¿é—®</li>
</ul>
</li>
</ol>
<h3 id="Inheritance-ç»§æ‰¿ï¼ˆä»£ç é‡ç”¨ï¼‰"><a href="#Inheritance-ç»§æ‰¿ï¼ˆä»£ç é‡ç”¨ï¼‰" class="headerlink" title="Inheritance ç»§æ‰¿ï¼ˆä»£ç é‡ç”¨ï¼‰"></a><strong>Inheritance ç»§æ‰¿ï¼ˆä»£ç é‡ç”¨ï¼‰</strong></h3><ol>
<li><p>ä¸€ä¸ªç±»å¯ä»¥æ´¾ç”Ÿå‡ºå­ç±»ï¼Œåœ¨è¿™ä¸ªçˆ¶ç±»é‡Œå®šä¹‰çš„å±æ€§ã€æ–¹æ³•è‡ªåŠ¨è¢«å­ç±»ç»§æ‰¿ </p>
</li>
<li><p>æ¯”å¦‚CSä¸­çš„è­¦å¯Ÿå’Œææ€–åˆ†å­ï¼Œå¯ä»¥å°†ä¸¤ä¸ªè§’è‰²çš„ç›¸åŒç‚¹å†™åˆ°ä¸€ä¸ªçˆ¶ç±»ä¸­ï¼Œç„¶ååŒæ—¶å»ç»§æ‰¿å®ƒ </p>
</li>
<li><p>ä½¿ç”¨ç»å…¸ç±»ï¼š Person.<strong>init</strong>(self,name,age) å¹¶é‡å†™å†™çˆ¶ç±»Personçš„æ„é€ æ–¹æ³•ï¼Œå®ç°ï¼Œå…ˆè¦†ç›–ï¼Œå†ç»§æ‰¿ï¼Œå†é‡æ„ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age)</span>:</span>  <span class="comment">#æ‰§è¡ŒPerson.__init__(self,name,age)æ—¶å°±ä¼šå°†ä¼ å…¥çš„å‚æ•°æ‰§è¡Œä¸€é</span></span><br><span class="line">        self.name = name          <span class="comment">#æ‰€ä»¥åœ¨BlackPersonä¸­ä¸ä»…æœ‰name,ageè€Œä¸”è¿˜æœ‰sex</span></span><br><span class="line">        self.age = age</span><br><span class="line">        self.sex = <span class="string">"normal"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"person is talking...."</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhitePerson</span><span class="params">(Person)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlackPerson</span><span class="params">(Person)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age,strength)</span>:</span>     <span class="comment">#å…ˆè¦†ç›–ï¼Œå†ç»§æ‰¿ï¼Œå†é‡æ„</span></span><br><span class="line">        <span class="comment">#å…ˆè¦†ç›–çˆ¶ç±»çš„__init__æ–¹æ³•ï¼Œå†ç»§æ‰¿çˆ¶ç±»__init__ï¼Œå†åŠ è‡ªå·±çš„å‚æ•°</span></span><br><span class="line">        Person.__init__(self,name,age)        <span class="comment">#å…ˆç»§æ‰¿çˆ¶ç±»Personï¼Œè¿™é‡Œselfå°±æ˜¯BlackPersonæœ¬èº«</span></span><br><span class="line">        <span class="comment">#å…ˆå°†name,ageä¼ ç»™å­ç±»BlackPerson,ç„¶åè°ƒç”¨Person.__init__æ„é€ æ–¹æ³•å°†å‚æ•°å‡ºå…¥çˆ¶ç±»ï¼ˆï¼‰</span></span><br><span class="line">        self.strength = strength              <span class="comment">#ç„¶åå†é‡æ„è‡ªå·±çš„æ–¹æ³•,å³å†™è‡ªå·±çš„å‚æ•°</span></span><br><span class="line">        print(self.name,self.age,self.sex)</span><br><span class="line">        print(self.strength)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"black balabla"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"is walking...."</span>)</span><br><span class="line"></span><br><span class="line">b = BlackPerson(<span class="string">"wei er smith"</span>,<span class="number">22</span>,<span class="string">"Strong"</span>)</span><br><span class="line">b.talk()</span><br><span class="line">b.walk()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment"># wei er smith 22 normal</span></span><br><span class="line"><span class="comment"># Strong</span></span><br><span class="line"><span class="comment"># black balabla</span></span><br><span class="line"><span class="comment"># is walking....</span></span><br><span class="line"><span class="comment"># person is talking....</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<h3 id="Polymorphism-å¤šæ€ï¼ˆæ¥å£é‡ç”¨ï¼‰"><a href="#Polymorphism-å¤šæ€ï¼ˆæ¥å£é‡ç”¨ï¼‰" class="headerlink" title="Polymorphism å¤šæ€ï¼ˆæ¥å£é‡ç”¨ï¼‰"></a><strong>Polymorphism å¤šæ€ï¼ˆæ¥å£é‡ç”¨ï¼‰</strong></h3><ol>
<li>å¤šæ€æ˜¯é¢å‘å¯¹è±¡çš„é‡è¦ç‰¹æ€§,ç®€å•ç‚¹è¯´:â€œä¸€ä¸ªæ¥å£ï¼Œå¤šç§å®ç°â€</li>
<li>æŒ‡ä¸€ä¸ªåŸºç±»ä¸­æ´¾ç”Ÿå‡ºäº†ä¸åŒçš„å­ç±»ï¼Œä¸”æ¯ä¸ªå­ç±»åœ¨ç»§æ‰¿åŒæ ·çš„æ–¹æ³•åçš„åŒæ—¶åˆå¯¹çˆ¶ç±»çš„æ–¹æ³•åšäº†ä¸åŒçš„å®ç°</li>
<li>è¿™å°±æ˜¯åŒä¸€ç§äº‹ç‰©è¡¨ç°å‡ºçš„å¤šç§å½¢æ€</li>
<li>æ¯”å¦‚é»„ç§äººç»§æ‰¿äº†äººtalkè¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯ä»–è¯´çš„æ˜¯ä¸­æ–‡ï¼Œè€Œç¾å›½äººçš„talkæ˜¯è‹±æ–‡ï¼Œä½†æ˜¯ä»–ä»¬æ˜¯åŒæ ·çš„talk</li>
</ol>
<p>ä½œç”¨ï¼šç®€å•çš„è®²å°±æ˜¯å…è®¸çˆ¶ç±»è°ƒç”¨å­ç±»çš„æ–¹æ³• </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span>    <span class="comment"># Constructor of the class</span></span><br><span class="line">        self.name = name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span>              <span class="comment"># Abstract method, defined by convention only</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">"Subclass must implement abstract method"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span><span class="params">(Animal)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Meow!'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(Animal)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Woof! Woof!'</span></span><br><span class="line"></span><br><span class="line">animals = [Cat(<span class="string">'Missy'</span>),</span><br><span class="line">           Dog(<span class="string">'Lassie'</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> animal <span class="keyword">in</span> animals:</span><br><span class="line">    print(animal.name + <span class="string">': '</span> + animal.talk())</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment"># Missy: Meow!</span></span><br><span class="line"><span class="comment"># Lassie: Woof! Woof!</span></span><br></pre></td></tr></table></figure>



<h2 id="é™æ€æ–¹æ³•ã€ç±»æ–¹æ³•ã€å±æ€§æ–¹æ³•"><a href="#é™æ€æ–¹æ³•ã€ç±»æ–¹æ³•ã€å±æ€§æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•ã€ç±»æ–¹æ³•ã€å±æ€§æ–¹æ³•"></a>é™æ€æ–¹æ³•ã€ç±»æ–¹æ³•ã€å±æ€§æ–¹æ³•</h2><h3 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a>é™æ€æ–¹æ³•</h3><ol>
<li><strong>ä½œç”¨</strong>ï¼šé™æ€æ–¹æ³•å¯ä»¥æ›´å¥½çš„ç»„ç»‡ä»£ç ï¼Œé˜²æ­¢ä»£ç å˜å¤§åå˜å¾—æ¯”è¾ƒæ··ä¹± </li>
<li><strong>ç‰¹æ€§</strong>:  é™æ€æ–¹æ³•åªæ˜¯åä¹‰ä¸Šå½’ç±»ç®¡ç†ï¼Œå®é™…ä¸Šåœ¨é™æ€æ–¹æ³•é‡Œè®¿é—®ä¸äº†ç±»æˆ–åˆ™å®ä¾‹ä¸­çš„ä»»ä½•å±æ€§ </li>
<li><strong>é™æ€æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯</strong><ul>
<li>æˆ‘ä»¬è¦å†™ä¸€ä¸ªåªåœ¨ç±»ä¸­è¿è¡Œè€Œä¸åœ¨å®ä¾‹ä¸­è¿è¡Œçš„æ–¹æ³•</li>
<li>ç»å¸¸æœ‰ä¸€äº›è·Ÿç±»æœ‰å…³ç³»çš„åŠŸèƒ½ä½†åœ¨è¿è¡Œæ—¶åˆä¸éœ€è¦å®ä¾‹å’Œç±»å‚ä¸çš„æƒ…å†µä¸‹éœ€è¦ç”¨åˆ°é™æ€æ–¹æ³• </li>
<li>æ¯”å¦‚æ›´æ”¹ç¯å¢ƒå˜é‡æˆ–è€…ä¿®æ”¹å…¶ä»–ç±»çš„å±æ€§ç­‰èƒ½ç”¨åˆ°é™æ€æ–¹æ³• </li>
<li>è¿™ç§æƒ…å†µå¯ä»¥ç›´æ¥ç”¨å‡½æ•°è§£å†³, ä½†è¿™æ ·åŒæ ·ä¼šæ‰©æ•£ç±»å†…éƒ¨çš„ä»£ç ï¼Œé€ æˆç»´æŠ¤å›°éš¾</li>
</ul>
</li>
<li><strong>è°ƒç”¨æ–¹å¼:</strong>  æ—¢å¯ä»¥è¢«ç±»ç›´æ¥è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹è°ƒç”¨ </li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"I am a static method"</span>)</span><br><span class="line">d = Dog(<span class="string">"ChenRonghua"</span>)</span><br><span class="line">d.eat()                       	<span class="comment">#æ–¹æ³•1ï¼šä½¿ç”¨å®ä¾‹è°ƒç”¨</span></span><br><span class="line">Dog.eat()                   	<span class="comment">#æ–¹æ³•2ï¼šä½¿ç”¨ç±»ç›´æ¥è°ƒç”¨</span></span><br></pre></td></tr></table></figure>



<h3 id="ç±»æ–¹æ³•"><a href="#ç±»æ–¹æ³•" class="headerlink" title="ç±»æ–¹æ³•"></a><strong>ç±»æ–¹æ³•</strong></h3><ol>
<li><strong>ä½œç”¨</strong>ï¼šæ— éœ€å®ä¾‹åŒ–ç›´æ¥è¢«ç±»è°ƒç”¨  </li>
<li><strong>ç‰¹æ€§:</strong>  ç±»æ–¹æ³•åªèƒ½è®¿é—®ç±»å˜é‡ï¼Œä¸èƒ½è®¿é—®å®ä¾‹å˜é‡</li>
<li><strong>ç±»æ–¹æ³•ä½¿ç”¨åœºæ™¯ï¼š</strong> å½“æˆ‘ä»¬è¿˜æœªåˆ›å»ºå®ä¾‹ï¼Œä½†æ˜¯éœ€è¦è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•</li>
<li><strong>è°ƒç”¨æ–¹å¼:</strong>  æ—¢å¯ä»¥è¢«ç±»ç›´æ¥è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹è°ƒç”¨</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">'ç±»å˜é‡'</span> <span class="comment">#åœ¨è¿™é‡Œå¦‚æœä¸å®šä¹‰ç±»å˜é‡ä»…å®šä¹‰å®ä¾‹å˜é‡ä¾ç„¶æŠ¥é”™</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name = <span class="string">'å®ä¾‹å˜é‡'</span></span><br><span class="line">        self.name = name</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(self,food)</span>:</span></span><br><span class="line">        print(<span class="string">"%s is eating %s"</span>%(self.name,food))</span><br><span class="line">Dog.eat(<span class="string">'baozi'</span>)                   <span class="comment">#æ–¹æ³•1ï¼šä½¿ç”¨ç±»ç›´æ¥è°ƒç”¨</span></span><br><span class="line">d = Dog(<span class="string">"ChenRonghua"</span>)          </span><br><span class="line">d.eat(<span class="string">"åŒ…å­"</span>)                      <span class="comment">#æ–¹æ³•2ï¼šä½¿ç”¨å®ä¾‹dè°ƒç”¨</span></span><br></pre></td></tr></table></figure>

<h3 id="å±æ€§æ–¹æ³•"><a href="#å±æ€§æ–¹æ³•" class="headerlink" title="å±æ€§æ–¹æ³•"></a>å±æ€§æ–¹æ³•</h3><p><strong>ä½œç”¨ï¼š</strong>å±æ€§æ–¹æ³•æŠŠä¸€ä¸ªæ–¹æ³•å˜æˆä¸€ä¸ªå±æ€§ï¼Œéšè—äº†å®ç°ç»†èŠ‚,è°ƒç”¨æ—¶ä¸å¿…åŠ æ‹¬å·ç›´æ¥d.eatå³å¯è°ƒç”¨self.eat()æ–¹æ³• </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">" %s is eating"</span> % self.name)</span><br><span class="line">d = Dog(<span class="string">"ChenRonghua"</span>)</span><br><span class="line">d.eat()</span><br><span class="line"><span class="comment"># è°ƒç”¨ä¼šå‡ºä»¥ä¸‹é”™è¯¯ï¼Œ è¯´NoneType is not callable, å› ä¸ºeatæ­¤æ—¶å·²ç»å˜æˆä¸€ä¸ªé™æ€å±æ€§äº†ï¼Œ </span></span><br><span class="line"><span class="comment"># ä¸æ˜¯æ–¹æ³•äº†ï¼Œ æƒ³è°ƒç”¨å·²ç»ä¸éœ€è¦åŠ ()å·äº†ï¼Œç›´æ¥d.eatå°±å¯ä»¥äº†</span></span><br></pre></td></tr></table></figure>

<h2 id="ç±»ä¸­çš„é­”æ³•æ–¹æ³•"><a href="#ç±»ä¸­çš„é­”æ³•æ–¹æ³•" class="headerlink" title="ç±»ä¸­çš„é­”æ³•æ–¹æ³•"></a>ç±»ä¸­çš„é­”æ³•æ–¹æ³•</h2><ol>
<li><p><code>__new__</code>é™æ€æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªåˆ›å»ºçš„å®ä¾‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'__new__'</span>)</span><br><span class="line">        <span class="keyword">return</span> object.__new__(cls)    <span class="comment"># å¿…é¡»è¿”å›çˆ¶ç±»çš„__new__æ–¹æ³•ï¼Œå¦åˆ™ä¸ä¸æ‰§è¡Œ__init__æ–¹æ³•ï¼Œæ— æ³•åˆ›å»ºå®ä¾‹</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p><code>__init__</code>æ„é€ å™¨ï¼Œå½“ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»ºçš„æ—¶å€™è°ƒç”¨çš„åˆå§‹åŒ–æ–¹æ³• </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>:</span> <span class="comment">##å°è£…ä¸€ä¸ªçŒ«ç±»</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,new_name)</span>:</span> <span class="comment"># å±æ€§å®šä¹‰åˆå§‹åŒ–æ–¹æ³•  åˆ›å»ºå¯¹è±¡æ—¶å°±ä¼šè¢«è°ƒç”¨</span></span><br><span class="line">        print(<span class="string">'è¿™æ˜¯ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•'</span>)</span><br><span class="line">        self.name = new_name  <span class="comment">##å±æ€§çš„å®šä¹‰</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(self)</span>:</span> <span class="comment">## æ–¹æ³•</span></span><br><span class="line">        print(<span class="string">'%s çˆ±åƒé±¼'</span> %(self.name))</span><br><span class="line">Tom=Cat(<span class="string">"tom"</span>)</span><br><span class="line">print(Tom.name)</span><br><span class="line">Tom.eat()</span><br><span class="line"><span class="comment"># è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">#è¿™æ˜¯ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="comment">#tom</span></span><br><span class="line"><span class="comment">#tom çˆ±åƒé±¼</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p><code>__del__</code> ææ„å™¨ï¼Œå½“ä¸€ä¸ªå®ä¾‹è¢«é”€æ¯çš„æ—¶å€™è°ƒç”¨çš„æ–¹æ³• </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        print(<span class="string">'%s æ¥äº†'</span> %(self.name))</span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'%s èµ°äº†'</span> %(self.name))</span><br><span class="line">tom = Cat(<span class="string">'tom'</span>)</span><br><span class="line">print(tom.name)</span><br><span class="line"><span class="comment"># del tom</span></span><br><span class="line">print(<span class="string">'*'</span> * <span class="number">50</span>)</span><br><span class="line">print(tom.name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">#tom æ¥äº†</span></span><br><span class="line"><span class="comment">#tom</span></span><br><span class="line"><span class="comment">#**************************************************</span></span><br><span class="line"><span class="comment">#tom</span></span><br><span class="line"><span class="comment">#tom èµ°äº†</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="4">
<li><p><code>__doc__</code>è¡¨ç¤ºç±»çš„æè¿°ä¿¡æ¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="string">""" è¾“å‡ºç±»çš„æè¿°ç±»ä¿¡æ¯ """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(Foo.__doc__) <span class="comment">#è¿è¡Œç»“æœï¼šæè¾“å‡ºç±»çš„æè¿°ç±»ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__call__</code>å¯¹è±¡åé¢åŠ æ‹¬å·ï¼Œè§¦å‘æ‰§è¡Œ</p>
<p><strong>ä½œç”¨ï¼š</strong>æ„é€ æ–¹æ³•<strong>init</strong>çš„æ‰§è¡Œæ˜¯ç”±åˆ›å»ºå¯¹è±¡è§¦å‘çš„ï¼Œå³ï¼šå¯¹è±¡ = ç±»å() ï¼›è€Œå¯¹äº <strong>call</strong> æ–¹æ³•çš„æ‰§è¡Œæ˜¯ç”±å¯¹è±¡åæ‹¬å·è§¦å‘çš„ï¼Œå³ï¼šå¯¹è±¡() æˆ–è€… ç±»()()      æ‰§è¡Œ<strong>call</strong>æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name = <span class="string">'å®ä¾‹å˜é‡'</span></span><br><span class="line">        self.name = name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"running call"</span>)</span><br><span class="line">        print(args,kwargs)</span><br><span class="line">d = Dog(<span class="string">"ChenRonghua"</span>)</span><br><span class="line">d(name=<span class="string">'tom'</span>)               <span class="comment"># å¦‚æœåªå®ä¾‹åŒ–ï¼Œè€Œä¸d()è°ƒç”¨ï¼Œ__call__å‡½æ•°ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment"># running call</span></span><br><span class="line"><span class="comment"># () &#123;'name': 'tom'&#125;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="6">
<li><p><code>__str__</code>å¦‚æœä¸€ä¸ªç±»ä¸­å®šä¹‰äº†<code>__str__</code>æ–¹æ³•ï¼Œåœ¨æ‰“å°å¯¹è±¡æ—¶ï¼Œé»˜è®¤è¾“å‡ºè¯¥æ–¹æ³•çš„è¿”å›å€¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'alex li'</span></span><br><span class="line">obj = Foo()</span><br><span class="line">print(obj)     <span class="comment"># è¾“å‡ºï¼šalex li</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="7">
<li><p><code>__dict__</code> æŸ¥çœ‹ç±»æˆ–å¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Province</span>:</span></span><br><span class="line">    country = <span class="string">'China'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, count)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.count = count</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'func'</span>)</span><br><span class="line"><span class="comment"># è·å–ç±»çš„æˆå‘˜ï¼Œå³ï¼šé™æ€å­—æ®µã€æ–¹æ³•ã€</span></span><br><span class="line">print(Province.__dict__)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š&#123;'country': 'China', '__module__': '__main__', 'func': &lt;function func at 0x10be30f50&gt;, '__init__': &lt;function __init__ at 0x10be30ed8&gt;, '__doc__': None&#125;</span></span><br><span class="line"></span><br><span class="line">obj1 = Province(<span class="string">'HeBei'</span>,<span class="number">10000</span>)</span><br><span class="line">print(obj1.__dict__)</span><br><span class="line"><span class="comment"># è·å– å¯¹è±¡obj1 çš„æˆå‘˜</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š&#123;'count': 10000, 'name': 'HeBei'&#125;</span></span><br><span class="line"></span><br><span class="line">obj2 = Province(<span class="string">'HeNan'</span>, <span class="number">3888</span>)</span><br><span class="line">print(obj2.__dict__)</span><br><span class="line"><span class="comment"># è·å– å¯¹è±¡obj1 çš„æˆå‘˜</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š&#123;'count': 3888, 'name': 'HeNan'&#125;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="8">
<li><p><code>__getitem__ã€__setitem__ã€__delitem__</code></p>
<p><strong>ä½œç”¨ï¼š</strong>ç”¨äºç´¢å¼•æ“ä½œï¼Œå¦‚å­—å…¸ã€‚ä»¥ä¸Šåˆ†åˆ«è¡¨ç¤ºè·å–ã€è®¾ç½®ã€åˆ é™¤æ•°æ® </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">'__getitem__'</span>, key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">'__setitem__'</span>, key, value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">'__delitem__'</span>, key)</span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">result = obj[<span class="string">'k1'</span>]           <span class="comment"># __getitem__ k1</span></span><br><span class="line">obj[<span class="string">'k2'</span>] = <span class="string">'wupeiqi'</span>        <span class="comment"># __setitem__ k2 wupeiqi</span></span><br><span class="line"><span class="keyword">del</span> obj[<span class="string">'k1'</span>]                <span class="comment"># __delitem__ k1</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>è£…é¥°å™¨ã€è¿­ä»£å™¨ã€ç”Ÿæˆå™¨</title>
    <url>/2020/03/09/%E8%A3%85%E9%A5%B0%E5%99%A8%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8%E3%80%81%E7%94%9F%E6%88%90%E5%99%A8/</url>
    <content><![CDATA[<h2 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a>è£…é¥°å™¨</h2><h3 id="ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ</h3><ul>
<li>è£…é¥°å™¨æœ¬è´¨æ˜¯å‡½æ•°ï¼Œç”¨æ¥ç»™å…¶ä»–å‡½æ•°æ·»åŠ æ–°çš„åŠŸèƒ½</li>
<li>ç‰¹ç‚¹ï¼šä¸ä¿®æ”¹è°ƒç”¨æ–¹å¼ã€ä¸ä¿®æ”¹æºä»£ç </li>
</ul>
<a id="more"></a>

<h3 id="è£…é¥°å™¨çš„åº”ç”¨åœºæ™¯"><a href="#è£…é¥°å™¨çš„åº”ç”¨åœºæ™¯" class="headerlink" title="è£…é¥°å™¨çš„åº”ç”¨åœºæ™¯"></a>è£…é¥°å™¨çš„åº”ç”¨åœºæ™¯</h3><ul>
<li>ç”¨æˆ·è®¤è¯ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•</li>
<li>è®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´ï¼ˆç®—æ˜¯ä¸€ä¸ªåŠŸèƒ½ã€åœ¨é¡¹ç›®é‡Œç”¨çš„ä¸å¤šï¼‰</li>
<li>æ’å…¥æ—¥å¿—çš„æ—¶å€™</li>
<li>redisç¼“å­˜</li>
</ul>
<h3 id="è£…é¥°å™¨æ±‚å‡½æ•°è¿è¡Œæ—¶é—´"><a href="#è£…é¥°å™¨æ±‚å‡½æ•°è¿è¡Œæ—¶é—´" class="headerlink" title="è£…é¥°å™¨æ±‚å‡½æ•°è¿è¡Œæ—¶é—´"></a>è£…é¥°å™¨æ±‚å‡½æ•°è¿è¡Œæ—¶é—´</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timer</span><span class="params">(func)</span>:</span>   <span class="comment">#timer(test1)  func=test1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deco</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        func(*args,**kwargs)      <span class="comment">#run test1</span></span><br><span class="line">        stop_time = time.time()</span><br><span class="line">        print(<span class="string">"running time is %s"</span>%(stop_time-start_time))</span><br><span class="line">    <span class="keyword">return</span> deco</span><br><span class="line"></span><br><span class="line"><span class="meta">@timer     # test1=timer(test1)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test1</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">"in the test1"</span>)</span><br><span class="line">test1()</span><br></pre></td></tr></table></figure>



<h3 id="ä¸‰çº§è£…é¥°å™¨"><a href="#ä¸‰çº§è£…é¥°å™¨" class="headerlink" title="ä¸‰çº§è£…é¥°å™¨"></a>ä¸‰çº§è£…é¥°å™¨</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(auth_type)</span>:</span></span><br><span class="line">    print(<span class="string">"auth func:"</span>,auth_type)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">outer_wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            print(<span class="string">"wrapper func args:"</span>, *args, **kwargs)</span><br><span class="line">            print(<span class="string">'è¿è¡Œå‰'</span>)</span><br><span class="line">            func(*args, **kwargs)</span><br><span class="line">            print(<span class="string">'è¿è¡Œå'</span>)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> outer_wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@auth(auth_type="local") # home = wrapper()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"welcome to home  page"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"from home"</span></span><br><span class="line">home()</span><br></pre></td></tr></table></figure>







<hr>
<h2 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h2><p><strong>è¿­ä»£å™¨æ˜¯è®¿é—®é›†åˆå†…å…ƒç´ çš„ä¸€ç§æ–¹å¼</strong>ã€‚è¿­ä»£å™¨å¯¹è±¡ä»é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è®¿é—®ï¼Œç›´åˆ°æ‰€æœ‰çš„å…ƒç´ éƒ½è¢«è®¿é—®ä¸€éåç»“æŸã€‚ </p>
<h3 id="è¿­ä»£å™¨å’Œå¯è¿­ä»£å¯¹è±¡"><a href="#è¿­ä»£å™¨å’Œå¯è¿­ä»£å¯¹è±¡" class="headerlink" title="è¿­ä»£å™¨å’Œå¯è¿­ä»£å¯¹è±¡"></a>è¿­ä»£å™¨å’Œå¯è¿­ä»£å¯¹è±¡</h3><ol>
<li>å‡¡æ˜¯å¯ä½œç”¨äº<code>for</code>å¾ªç¯çš„å¯¹è±¡éƒ½æ˜¯å¯è¿­ä»£çš„ï¼ˆIterableï¼‰ç±»å‹ï¼›</li>
<li>å‡¡æ˜¯å¯ä½œç”¨äº<code>next()</code>å‡½æ•°çš„å¯¹è±¡éƒ½æ˜¯è¿­ä»£å™¨ï¼ˆ<code>Iteratorï¼‰</code>ç±»å‹ï¼Œå®ƒä»¬è¡¨ç¤ºä¸€ä¸ªæƒ°æ€§è®¡ç®—çš„åºåˆ—ï¼›</li>
<li>é›†åˆæ•°æ®ç±»å‹å¦‚<code>list</code>ã€<code>dict</code>ã€<code>str</code>ç­‰æ˜¯å¯è¿­ä»£çš„ä½†ä¸æ˜¯è¿­ä»£å™¨ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡<code>iter()</code>å‡½æ•°è·å¾—ä¸€ä¸ª<code>Iterator</code>å¯¹è±¡ã€‚</li>
<li>Pythonçš„<code>for</code>å¾ªç¯æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡ä¸æ–­è°ƒç”¨<code>next()</code>å‡½æ•°å®ç°çš„</li>
</ol>
<p><strong>æ€»ç»“ï¼š</strong> ä¸€ä¸ªå®ç°äº†<strong>iter</strong>æ–¹æ³•çš„å¯¹è±¡æ˜¯å¯è¿­ä»£çš„ï¼Œä¸€ä¸ªå®ç°nextæ–¹æ³•çš„å¯¹è±¡æ˜¯è¿­ä»£å™¨</p>
<h3 id="è¿­ä»£å™¨çš„ä¸¤ç§æ–¹æ³•"><a href="#è¿­ä»£å™¨çš„ä¸¤ç§æ–¹æ³•" class="headerlink" title="è¿­ä»£å™¨çš„ä¸¤ç§æ–¹æ³•"></a>è¿­ä»£å™¨çš„ä¸¤ç§æ–¹æ³•</h3><ol>
<li><p><strong>__iter__æ–¹æ³•</strong></p>
<p>â€‹    è¿”å›è¿­ä»£å™¨è‡ªèº« </p>
</li>
<li><p><strong>nextæ–¹æ³•</strong></p>
<p>â€‹    è¿”å›å®¹å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´  </p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = iter([<span class="number">1</span>,<span class="number">2</span>])              <span class="comment">#ç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨</span></span><br><span class="line">print(a.__next__())</span><br><span class="line">print(a.__next__())</span><br><span class="line">print(a.__next__())           <span class="comment">#åœ¨è¿™ä¸€æ­¥ä¼šå¼•å‘  â€œStopIterationâ€ çš„å¼‚å¸¸</span></span><br></pre></td></tr></table></figure>



<p><strong>æ³¨æ„ï¼š</strong>å¦‚æœnextæ–¹æ³•è¢«è°ƒç”¨ï¼Œä½†æ˜¯è¿­ä»£å™¨ä¸­æ²¡æœ‰å€¼å¯ä»¥è¿”å›å°±ä¼šå¼•å‘ä¸€ä¸ªStopIterationå¼‚å¸¸ </p>
<h3 id="åˆ¤æ–­æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡"><a href="#åˆ¤æ–­æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡"></a>åˆ¤æ–­æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line">print(isinstance([],Iterable))                               <span class="comment">#True</span></span><br><span class="line">print(isinstance(&#123;&#125;,Iterable))                               <span class="comment">#True</span></span><br><span class="line">print(isinstance((),Iterable))                               <span class="comment">#True</span></span><br><span class="line">print(isinstance(<span class="string">"aaa"</span>,Iterable))                            <span class="comment">#True</span></span><br><span class="line">print(isinstance((x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>)),Iterable))           <span class="comment">#True</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ¤æ–­æ˜¯å¦æ˜¯è¿­ä»£å™¨"><a href="#åˆ¤æ–­æ˜¯å¦æ˜¯è¿­ä»£å™¨" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ˜¯è¿­ä»£å™¨"></a>åˆ¤æ–­æ˜¯å¦æ˜¯è¿­ä»£å™¨</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterator</span><br><span class="line">t = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">print(isinstance(t,Iterator))           <span class="comment">#False</span></span><br><span class="line">t1 = iter(t)</span><br><span class="line">print(isinstance(t1,Iterator))          <span class="comment">#True</span></span><br></pre></td></tr></table></figure>



<h3 id="ä½¿ç”¨è¿­ä»£å™¨ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#ä½¿ç”¨è¿­ä»£å™¨ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="ä½¿ç”¨è¿­ä»£å™¨ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—"></a>ä½¿ç”¨è¿­ä»£å™¨ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FibIterator</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.current = <span class="number">0</span></span><br><span class="line">        self.num1 = <span class="number">0</span></span><br><span class="line">        self.num2 = <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.current &lt; self.n :</span><br><span class="line">            num = self.num1</span><br><span class="line">            self.num1 , self.num2 = self.num2 , self.num1+self.num2</span><br><span class="line">            self.current += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="keyword">return</span> self</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    fib = FibIterator(<span class="number">30</span>)</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> fib:</span><br><span class="line">        print(num,end=<span class="string">' '</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h2><h3 id="ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ</h3><ul>
<li>ç”Ÿæˆå™¨å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£å™¨ï¼ˆä¸€è¾¹å¾ªç¯ï¼Œä¸€è¾¹è®¡ç®—çš„æœºåˆ¶ ï¼‰</li>
<li>ä¸€ä¸ªæœ‰yieldå…³é”®å­—çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨<ul>
<li>ç”Ÿæˆå™¨æ˜¯è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè®°ä½ä¸Šä¸€æ¬¡è¿”å›æ—¶åœ¨å‡½æ•°ä½“ä¸­çš„ä½ç½®ã€‚</li>
<li>å¯¹ç”Ÿæˆå™¨å‡½æ•°çš„ç¬¬äºŒæ¬¡ï¼ˆæˆ–ç¬¬ n æ¬¡ï¼‰è°ƒç”¨è·³è½¬è‡³è¯¥å‡½æ•°ä¸­é—´ï¼Œè€Œä¸Šæ¬¡è°ƒç”¨çš„æ‰€æœ‰å±€éƒ¨å˜é‡éƒ½ä¿æŒä¸å˜ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ç”Ÿæˆå™¨çš„åº”ç”¨åœºæ™¯"><a href="#ç”Ÿæˆå™¨çš„åº”ç”¨åœºæ™¯" class="headerlink" title="ç”Ÿæˆå™¨çš„åº”ç”¨åœºæ™¯"></a>ç”Ÿæˆå™¨çš„åº”ç”¨åœºæ™¯</h3><ul>
<li>ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å¹³å¸¸å†™ä»£ç å¯èƒ½ç”¨çš„å¹¶ä¸å¤šï¼Œä½†æ˜¯pythonæºç å¤§é‡ä½¿ç”¨ </li>
<li>æ¯”å¦‚æˆ‘ä»¬tornadoæ¡†æ¶å°±æ˜¯åŸºäº ç”Ÿæˆå™¨+åç¨‹ </li>
<li>æ¯”å¦‚æˆ‘ä»¬è¦ç”Ÿæˆä¸€ç™¾ä¸‡ä¸ªæ•°æ®ï¼Œå¦‚æœç”¨ç”Ÿæˆå™¨éå¸¸èŠ‚çœç©ºé—´ï¼Œç”¨åˆ—è¡¨æµªè´¹å¤§é‡ç©ºé—´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">t1 = time.time()</span><br><span class="line">g = (i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000000</span>))</span><br><span class="line">t2 = time.time()</span><br><span class="line">lst = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000000</span>)]</span><br><span class="line">t3 = time.time()</span><br><span class="line">print(<span class="string">'ç”Ÿæˆå™¨æ—¶é—´ï¼š'</span>,t2 - t1)  <span class="comment"># ç”Ÿæˆå™¨æ—¶é—´ï¼š 0.0</span></span><br><span class="line">print(<span class="string">'åˆ—è¡¨æ—¶é—´ï¼š'</span>,t3 - t2)    <span class="comment"># åˆ—è¡¨æ—¶é—´ï¼š 5.821957349777222</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨</h3><ul>
<li>èŠ‚çœç©ºé—´</li>
<li>é«˜æ•ˆ</li>
</ul>
<h3 id="ç”Ÿæˆå™¨ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#ç”Ÿæˆå™¨ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="ç”Ÿæˆå™¨ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—"></a>ç”Ÿæˆå™¨ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fei</span><span class="params">(n)</span>:</span></span><br><span class="line">    num1,num2 = <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    current = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> current &lt; n:</span><br><span class="line">        num = num1</span><br><span class="line">        num1,num2 = num2,num1+num2</span><br><span class="line">        current += <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> num</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    f = fei(<span class="number">10</span>)</span><br><span class="line">    print(f)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print(next(f))</span><br><span class="line">        <span class="keyword">except</span> StopIteration:</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>





<h3 id="ç”Ÿæˆå™¨è¯»å–æ–‡ä»¶"><a href="#ç”Ÿæˆå™¨è¯»å–æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆå™¨è¯»å–æ–‡ä»¶"></a>ç”Ÿæˆå™¨è¯»å–æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_big_file_v</span><span class="params">(fname)</span>:</span></span><br><span class="line">    block_size = <span class="number">1024</span> * <span class="number">8</span></span><br><span class="line">    <span class="keyword">with</span> open(fname,encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            chunk = fp.read(block_size)</span><br><span class="line">            <span class="comment"># å½“æ–‡ä»¶æ²¡æœ‰æ›´å¤šå†…å®¹æ—¶ï¼Œread è°ƒç”¨å°†ä¼šè¿”å›ç©ºå­—ç¬¦ä¸² ''</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            print(chunk)</span><br><span class="line">            print(<span class="string">'1'</span>)</span><br><span class="line">path = <span class="string">r'E:\python\pachong\story\a.txt'</span></span><br><span class="line">read_big_file_v(path)</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹</title>
    <url>/2020/03/09/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><ul>
<li><p><strong>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼ˆ å†…å­˜ã€cpuã€ç½‘ç»œã€ioï¼‰</strong> </p>
<a id="more"></a>
</li>
<li><p><strong>ä¸€ä¸ªè¿è¡Œèµ·æ¥çš„ç¨‹åºå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹</strong> </p>
<ul>
<li>ä»€ä¹ˆæ˜¯ç¨‹åºï¼ˆç¨‹åºæ˜¯æˆ‘ä»¬å­˜å‚¨åœ¨ç¡¬ç›˜é‡Œçš„ä»£ç ï¼‰</li>
<li>ç¡¬ç›˜ï¼ˆ256Gï¼‰ã€å†…å­˜æ¡ï¼ˆ8Gï¼‰</li>
<li>å½“æˆ‘ä»¬åŒå‡»å›¾æ ‡ï¼Œæ‰“å¼€ç¨‹åºçš„æ—¶å€™ï¼Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡I/Oæ“ä½œï¼ˆè¯»å†™ï¼‰å†…å­˜æ¡é‡Œé¢</li>
<li>å†…å­˜æ¡å°±æ˜¯æˆ‘ä»¬æ‰€æŒ‡çš„èµ„æº </li>
<li>CPUåˆ†æ—¶<ul>
<li>CPUæ¯”ä½ çš„æ‰‹é€Ÿå¿«å¤šäº†ï¼Œåˆ†æ—¶å¤„ç†æ¯ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ç”±äºå¤ªå¿«ç„¶ä½ è§‰å¾—æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ç‹¬å cpu</li>
<li>cpuæ˜¯è®¡ç®—ï¼Œåªæœ‰æ—¶é—´ç‰‡åˆ°äº†ï¼Œè·å–cpuï¼Œçº¿ç¨‹çœŸæ­£æ‰§è¡Œ</li>
<li>å½“ä½ æƒ³ä½¿ç”¨ ç½‘ç»œã€ç£ç›˜ç­‰èµ„æºçš„æ—¶å€™ï¼Œéœ€è¦cpuçš„è°ƒåº¦</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿›ç¨‹å…·æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•ç›¸äº’é€šä¿¡</p>
<ul>
<li>è¿›ç¨‹å¦‚ä½•é€šä¿¡<ul>
<li>è¿›ç¨‹queue(çˆ¶å­è¿›ç¨‹é€šä¿¡)</li>
<li>pipeï¼ˆåŒä¸€ç¨‹åºä¸‹ä¸¤ä¸ªè¿›ç¨‹é€šä¿¡ï¼‰</li>
<li>managersï¼ˆåŒä¸€ç¨‹åºä¸‹å¤šä¸ªè¿›ç¨‹é€šä¿¡ï¼‰</li>
<li>RabbitMQã€redisç­‰ï¼ˆä¸åŒç¨‹åºé—´é€šä¿¡ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><p>ä¸ºä»€ä¹ˆéœ€è¦è¿›ç¨‹æ± </p>
<ul>
<li>ä¸€æ¬¡æ€§å¼€å¯æŒ‡å®šæ•°é‡çš„è¿›ç¨‹</li>
<li>å¦‚æœæœ‰åä¸ªè¿›ç¨‹ï¼Œæœ‰ä¸€ç™¾ä¸ªä»»åŠ¡ï¼Œä¸€æ¬¡å¯ä»¥å¤„ç†å¤šå°‘ä¸ªï¼ˆä¸€æ¬¡æ€§åªèƒ½å¤„ç†åä¸ªï¼‰</li>
<li>é˜²æ­¢è¿›ç¨‹å¼€å¯æ•°é‡è¿‡å¤šå¯¼è‡´æœåŠ¡å™¨å‹åŠ›è¿‡å¤§</li>
</ul>
</li>
</ul>
<h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><ul>
<li>æœ‰äº†è¿›ç¨‹ä¸ºä»€ä¹ˆè¿˜éœ€è¦çº¿ç¨‹<ul>
<li>å› ä¸ºè¿›ç¨‹ä¸èƒ½åŒä¸€æ—¶é—´åªèƒ½åšä¸€ä¸ªäº‹æƒ…</li>
</ul>
</li>
<li>ä»€ä¹ˆæ˜¯çº¿ç¨‹<ul>
<li>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•ä½</li>
<li>çº¿ç¨‹æ˜¯è¿›ç¨‹æ­£çœŸçš„æ‰§è¡Œè€…ï¼Œæ˜¯ä¸€äº›æŒ‡ä»¤çš„é›†åˆï¼ˆè¿›ç¨‹èµ„æºçš„æ‹¥æœ‰è€…ï¼‰</li>
<li>åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„è¯»å¤šä¸ª<strong>çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´</strong>ï¼Œæ•°æ®ç›´æ¥è®¿é—®ï¼ˆæ•°æ®å…±äº«ï¼‰</li>
<li>ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼Œå¿…é¡»ä½¿ç”¨<strong>çº¿ç¨‹é”</strong></li>
</ul>
</li>
<li>GILå…¨å±€è§£é‡Šå™¨é”<ul>
<li>åœ¨pythonå…¨å±€è§£é‡Šå™¨ä¸‹ï¼Œä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿è¡Œ</li>
<li>é˜²æ­¢å¤šä¸ªçº¿ç¨‹éƒ½ä¿®æ”¹æ•°æ®</li>
</ul>
</li>
<li>çº¿ç¨‹é”ï¼ˆäº’æ–¥é”ï¼‰<ul>
<li>GILé”åªèƒ½ä¿è¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªèµ„æºæ“ä½œï¼Œä½†å½“ä¸Šä¸€ä¸ªçº¿ç¨‹è¿˜æœªæ‰§è¡Œå®Œæ¯•æ—¶å¯èƒ½å°±ä¼šé‡Šæ”¾GILï¼Œå…¶ä»–çº¿ç¨‹å°±å¯ä»¥æ“ä½œäº†</li>
<li>çº¿ç¨‹é”æœ¬è´¨æŠŠçº¿ç¨‹ä¸­çš„æ•°æ®åŠ äº†ä¸€æŠŠäº’æ–¥é”<ul>
<li>mysqlä¸­å…±äº«é” &amp; äº’æ–¥é”</li>
<li>mysqlå…±äº«é”ï¼šå…±äº«é”ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½èƒ½è¯»ï¼Œè€Œä¸èƒ½å†™ </li>
<li>mysqlæ’å®ƒé”ï¼šæ’å®ƒï¼Œä»»ä½•çº¿ç¨‹è¯»å–è¿™ä¸ªè¿™ä¸ªæ•°æ®çš„æƒåˆ©éƒ½æ²¡æœ‰ </li>
<li>åŠ ä¸Šçº¿ç¨‹é”ä¹‹åæ‰€æœ‰å…¶ä»–çº¿ç¨‹ï¼Œè¯»éƒ½ä¸èƒ½è¯»è¿™ä¸ªæ•°æ® </li>
</ul>
</li>
<li>æœ‰äº†GILå…¨å±€è§£é‡Šå™¨é”ä¸ºä»€ä¹ˆè¿˜éœ€è¦çº¿ç¨‹é”<ul>
<li>å› ä¸ºcpuæ˜¯åˆ†æ—¶ä½¿ç”¨çš„</li>
</ul>
</li>
</ul>
</li>
<li>æ­»é”å®šä¹‰<ul>
<li>ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹æˆ–çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»</li>
</ul>
</li>
</ul>
<h2 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h2><ul>
<li>ä»€ä¹ˆæ˜¯åç¨‹<ul>
<li>åç¨‹å¾®çº¿ç¨‹ï¼Œçº¤ç¨‹ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹</li>
<li>åç¨‹èƒ½åœ¨å•çº¿ç¨‹å¤„ç†é«˜å¹¶å‘<ul>
<li>çº¿ç¨‹é‡åˆ°I/Oæ“ä½œä¼šç­‰å¾…ã€é˜»å¡ï¼Œåç¨‹é‡åˆ°I/Oä¼šè‡ªåŠ¨åˆ‡æ¢ï¼ˆå‰©ä¸‹çš„åªæœ‰CPUæ“ä½œï¼‰</li>
<li>çº¿ç¨‹çš„çŠ¶æ€ä¿å­˜åœ¨CPUçš„å¯„å­˜å™¨å’Œæ ˆé‡Œè€Œåç¨‹æ‹¥æœ‰è‡ªå·±çš„ç©ºé—´ï¼Œæ‰€ä»¥æ— éœ€ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œæ‰€ä»¥å¿«</li>
</ul>
</li>
<li>ä¸ºç”šä¹ˆåç¨‹èƒ½å¤Ÿé‡åˆ°I/Oè‡ªåŠ¨åˆ‡æ¢<ul>
<li>åç¨‹æœ‰ä¸€ä¸ªgeventæ¨¡å—(å°è£…äº†greenletæ¨¡å—)ï¼Œé‡åˆ°I/Oè‡ªåŠ¨åˆ‡æ¢</li>
</ul>
</li>
</ul>
</li>
<li>åç¨‹ç¼ºç‚¹<ul>
<li>æ— æ³•åˆ©ç”¨å¤šæ ¸èµ„æºï¼š<strong>åç¨‹çš„æœ¬è´¨æ˜¯ä¸ªå•çº¿ç¨‹,å®ƒä¸èƒ½åŒæ—¶å°† å•ä¸ªCPU çš„å¤šä¸ªæ ¸ç”¨ä¸Š</strong>,åç¨‹éœ€è¦å’Œè¿›ç¨‹é…åˆæ‰èƒ½è¿è¡Œåœ¨å¤šCPUä¸Š</li>
<li><strong>çº¿ç¨‹é˜»å¡ï¼ˆBlockingï¼‰æ“ä½œï¼ˆå¦‚IOæ—¶ï¼‰ä¼šé˜»å¡æ‰æ•´ä¸ªç¨‹åº</strong></li>
</ul>
</li>
<li>åç¨‹æœ€å¤§çš„ä¼˜ç‚¹<ul>
<li>ä¸ä»…æ˜¯å¤„ç†é«˜å¹¶å‘ï¼ˆå•çº¿ç¨‹ä¸‹å¤„ç†é«˜å¹¶å‘ï¼‰</li>
<li>ç‰¹åˆ«èŠ‚çœèµ„æºï¼ˆ500æ—¥æ´»ï¼Œç”¨phpå†™éœ€è¦ä¸¤ç™¾å¤šæ€æœºå™¨ï¼Œä½†æ˜¯golangåªéœ€è¦äºŒåå¤šå¤ªæœºå™¨ï¼‰</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerfile</title>
    <url>/2020/01/08/Dockerfile/</url>
    <content><![CDATA[<h2 id="å…³äºDockerfile"><a href="#å…³äºDockerfile" class="headerlink" title="å…³äºDockerfile"></a>å…³äºDockerfile</h2><p>ã€€ã€€åœ¨Dockerä¸­åˆ›å»ºé•œåƒæœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨Dockerfileã€‚Dockerfileæ˜¯ä¸€ä¸ªDockeré•œåƒçš„æè¿°æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£æˆç«ç®­å‘å°„çš„Aã€Bã€Cã€Dâ€¦çš„æ­¥éª¤ã€‚Dockerfileå…¶å†…éƒ¨<strong>åŒ…å«äº†ä¸€æ¡æ¡çš„æŒ‡ä»¤</strong>ï¼Œ<strong>æ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»º</strong>ã€‚ </p>
<a id="more"></a>

<img src="/2020/01/08/Dockerfile/image1.png" class="" title="docker">  

<p><strong>ä¸€ä¸ªDockerfileçš„å®ä¾‹å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åŸºäºpython3.6çš„é•œåƒ</span></span><br><span class="line">FROM python:<span class="number">3.6</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#ç»´æŠ¤äººçš„ä¿¡æ¯</span></span><br><span class="line">MAINTAINER zhangsan</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line">RUN  mkdir /code</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®å½“å‰å·¥ä½œç›®å½•</span></span><br><span class="line">WORKDIR /code</span><br><span class="line"></span><br><span class="line"><span class="comment">#copyæ–‡ä»¶</span></span><br><span class="line">ADD . /code/</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line">RUN pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€å¯8000ç«¯å£</span></span><br><span class="line">EXPOSE <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å½“å¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶</span></span><br><span class="line">CMD [<span class="string">"python"</span>, <span class="string">"manage.py"</span>, <span class="string">"runserver"</span>, <span class="string">"0:8000"</span>]</span><br></pre></td></tr></table></figure>

<p><strong>ç”±ä¸Šå¯çŸ¥ï¼ŒDockerfileç»“æ„å¤§è‡´åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š</strong> </p>
<ol>
<li>åŸºç¡€é•œåƒä¿¡æ¯ </li>
<li>ç»´æŠ¤è€…ä¿¡æ¯</li>
<li>é•œåƒæ“ä½œå‘½ä»¤</li>
<li>å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤</li>
</ol>
<img src="/2020/01/08/Dockerfile/image2.png" class="" title="Dockerfile">  

<hr>
<h2 id="Dockerfileæ¡ˆä¾‹"><a href="#Dockerfileæ¡ˆä¾‹" class="headerlink" title="Dockerfileæ¡ˆä¾‹"></a>Dockerfileæ¡ˆä¾‹</h2><p><strong>åˆå§‹åŒ–ä¸€ä¸ªdjangoé¡¹ç›®å¹¶ç”¨dockerå¯åŠ¨</strong> </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># django-admin startproject demo</span></span><br><span class="line">[root@node1 demo]<span class="comment"># cd demo</span></span><br><span class="line">[root@node1 demo]<span class="comment"># python3 manage.py runserver 0.0.0.0:8000                  # æµ‹è¯•é¡¹ç›®æ˜¯å¦å¯ä»¥å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">[root@node1 demo]<span class="comment"># vim Dockerfile                                            # dockerfileå†…å®¹å¦‚ä¸‹,è·¯å¾„æ”¾åˆ°djangoé¡¹ç›®æ ¹è·¯å¾„</span></span><br><span class="line">[root@node1 demo]<span class="comment"># vim requirements.txt                                      # djangoéœ€è¦å®‰è£…çš„åŒ…ï¼Œè·¯å¾„æ”¾åˆ°djangoé¡¹ç›®æ ¹è·¯å¾„</span></span><br><span class="line">[root@node1 demo]<span class="comment"># docker build -t dj_demo:v1 -f Dockerfile . </span></span><br><span class="line">[root@node1 demo]<span class="comment"># docker run -d -p 192.168.56.11:8000:8000 dj_demo:v1</span></span><br></pre></td></tr></table></figure>

<p><strong>Dockerfile</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FROM python:<span class="number">3.6</span></span><br><span class="line">MAINTAINER zhangsan</span><br><span class="line">RUN  mkdir /code</span><br><span class="line">WORKDIR /code</span><br><span class="line">ADD . /code/</span><br><span class="line">RUN pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">EXPOSE <span class="number">8000</span></span><br><span class="line">CMD [<span class="string">"python"</span>, <span class="string">"manage.py"</span>, <span class="string">"runserver"</span>, <span class="string">"0:8000"</span>]</span><br></pre></td></tr></table></figure>

<p><strong>requirements.txt</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Django==<span class="number">2.0</span><span class="number">.4</span></span><br><span class="line">mysqlclient==<span class="number">1.4</span><span class="number">.6</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker-compose</title>
    <url>/2020/01/05/docker-compose/</url>
    <content><![CDATA[<h2 id="docker-composeç®€ä»‹"><a href="#docker-composeç®€ä»‹" class="headerlink" title="docker-composeç®€ä»‹"></a>docker-composeç®€ä»‹</h2><p>Docker-Composeé¡¹ç›®æ˜¯Dockerå®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹Dockerå®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚</p>
<p>Docker-Composeå°†æ‰€ç®¡ç†çš„å®¹å™¨åˆ†ä¸ºä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯å·¥ç¨‹ï¼ˆprojectï¼‰ï¼ŒæœåŠ¡ï¼ˆserviceï¼‰ä»¥åŠå®¹å™¨ï¼ˆcontainerï¼‰ã€‚</p>
<a id="more"></a>

<p>Docker-Composeè¿è¡Œç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆdocker-compose.ymlï¼Œextendsæ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡æ–‡ä»¶ç­‰ï¼‰ç»„æˆä¸€ä¸ªå·¥ç¨‹ï¼Œè‹¥æ— ç‰¹æ®ŠæŒ‡å®šå·¥ç¨‹åå³ä¸ºå½“å‰ç›®å½•åã€‚ä¸€ä¸ªå·¥ç¨‹å½“ä¸­å¯åŒ…å«å¤šä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ä¸­å®šä¹‰äº†å®¹å™¨è¿è¡Œçš„é•œåƒï¼Œå‚æ•°ï¼Œä¾èµ–ã€‚ä¸€ä¸ªæœåŠ¡å½“ä¸­å¯åŒ…æ‹¬å¤šä¸ªå®¹å™¨å®ä¾‹ï¼ŒDocker-Composeå¹¶æ²¡æœ‰è§£å†³è´Ÿè½½å‡è¡¡çš„é—®é¢˜ï¼Œå› æ­¤éœ€è¦å€ŸåŠ©å…¶å®ƒå·¥å…·å®ç°æœåŠ¡å‘ç°åŠè´Ÿè½½å‡è¡¡ã€‚</p>
<p>Docker-Composeçš„å·¥ç¨‹é…ç½®æ–‡ä»¶é»˜è®¤ä¸ºdocker-compose.ymlï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡COMPOSE_FILEæˆ–-få‚æ•°è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå…¶å®šä¹‰äº†å¤šä¸ªæœ‰ä¾èµ–å…³ç³»çš„æœåŠ¡åŠæ¯ä¸ªæœåŠ¡è¿è¡Œçš„å®¹å™¨ã€‚</p>
<p>ä½¿ç”¨ä¸€ä¸ªDockerfileæ¨¡æ¿æ–‡ä»¶ï¼Œå¯ä»¥è®©ç”¨æˆ·å¾ˆæ–¹ä¾¿çš„å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ã€‚åœ¨å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°éœ€è¦å¤šä¸ªå®¹å™¨ç›¸äº’é…åˆæ¥å®ŒæˆæŸé¡¹ä»»åŠ¡çš„æƒ…å†µã€‚ä¾‹å¦‚è¦å®ç°ä¸€ä¸ªWebé¡¹ç›®ï¼Œé™¤äº†WebæœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“æœåŠ¡å®¹å™¨ï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ã€‚</p>
<p>Composeå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„docker-compose.ymlæ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰ã€‚</p>
<p>Docker-Composeé¡¹ç›®ç”±Pythonç¼–å†™ï¼Œè°ƒç”¨DockeræœåŠ¡æä¾›çš„APIæ¥å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ã€‚å› æ­¤ï¼Œåªè¦æ‰€æ“ä½œçš„å¹³å°æ”¯æŒDocker APIï¼Œå°±å¯ä»¥åœ¨å…¶ä¸Šåˆ©ç”¨Composeæ¥è¿›è¡Œç¼–æ’ç®¡ç†ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li>Composeæ˜¯ä¸€ä¸ªå®šä¹‰å’Œç®¡ç†å¤šå®¹å™¨çš„å·¥å…·ï¼Œä½¿ç”¨Pythonè¯­è¨€ç¼–å†™</li>
<li>ä½¿ç”¨Composeé…ç½®æ–‡ä»¶æè¿°å¤šä¸ªå®¹å™¨åº”ç”¨çš„æ¶æ„ï¼Œæ¯”å¦‚ä½¿ç”¨ä»€ä¹ˆé•œåƒã€æ•°æ®å·ã€ç½‘ç»œã€æ˜ å°„ç«¯å£ç­‰</li>
<li>ç„¶åä¸€æ¡å‘½ä»¤ç®¡ç†æ‰€æœ‰æœåŠ¡ï¼Œæ¯”å¦‚å¯åŠ¨ã€åœæ­¢ã€é‡å¯ç­‰</li>
</ul>
<h2 id="docker-composeä½œç”¨"><a href="#docker-composeä½œç”¨" class="headerlink" title="docker composeä½œç”¨"></a>docker composeä½œç”¨</h2><ul>
<li>ä½¿ç”¨ composeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ YAML æ–‡ä»¶å£°æ˜å¼çš„å®šä¹‰åº”ç”¨ç¨‹åºçš„å„ä¸ªæœåŠ¡ï¼Œå¹¶ç”±å•ä¸ªå‘½ä»¤å®Œæˆåº”ç”¨çš„åˆ›å»ºå’Œå¯åŠ¨ã€‚ </li>
</ul>
<h2 id="ockerä¸docker-composeå¯¹æ¯”"><a href="#ockerä¸docker-composeå¯¹æ¯”" class="headerlink" title="ockerä¸docker-composeå¯¹æ¯”"></a>ockerä¸docker-composeå¯¹æ¯”</h2><ul>
<li><p>dockeræ˜¯è‡ªåŠ¨åŒ–æ„å»ºé•œåƒï¼Œå¹¶å¯åŠ¨é•œåƒã€‚ docker composeæ˜¯è‡ªåŠ¨åŒ–ç¼–æ’å®¹å™¨ã€‚</p>
</li>
<li><p>dockeræ˜¯åŸºäºDockerfileå¾—åˆ°images,å¯åŠ¨çš„æ—¶å€™æ˜¯ä¸€ä¸ªå•ç‹¬çš„container</p>
</li>
<li><p>docker-composeæ˜¯åŸºäºdocker-compose.yml,é€šå¸¸å¯åŠ¨çš„æ—¶å€™æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡é€šå¸¸ç”±å¤šä¸ªcontainerå…±åŒç»„æˆï¼Œå¹¶ä¸”ç«¯å£ï¼Œé…ç½®ç­‰ç”±docker-composeå®šä¹‰å¥½ã€‚</p>
</li>
<li><p>ä¸¤è€…éƒ½éœ€è¦å®‰è£…ï¼Œä½†æ˜¯è¦ä½¿ç”¨docker-composeï¼Œå¿…é¡»å·²ç»å®‰è£…docker</p>
</li>
</ul>
<h2 id="å®‰è£…docker-compose"><a href="#å®‰è£…docker-compose" class="headerlink" title="å®‰è£…docker-compose"></a>å®‰è£…docker-compose</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@linux-node4 ~]<span class="comment"># curl -L https://github.com/docker/compose/releases/download/1.15.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span></span><br><span class="line">[root@linux-node4 ~]<span class="comment"># chmod +x /usr/local/bin/docker-compose</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span></span><br><span class="line"></span><br><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure>



<h2 id="docker-composeé…ç½®æ–‡ä»¶è§£æ"><a href="#docker-composeé…ç½®æ–‡ä»¶è§£æ" class="headerlink" title="docker-composeé…ç½®æ–‡ä»¶è§£æ"></a>docker-composeé…ç½®æ–‡ä»¶è§£æ</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">version: <span class="string">'3'</span>                       <span class="comment"># cocker composeç‰ˆæœ¬å·</span></span><br><span class="line"></span><br><span class="line">services:                          <span class="comment"># é¡¶çº§é…ç½®æ–‡ä»¶(åç§°è‡ªå·±å†™)</span></span><br><span class="line">  mysql:                           <span class="comment"># æœåŠ¡å: å®¹å™¨å»ºé€šä¿¡ã€ç®¡ç†å®¹å™¨ï¼ˆmysqlè¿™ä¸ªå®¹å™¨å–çš„åå­—ï¼Œä¹Ÿæ˜¯è‡ªå·±å†™çš„ï¼‰</span></span><br><span class="line">    image: mysql:<span class="number">5.7</span>               <span class="comment"># å¼•å…¥å®˜æ–¹mysqlé•œåƒï¼ˆå¯ä»¥å¤§å®¶è‡ªå·±çš„hubä»“åº“ï¼Œä¸­å¤§å‹å…¬å¸éƒ½ä¼šè‡ªå·±æ­å»ºdocker hubä»“åº“ï¼‰</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ./mysql:/var/lib/mysql         <span class="comment"># æŠŠå½“å‰æ–‡ä»¶å¤¹ä¸‹çš„ ./mysqlæ–‡ä»¶å¤¹æŒ‚è½½åˆ°dockerå®¹å™¨ /var/lib/mysql è·¯å¾„ä¸‹</span></span><br><span class="line">    expose:</span><br><span class="line">      - <span class="string">"3306"</span>                        <span class="comment"># å°†å½“å‰å®¹å™¨çš„ç«¯å£3306ç«¯å£æš´éœ²ç»™linkåˆ°æœ¬å®¹å™¨çš„å®¹å™¨</span></span><br><span class="line">    restart: always                   <span class="comment"># å®¿ä¸»æœºé‡å¯è‡ªåŠ¨æ‹‰èµ·è¿™ä¸ªdockerå®¹å™¨</span></span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=root             <span class="comment"># mysqlæœåŠ¡å™¨rootå¯†ç root</span></span><br><span class="line">      - MYSQL_DATABASE=djangodocker          <span class="comment"># åˆ›å»ºæ•°æ®åº“ djangodocker</span></span><br><span class="line">      - MYSQL_USER=django                    <span class="comment"># åˆ›å»ºä¸€ä¸ªç”¨æˆ· django</span></span><br><span class="line">      - MYSQL_PASSWORD=django                <span class="comment"># ç”¨æˆ·å¯†ç ä¸ºdjango</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- å•ç‹¬éƒ¨ç½²ä¸€ä¸ªnginx</span><br><span class="line">  - å®‰è£…nginxæœåŠ¡</span><br><span class="line">  - é…ç½®nginx.conf</span><br><span class="line">  - é…ç½® /etc/nginx/conf.d/*.conf</span><br><span class="line">  - è®¿é—®ç«¯å£</span><br><span class="line"></span><br><span class="line">  nginx:</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    volumes:</span><br><span class="line">      - ./nginx/nginx.conf:/etc/nginx/nginx.conf</span><br><span class="line">      - ./nginx/conf:/etc/nginx/conf.d</span><br><span class="line">      - ./web/staticfiles:/django_static</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"80:80"</span>                             <span class="comment"># ç»‘å®šå®¹å™¨çš„80ç«¯å£åˆ°ä¸»æœºçš„80ç«¯å£</span></span><br><span class="line">    depends_on:</span><br><span class="line">      - web                                 <span class="comment"># å¿…é¡»å…ˆå¯åŠ¨webå®¹å™¨ç„¶æ‰èƒ½å¯åŠ¨nginxå®¹å™¨</span></span><br><span class="line"></span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    expose:</span><br><span class="line">      - <span class="string">"6379"</span></span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    <span class="comment"># command: python manage.py runserver 0:8000</span></span><br><span class="line">    <span class="comment"># ports:</span></span><br><span class="line">    <span class="comment">#   - "8000:8000"</span></span><br><span class="line">    command: uwsgi --ini uwsgi.ini             <span class="comment"># å¯åŠ¨uwsgiå‘½ä»¤</span></span><br><span class="line">    working_dir: /code/web                     <span class="comment"># é¡¹ç›®å·¥ä½œè·¯å¾„</span></span><br><span class="line">    volumes:</span><br><span class="line">      - .:/code                                <span class="comment"># å°†å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„ /code æ–‡ä»¶å¤¹</span></span><br><span class="line">    expose:</span><br><span class="line">      - <span class="string">"8000"</span></span><br><span class="line">    depends_on:                                <span class="comment"># å¿…é¡»mysqlå’Œreidså®¹å™¨å¯åŠ¨åæ‰èƒ½å¯åŠ¨webå®¹å™¨</span></span><br><span class="line">      - mysql</span><br><span class="line">      - redis</span><br><span class="line"></span><br><span class="line">  celery:</span><br><span class="line">    build: .</span><br><span class="line">    command: celery -A web worker -l info</span><br><span class="line">    working_dir: /code/web</span><br><span class="line">    volumes:</span><br><span class="line">      - .:/code</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql</span><br><span class="line">      - redis</span><br></pre></td></tr></table></figure>







<h2 id="Docker-Composeå¸¸ç”¨å‘½ä»¤"><a href="#Docker-Composeå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Docker-Composeå¸¸ç”¨å‘½ä»¤"></a>Docker-Composeå¸¸ç”¨å‘½ä»¤</h2><p> <strong>1ã€Docker-Composeå‘½ä»¤æ ¼å¼</strong> </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker-compose [-f &lt;arg&gt;...] [options] [COMMAND] [ARGS...]</span><br><span class="line">å‘½ä»¤é€‰é¡¹å¦‚ä¸‹ï¼š</span><br><span class="line">-fï¼Œâ€“file FILEæŒ‡å®šComposeæ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºdocker-compose.ymlï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚</span><br><span class="line">-pï¼Œâ€“project-name NAMEæŒ‡å®šé¡¹ç›®åç§°ï¼Œé»˜è®¤å°†ä½¿ç”¨æ‰€åœ¨ç›®å½•åç§°ä½œä¸ºé¡¹ç›®åã€‚</span><br><span class="line">-x-network-driver ä½¿ç”¨Dockerçš„å¯æ‹”æ’ç½‘ç»œåç«¯ç‰¹æ€§ï¼ˆéœ€è¦Docker <span class="number">1.9</span>+ç‰ˆæœ¬ï¼‰</span><br><span class="line">-x-network-driver DRIVERæŒ‡å®šç½‘ç»œåç«¯çš„é©±åŠ¨ï¼Œé»˜è®¤ä¸ºbridgeï¼ˆéœ€è¦Docker <span class="number">1.9</span>+ç‰ˆæœ¬ï¼‰</span><br><span class="line">-verboseè¾“å‡ºæ›´å¤šè°ƒè¯•ä¿¡æ¯</span><br><span class="line">-vï¼Œâ€“versionæ‰“å°ç‰ˆæœ¬å¹¶é€€å‡º</span><br></pre></td></tr></table></figure>

<p><strong>2ã€docker-compose up</strong> </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker-compose up [options] [--scale SERVICE=NUM...] [SERVICE...]</span><br><span class="line">é€‰é¡¹åŒ…æ‹¬ï¼š</span><br><span class="line">-d åœ¨åå°è¿è¡ŒæœåŠ¡å®¹å™¨</span><br><span class="line">â€“no-color ä¸ä½¿ç”¨é¢œè‰²æ¥åŒºåˆ†ä¸åŒçš„æœåŠ¡çš„æ§åˆ¶è¾“å‡º</span><br><span class="line">â€“no-deps ä¸å¯åŠ¨æœåŠ¡æ‰€é“¾æ¥çš„å®¹å™¨</span><br><span class="line">â€“force-recreate å¼ºåˆ¶é‡æ–°åˆ›å»ºå®¹å™¨ï¼Œä¸èƒ½ä¸â€“no-recreateåŒæ—¶ä½¿ç”¨</span><br><span class="line">â€“no-recreate å¦‚æœå®¹å™¨å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸é‡æ–°åˆ›å»ºï¼Œä¸èƒ½ä¸â€“force-recreateåŒæ—¶ä½¿ç”¨</span><br><span class="line">â€“no-build ä¸è‡ªåŠ¨æ„å»ºç¼ºå¤±çš„æœåŠ¡é•œåƒ</span><br><span class="line">â€“build åœ¨å¯åŠ¨å®¹å™¨å‰æ„å»ºæœåŠ¡é•œåƒ</span><br><span class="line">â€“abort-on-container-exit åœæ­¢æ‰€æœ‰å®¹å™¨ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªå®¹å™¨è¢«åœæ­¢ï¼Œä¸èƒ½ä¸-dåŒæ—¶ä½¿ç”¨</span><br><span class="line">-t, â€“timeout TIMEOUT åœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º<span class="number">10</span>ç§’ï¼‰</span><br><span class="line">â€“remove-orphans åˆ é™¤æœåŠ¡ä¸­æ²¡æœ‰åœ¨composeæ–‡ä»¶ä¸­å®šä¹‰çš„å®¹å™¨</span><br><span class="line">â€“scale SERVICE=NUM è®¾ç½®æœåŠ¡è¿è¡Œå®¹å™¨çš„ä¸ªæ•°ï¼Œå°†è¦†ç›–åœ¨composeä¸­é€šè¿‡scaleæŒ‡å®šçš„å‚æ•°</span><br><span class="line">docker-compose up	å¯åŠ¨æ‰€æœ‰æœåŠ¡</span><br><span class="line">docker-compose up -d	åœ¨åå°æ‰€æœ‰å¯åŠ¨æœåŠ¡</span><br><span class="line">-f æŒ‡å®šä½¿ç”¨çš„Composeæ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºdocker-compose.ymlï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚</span><br><span class="line">docker-compose -f docker-compose.yml up -d</span><br></pre></td></tr></table></figure>



<p><strong>3ã€docker-compose</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker-compose ps 			<span class="comment">#åˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker-compose stop			<span class="comment">#åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡docker-compose start å†æ¬¡å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">docker-compose -h			<span class="comment">#æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line"></span><br><span class="line">docker-compose down			<span class="comment">#åœç”¨ç§»é™¤æ‰€æœ‰å®¹å™¨ä»¥åŠç½‘ç»œç›¸å…³</span></span><br><span class="line"></span><br><span class="line">docker-compose logs			<span class="comment">#æŸ¥çœ‹æœåŠ¡å®¹å™¨çš„è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">docker-compose build			<span class="comment">#æ„å»ºï¼ˆé‡æ–°æ„å»ºï¼‰é¡¹ç›®ä¸­çš„æœåŠ¡å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker-compose pull			<span class="comment">#æ‹‰å–æœåŠ¡ä¾èµ–çš„é•œåƒ</span></span><br><span class="line"></span><br><span class="line">docker-compose restart			<span class="comment">#é‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">docker-compose rm			<span class="comment">#åˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨ã€‚æ¨èå…ˆæ‰§è¡Œdocker-compose stopå‘½ä»¤æ¥åœæ­¢å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker-compose rm -f			<span class="comment">#å¼ºåˆ¶ç›´æ¥åˆ é™¤ï¼ŒåŒ…æ‹¬éåœæ­¢çŠ¶æ€çš„å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker-compose rm -v			<span class="comment">#åˆ é™¤å®¹å™¨æ‰€æŒ‚è½½çš„æ•°æ®å·</span></span><br><span class="line"></span><br><span class="line">docker-compose start			<span class="comment">#å¯åŠ¨å·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker-compose pause			<span class="comment">#æš‚åœä¸€ä¸ªæœåŠ¡å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker-compose stop			<span class="comment">#æ˜¾ç¤ºå„ä¸ªå®¹å™¨è¿è¡Œçš„è¿›ç¨‹æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">docker-compose unpause			<span class="comment">#æ¢å¤å¤„äºæš‚åœçŠ¶æ€ä¸­çš„æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">docker-compose version			<span class="comment">#æ‰“å°ç‰ˆæœ¬ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="code"><pre><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/hanguofei/article/details/103016549</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerå‘½ä»¤</title>
    <url>/2020/01/02/docker%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="ä¸€ã€dockerçš„å®‰è£…"><a href="#ä¸€ã€dockerçš„å®‰è£…" class="headerlink" title="ä¸€ã€dockerçš„å®‰è£…"></a>ä¸€ã€dockerçš„å®‰è£…</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1ã€å®‰è£…ä¾èµ–åŒ…</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ã€æ·»åŠ Dockerè½¯ä»¶åŒ…æº(å¦åˆ™dokerå®‰è£…çš„ä¸æ˜¯æ–°ç‰ˆæœ¬)</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ã€å®‰è£…Docker CE</span></span><br><span class="line">yum install -y docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ã€å¯åŠ¨DockeræœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5ã€æµ‹è¯•dockeræ˜¯å¦å®‰è£…æˆåŠŸï¼ˆhello-worldæ˜¯å®˜æ–¹æä¾›çš„ä¸€ä¸ªæµ‹è¯•é•œåƒï¼‰</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6ã€æŸ¥çœ‹dockeråŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">docker info</span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="äºŒã€dockerçš„ç®€å•ä½¿ç”¨"><a href="#äºŒã€dockerçš„ç®€å•ä½¿ç”¨" class="headerlink" title="äºŒã€dockerçš„ç®€å•ä½¿ç”¨"></a>äºŒã€dockerçš„ç®€å•ä½¿ç”¨</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1ã€åˆ›å»ºä¸€ä¸ªnginxå®¹å™¨</span></span><br><span class="line">docker run -it nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ã€æŸ¥çœ‹dockerè¿è¡Œçš„å®¹å™¨(å¯ä»¥è·å–åˆ°è¿™ä¸ªå®¹å™¨çš„id)</span></span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ã€è®¿é—®è¿™ä¸ªå®¹å™¨</span></span><br><span class="line"><span class="comment"># è¿›å…¥è¿™ä¸ªnginxå®¹å™¨ï¼ˆè¿›å…¥çš„æ–‡ä»¶ç³»ç»Ÿå’Œå®¿ä¸»æœºæ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼‰</span></span><br><span class="line">docker <span class="keyword">exec</span> -it <span class="number">73877e65</span>c07d bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ã€æŸ¥çœ‹å½“å‰å®¹å™¨çš„ IP</span></span><br><span class="line">docker inspect <span class="number">73877e65</span>c07d   <span class="comment"># 73877e65c07dæ˜¯é€šè¿‡docekr psæŸ¥çœ‹åˆ°çš„å®¹å™¨ID</span></span><br><span class="line">curl <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>               <span class="comment"># æµ‹è¯•è¿™ä¸ªnginxå®¹å™¨æ˜¯å¦å¯ä»¥è®¿é—®</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€dockerå¸¸ç”¨å‘½ä»¤"><a href="#ä¸‰ã€dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="ä¸‰ã€dockerå¸¸ç”¨å‘½ä»¤"></a>ä¸‰ã€dockerå¸¸ç”¨å‘½ä»¤</h2><h3 id="1ã€dockeré•œåƒç›¸å…³"><a href="#1ã€dockeré•œåƒç›¸å…³" class="headerlink" title="1ã€dockeré•œåƒç›¸å…³"></a><strong>1ã€dockeré•œåƒç›¸å…³</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker help                      		<span class="comment"># æŸ¥çœ‹dockerå¸®åŠ©</span></span><br><span class="line"></span><br><span class="line">docker image --help              		<span class="comment"># æŸ¥çœ‹ dockerä¸­ é•œåƒç›¸å…³å¸®åŠ©</span></span><br><span class="line"></span><br><span class="line">docker image ls                  		<span class="comment"># æŸ¥çœ‹å½“å‰æ‰€æœ‰é•œåƒ</span></span><br><span class="line"></span><br><span class="line">docker image inspect nginx       		<span class="comment"># æŸ¥çœ‹æŒ‡å®šé•œåƒï¼ˆnginxé•œåƒï¼‰è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">docker pull nginx:<span class="number">1.14</span>           		<span class="comment"># ä¸‹è½½æŒ‡å®šç‰ˆæœ¬é•œåƒ nginx</span></span><br><span class="line"></span><br><span class="line">docker image rm nginx:<span class="number">1.14</span>       		<span class="comment"># åˆ é™¤nginx 1.14ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line">docker image save nginx &gt; nginx.tar      	<span class="comment"># å¯¼å‡ºniginxé•œåƒ</span></span><br></pre></td></tr></table></figure>

<h3 id="2ã€dockerå®¹å™¨å¸¸ç›¸å…³"><a href="#2ã€dockerå®¹å™¨å¸¸ç›¸å…³" class="headerlink" title="2ã€dockerå®¹å™¨å¸¸ç›¸å…³"></a>2ã€dockerå®¹å™¨å¸¸ç›¸å…³</h3><p><strong>docker run å¸¸ç”¨å‚æ•°</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-d:   åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›</span><br><span class="line">-i:   ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›</span><br><span class="line">-t:   ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›</span><br><span class="line">-P:   éšæœºç«¯å£æ˜ å°„ï¼Œå®¹å™¨å†…éƒ¨ç«¯å£éšæœºæ˜ å°„åˆ°ä¸»æœºçš„é«˜ç«¯å£</span><br><span class="line">-p:   æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£</span><br><span class="line">--name=<span class="string">"nginx-lb"</span>:   ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›</span><br><span class="line">--dns <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>:   æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›</span><br></pre></td></tr></table></figure>

<p><strong>docker run å…¶ä»–å‚æ•°</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">--dns-search example.com: æŒ‡å®šå®¹å™¨DNSæœç´¢åŸŸåï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›</span><br><span class="line"></span><br><span class="line">-h <span class="string">"mars"</span>: æŒ‡å®šå®¹å™¨çš„hostnameï¼›</span><br><span class="line"></span><br><span class="line">-e username=<span class="string">"ritchie"</span>: è®¾ç½®ç¯å¢ƒå˜é‡ï¼›</span><br><span class="line"></span><br><span class="line">--env-file=[]: ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ç¯å¢ƒå˜é‡ï¼›</span><br><span class="line"></span><br><span class="line">--cpuset=<span class="string">"0-2"</span> <span class="keyword">or</span> --cpuset=<span class="string">"0,1,2"</span>: ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šCPUè¿è¡Œï¼›</span><br><span class="line"></span><br><span class="line">-m :è®¾ç½®å®¹å™¨ä½¿ç”¨å†…å­˜æœ€å¤§å€¼ï¼›</span><br><span class="line"></span><br><span class="line">--net=<span class="string">"bridge"</span>: æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridge/host/none/container: å››ç§ç±»å‹ï¼›</span><br><span class="line"></span><br><span class="line">--link=[]: æ·»åŠ é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼›</span><br><span class="line"></span><br><span class="line">--expose=[]: å¼€æ”¾ä¸€ä¸ªç«¯å£æˆ–ä¸€ç»„ç«¯å£ï¼›</span><br><span class="line"></span><br><span class="line">--volume , -v:    ç»‘å®šä¸€ä¸ªå·</span><br><span class="line"></span><br><span class="line">-a stdin: æŒ‡å®šæ ‡å‡†è¾“å…¥è¾“å‡ºå†…å®¹ç±»å‹ï¼Œå¯é€‰ STDIN/STDOUT/STDERR ä¸‰é¡¹ï¼›</span><br></pre></td></tr></table></figure>

<p><strong>docker å®¹å™¨ç®¡ç†</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker ps					<span class="comment">#æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker ps -a					<span class="comment">#æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker start å®¹å™¨id				<span class="comment">#å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker stop å®¹å™¨id                		<span class="comment"># å…³é—­ä¸€ä¸ªå®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker kill å®¹å™¨id				<span class="comment">#å¼ºåˆ¶åœæ­¢å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker rm å®¹å™¨id				<span class="comment">#åˆ é™¤å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker rm -f å®¹å™¨id				<span class="comment">#åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker inspect å®¹å™¨id				<span class="comment">#æŸ¥çœ‹å®¹å™¨çš„æ‰€æœ‰ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">docker container logs å®¹å™¨id			<span class="comment">#æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line">docker top å®¹å™¨id				<span class="comment">#æŸ¥çœ‹å®¹å™¨é‡Œçš„è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line">docker <span class="keyword">exec</span> -it å®¹å™¨åç§° bash			<span class="comment">#è¿›å…¥å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">exit						<span class="comment">#é€€å‡ºå®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker run --help                               <span class="comment"># æŸ¥çœ‹åˆ›å»ºå®¹å™¨å¸®åŠ©</span></span><br><span class="line"></span><br><span class="line">docker run -it centos                           <span class="comment"># åˆ›å»ºcentosé•œåƒå¹¶è¿›å…¥ç»ˆç«¯</span></span><br><span class="line"></span><br><span class="line">docker run -d nginx                             <span class="comment"># åå°å¯åŠ¨nginxå®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker run -itd centos                          <span class="comment"># å¯ç”¨ä¸€ä¸ªä¼ªç»ˆç«¯å®ˆæŠ¤centoså®¹å™¨</span></span><br></pre></td></tr></table></figure>

<p><strong>dockerå‘½ä»¤è§£æ</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">docker container run -d --name web3 -e test=<span class="number">123456</span> -p <span class="number">8800</span>:<span class="number">80</span> -h webhostname --restart always nginx</span><br><span class="line">    </span><br><span class="line">-d                                       <span class="comment"># åå°å¯åŠ¨nginxå®¹å™¨</span></span><br><span class="line">--name web3                              <span class="comment"># è‡ªå®šä¹‰å®¹å™¨åå­—(é»˜è®¤ä¼šæ˜¯ä¸€æ®µéšæœºå­—ç¬¦ä¸²)</span></span><br><span class="line">-e test=<span class="number">123456</span>                           <span class="comment"># å¯åŠ¨å®¹å™¨æ·»åŠ å˜é‡ test=123456 (echo $test)</span></span><br><span class="line">-p <span class="number">8800</span>:<span class="number">80</span>                               <span class="comment"># å®¿ä¸»æœºçš„8800ç«¯å£æ˜ å°„åˆ°dockerå®¹å™¨çš„80ç«¯å£ä¸­</span></span><br><span class="line">-h webhostname                           <span class="comment"># dockerå®¹å™¨ä¸»æœºå (a300f394af88)</span></span><br><span class="line">--restart always                         <span class="comment"># å®¿ä¸»æœºé‡å¯è‡ªåŠ¨æ‹‰èµ·è¿™ä¸ªdockerå®¹å™¨</span></span><br><span class="line">nginx                                    <span class="comment"># ä½¿ç”¨è¿™ä¸ªnginxé•œåƒå¯åŠ¨å®¹å™¨</span></span><br><span class="line"><span class="comment">#æ³¨ï¼šhttp://192.168.56.12:8800/     	è®¿é—®è¿™ä¸ªdocker  nginx</span></span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker</title>
    <url>/2020/01/02/docker/</url>
    <content><![CDATA[<h2 id="ä¸€ã€Dockerç®€ä»‹"><a href="#ä¸€ã€Dockerç®€ä»‹" class="headerlink" title="ä¸€ã€Dockerç®€ä»‹"></a>ä¸€ã€Dockerç®€ä»‹</h2><ol>
<li><p>Docker æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„å¼€æºå®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ </p>
</li>
<li><p>ç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linuxæˆ–Windows æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚ </p>
</li>
<li><p>æ¯ä¸ªå®¹å™¨æ‹¥æœ‰ä¸€å¥—å’Œå®¿ä¸»æœºå®Œå…¨éš”ç¦»çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå…±ç”¨linuxå†…æ ¸ï¼‰ï¼Œç¨‹åºåœ¨è¿™ä¸ªè™šæ‹Ÿå®¹å™¨é‡Œè¿è¡Œï¼Œå°±å¥½åƒåœ¨çœŸå®çš„ç‰©ç†æœºä¸Šè¿è¡Œä¸€æ ·ã€‚ </p>
<p>å®¹å™¨ï¼š</p>
<p><strong>1ï¼‰</strong>å®¹å™¨æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº§åˆ«ä¸‹çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œè¿è¡Œä¸€ä¸ªå®¹å™¨å°±è¡Œè¿è¡Œä¸€ä¸ªè¿›ç¨‹ä¸€æ ·</p>
<p><strong>2ï¼‰</strong>å®¹å™¨ä¾èµ–linuxå†…æ ¸ç‰¹æ€§ï¼šNamespaceï¼ˆèµ„æºéš”ç¦»ï¼‰å’ŒCgroupsï¼ˆèµ„æºé™åˆ¶ï¼‰</p>
</li>
</ol>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li>ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºæ‰“åŒ…å·¥å…·</li>
<li>ä½¿ç”¨æœ€å¹¿æ³›çš„å¼€æºå®¹å™¨</li>
<li>ä¸€ç§æ“ä½œç³»ç»Ÿçº§çš„è™šæ‹ŸåŒ–æŠ€æœ¯</li>
<li>ä¾èµ–äºLinuxå†…æ ¸ç‰¹æ€§ï¼šNamespaceï¼ˆèµ„æºéš”ç¦»ï¼‰ å’Œ Cgroupsï¼ˆèµ„æºé™åˆ¶ï¼‰</li>
</ul>
<a id="more"></a>



<hr>
<h2 id="äºŒã€dockerçš„ç»„æˆ"><a href="#äºŒã€dockerçš„ç»„æˆ" class="headerlink" title="äºŒã€dockerçš„ç»„æˆ"></a>äºŒã€dockerçš„ç»„æˆ</h2><p><strong><img src="/2020/01/02/docker/image1.png" class="" title="dockeræ„æˆå›¾"></strong> </p>
<table>
<thead>
<tr>
<th>DockerClient</th>
<th>å®¢æˆ·ç«¯</th>
</tr>
</thead>
<tbody><tr>
<td>Docker Daemon</td>
<td>å®ˆæŠ¤è¿›ç¨‹</td>
</tr>
<tr>
<td>Docker Images</td>
<td>é•œåƒ</td>
</tr>
<tr>
<td>Docker Container</td>
<td>å®¹å™¨</td>
</tr>
<tr>
<td>Docker Registry</td>
<td>é•œåƒä»“åº“</td>
</tr>
</tbody></table>
<h2 id="ä¸‰ã€dockerä¸è™šæ‹Ÿæœºæ¯”è¾ƒ"><a href="#ä¸‰ã€dockerä¸è™šæ‹Ÿæœºæ¯”è¾ƒ" class="headerlink" title="ä¸‰ã€dockerä¸è™šæ‹Ÿæœºæ¯”è¾ƒ"></a>ä¸‰ã€dockerä¸è™šæ‹Ÿæœºæ¯”è¾ƒ</h2><p><strong><img src="/2020/01/02/docker/image2.png" class="" title="è™šæ‹Ÿæœºä¸dockerç»“æ„å¯¹æ¯”"></strong> </p>
<p><strong><img src="/2020/01/02/docker/image3.png" class="" title="è™šæ‹Ÿæœºä¸dockeræ€§èƒ½å¯¹æ¯”"></strong> </p>
<h2 id="å››ã€dockeræŠ€æœ¯åº”ç”¨åœºæ™¯"><a href="#å››ã€dockeræŠ€æœ¯åº”ç”¨åœºæ™¯" class="headerlink" title="å››ã€dockeræŠ€æœ¯åº”ç”¨åœºæ™¯"></a>å››ã€dockeræŠ€æœ¯åº”ç”¨åœºæ™¯</h2><h3 id="1ã€åœºæ™¯ä¸€ï¼šèŠ‚çœé¡¹ç›®ç¯å¢ƒéƒ¨ç½²æ—¶é—´"><a href="#1ã€åœºæ™¯ä¸€ï¼šèŠ‚çœé¡¹ç›®ç¯å¢ƒéƒ¨ç½²æ—¶é—´" class="headerlink" title="1ã€åœºæ™¯ä¸€ï¼šèŠ‚çœé¡¹ç›®ç¯å¢ƒéƒ¨ç½²æ—¶é—´"></a><strong>1ã€åœºæ™¯ä¸€ï¼šèŠ‚çœé¡¹ç›®ç¯å¢ƒéƒ¨ç½²æ—¶é—´</strong></h3><p>ã€€ã€€ã€€<strong>1ï¼‰å•é¡¹ç›®æ‰“åŒ…</strong></p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€1. æ¯æ¬¡éƒ¨ç½²é¡¹ç›®åˆ°æµ‹è¯•ã€ç”Ÿäº§ç­‰ç¯å¢ƒï¼Œéƒ½è¦éƒ¨ç½²ä¸€å¤§å †ä¾èµ–çš„è½¯ä»¶ã€å·¥å…·ï¼Œæ—¶é—´ä¹…ï¼Œå‡ºé”™æ¦‚ç‡å¤§ã€‚</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€2. Dockerä¸»è¦ç†å¿µå°±æ˜¯ç¯å¢ƒæ‰“åŒ…éƒ¨ç½²ï¼Œå¯åœ¨ä»»æ„Docker Engineè¿è¡Œã€‚</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€3. æˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸ªé¡¹ç›®ç¯å¢ƒæ‰“åŒ…åˆ°é•œåƒï¼Œpushåˆ°é•œåƒä»“åº“ï¼Œå½“æœ‰éœ€è¦éƒ¨ç½²è¿™ä¸ªé¡¹ç›®æ—¶ï¼Œç›´æ¥pullé•œåƒå¯åŠ¨å®¹å™¨ï¼Œè¿™ä¸ªé¡¹ç›®å°±å¯ä»¥è®¿é—®äº†ï¼ä¸€æ¬¡æ„å»ºå¤šæ¬¡éƒ¨ç½²ï¼Œä¸€åŠ³æ°¸é€¸ã€‚</p>
<p>ã€€ã€€ã€€ <strong>2ï¼‰æ•´å¥—é¡¹ç›®æ‰“åŒ…</strong></p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€1. æ¯”å¦‚æœ‰ä¸€ä¸ªäº§å“å¯ä»¥æ•´å¥—éƒ¨ç½²åˆ°å®¢æˆ·é‚£é‡Œï¼Œä»¥å¾€éƒ½æ˜¯æ´¾ä¸€åå®æ–½å·¥ç¨‹å¸ˆåˆ°å®¢æˆ·é‚£éƒ¨ç½²ã€‚</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€2. å¦‚æœç”¨äº†Dockerï¼Œæˆ‘ä»¬å¯ä»¥å‰æœŸå°†è¿™å¥—é¡¹ç›®å°è£…æ‰“åŒ…èµ·æ¥ï¼Œå®ç°ä¸€é”®éƒ¨ç½²ï¼Œåˆ†åˆ†é’Ÿé’Ÿæå®šï¼Œå°±ä¸éœ€è¦å†æ´¾äººè¿‡å»äº†ã€‚æ¯”å¦‚å®˜æ–¹çš„Docker Composeç¼–æ’å·¥å…·ã€‚</p>
<p>ã€€ã€€ã€€ <strong>3ï¼‰æ–°å¼€æºæŠ€æœ¯è¯•ç”¨</strong></p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€1. æœ‰æ—¶ï¼Œæˆ‘ä»¬æƒ³è°ƒç ”ä¸€äº›å¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»å…¬å…±é•œåƒä»“åº“pullé¡¹ç›®å®˜æ–¹åšå¥½é•œåƒå¯åŠ¨å®¹å™¨å³å¯ã€‚</p>
<h3 id="2ã€åœºæ™¯äºŒï¼šç¯å¢ƒä¸€è‡´æ€§"><a href="#2ã€åœºæ™¯äºŒï¼šç¯å¢ƒä¸€è‡´æ€§" class="headerlink" title="2ã€åœºæ™¯äºŒï¼šç¯å¢ƒä¸€è‡´æ€§"></a><strong>2ã€åœºæ™¯äºŒï¼šç¯å¢ƒä¸€è‡´æ€§</strong></h3><p>ã€€ã€€ã€€ã€€ã€€ã€€1. é¡¹ç›®åœ¨å¼€å‘ç”µè„‘æœ¬åœ°è¿è¡Œæ²¡é—®é¢˜ï¼Œåˆ°äº†æµ‹è¯•æˆ–ç”Ÿäº§ç¯å¢ƒå°±è¿è¡Œä¸èµ·æ¥ã€‚</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€2. Dockerå°†é¡¹ç›®ç¯å¢ƒæ‰“åŒ…æˆé•œåƒï¼Œå¯ä»¥åœ¨ä»»ä½•Docker Engineéƒ¨ç½²ã€‚</p>
<h3 id="3ã€åœºæ™¯ä¸‰ï¼šæŒç»­é›†æˆ"><a href="#3ã€åœºæ™¯ä¸‰ï¼šæŒç»­é›†æˆ" class="headerlink" title="3ã€åœºæ™¯ä¸‰ï¼šæŒç»­é›†æˆ"></a><strong>3ã€åœºæ™¯ä¸‰ï¼šæŒç»­é›†æˆ</strong></h3><p>ã€€ã€€ã€€ã€€ã€€ã€€1. ä¸€ä¸ªé¡¹ç›®ç‰ˆæœ¬å¿«é€Ÿè¿­ä»£çš„æµ‹è¯•åœºæ™¯ï¼Œéœ€è¦ä¸€ä¸ªåˆç†çš„CIï¼ˆæŒç»­é›†æˆï¼‰/CDï¼ˆæŒç»­éƒ¨ç½²ï¼‰ç¯å¢ƒæ”¯æ’‘ã€‚</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€2. CI/CDæ˜¯ä¸€ä¸ªå‘¨æœŸæ€§è‡ªåŠ¨åŒ–é¡¹ç›®æµ‹è¯•æµç¨‹ï¼ŒåŒ…æ‹¬æ„å»ºã€éƒ¨ç½²ã€æµ‹è¯•ã€å‘å¸ƒç­‰å·¥ä½œï¼Œå¾ˆå°‘éœ€è¦äººå·¥å¹²é¢„ã€‚</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€3. Dockeré€šè¿‡é¡¹ç›®é•œåƒæ„å»ºå’Œå¿«é€Ÿéƒ¨ç½²ï¼Œæ‰“é€šæµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒï¼Œé«˜åº¦ä¿æŒå¤šä¸ªç¯å¢ƒä¹‹é—´ä¸€è‡´æ€§ã€‚</p>
<h3 id="4ã€åœºæ™¯å››ï¼šå¾®æœåŠ¡"><a href="#4ã€åœºæ™¯å››ï¼šå¾®æœåŠ¡" class="headerlink" title="4ã€åœºæ™¯å››ï¼šå¾®æœåŠ¡"></a><strong>4ã€åœºæ™¯å››ï¼šå¾®æœåŠ¡</strong></h3><p>ã€€ã€€ã€€ã€€ã€€ã€€1. å¾®æœåŠ¡æŒ‡å°½å¯èƒ½ç»†ç²’åº¦æ‹†åˆ†ä¸šåŠ¡ç¨‹åºæ¶æ„ï¼Œç”±å¤šä¸ªç‹¬ç«‹æœåŠ¡ç»„æˆä¸šåŠ¡ç³»ç»Ÿã€‚</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€2. Dockerå®¹å™¨ä½œä¸ºè¿™äº›ç‹¬ç«‹æœåŠ¡çš„éƒ¨ç½²å•å…ƒï¼Œæ¯ä¸ªæœåŠ¡å•ç‹¬éƒ¨ç½²åˆ°ä¸€ä¸ªdockerå®¹å™¨ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­£åˆ™è¡¨è¾¾å¼</title>
    <url>/2019/11/26/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><h3 id="æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„è´ªå©ªåŒ¹é…å’Œæƒ°æ€§åŒ¹é…"><a href="#æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„è´ªå©ªåŒ¹é…å’Œæƒ°æ€§åŒ¹é…" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„è´ªå©ªåŒ¹é…å’Œæƒ°æ€§åŒ¹é…"></a>æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„è´ªå©ªåŒ¹é…å’Œæƒ°æ€§åŒ¹é…</h3><ol>
<li>è´ªå©ªæ¨¡å¼å°±æ˜¯åŒ¹é…æœ€é•¿çš„å­—ç¬¦ä¸²ï¼Œéè´ªå©ªæ¨¡å¼å°±æ˜¯åŒ¹é…æœ€çŸ­å­—ç¬¦ä¸²ã€‚ </li>
</ol>
<h3 id="å¦‚ä½•åŒºåˆ†ä¸¤ç§æ¨¡å¼"><a href="#å¦‚ä½•åŒºåˆ†ä¸¤ç§æ¨¡å¼" class="headerlink" title="å¦‚ä½•åŒºåˆ†ä¸¤ç§æ¨¡å¼"></a>å¦‚ä½•åŒºåˆ†ä¸¤ç§æ¨¡å¼</h3><p>é»˜è®¤æƒ…å†µä¸‹åŒ¹é…éƒ½æ˜¯è´ªå©ªæ¨¡å¼ï¼Œå¦‚æœè¦æ”¹æˆéè´ªå©ªæ¨¡å¼ï¼Œåªéœ€è¦é‡è¯åé¢åŠ ä¸Šä¸€ä¸ªé—®å·? </p>
<a id="more"></a>

<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>åŒ¹é…ä»»æ„1ä¸ªå­—ç¬¦ï¼ˆé™¤äº†\nï¼‰</td>
</tr>
<tr>
<td>[ ]</td>
<td>åŒ¹é…[ ]ä¸­åˆ—ä¸¾çš„å­—ç¬¦</td>
</tr>
<tr>
<td>\d</td>
<td>åŒ¹é…æ•°å­—ï¼Œå³0-9</td>
</tr>
<tr>
<td>\D</td>
<td>åŒ¹é…éæ•°å­—ï¼Œå³ä¸æ˜¯æ•°å­—</td>
</tr>
<tr>
<td>\s</td>
<td>åŒ¹é…ç©ºç™½ï¼Œå³ ç©ºæ ¼</td>
</tr>
<tr>
<td>\S</td>
<td>åŒ¹é…éç©ºç™½</td>
</tr>
<tr>
<td>\w</td>
<td>åŒ¹é…å•è¯å­—ç¬¦ï¼Œå³a-zã€A-Zã€0-9ã€_</td>
</tr>
<tr>
<td>\W</td>
<td>åŒ¹é…éå•è¯å­—ç¬¦</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>*</th>
<th>åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°0æ¬¡æˆ–è€…æ— é™æ¬¡ï¼Œå³å¯æœ‰å¯æ— </th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°1æ¬¡æˆ–è€…æ— é™æ¬¡ï¼Œå³è‡³å°‘æœ‰1æ¬¡</td>
</tr>
<tr>
<td>?</td>
<td>åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°1æ¬¡æˆ–è€…0æ¬¡ï¼Œå³è¦ä¹ˆæœ‰1æ¬¡ï¼Œè¦ä¹ˆæ²¡æœ‰</td>
</tr>
<tr>
<td>{m}</td>
<td>åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°mæ¬¡</td>
</tr>
<tr>
<td>{m,n}</td>
<td>åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°ä»måˆ°næ¬¡</td>
</tr>
<tr>
<td>^</td>
<td>åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´æ˜¯å¦ä»¥^åé¢çš„å­—ç¬¦å¼€å¤´</td>
</tr>
<tr>
<td>$</td>
<td>åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾æ˜¯å¦ä»¥$å‰é¢çš„å­—ç¬¦ç»“æŸ</td>
</tr>
</tbody></table>
<h3 id="reæ¨¡å—"><a href="#reæ¨¡å—" class="headerlink" title="reæ¨¡å—"></a>reæ¨¡å—</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># reæ¨¡å—</span></span><br><span class="line"><span class="number">1.</span>re.findall(<span class="string">'æ­£åˆ™è¡¨è¾¾å¼'</span>, <span class="string">'å¾…åŒ¹é…å­—ç¬¦ä¸²'</span>): è¿”å›æ‰€æœ‰æ»¡è¶³åŒ¹é…æ¡ä»¶çš„ç»“æœ, ä»¥åˆ—è¡¨å½¢å¼è¿”å›</span><br><span class="line"><span class="number">2.</span>re.search(<span class="string">'æ­£åˆ™è¡¨è¾¾å¼'</span>, <span class="string">'å¸¦åŒ¹é…å­—ç¬¦ä¸²'</span>): åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªå°±è¿”å›ä¸€ä¸ªå¯¹è±¡, è¯¥å¯¹è±¡ä½¿ç”¨group()è¿›è¡Œå–å€¼, å¦‚æœä¸ºåŒ¹é…åˆ°åˆ™è¿”å›<span class="literal">None</span></span><br><span class="line"><span class="number">3.</span>re.match(<span class="string">'æ­£åˆ™è¡¨è¾¾å¼'</span>, <span class="string">'å¾…åŒ¹é…å­—ç¬¦ä¸²'</span>): åªä»å­—ç¬¦ä¸²å¼€å§‹è¿›è¡ŒåŒ¹é…, å¦‚æœåŒ¹é…æˆåŠŸè¿”å›ä¸€ä¸ªå¯¹è±¡,åŒæ ·ä½¿ç”¨group()è¿›è¡Œå–å€¼, åŒ¹é…ä¸æˆåŠŸè¿”å›<span class="literal">None</span></span><br><span class="line"><span class="number">4.</span>re.compile(<span class="string">'æ­£åˆ™è¡¨è¾¾å¼'</span>): å°†æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘ä¸ºå¯¹è±¡, ä½†éœ€è¦æŒ‰è¯¥æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ˜¯å¯ä»¥åœ¨ç›´æ¥ä½¿ç”¨è¯¥å¯¹è±¡è°ƒç”¨ä»¥ä¸Šæ–¹æ³•å³å¯.</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹:    </span></span><br><span class="line">s = <span class="string">"abcabcä½ å¥½"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># findallæ–¹æ³•æ¼”ç¤º</span></span><br><span class="line">res_findall = re.findall(<span class="string">'a'</span>, s)</span><br><span class="line">print(<span class="string">'findallåŒ¹é…ç»“æœ:'</span>, res_findall)</span><br><span class="line"></span><br><span class="line"><span class="comment"># searchæ–¹æ³•æ¼”ç¤º, ä¸ç¡®å®šæ˜¯å¦èƒ½åŒ¹é…å‡ºç»“æœ, ä¸å¯ç›´æ¥ä½¿ç”¨groupè¿›è¡Œå–å€¼, éœ€è¦åˆ¤æ–­æˆ–è¿›è¡Œå¼‚å¸¸å¤„ç†</span></span><br><span class="line">res_search = re.search(<span class="string">"ä½ "</span>, s)</span><br><span class="line"><span class="keyword">if</span> res:</span><br><span class="line">    print(<span class="string">'searchåŒ¹é…ç»“æœ'</span>, res.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'None'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># matchæ–¹æ³•æ¼”ç¤º:</span></span><br><span class="line">res_match_1 = re.match(<span class="string">'abc'</span>, s)</span><br><span class="line">res_match_2 = re.match(<span class="string">'bc'</span>, s)</span><br><span class="line">print(<span class="string">'res_match_1ç»“æœ:'</span>, res_match_1)</span><br><span class="line">print(<span class="string">'res_match_2ç»“æœ:'</span>, res_match_2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># compileæ–¹æ³•æ¼”ç¤º:</span></span><br><span class="line">re_obj = re.compile(<span class="string">'ab'</span>)</span><br><span class="line">res = re_obj.findall(s)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æŠ“å–æ ¡èŠ±ç½‘å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ±‚url, æŠ“å–é¡µé¢</span></span><br><span class="line">url = <span class="string">'http://www.xiaohuar.com/hua/'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url, headers=headers)</span><br><span class="line">html = res.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨æ­£åˆ™åŒ¹é…é¡µé¢ä¸­çš„imgæ ‡ç­¾, è·å–å…¶srcå±æ€§å€¼</span></span><br><span class="line">all_src = re.findall(<span class="string">'&lt;img.*src="(.*jpg)"'</span>, html, re.M)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†è·å–åˆ°çš„å›¾ç‰‡è¿æ¥, å¤„ç†è¿æ¥ä¸ºå®Œæ•´çš„url, å†æ¬¡è¯·æ±‚æŠ“å–å›¾ç‰‡äºŒè¿›åˆ¶æµæ•°æ®, å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">for</span> num, url <span class="keyword">in</span> enumerate(all_src):</span><br><span class="line">    url = <span class="string">'http://www.xiaohuar.com'</span> + url</span><br><span class="line">    image = requests.get(url=url, headers=headers)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'%s.jpg'</span> % num, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(image.content)</span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>nginxé…ç½®è´Ÿè½½å‡è¡¡</title>
    <url>/2019/05/06/Nginx%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</url>
    <content><![CDATA[<h2 id="1ã€æ­è½½å®éªŒç¯å¢ƒï¼ˆä½¿ç”¨dockeréƒ¨ç½²ä¸¤å°nginxå®¹å™¨ï¼‰"><a href="#1ã€æ­è½½å®éªŒç¯å¢ƒï¼ˆä½¿ç”¨dockeréƒ¨ç½²ä¸¤å°nginxå®¹å™¨ï¼‰" class="headerlink" title="1ã€æ­è½½å®éªŒç¯å¢ƒï¼ˆä½¿ç”¨dockeréƒ¨ç½²ä¸¤å°nginxå®¹å™¨ï¼‰"></a>1ã€æ­è½½å®éªŒç¯å¢ƒï¼ˆä½¿ç”¨dockeréƒ¨ç½²ä¸¤å°nginxå®¹å™¨ï¼‰</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨dockeræ­å»ºç¬¬ä¸€å°nginxæœåŠ¡</span></span><br><span class="line">[root@node1 ~]<span class="comment"># docker container run -d --name web01 -p 81:80 nginx</span></span><br><span class="line">æµ‹è¯•è®¿é—®ï¼šhttp://<span class="number">192.168</span><span class="number">.26</span><span class="number">.128</span><span class="number">.81</span>/</span><br><span class="line">[root@node1 ~]<span class="comment"># docker exec -it web01 bash</span></span><br><span class="line">root@b68021de00b8:/<span class="comment"># echo web01 &gt; /usr/share/nginx/html/index.html</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨dockeræ­å»ºç¬¬äºŒå°nginxæœåŠ¡</span></span><br><span class="line">[root@node1 ~]<span class="comment"># docker container run -d --name web02 -p 82:80 nginx</span></span><br><span class="line">æµ‹è¯•è®¿é—®ï¼šhttp://<span class="number">192.168</span><span class="number">.26</span><span class="number">.128</span><span class="number">.82</span>/</span><br><span class="line">[root@node1 ~]<span class="comment"># docker exec -it web02 bash</span></span><br><span class="line">root@ba1678e54a53:/<span class="comment"># echo web02 &gt; /usr/share/nginx/html/index.html</span></span><br></pre></td></tr></table></figure>

<hr>
<a id="more"></a>

<h2 id="2ã€åœ¨çœŸå®ä¸»æœºä¸­å®‰è£…nginxå¹¶é…ç½®è´Ÿè½½å‡è¡¡"><a href="#2ã€åœ¨çœŸå®ä¸»æœºä¸­å®‰è£…nginxå¹¶é…ç½®è´Ÿè½½å‡è¡¡" class="headerlink" title="2ã€åœ¨çœŸå®ä¸»æœºä¸­å®‰è£…nginxå¹¶é…ç½®è´Ÿè½½å‡è¡¡"></a>2ã€<strong>åœ¨çœŸå®ä¸»æœºä¸­å®‰è£…nginxå¹¶é…ç½®è´Ÿè½½å‡è¡¡</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># yum -y install nginx</span></span><br><span class="line">[root@node1 ~]<span class="comment"># vim /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="comment">#### ä¿®æ”¹nginx.conf é»˜è®¤æ˜¯è½®è®­ ####</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"># 1. upstreamæ˜¯è‡ªå·±å†™çš„ï¼Œä¸€å®šè¦æ”¾åœ¨serverå¤–é¢</span></span><br><span class="line"><span class="string">upstream myservers &#123;</span></span><br><span class="line"><span class="string">    server 192.168.56.14:81;</span></span><br><span class="line"><span class="string">    server 192.168.56.14:82;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 2. serverå…¶å®é»˜è®¤å·²ç»æœ‰ä¸€ä¸ªï¼Œåªéœ€è¦ä¿®æ”¹locationä¸­é…ç½®ï¼ŒæŒ‡å®šè½¬å‘ä»£ç†å³å¯</span></span><br><span class="line"><span class="string">server &#123;</span></span><br><span class="line"><span class="string">    location / &#123;</span></span><br><span class="line"><span class="string">       proxy_pass http://myservers;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">[root@node1 nginx]<span class="comment"># systemctl reload nginx				#é‡è½½nginx</span></span><br><span class="line">[root@node1 nginx]<span class="comment"># systemctl start nginx				#å¯åŠ¨nginx</span></span><br><span class="line">[root@node1 nginx]<span class="comment"># systemctl restart nginx 				#é‡å¯nginx</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3ã€è´Ÿè½½å‡è¡¡å¸¸ç”¨é…ç½®æ¢³ç†"><a href="#3ã€è´Ÿè½½å‡è¡¡å¸¸ç”¨é…ç½®æ¢³ç†" class="headerlink" title="3ã€è´Ÿè½½å‡è¡¡å¸¸ç”¨é…ç½®æ¢³ç†"></a>3ã€è´Ÿè½½å‡è¡¡å¸¸ç”¨é…ç½®æ¢³ç†</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚</span><br><span class="line"></span><br><span class="line">upstream backserver &#123;</span><br><span class="line">    server <span class="number">192.168</span><span class="number">.0</span><span class="number">.14</span>;</span><br><span class="line">    server <span class="number">192.168</span><span class="number">.0</span><span class="number">.15</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>ã€æƒé‡ weight</span><br><span class="line">æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">upstream backserver &#123;</span><br><span class="line">    server <span class="number">192.168</span><span class="number">.0</span><span class="number">.14</span> weight=<span class="number">3</span>;</span><br><span class="line">    server <span class="number">192.168</span><span class="number">.0</span><span class="number">.15</span> weight=<span class="number">7</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>ã€ip_hashï¼ˆ IPç»‘å®šï¼‰</span><br><span class="line">ä¸Šè¿°æ–¹å¼å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¯´ï¼Œåœ¨è´Ÿè½½å‡è¡¡ç³»ç»Ÿä¸­ï¼Œå‡å¦‚ç”¨æˆ·åœ¨æŸå°æœåŠ¡å™¨ä¸Šç™»å½•äº†ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·ç¬¬äºŒæ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è´Ÿè½½å‡è¡¡ç³»ç»Ÿï¼Œ</span><br><span class="line">æ¯æ¬¡è¯·æ±‚éƒ½ä¼šé‡æ–°å®šä½åˆ°æœåŠ¡å™¨é›†ç¾¤ä¸­çš„æŸä¸€ä¸ªï¼Œé‚£ä¹ˆå·²ç»ç™»å½•æŸä¸€ä¸ªæœåŠ¡å™¨çš„ç”¨æˆ·å†é‡æ–°å®šä½åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå…¶ç™»å½•ä¿¡æ¯å°†ä¼šä¸¢å¤±ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸å¦¥çš„ã€‚</span><br><span class="line">æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ip_hashæŒ‡ä»¤è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœå®¢æˆ·å·²ç»è®¿é—®äº†æŸä¸ªæœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·å†æ¬¡è®¿é—®æ—¶ï¼Œä¼šå°†è¯¥è¯·æ±‚é€šè¿‡å“ˆå¸Œç®—æ³•ï¼Œè‡ªåŠ¨å®šä½åˆ°è¯¥æœåŠ¡å™¨ã€‚</span><br><span class="line">æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚</span><br><span class="line"></span><br><span class="line">upstream backserver &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server <span class="number">192.168</span><span class="number">.0</span><span class="number">.14</span>:<span class="number">88</span>;</span><br><span class="line">    server <span class="number">192.168</span><span class="number">.0</span><span class="number">.15</span>:<span class="number">80</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>ã€fairï¼ˆç¬¬ä¸‰æ–¹æ’ä»¶ï¼‰</span><br><span class="line">æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</span><br><span class="line"></span><br><span class="line">upstream backserver &#123;</span><br><span class="line">    server server1;</span><br><span class="line">    server server2;</span><br><span class="line">    fair;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>ã€url_hashï¼ˆç¬¬ä¸‰æ–¹æ’ä»¶ï¼‰</span><br><span class="line">æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚</span><br><span class="line"></span><br><span class="line">upstream backserver &#123;</span><br><span class="line">    server squid1:<span class="number">3128</span>;</span><br><span class="line">    server squid2:<span class="number">3128</span>;</span><br><span class="line">    hash $request_uri;</span><br><span class="line">    hash_method crc32;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxå’ŒuWSGIåŒºåˆ«å’Œä½œç”¨</title>
    <url>/2019/05/04/nginx%E5%92%8CuWSGI%E5%8C%BA%E5%88%AB%E5%92%8C%E4%BD%9C%E7%94%A8/</url>
    <content><![CDATA[<h2 id="nginxå’ŒuWSGIçš„åŒºåˆ«"><a href="#nginxå’ŒuWSGIçš„åŒºåˆ«" class="headerlink" title="nginxå’ŒuWSGIçš„åŒºåˆ«"></a>nginxå’ŒuWSGIçš„åŒºåˆ«</h2><ul>
<li><strong>nginx</strong>å’Œ<strong>uWSGI</strong>éƒ½æ˜¯webæœåŠ¡å™¨ï¼Œéƒ½å¯ä»¥ç”¨æ¥éƒ¨ç½²djangoç­‰æœåŠ¡</li>
<li><strong>nginx</strong>ï¼šå¤„ç†é™æ€èµ„æºèƒ½åŠ›éå¸¸å¼ºï¼Œè¿˜å¯ä»¥æä¾› è´Ÿè½½å‡è¡¡ã€åå‘ä»£ç†ã€æ”»å‡»æ‹¦æˆªç­‰</li>
<li><strong>uWSGI</strong>ï¼šå•ç‚¹éƒ¨ç½²ï¼Œå®¹æ˜“éƒ¨ç½²ï¼Œæ€§èƒ½å·®ä¸€äº›ï¼Œå¯ä»¥æ”¯æŒçš„webåè®®å¤š</li>
</ul>
<p>â€‹    <a id="more"></a></p>
<h1 id="django-nginx-uwsgiè¯·æ±‚å¤„ç†è¿‡ç¨‹"><a href="#django-nginx-uwsgiè¯·æ±‚å¤„ç†è¿‡ç¨‹" class="headerlink" title="django+nginx+uwsgiè¯·æ±‚å¤„ç†è¿‡ç¨‹"></a>django+nginx+uwsgiè¯·æ±‚å¤„ç†è¿‡ç¨‹</h1><img src="/2019/05/04/nginx%E5%92%8CuWSGI%E5%8C%BA%E5%88%AB%E5%92%8C%E4%BD%9C%E7%94%A8/1583286059097.png" class="" title="æµç¨‹å›¾">

<h3 id="1ã€è¯·æ±‚å¤„ç†æ•´ä½“æµç¨‹"><a href="#1ã€è¯·æ±‚å¤„ç†æ•´ä½“æµç¨‹" class="headerlink" title="1ã€è¯·æ±‚å¤„ç†æ•´ä½“æµç¨‹"></a>1ã€è¯·æ±‚å¤„ç†æ•´ä½“æµç¨‹</h3><p>nginxæ¥æ”¶åˆ°æµè§ˆå™¨å‘é€è¿‡æ¥çš„httpè¯·æ±‚ï¼Œå°†åŒ…è¿›è¡Œè§£æï¼Œåˆ†æurl </p>
<p><strong>é™æ€æ–‡ä»¶è¯·æ±‚ï¼š</strong>å°±ç›´æ¥è®¿é—®ç”¨æˆ·ç»™nginxé…ç½®çš„é™æ€æ–‡ä»¶ç›®å½•ï¼Œç›´æ¥è¿”å›ç”¨æˆ·è¯·æ±‚çš„é™æ€æ–‡ä»¶</p>
<p><strong>åŠ¨æ€æ¥å£è¯·æ±‚ï¼š</strong>é‚£ä¹ˆnginxå°±å°†è¯·æ±‚è½¬å‘ç»™uWSGIï¼Œæœ€ååˆ°è¾¾djangoå¤„ç†</p>
<h3 id="2ã€å„æ¨¡å—ä½œç”¨"><a href="#2ã€å„æ¨¡å—ä½œç”¨" class="headerlink" title="2ã€å„æ¨¡å—ä½œç”¨"></a>2ã€å„æ¨¡å—ä½œç”¨</h3><ol>
<li><strong>nginxï¼š</strong>æ˜¯å¯¹å¤–çš„æœåŠ¡å™¨ï¼Œå¤–éƒ¨æµè§ˆå™¨é€šè¿‡urlè®¿é—®nginxï¼Œnginxä¸»è¦å¤„ç†é™æ€è¯·æ±‚</li>
<li><strong>uWSGIï¼š</strong>æ˜¯å¯¹å†…çš„æœåŠ¡å™¨ï¼Œä¸»è¦ç”¨æ¥å¤„ç†åŠ¨æ€è¯·æ±‚</li>
<li><strong>uwsgiï¼š</strong>æ˜¯ä¸€ç§webåè®®ï¼Œæ¥æ”¶åˆ°è¯·æ±‚ä¹‹åå°†åŒ…è¿›è¡Œå¤„ç†ï¼Œå¤„ç†æˆwsgiå¯ä»¥æ¥å—çš„æ ¼å¼ï¼Œå¹¶å‘ç»™wsgi</li>
<li><strong>wsgiï¼š</strong>æ˜¯pythonä¸“ç”¨çš„webåè®®ï¼Œæ ¹æ®è¯·æ±‚è°ƒç”¨åº”ç”¨ç¨‹åºï¼ˆdjangoï¼‰çš„æŸä¸ªæ–‡ä»¶ï¼ŒæŸä¸ªæ–‡ä»¶çš„æŸä¸ªå‡½æ•°</li>
<li><strong>djangoï¼š</strong>æ˜¯çœŸæ­£å¹²æ´»çš„ï¼ŒæŸ¥è¯¢æ•°æ®ç­‰èµ„æºï¼ŒæŠŠå¤„ç†çš„ç»“æœå†æ¬¡è¿”å›ç»™WSGIï¼Œ WSGI å°†è¿”å›å€¼è¿›è¡Œæ‰“åŒ…ï¼Œæ‰“åŒ…æˆuwsgièƒ½å¤Ÿæ¥æ”¶çš„æ ¼å¼</li>
<li>uwsgiæ¥æ”¶wsgiå‘é€çš„è¯·æ±‚ï¼Œå¹¶è½¬å‘ç»™nginx,nginxæœ€ç»ˆå°†è¿”å›å€¼è¿”å›ç»™æµè§ˆå™¨</li>
</ol>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Web</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆuWSGI,uwsgi,WSGIçš„åŒºåˆ«</title>
    <url>/2019/05/04/%E6%B5%85%E8%B0%88uWSGI-uwsgi-WSGI%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<h2 id="è¦æ³¨æ„WSGIã€uwsgiã€uWSGIè¿™ä¸‰ä¸ªæ¦‚å¿µçš„åŒºåˆ†"><a href="#è¦æ³¨æ„WSGIã€uwsgiã€uWSGIè¿™ä¸‰ä¸ªæ¦‚å¿µçš„åŒºåˆ†" class="headerlink" title="è¦æ³¨æ„WSGIã€uwsgiã€uWSGIè¿™ä¸‰ä¸ªæ¦‚å¿µçš„åŒºåˆ†"></a>è¦æ³¨æ„WSGIã€uwsgiã€uWSGIè¿™ä¸‰ä¸ªæ¦‚å¿µçš„åŒºåˆ†</h2><ul>
<li>WSGIæ˜¯ä¸€ç§é€šä¿¡åè®®ã€‚</li>
<li>uwsgiæ˜¯ä¸€ç§çº¿è·¯åè®®è€Œä¸æ˜¯é€šä¿¡åè®®ï¼Œåœ¨æ­¤å¸¸ç”¨äºåœ¨uWSGIæœåŠ¡å™¨ä¸å…¶ä»–ç½‘ç»œæœåŠ¡å™¨çš„æ•°æ®é€šä¿¡ã€‚</li>
<li>è€ŒuWSGIæ˜¯å®ç°äº†uwsgiå’ŒWSGIä¸¤ç§åè®®çš„WebæœåŠ¡å™¨ã€‚</li>
</ul>
<a id="more"></a>

<h2 id="WSGI"><a href="#WSGI" class="headerlink" title="WSGI"></a>WSGI</h2><p><strong>WSGIæ˜¯ä¸€ç§é€šä¿¡åè®®</strong>ã€‚WSGI ä¸æ˜¯æ¡†æ¶ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œè€Œæ˜¯ä»‹äº Webåº”ç”¨ç¨‹åºï¼ˆWebæ¡†æ¶ï¼‰ä¸ Web Server ä¹‹é—´äº¤äº’çš„ä¸€ç§è§„èŒƒã€‚åªè¦å¤§å®¶éƒ½éµå¾ªWSGIè§„èŒƒå®ç° Web æ¡†æ¶ï¼Œå°±å¯ä»¥ ä½¿ç”¨ Gunicorn æ¥è¿è¡Œï¼Œè§„èŒƒæœ€æ—©åœ¨ PEP333 ä¸­è¢«æå‡ºã€‚ </p>
<img src="/2019/05/04/%E6%B5%85%E8%B0%88uWSGI-uwsgi-WSGI%E7%9A%84%E5%8C%BA%E5%88%AB/20181212210028151.png" class="" title="This is an test image">  

<p>WSGI è§„å®šäº†WebæœåŠ¡å™¨ï¼ˆServerï¼‰å’Œåº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰åŒæ–¹å„è‡ªéœ€è¦å®ç°ä»€ä¹ˆæ¥å£ï¼Œä»¥ä¾¿ä¸¤è€…èƒ½å®Œç¾çš„é…åˆä½¿ç”¨ï¼Œè¿™ä¸ªå’Œ USB Type-C è§„èŒƒå¾ˆåƒï¼Œ åªè¦æ‰‹æœºå’Œå……ç”µçº¿éƒ½éµå¾ªäº† Type-C æ¥å£è§„èŒƒï¼Œ å¤§å®¶çš„å……ç”µçº¿å°±å¯ä»¥å¤ç”¨ï¼Œä¸åŒçš„æ˜¯å……ç”µè°å¿«è°æ…¢çš„é—®é¢˜ï¼Œè€Œè‹¹æœæ²¡æœ‰éµå¾ªType-Cè§„èŒƒï¼Œæ‰€ä»¥åªæœ‰ä»–è‡ªå®¶çš„çº¿æ‰èƒ½å……è‹¹æœæ‰‹æœºã€‚</p>
<p>ä¸€ä¸ªå®Œæ•´çš„ Web åº”ç”¨åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡å™¨ç¨‹åºï¼ˆServerï¼‰ï¼Œä¸€ä¸ªæ˜¯åº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰ï¼ŒæœåŠ¡å™¨ç¨‹åºè´Ÿè´£æ¥æ”¶æµè§ˆå™¨å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œåº”ç”¨ç¨‹åºè´Ÿè´£å¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚ æ¯”å¦‚æˆ‘åŸºäº Django æ¡†æ¶å¼€å‘ä¸€ä¸ªåšå®¢åº”ç”¨ï¼Œéƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒæ—¶ä¼šç”¨ Gunicorn æˆ–è€… Uwsgi ä½œä¸ºæœåŠ¡å™¨ç¨‹åºã€‚</p>
<p>Python ä¸­ Web æ¡†æ¶éå¸¸å¤šï¼ŒFlaskã€Djangoã€Bottleã€Pyramidã€Tornado ç­‰ç­‰ï¼Œç”šè‡³ä½ ä¹Ÿè‡ªå·±ä¹Ÿå¯ä»¥é€ ä¸€ä¸ª Web æ¡†æ¶ï¼Œé‚£ä¹ˆè¿™ä¹ˆå¤šæ¡†æ¶ï¼Œä¸ºä»€ä¹ˆä»–ä»¬éƒ½å¯ä»¥ç”¨ Gunicorn æˆ–è€… Uwsgi æ¥éƒ¨ç½²å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆå°±æ˜¯ WSGI è§„èŒƒã€‚</p>
<h2 id="uwsgi"><a href="#uwsgi" class="headerlink" title="uwsgi"></a>uwsgi</h2><p>uwsgiæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åè®®ï¼Œèƒ½å¤Ÿæºå¸¦ä»»ä½•ç±»å‹çš„ä¿¡æ¯ã€‚uwsgiæ•°æ®åŒ…çš„å‰4ä¸ªå­—èŠ‚ç”¨äºæè¿°ä¿¡æ¯çš„ç±»å‹ã€‚uwsgiåè®®ä¸»è¦å·¥ä½œåœ¨TCPæ–¹å¼ä¸‹ã€‚uwsgiæ˜¯ä¸€ç§çº¿è·¯åè®®è€Œä¸æ˜¯é€šä¿¡åè®®ï¼Œåœ¨æ­¤å¸¸ç”¨äºåœ¨uWSGIæœåŠ¡å™¨ä¸å…¶ä»–ç½‘ç»œæœåŠ¡å™¨çš„æ•°æ®é€šä¿¡ã€‚ </p>
<p>uwsgiåè®®æ˜¯ä¸€ä¸ªuWSGIæœåŠ¡å™¨è‡ªæœ‰çš„åè®®ï¼Œå®ƒç”¨äºå®šä¹‰ä¼ è¾“ä¿¡æ¯çš„ç±»å‹ï¼ˆtype of informationï¼‰ï¼Œæ¯ä¸€ä¸ªuwsgi packetå‰4byteä¸ºä¼ è¾“ä¿¡æ¯ç±»å‹æè¿°ï¼Œå®ƒä¸WSGIç›¸æ¯”æ˜¯ä¸¤æ ·ä¸œè¥¿ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Struct uwsgi_packet_header&#123;</span><br><span class="line">uint8_t modifier1;</span><br><span class="line">uint16_t datasize;</span><br><span class="line">uint8_t modifier2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="uWSGI"><a href="#uWSGI" class="headerlink" title="uWSGI"></a>uWSGI</h2><p>uWSGIæ˜¯ä¸€ä¸ªå¿«é€Ÿçš„ã€è‡ªç»´æŠ¤ã€å¯¹å¼€å‘è€…å’Œç³»ç»Ÿç®¡ç†è€…å‹å¥½çš„åº”ç”¨ç¨‹åºå®¹å™¨ï¼Œæ˜¯çº¯cè¯­è¨€å¼€å‘çš„æœåŠ¡å™¨ã€‚uWSGIæ˜¯å®ç°äº†uwsgiå’ŒWSGIä¸¤ç§åè®®çš„WebæœåŠ¡å™¨ã€‚</p>
<p>uWSGIæ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œå®ƒå®ç°äº†WSGIåè®®ã€uwsgiã€httpç­‰åè®®ã€‚Nginxä¸­HttpUwsgiModuleçš„ä½œç”¨æ˜¯ä¸uWSGIæœåŠ¡å™¨è¿›è¡Œäº¤æ¢ã€‚WSGIæ˜¯ä¸€ç§WebæœåŠ¡å™¨ç½‘å…³æ¥å£ã€‚å®ƒæ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ï¼ˆå¦‚nginxï¼ŒuWSGIç­‰æœåŠ¡å™¨ï¼‰ä¸webåº”ç”¨ï¼ˆå¦‚ç”¨Flaskæ¡†æ¶å†™çš„ç¨‹åºï¼‰é€šä¿¡çš„ä¸€ç§è§„èŒƒã€‚</p>
<p>å¯¹äºç®¡ç†äººå‘˜æ¥è¯´ï¼ŒuWSGIæœåŠ¡å™¨æä¾›äº†å„ç§é…ç½®æ–¹æ³•ï¼šå‘½ä»¤è¡Œã€ç¯å¢ƒå˜é‡ã€XMLã€INIã€YAMLã€JSONã€SQlite3æ•°æ®åº“å’ŒLDAPã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒçš„è®¾è®¡å®Œå…¨æ¨¡å—åŒ–ï¼Œè¿™æ„å‘³ç€ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ’ä»¶ä»¥ä¾¿æ»¡è¶³ä¸åŒçš„æŠ€æœ¯åº”ç”¨ï¼Œä»è€Œå®ç°å…¼å®¹æ€§</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Web</tag>
      </tags>
  </entry>
  <entry>
    <title>Django+uWSGI+Nginxçš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</title>
    <url>/2019/05/03/Django-uWSGI-Nginx%E7%9A%84%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h2 id="1ã€Django-Uwsgi-Nginx-éƒ¨ç½²çš„ä½œç”¨"><a href="#1ã€Django-Uwsgi-Nginx-éƒ¨ç½²çš„ä½œç”¨" class="headerlink" title="1ã€Django + Uwsgi + Nginx éƒ¨ç½²çš„ä½œç”¨"></a>1ã€Django + Uwsgi + Nginx éƒ¨ç½²çš„ä½œç”¨</h2><a id="more"></a>

<p>   <strong>1ã€Django + Uwsgi + Nginxæ–¹æ¡ˆ</strong></p>
<p> ã€€ã€€ã€€ã€€ã€€ã€€<strong><img src="/2019/05/03/Django-uWSGI-Nginx%E7%9A%84%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/DUN.png" class="" title="This is an test image"></strong> </p>
<p>ã€€ã€€1. webé¡¹ç›®ï¼Œä½¿ç”¨nginxçš„ç›®çš„æ˜¯ä¸ºäº†å®‰å…¨å’Œè´Ÿè½½å‡è¡¡ï¼Œé…ç½®äº†nginxåšå‰ç«¯ä»£ç†ï¼Œuwsgiä½œåç«¯ä»£ç†çš„æœåŠ¡å™¨ã€‚</p>
<p>ã€€ã€€2. åœ¨å¤„ç†æ¥è‡ªInternetçš„è¯·æ±‚æ—¶ï¼Œè¦å…ˆç»è¿‡nginxçš„å¤„ç†ï¼ŒnginxæŠŠè¯·æ±‚å†äº¤ç»™uwsgiï¼Œç»è¿‡uwsgiæ‰èƒ½è®¿é—®åˆ°é¡¹ç›®æœ¬èº«ã€‚</p>
<p>ã€€<strong>2ã€Django + uwsgiæ–¹æ¡ˆ</strong></p>
<p>ã€€ã€€1. æ²¡æœ‰nginxè€Œåªæœ‰uwsgiçš„æœåŠ¡å™¨ï¼Œåˆ™æ˜¯Internetè¯·æ±‚ç›´æ¥ç”±uwsgiå¤„ç†ï¼Œå¹¶åé¦ˆåˆ°webé¡¹ç›®ä¸­ã€‚</p>
<p>ã€€ã€€2. nginxå¯ä»¥å®ç°å®‰å…¨è¿‡æ»¤ï¼Œé˜²DDOSç­‰ä¿æŠ¤å®‰å…¨çš„æ“ä½œï¼Œå¹¶ä¸”å¦‚æœé…ç½®äº†å¤šå°æœåŠ¡å™¨ï¼Œnginxå¯ä»¥ä¿è¯æœåŠ¡å™¨çš„è´Ÿè½½ç›¸å¯¹å‡è¡¡ã€‚</p>
<p>ã€€ã€€3. è€Œuwsgiåˆ™æ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œå®ç°äº†WSGIåè®®(Web Server Gateway Interface)ï¼Œhttpåè®®ç­‰ï¼Œå®ƒå¯ä»¥æ¥æ”¶å’Œå¤„ç†è¯·æ±‚ï¼Œå‘å‡ºå“åº”ç­‰ã€‚<br>ã€€ã€€ æ‰€ä»¥åªç”¨uwsgiä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>ã€€<strong>3ã€nginxå’ŒuWSGIç‰¹ç‚¹</strong></p>
<p>ã€€ã€€ã€€<strong>1ï¼‰nginxçš„ä½œç”¨</strong></p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€1.åå‘ä»£ç†ï¼Œå¯ä»¥æ‹¦æˆªä¸€äº›webæ”»å‡»ï¼Œä¿æŠ¤åç«¯çš„webæœåŠ¡å™¨</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€2.è´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®è½®è¯¢ç®—æ³•ï¼Œåˆ†é…è¯·æ±‚åˆ°å¤šèŠ‚ç‚¹webæœåŠ¡å™¨</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€3.ç¼“å­˜é™æ€èµ„æºï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œé‡Šæ”¾webæœåŠ¡å™¨çš„å†…å­˜å ç”¨ï¼Œä¸“é¡¹ä¸“ç”¨</p>
<p>ã€€ã€€ã€€2ï¼‰uWSGIçš„é€‚ç”¨**</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€1.å•èŠ‚ç‚¹æœåŠ¡å™¨çš„ç®€æ˜“éƒ¨ç½²</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€2.è½»é‡çº§ï¼Œå¥½éƒ¨ç½²</p>
<h2 id="2ã€Django-Uwsgi-Nginx-çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"><a href="#2ã€Django-Uwsgi-Nginx-çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="2ã€Django + Uwsgi + Nginx çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"></a>2ã€Django + Uwsgi + Nginx çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</h2><h3 id="1ã€åœ¨centos-7ä¸­å®‰è£…python3ç¯å¢ƒ"><a href="#1ã€åœ¨centos-7ä¸­å®‰è£…python3ç¯å¢ƒ" class="headerlink" title="1ã€åœ¨centos 7ä¸­å®‰è£…python3ç¯å¢ƒ"></a><strong>1ã€åœ¨centos 7ä¸­å®‰è£…python3ç¯å¢ƒ</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1ã€yumæ›´æ–°yumæº</span></span><br><span class="line">yum update</span><br><span class="line"><span class="comment"># 2ã€å®‰è£…Python 3.7æ‰€éœ€çš„ä¾èµ–å¦åˆ™å®‰è£…åæ²¡æœ‰pip3åŒ…</span></span><br><span class="line">yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel libffi-devel gcc make</span><br><span class="line"><span class="comment"># 3ã€åœ¨å®˜ç½‘ä¸‹è½½æ‰€éœ€ç‰ˆæœ¬ï¼Œè¿™é‡Œç”¨çš„æ˜¯3.7.0ç‰ˆæœ¬</span></span><br><span class="line">wget https://www.python.org/ftp/<span class="number">3.7</span><span class="number">.0</span>/Python<span class="number">-3.7</span><span class="number">.0</span>.tgz</span><br><span class="line"><span class="number">2</span>ã€å®‰è£…Python</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1ã€è§£å‹</span></span><br><span class="line">tar -xvf Python<span class="number">-3.7</span><span class="number">.0</span>.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment">#2ã€é…ç½®ç¼–è¯‘</span></span><br><span class="line">cd Python<span class="number">-3.7</span><span class="number">.0</span></span><br><span class="line">./configure --prefix=/usr/local/python3  <span class="comment"># é…ç½®ç¼–è¯‘çš„çš„è·¯å¾„ï¼ˆè¿™é‡Œ--prefixæ˜¯æŒ‡å®šç¼–è¯‘å®‰è£…çš„æ–‡ä»¶å¤¹ï¼‰</span></span><br><span class="line">./configure --enable-optimizations  <span class="comment"># æ‰§è¡Œè¯¥ä»£ç åï¼Œä¼šç¼–è¯‘å®‰è£…åˆ° /usr/local/bin/ ä¸‹ï¼Œä¸”ä¸ç”¨æ·»åŠ è½¯è¿æ¥æˆ–ç¯å¢ƒå˜é‡</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">ln -s /usr/local/python3/bin/python3 /usr/bin/python3  <span class="comment"># æ·»åŠ è½¯è¿æ¥</span></span><br><span class="line">ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3</span><br><span class="line"></span><br><span class="line"><span class="comment">#3ã€å°†/usr/local/python3/binåŠ å…¥PATH</span></span><br><span class="line">[root@linux-node1 testProj]<span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="comment">#ç„¶ååœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ </span></span><br><span class="line">export PATH=$PATH:/usr/local/python3/bin</span><br><span class="line"></span><br><span class="line">[root@linux-node1 testProj]<span class="comment"># source /etc/profile # ä¿®æ”¹å®Œåï¼Œè¿˜éœ€è¦è®©è¿™ä¸ªç¯å¢ƒå˜é‡åœ¨é…ç½®ä¿¡æ¯ä¸­ç”Ÿæ•ˆï¼Œæ‰§è¡Œå‘½ä»¤</span></span><br></pre></td></tr></table></figure>





<h3 id="2ã€åˆå§‹åŒ–ä¸€ä¸ªdjangoé¡¹ç›®"><a href="#2ã€åˆå§‹åŒ–ä¸€ä¸ªdjangoé¡¹ç›®" class="headerlink" title="2ã€åˆå§‹åŒ–ä¸€ä¸ªdjangoé¡¹ç›®"></a><strong>2ã€åˆå§‹åŒ–ä¸€ä¸ªdjangoé¡¹ç›®</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 /]<span class="comment"># pip3 install django==2.0.4</span></span><br><span class="line">[root@node1 /]<span class="comment"># mkdir /code/</span></span><br><span class="line">[root@node1 /]<span class="comment"># cd /code/</span></span><br><span class="line">[root@node1 testProj]<span class="comment"># django-admin startproject mmcsite</span></span><br><span class="line">[root@node1 testProj]<span class="comment"># cd /code/mmcsite</span></span><br><span class="line">[root@node1 testProj]<span class="comment"># python3 manage.py runserver 0.0.0.0:8000</span></span><br><span class="line"><span class="comment"># é¡µé¢ä¸­è®¿é—®ï¼šhttp://192.168.56.11:8000/</span></span><br></pre></td></tr></table></figure>



<h3 id="3ã€å®‰è£…uwsgi-å¹¶ä½¿ç”¨uWSGIå¯åŠ¨è¿™ä¸ªæœåŠ¡"><a href="#3ã€å®‰è£…uwsgi-å¹¶ä½¿ç”¨uWSGIå¯åŠ¨è¿™ä¸ªæœåŠ¡" class="headerlink" title="3ã€å®‰è£…uwsgi å¹¶ä½¿ç”¨uWSGIå¯åŠ¨è¿™ä¸ªæœåŠ¡"></a><strong>3ã€å®‰è£…uwsgi å¹¶ä½¿ç”¨uWSGIå¯åŠ¨è¿™ä¸ªæœåŠ¡</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'''1. å®‰è£…uwsgi'''</span></span><br><span class="line">[root@node1 /]<span class="comment"># pip3 install uwsgi</span></span><br><span class="line">[root@node1 /]<span class="comment"># ln -s /usr/local/python3/bin/uwsgi /usr/bin/uwsgi</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''2. é…ç½®uwsgi.iniå¯åŠ¨æ–‡ä»¶'''</span></span><br><span class="line">[root@node1 /]<span class="comment"># vim uwsgi.ini</span></span><br><span class="line">[uwsgi]</span><br><span class="line">socket = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">3031</span></span><br><span class="line">chdir = /code/mmcsite</span><br><span class="line">wsgi-file = /code/mmcsite/wsgi.py</span><br><span class="line">processes = <span class="number">5</span></span><br><span class="line">threads = <span class="number">30</span></span><br><span class="line">master = true</span><br><span class="line">daemonize = /code/mmcsite/uwsgi.log</span><br><span class="line">module=mmcsite.wsgi</span><br><span class="line">pidfile = /code/mmcsite/uwsgi.pid</span><br><span class="line">chmod-socket=<span class="number">666</span></span><br><span class="line">enable-threads = true</span><br><span class="line"></span><br><span class="line"><span class="string">'''3. ä½¿ç”¨uwsgiå¯åŠ¨djangoï¼šä¸€å®šè¦åœ¨è¿™ä¸ªé¡¹ç›®ç›®å½•ä¸­'''</span></span><br><span class="line">[root@node1 /]<span class="comment"># uwsgi --http 192.168.26.128:80 --file mmcsite/wsgi.py --static-map=/static=static</span></span><br><span class="line">è®¿é—®é¡¹ç›®ï¼šhttp://<span class="number">192.168</span><span class="number">.26</span><span class="number">.128</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 /]<span class="comment"># vim /code/mmcsite/uwsgi.ini  # uwsgi.iniæ–‡ä»¶</span></span><br><span class="line">[uwsgi]</span><br><span class="line">socket = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">3031</span>                  <span class="comment"># æŒ‡å®šsocketç›‘å¬çš„åœ°å€å’Œç«¯å£</span></span><br><span class="line">chdir = /code/mmcsite                  <span class="comment"># é¡¹ç›®è·¯å¾„ </span></span><br><span class="line">wsgi-file = /code/mmcsite/wsgi.py      <span class="comment"># djangoçš„wsgiæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">processes = <span class="number">5</span>                          <span class="comment"># å¯åŠ¨äº”ä¸ªè¿›ç¨‹</span></span><br><span class="line">threads = <span class="number">30</span>                           <span class="comment"># æ¯ä¸ªè¿›ç¨‹å¯åŠ¨30ä¸ªçº¿ç¨‹</span></span><br><span class="line">master = true</span><br><span class="line">daemonize = /code/mmcsite/uwsgi.log    <span class="comment"># æ—¥å¿—å­˜æ”¾è·¯å¾„</span></span><br><span class="line">module=mmcsite.wsgi                    <span class="comment"># ä½¿ç”¨mmcsite.wsgiæ¨¡å—</span></span><br><span class="line">pidfile = /code/mmcsite/uwsgi.pid      <span class="comment"># uwsgiå¯åŠ¨è¿›ç¨‹idå­˜æ”¾è·¯å¾„</span></span><br><span class="line">chmod-socket=<span class="number">666</span>                       <span class="comment"># socketæƒé™</span></span><br><span class="line">enable-threads = true                  <span class="comment"># å…è®¸ç”¨å†…åµŒçš„è¯­è¨€å¯åŠ¨çº¿ç¨‹ï¼Œè¿™å°†å…è®¸ä½ åœ¨appç¨‹åºä¸­äº§ç”Ÿä¸€ä¸ªå­çº¿ç¨‹</span></span><br></pre></td></tr></table></figure>

<h3 id="4ã€å®‰è£…é…ç½®nginx"><a href="#4ã€å®‰è£…é…ç½®nginx" class="headerlink" title="4ã€å®‰è£…é…ç½®nginx"></a>4ã€å®‰è£…é…ç½®nginx</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'''1. é…ç½®nginx YUMæº'''</span></span><br><span class="line">[root@node1 /] vim /etc/yum.repos.d/nginx.repo</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[nginx]</span></span><br><span class="line"><span class="string">name=nginx repo</span></span><br><span class="line"><span class="string"># ä¸‹é¢è¿™è¡Œcentosæ ¹æ®ä½ è‡ªå·±çš„æ“ä½œç³»ç»Ÿä¿®æ”¹æ¯”å¦‚ï¼šOS/rehel</span></span><br><span class="line"><span class="string"># 6æ˜¯ä½ Linuxç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡URLæŸ¥çœ‹è·¯å¾„æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="string">baseurl=http://nginx.org/packages/centos/7/$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">'''2. å®‰è£…nginx'''</span></span><br><span class="line">[root@node1 /] yum -y install nginx</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 /]<span class="comment"># vim /etc/nginx/conf.d/django.conf </span></span><br><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">8888</span>;</span><br><span class="line">    server_name  <span class="number">192.168</span><span class="number">.26</span><span class="number">.128</span>;</span><br><span class="line">    client_max_body_size <span class="number">5</span>M;</span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_buffers <span class="number">32</span> <span class="number">4</span>K;<span class="comment">#å‹ç¼©åœ¨å†…å­˜ä¸­ç¼“å†²32å— æ¯å—4K</span></span><br><span class="line">    gzip_comp_level <span class="number">6</span> ;<span class="comment">#å‹ç¼©çº§åˆ« æ¨è6</span></span><br><span class="line">    gzip_min_length <span class="number">4000</span>;<span class="comment">#å¼€å§‹å‹ç¼©çš„æœ€å°é•¿åº¦4bit</span></span><br><span class="line">        gzip_types text/plain application/json application/javascript application/x-javascript application/css application/xml application/xml+rss text/javascript application/x-httpd-php image/jpeg image/gif image/png image/x-ms-bmp;</span><br><span class="line">        location / &#123;</span><br><span class="line">              include uwsgi_params;</span><br><span class="line">              uwsgi_pass <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3031</span>;</span><br><span class="line">              uwsgi_ignore_client_abort on;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page <span class="number">404</span> /<span class="number">404.</span>html;</span><br><span class="line">            location = /<span class="number">40</span>x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /<span class="number">50</span>x.html;</span><br><span class="line">            location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5ã€å¯åŠ¨é¡¹ç›®"><a href="#5ã€å¯åŠ¨é¡¹ç›®" class="headerlink" title="5ã€å¯åŠ¨é¡¹ç›®"></a>5ã€å¯åŠ¨é¡¹ç›®</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 demo2]<span class="comment"># systemctl restart nginx   # å¼€å¯nginx</span></span><br><span class="line">[root@node1 demo2]<span class="comment"># uwsgi --ini uwsgi.ini     # å¯åŠ¨uwsgiçš„djangoé¡¹ç›®</span></span><br><span class="line"><span class="comment"># http://192.168.56.11:8888/ è®¿é—®é¡¹ç›®</span></span><br><span class="line">[root@node1 demo2]<span class="comment"># uwsgi --stop uwsgi.pid    # å…³é—­uwsgi</span></span><br></pre></td></tr></table></figure>



<h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxæ˜¯ä»€ä¹ˆ?</title>
    <url>/2019/05/01/Nginx%E6%98%AF%E4%BB%80%E4%B9%88/</url>
    <content><![CDATA[<h2 id="ä¸€ã€åŸºæœ¬ä»‹ç»"><a href="#ä¸€ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="ä¸€ã€åŸºæœ¬ä»‹ç»"></a>ä¸€ã€åŸºæœ¬ä»‹ç»</h2><p>Nginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<strong>HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨</strong>ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª<strong>IMAP/POP3/SMTP</strong>ä»£ç†æœåŠ¡å™¨ã€‚ </p>
<p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„WebæœåŠ¡å™¨/åå‘ä»£ç†æœåŠ¡å™¨ä»¥åŠç”µå­é‚®ä»¶ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶åœ¨ä¸€ä¸ªBSD-likeåè®®ä¸‹å‘è¡Œã€‚ç”±ä¿„ç½—æ–¯çš„ç¨‹åºè®¾è®¡å¸ˆlgor Sysoevæ‰€å¼€å‘ï¼Œä¾›ä¿„å›½å¤§å‹çš„å…¥å£ç½‘ç«™åŠæœç´¢å¼•æ“Ramblerä½¿ç”¨ã€‚å…¶ç‰¹ç‚¹æ˜¯<strong>å æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼º</strong>ï¼Œäº‹å®ä¸Šnginxçš„å¹¶å‘èƒ½åŠ›ç¡®å®åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ã€‚ </p>
<a id="more"></a>

<p><strong>1ã€nginxé«˜å¹¶å‘åŸç†ï¼ˆ å¤šè¿›ç¨‹+epollå®ç°é«˜å¹¶å‘ ï¼‰</strong></p>
<ol>
<li>Nginx åœ¨å¯åŠ¨åï¼Œä¼šæœ‰ä¸€ä¸ª master è¿›ç¨‹å’Œå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„ worker è¿›ç¨‹ã€‚</li>
<li>æ¯ä¸ªå­è¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹(åç¨‹)ï¼Œé‡‡ç”¨çš„ IOå¤šè·¯å¤ç”¨æ¨¡å‹epollï¼Œå®ç°é«˜å¹¶å‘ã€‚</li>
</ol>
<p><strong>2ã€epollèƒ½å®ç°é«˜å¹¶å‘åŸç†</strong></p>
<ol>
<li>epoll() ä¸­å†…æ ¸åˆ™ç»´æŠ¤ä¸€ä¸ªé“¾è¡¨ï¼Œepoll_wait æ–¹æ³•å¯ä»¥è·å–åˆ°é“¾è¡¨é•¿åº¦ï¼Œä¸ä¸º0å°±çŸ¥é“æ–‡ä»¶æè¿°ç¬¦å‡†å¤‡å¥½äº†ã€‚</li>
<li>åœ¨å†…æ ¸å®ç°ä¸­ epoll æ˜¯æ ¹æ®æ¯ä¸ª sockfd ä¸Šé¢çš„ä¸è®¾å¤‡é©±åŠ¨ç¨‹åºå»ºç«‹èµ·æ¥çš„å›è°ƒå‡½æ•°å®ç°çš„ã€‚</li>
<li>æŸä¸ª sockfd ä¸Šçš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¸å®ƒå¯¹åº”çš„å›è°ƒå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œæ¥æŠŠè¿™ä¸ª sockfd åŠ å…¥é“¾è¡¨ï¼Œå…¶ä»–å¤„äºâ€œç©ºé—²çš„â€çŠ¶æ€çš„åˆ™ä¸ä¼šã€‚</li>
<li>epollä¸Šé¢é“¾è¡¨ä¸­è·å–æ–‡ä»¶æè¿°ï¼Œè¿™é‡Œä½¿ç”¨å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰æŠ€æœ¯ï¼Œ é¿å…äº†å¤åˆ¶å¤§é‡æ–‡ä»¶æè¿°ç¬¦å¸¦æ¥çš„å¼€é”€</li>
<li><strong>å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰</strong>ï¼šå†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€ä¸ªæ–‡ä»¶åˆ°ä¸€å—å†…å­˜çš„æ˜ å°„ï¼Œå°†ä¸å¿…å†å¯¹æ–‡ä»¶æ‰§è¡ŒI/Oæ“ä½œ</li>
</ol>
<p><strong>3ã€nginxå’Œapacheæ¯”è¾ƒ</strong> </p>
<ol>
<li><strong>nginxç›¸å¯¹äºapacheçš„ä¼˜ç‚¹</strong> <ol>
<li>è½»é‡çº§ï¼ŒåŒæ ·èµ·web æœåŠ¡ï¼Œæ¯”apache å ç”¨æ›´å°‘çš„å†…å­˜åŠèµ„æº </li>
<li>æŠ—å¹¶å‘ï¼Œnginx å¤„ç†è¯·æ±‚æ˜¯å¼‚æ­¥éé˜»å¡çš„ï¼Œè€Œapache åˆ™æ˜¯é˜»å¡å‹çš„ï¼Œåœ¨é«˜å¹¶å‘ä¸‹nginx èƒ½ä¿æŒä½èµ„æºä½æ¶ˆè€—é«˜æ€§èƒ½ </li>
<li>é«˜åº¦æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œç¼–å†™æ¨¡å—ç›¸å¯¹ç®€å•ï¼Œç¤¾åŒºæ´»è·ƒï¼Œå„ç§é«˜æ€§èƒ½æ¨¡å—å‡ºå“è¿…é€Ÿå•Š </li>
</ol>
</li>
<li><strong>apache ç›¸å¯¹äºnginx çš„ä¼˜ç‚¹</strong> <ol>
<li>apache æ›´ä¸ºæˆç†Ÿï¼Œå°‘ bug ï¼Œç¨³å®šæ€§å¥½ </li>
<li>rewrite ï¼Œæ¯”nginx çš„rewrite å¼ºå¤§ </li>
<li>æ¨¡å—è¶…å¤šï¼ŒåŸºæœ¬æƒ³åˆ°çš„éƒ½å¯ä»¥æ‰¾åˆ° </li>
</ol>
</li>
</ol>
<h2 id="äºŒã€åè¯è§£é‡Š"><a href="#äºŒã€åè¯è§£é‡Š" class="headerlink" title="äºŒã€åè¯è§£é‡Š"></a>äºŒã€åè¯è§£é‡Š</h2><h3 id="ä»£ç†æœåŠ¡å™¨"><a href="#ä»£ç†æœåŠ¡å™¨" class="headerlink" title="ä»£ç†æœåŠ¡å™¨"></a><strong>ä»£ç†æœåŠ¡å™¨</strong></h3><p>ä¸€èˆ¬æ˜¯æŒ‡å±€åŸŸç½‘å†…éƒ¨çš„æœºå™¨<strong>é€šè¿‡ä»£ç†æœåŠ¡å™¨</strong>å‘é€è¯·æ±‚åˆ°äº’è”ç½‘ä¸Šçš„æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨ä¸€èˆ¬ä½œç”¨åœ¨å®¢æˆ·ç«¯ã€‚</p>
<h3 id="æ­£å‘ä»£ç†"><a href="#æ­£å‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†"></a><strong>æ­£å‘ä»£ç†</strong></h3><p><strong><img src="/2019/05/01/Nginx%E6%98%AF%E4%BB%80%E4%B9%88/timg1.png" class="" title="This is an test image"></strong> </p>
<ol>
<li>æˆ‘è®¿é—®ä¸äº†æŸç½‘ç«™ï¼Œä½†æ˜¯æˆ‘èƒ½è®¿é—®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè¿™ä¸ªä»£ç†æœåŠ¡å™¨å‘¢,ä»–èƒ½è®¿é—®é‚£ä¸ªæˆ‘ä¸èƒ½è®¿é—®çš„ç½‘ç«™</li>
<li>äºæ˜¯æˆ‘å…ˆè¿ä¸Šä»£ç†æœåŠ¡å™¨,å‘Šè¯‰ä»–æˆ‘éœ€è¦é‚£ä¸ªæ— æ³•è®¿é—®ç½‘ç«™çš„å†…å®¹ï¼Œä»£ç†æœåŠ¡å™¨å»å–å›æ¥,ç„¶åè¿”å›ç»™æˆ‘ã€‚</li>
<li>å®¢æˆ·ç«¯å¿…é¡»è®¾ç½®æ­£å‘ä»£ç†æœåŠ¡å™¨ï¼Œå½“ç„¶å‰ææ˜¯è¦çŸ¥é“æ­£å‘ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè¿˜æœ‰ä»£ç†ç¨‹åºçš„ç«¯å£ã€‚</li>
<li>ä¾‹å¦‚ä¹‹å‰ä½¿ç”¨è¿‡è¿™ç±»è½¯ä»¶ä¾‹å¦‚CCproxyï¼Œ<a href="http://www.ccproxy.com/" target="_blank" rel="noopener">http://www.ccproxy.com/</a> éœ€è¦åœ¨æµè§ˆå™¨ä¸­é…ç½®ä»£ç†çš„åœ°å€ã€‚</li>
</ol>
<h3 id="æ­£å‘ä»£ç†çš„ä½œç”¨"><a href="#æ­£å‘ä»£ç†çš„ä½œç”¨" class="headerlink" title="æ­£å‘ä»£ç†çš„ä½œç”¨"></a>æ­£å‘ä»£ç†çš„ä½œç”¨</h3><ol>
<li>è®¿é—®åŸæ¥æ— æ³•è®¿é—®çš„èµ„æºï¼Œå¦‚google </li>
<li>å¯ä»¥åšç¼“å­˜ï¼ŒåŠ é€Ÿè®¿é—®èµ„æº</li>
<li>å¯¹å®¢æˆ·ç«¯è®¿é—®æˆæƒï¼Œä¸Šç½‘è¿›è¡Œè®¤è¯</li>
<li>ä»£ç†å¯ä»¥è®°å½•ç”¨æˆ·è®¿é—®è®°å½•ï¼ˆä¸Šç½‘è¡Œä¸ºç®¡ç†ï¼‰ï¼Œå¯¹å¤–éšè—ç”¨æˆ·ä¿¡æ¯</li>
</ol>
<h3 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h3><p><strong><img src="/2019/05/01/Nginx%E6%98%AF%E4%BB%80%E4%B9%88/timg4.png" class="" title="This is an test image"></strong> </p>
<ol>
<li><p>åå‘ä»£ç†å¯¹ç”¨æˆ·é€æ˜ï¼Œå®¢æˆ·ç«¯æ— éœ€ä»»ä½•é…ç½®å³å¯è®¿é—®æœåŠ¡ã€‚</p>
</li>
<li><p>å®é™…è¿è¡Œæ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ã€‚</p>
</li>
<li><p>å¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚</p>
</li>
</ol>
<h3 id="åå‘ä»£ç†çš„ä½¿ç”¨åœºæ™¯"><a href="#åå‘ä»£ç†çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="åå‘ä»£ç†çš„ä½¿ç”¨åœºæ™¯"></a>åå‘ä»£ç†çš„ä½¿ç”¨åœºæ™¯</h3><p><strong>1. ä¿è¯å†…ç½‘çš„å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨åå‘ä»£ç†æä¾›WAFåŠŸèƒ½ï¼Œé˜»æ­¢webæ”»å‡»</strong></p>
<p>â€‹        <strong>ä¾‹ï¼š</strong>å¤§å‹ç½‘ç«™ï¼Œé€šå¸¸å°†åå‘ä»£ç†ä½œä¸ºå…¬ç½‘è®¿é—®åœ°å€ï¼ŒWebæœåŠ¡å™¨æ˜¯å†…ç½‘ </p>
<p><strong><img src="/2019/05/01/Nginx%E6%98%AF%E4%BB%80%E4%B9%88/timg3.png" class="" title="This is an test image"></strong> </p>
<p><strong>2. è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡åå‘ä»£ç†æœåŠ¡å™¨æ¥ä¼˜åŒ–ç½‘ç«™çš„è´Ÿè½½</strong></p>
<p><strong><img src="/2019/05/01/Nginx%E6%98%AF%E4%BB%80%E4%B9%88/timg4.png" class="" title="This is an test image"></strong> </p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ­£å‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯ï¼Œä¸ºå®¢æˆ·ç«¯æœåŠ¡ </p>
<p>åå‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯æœåŠ¡ç«¯ï¼Œä¸ºæœåŠ¡ç«¯æœåŠ¡ </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨æˆ·ç™»å½•å¯¹æ¥QQã€å¾®ä¿¡ã€å¾®åšç­‰ä¸‰æ–¹ç™»å½•</title>
    <url>/2019/04/22/%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%AF%B9%E6%8E%A5QQ%E3%80%81%E5%BE%AE%E4%BF%A1%E3%80%81%E5%BE%AE%E5%8D%9A%E7%AD%89%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/</url>
    <content><![CDATA[<h2 id="è·å–ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•æˆæƒ"><a href="#è·å–ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•æˆæƒ" class="headerlink" title="è·å–ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•æˆæƒ"></a>è·å–ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•æˆæƒ</h2><p><strong><img src="/2019/04/22/%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%AF%B9%E6%8E%A5QQ%E3%80%81%E5%BE%AE%E4%BF%A1%E3%80%81%E5%BE%AE%E5%8D%9A%E7%AD%89%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/nan.png" class="" title="ç™»å½•æˆæƒ"></strong> </p>
<p>ç”³è¯·ç¬¬ä¸‰æ–¹å¼€å‘å¹³å°çš„è´¦å·</p>
<p>ä¸‰å®¶å¼€æ”¾å¹³å°çš„ç”³è¯·åœ°å€ï¼š</p>
<table>
<thead>
<tr>
<th>å¾®åšå¼€æ”¾å¹³å°</th>
<th><a href="http://open.weibo.com" target="_blank" rel="noopener">http://open.weibo.com</a></th>
</tr>
</thead>
<tbody><tr>
<td>å¾®ä¿¡å¼€æ”¾å¹³å°</td>
<td><a href="https://open.weixin.qq.com" target="_blank" rel="noopener">https://open.weixin.qq.com</a></td>
</tr>
<tr>
<td>QQäº’è”å¹³å°</td>
<td><a href="https://connect.qq.com/" target="_blank" rel="noopener">https://connect.qq.com</a></td>
</tr>
</tbody></table>
<a id="more"></a>

<h2 id="ä¸‰æ–¹ç™»å½•æµç¨‹ï¼ˆä»¥å¾®åšç™»å½•ä¸ºä¾‹ï¼‰"><a href="#ä¸‰æ–¹ç™»å½•æµç¨‹ï¼ˆä»¥å¾®åšç™»å½•ä¸ºä¾‹ï¼‰" class="headerlink" title="ä¸‰æ–¹ç™»å½•æµç¨‹ï¼ˆä»¥å¾®åšç™»å½•ä¸ºä¾‹ï¼‰"></a>ä¸‰æ–¹ç™»å½•æµç¨‹ï¼ˆä»¥å¾®åšç™»å½•ä¸ºä¾‹ï¼‰</h2><p>å¼€å‘æ–‡æ¡£ï¼š<a href="https://open.weibo.com/wiki/%E6%8E%88%E6%9D%83%E6%9C%BA%E5%88%B6" target="_blank" rel="noopener">https://open.weibo.com/wiki/%E6%8E%88%E6%9D%83%E6%9C%BA%E5%88%B6</a> </p>
<h3 id="1ï¼‰å‰ç«¯è·å–è®¤è¯code"><a href="#1ï¼‰å‰ç«¯è·å–è®¤è¯code" class="headerlink" title="1ï¼‰å‰ç«¯è·å–è®¤è¯code"></a>1ï¼‰å‰ç«¯è·å–è®¤è¯code</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">1. åœ¨Vueé¡µé¢åŠ è½½æ—¶åŠ¨æ€å‘é€è¯·æ±‚è·å–å¾®åšæˆæƒurl</span><br><span class="line">2. djangoæ”¶åˆ°è¯·æ±‚çš„urlåï¼Œé€šè¿‡å¾®åšåº”ç”¨ID(client_id)å’Œå›è°ƒåœ°å€(redirect_uri)åŠ¨æ€ç”Ÿæˆæˆæƒurlè¿”å›ç»™Vue</span><br><span class="line">3. å½“ç”¨æˆ·ç‚¹å‡»ä¸Šé¢çš„urlè¿›è¡Œæ‰«ç ï¼ŒæˆæƒæˆåŠŸä¼šè·³è½¬æˆ‘ä»¬çš„å›è°ƒç•Œé¢å¹¶é™„åŠ codeå‚æ•°</span><br><span class="line">4. Vueè·å–åˆ°å¾®åšè¿”å›çš„codeåï¼Œä¼šå°†codeå‘é€ç»™djangoåç«¯(ä¸Šé¢çš„redirect_uri)</span><br></pre></td></tr></table></figure>

<p>å¾®åšç™»å½•æ ‡è¯†çš„åœ°å€å¦‚ä¸‹ï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;api.weibo.com&#x2F;oauth2&#x2F;authorize?client_id&#x3D;YOUR_CLIENT_ID&amp;response_type&#x3D;code&amp;redirect_uri&#x3D;YOUR_REGISTERED_REDIRECT_URI</span><br></pre></td></tr></table></figure>

<p>å‚æ•°</p>
<table>
<thead>
<tr>
<th></th>
<th>å¿…é€‰</th>
<th>ç±»å‹åŠèŒƒå›´</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>client_id</td>
<td>true</td>
<td>string</td>
<td>ç”³è¯·åº”ç”¨æ—¶åˆ†é…çš„AppKeyã€‚</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>true</td>
<td>string</td>
<td>æˆæƒå›è°ƒåœ°å€ï¼Œç«™å¤–åº”ç”¨éœ€ä¸è®¾ç½®çš„å›è°ƒåœ°å€ä¸€è‡´ï¼Œç«™å†…åº”ç”¨éœ€å¡«å†™canvas pageçš„åœ°å€ã€‚</td>
</tr>
<tr>
<td>response_type</td>
<td>false</td>
<td>string</td>
<td>code</td>
</tr>
</tbody></table>
<p> è¿”å›å€¼</p>
<table>
<thead>
<tr>
<th>è¿”å›å€¼å­—æ®µ</th>
<th>å­—æ®µç±»å‹</th>
<th>å­—æ®µè¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>code</td>
<td>string</td>
<td>ç”¨äºç¬¬äºŒæ­¥è°ƒç”¨oauth2/access_tokenæ¥å£ï¼Œè·å–æˆæƒåçš„access tokenã€‚</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>å¦‚æœä¼ é€’å‚æ•°ï¼Œä¼šå›ä¼ è¯¥å‚æ•°ã€‚</td>
</tr>
</tbody></table>
<h3 id="2ï¼‰è·å–å¾®åšaccess-token"><a href="#2ï¼‰è·å–å¾®åšaccess-token" class="headerlink" title="2ï¼‰è·å–å¾®åšaccess_token"></a>2ï¼‰è·å–å¾®åšaccess_token</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åç«¯è·å–codeåï¼Œç»“åˆclient_idã€client_secretã€redirect_uriå‚æ•°è¿›è¡Œä¼ é€’,è·å–å¾®åšaccess_token</span><br></pre></td></tr></table></figure>

<p>è¯·æ±‚åœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;api.weibo.com&#x2F;oauth2&#x2F;access_token?client_id&#x3D;YOUR_CLIENT_ID&amp;client_secret&#x3D;YOUR_CLIENT_SECRET&amp;grant_type&#x3D;authorization_code&amp;redirect_uri&#x3D;YOUR_REGISTERED_REDIRECT_URI&amp;code&#x3D;CODE</span><br></pre></td></tr></table></figure>

<p>è¯·æ±‚æ–¹å¼ï¼š</p>
<p>POST</p>
<p>è¯·æ±‚å‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>å¿…é€‰</th>
<th>ç±»å‹åŠèŒƒå›´</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>client_id</td>
<td>true</td>
<td>string</td>
<td>ç”³è¯·åº”ç”¨æ—¶åˆ†é…çš„AppKeyã€‚</td>
</tr>
<tr>
<td>client_secret</td>
<td>true</td>
<td>string</td>
<td>ç”³è¯·åº”ç”¨æ—¶åˆ†é…çš„AppSecretã€‚</td>
</tr>
<tr>
<td>grant_type</td>
<td>true</td>
<td>string</td>
<td>è¯·æ±‚çš„ç±»å‹ï¼Œå¡«å†™authorization_code</td>
</tr>
<tr>
<td>code</td>
<td>ture</td>
<td>string</td>
<td>è°ƒç”¨authorizeè·å¾—çš„codeå€¼ã€‚</td>
</tr>
<tr>
<td>rediect_url</td>
<td>ture</td>
<td>string</td>
<td>å›è°ƒåœ°å€ï¼Œéœ€éœ€ä¸æ³¨å†Œåº”ç”¨é‡Œçš„å›è°ƒåœ°å€ä¸€è‡´ã€‚</td>
</tr>
</tbody></table>
<p>è¿”å›å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;access_token&quot;: &quot;SlAV32hkKG&quot;,</span><br><span class="line">    &quot;remind_in&quot;: 3600,</span><br><span class="line">    &quot;expires_in&quot;: 3600,</span><br><span class="line">    &quot;uid&quot;:1887188234</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-è·å–å¾®åšç”¨æˆ·åŸºæœ¬ä¿¡æ¯å¹¶ä¿å­˜åˆ°æ•°æ®åº“"><a href="#3-è·å–å¾®åšç”¨æˆ·åŸºæœ¬ä¿¡æ¯å¹¶ä¿å­˜åˆ°æ•°æ®åº“" class="headerlink" title="3)è·å–å¾®åšç”¨æˆ·åŸºæœ¬ä¿¡æ¯å¹¶ä¿å­˜åˆ°æ•°æ®åº“"></a>3)è·å–å¾®åšç”¨æˆ·åŸºæœ¬ä¿¡æ¯å¹¶ä¿å­˜åˆ°æ•°æ®åº“</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨è·å¾—çš„access_tokenè°ƒç”¨è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯çš„æ¥å£ï¼Œè·å–ç”¨æˆ·ç¬¬ä¸‰æ–¹å¹³å°çš„åŸºæœ¬ä¿¡æ¯</span><br><span class="line">ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ï¼Œç„¶åå…³è”æœ¬åœ°ç”¨æˆ·ï¼Œç„¶åå°†ç”¨æˆ·ä¿¡æ¯è¿”å›ç»™å‰ç«¯</span><br></pre></td></tr></table></figure>

<h3 id="4ï¼‰ç”Ÿæˆtokenç»™vue"><a href="#4ï¼‰ç”Ÿæˆtokenç»™vue" class="headerlink" title="4ï¼‰ç”Ÿæˆtokenç»™vue"></a>4ï¼‰ç”Ÿæˆtokenç»™vue</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">djangoåç«¯å€ŸåŠ©å¾®åšè®¤è¯æˆåŠŸåï¼Œå¯ä»¥ä½¿ç”¨JWTç”Ÿæˆtokenï¼Œè¿”å›ç»™Vue</span><br><span class="line">Vueå°†tokenå­˜å‚¨åˆ°localStorageä¸­ï¼Œä»¥ä¾¿ç”¨æˆ·è®¿é—®å…¶ä»–é¡µé¢è¿›è¡Œèº«ä»½éªŒè¯</span><br></pre></td></tr></table></figure>

<h3 id="5ï¼‰ä¹Ÿå¯ä»¥è·å–ç”¨æˆ·çš„å…¨éƒ¨ä¿¡æ¯"><a href="#5ï¼‰ä¹Ÿå¯ä»¥è·å–ç”¨æˆ·çš„å…¨éƒ¨ä¿¡æ¯" class="headerlink" title="5ï¼‰ä¹Ÿå¯ä»¥è·å–ç”¨æˆ·çš„å…¨éƒ¨ä¿¡æ¯"></a>5ï¼‰ä¹Ÿå¯ä»¥è·å–ç”¨æˆ·çš„å…¨éƒ¨ä¿¡æ¯</h3><p>è·å–ç”¨æˆ·ä¿¡æ¯APIï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;api.weibo.com&#x2F;2&#x2F;users&#x2F;show.json</span><br></pre></td></tr></table></figure>



<p>è¯·æ±‚å‚æ•°:</p>
<table>
<thead>
<tr>
<th></th>
<th>å¿…é€‰</th>
<th>ç±»å‹åŠèŒƒå›´</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>access_token</td>
<td>true</td>
<td>string</td>
<td>é‡‡ç”¨OAuthæˆæƒæ–¹å¼ä¸ºå¿…å¡«å‚æ•°ï¼ŒOAuthæˆæƒåè·å¾—ã€‚</td>
</tr>
<tr>
<td>uid</td>
<td>false</td>
<td>int64</td>
<td>éœ€è¦æŸ¥è¯¢çš„ç”¨æˆ·IDã€‚</td>
</tr>
<tr>
<td>screen_name</td>
<td>false</td>
<td>string</td>
<td>éœ€è¦æŸ¥è¯¢çš„ç”¨æˆ·æ˜µç§°ã€‚</td>
</tr>
</tbody></table>
<p> å‚æ•°uidä¸screen_nameäºŒè€…å¿…é€‰å…¶ä¸€ï¼Œä¸”åªèƒ½é€‰å…¶ä¸€ï¼›</p>
<p>è¿”å›ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: 1404376560,</span><br><span class="line">    &quot;screen_name&quot;: &quot;zaku&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;zaku&quot;,</span><br><span class="line">    &quot;province&quot;: &quot;11&quot;,</span><br><span class="line">    &quot;city&quot;: &quot;5&quot;,</span><br><span class="line">    &quot;location&quot;: &quot;åŒ—äº¬ æœé˜³åŒº&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;äººç”Ÿäº”åå¹´ï¼Œä¹ƒå¦‚æ¢¦å¦‚å¹»ï¼›æœ‰ç”Ÿæ–¯æœ‰æ­»ï¼Œå£®å£«å¤ä½•æ†¾ã€‚&quot;,</span><br><span class="line">    &quot;url&quot;: &quot;http:&#x2F;&#x2F;blog.sina.com.cn&#x2F;zaku&quot;,</span><br><span class="line">    &quot;profile_image_url&quot;: &quot;http:&#x2F;&#x2F;tp1.sinaimg.cn&#x2F;1404376560&#x2F;50&#x2F;0&#x2F;1&quot;,</span><br><span class="line">    &quot;domain&quot;: &quot;zaku&quot;,</span><br><span class="line">    &quot;gender&quot;: &quot;m&quot;,</span><br><span class="line">    &quot;followers_count&quot;: 1204,</span><br><span class="line">    &quot;friends_count&quot;: 447,</span><br><span class="line">    &quot;statuses_count&quot;: 2908,</span><br><span class="line">    &quot;favourites_count&quot;: 0,</span><br><span class="line">    &quot;created_at&quot;: &quot;Fri Aug 28 00:00:00 +0800 2009&quot;,</span><br><span class="line">    &quot;following&quot;: false,</span><br><span class="line">    &quot;allow_all_act_msg&quot;: false,</span><br><span class="line">    &quot;geo_enabled&quot;: true,</span><br><span class="line">    &quot;verified&quot;: false,</span><br><span class="line">    &quot;status&quot;: &#123;</span><br><span class="line">        &quot;created_at&quot;: &quot;Tue May 24 18:04:53 +0800 2011&quot;,</span><br><span class="line">        &quot;id&quot;: 11142488790,</span><br><span class="line">        &quot;text&quot;: &quot;æˆ‘çš„ç›¸æœºåˆ°äº†ã€‚&quot;,</span><br><span class="line">        &quot;source&quot;: &quot;&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;weibo.com&quot; rel&#x3D;&quot;nofollow&quot;&gt;æ–°æµªå¾®åš&lt;&#x2F;a&gt;&quot;,</span><br><span class="line">        &quot;favorited&quot;: false,</span><br><span class="line">        &quot;truncated&quot;: false,</span><br><span class="line">        &quot;in_reply_to_status_id&quot;: &quot;&quot;,</span><br><span class="line">        &quot;in_reply_to_user_id&quot;: &quot;&quot;,</span><br><span class="line">        &quot;in_reply_to_screen_name&quot;: &quot;&quot;,</span><br><span class="line">        &quot;geo&quot;: null,</span><br><span class="line">        &quot;mid&quot;: &quot;5610221544300749636&quot;,</span><br><span class="line">        &quot;annotations&quot;: [],</span><br><span class="line">        &quot;reposts_count&quot;: 5,</span><br><span class="line">        &quot;comments_count&quot;: 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;allow_all_comment&quot;: true,</span><br><span class="line">    &quot;avatar_large&quot;: &quot;http:&#x2F;&#x2F;tp1.sinaimg.cn&#x2F;1404376560&#x2F;180&#x2F;0&#x2F;1&quot;,</span><br><span class="line">    &quot;verified_reason&quot;: &quot;&quot;,</span><br><span class="line">    &quot;follow_me&quot;: false,</span><br><span class="line">    &quot;online_status&quot;: 0,</span><br><span class="line">    &quot;bi_followers_count&quot;: 215</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¿”å›å€¼ï¼š</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>è¿”å›å€¼å­—æ®µ</th>
<th>å­—æ®µç±»å‹</th>
<th>å­—æ®µè¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int64</td>
<td>ç”¨æˆ·UID</td>
</tr>
<tr>
<td>idstr</td>
<td>string</td>
<td>å­—ç¬¦ä¸²å‹çš„ç”¨æˆ·UID</td>
</tr>
<tr>
<td>screen_name</td>
<td>string</td>
<td>ç”¨æˆ·æ˜µç§°</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>å‹å¥½æ˜¾ç¤ºåç§°</td>
</tr>
<tr>
<td>province</td>
<td>int</td>
<td>ç”¨æˆ·æ‰€åœ¨çœçº§ID</td>
</tr>
<tr>
<td>city</td>
<td>int</td>
<td>ç”¨æˆ·æ‰€åœ¨åŸå¸‚ID</td>
</tr>
<tr>
<td>location</td>
<td>string</td>
<td>ç”¨æˆ·æ‰€åœ¨åœ°</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>ç”¨æˆ·ä¸ªäººæè¿°</td>
</tr>
<tr>
<td>url</td>
<td>string</td>
<td>ç”¨æˆ·åšå®¢åœ°å€</td>
</tr>
<tr>
<td>profile_image_url</td>
<td>string</td>
<td>ç”¨æˆ·å¤´åƒåœ°å€ï¼ˆä¸­å›¾ï¼‰ï¼Œ50Ã—50åƒç´ </td>
</tr>
<tr>
<td>profile_url</td>
<td>string</td>
<td>ç”¨æˆ·çš„å¾®åšç»Ÿä¸€URLåœ°å€</td>
</tr>
<tr>
<td>domain</td>
<td>string</td>
<td>ç”¨æˆ·çš„ä¸ªæ€§åŒ–åŸŸå</td>
</tr>
<tr>
<td>weihao</td>
<td>string</td>
<td>ç”¨æˆ·çš„å¾®å·</td>
</tr>
<tr>
<td>gender</td>
<td>string</td>
<td>æ€§åˆ«ï¼Œmï¼šç”·ã€fï¼šå¥³ã€nï¼šæœªçŸ¥</td>
</tr>
<tr>
<td>followers_count</td>
<td>int</td>
<td>ç²‰ä¸æ•°</td>
</tr>
<tr>
<td>friends_count</td>
<td>int</td>
<td>å…³æ³¨æ•°</td>
</tr>
<tr>
<td>statuses_count</td>
<td>int</td>
<td>å¾®åšæ•°</td>
</tr>
<tr>
<td>favourites_count</td>
<td>int</td>
<td>æ”¶è—æ•°</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>ç”¨æˆ·åˆ›å»ºï¼ˆæ³¨å†Œï¼‰æ—¶é—´</td>
</tr>
<tr>
<td>following</td>
<td>boolean</td>
<td>æš‚æœªæ”¯æŒ</td>
</tr>
<tr>
<td>allow_all_act_msg</td>
<td>boolean</td>
<td>æ˜¯å¦å…è®¸æ‰€æœ‰äººç»™æˆ‘å‘ç§ä¿¡ï¼Œtrueï¼šæ˜¯ï¼Œfalseï¼šå¦</td>
</tr>
<tr>
<td>geo_enabled</td>
<td>boolean</td>
<td>æ˜¯å¦å…è®¸æ ‡è¯†ç”¨æˆ·çš„åœ°ç†ä½ç½®ï¼Œtrueï¼šæ˜¯ï¼Œfalseï¼šå¦</td>
</tr>
<tr>
<td>verified</td>
<td>boolean</td>
<td>æ˜¯å¦æ˜¯å¾®åšè®¤è¯ç”¨æˆ·ï¼Œå³åŠ Vç”¨æˆ·ï¼Œtrueï¼šæ˜¯ï¼Œfalseï¼šå¦</td>
</tr>
<tr>
<td>verified_type</td>
<td>int</td>
<td>æš‚æœªæ”¯æŒ</td>
</tr>
<tr>
<td>remark</td>
<td>string</td>
<td>ç”¨æˆ·å¤‡æ³¨ä¿¡æ¯ï¼Œåªæœ‰åœ¨æŸ¥è¯¢ç”¨æˆ·å…³ç³»æ—¶æ‰è¿”å›æ­¤å­—æ®µ</td>
</tr>
<tr>
<td>status</td>
<td>object</td>
<td>ç”¨æˆ·çš„æœ€è¿‘ä¸€æ¡å¾®åšä¿¡æ¯å­—æ®µ <a href="http://open.weibo.com/wiki/%E5%B8%B8%E8%A7%81%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84#.E5.BE.AE.E5.8D.9A.EF.BC.88status.EF.BC.89" target="_blank" rel="noopener">è¯¦ç»†</a></td>
</tr>
<tr>
<td>allow_all_comment</td>
<td>boolean</td>
<td>æ˜¯å¦å…è®¸æ‰€æœ‰äººå¯¹æˆ‘çš„å¾®åšè¿›è¡Œè¯„è®ºï¼Œtrueï¼šæ˜¯ï¼Œfalseï¼šå¦</td>
</tr>
<tr>
<td>avatar_large</td>
<td>string</td>
<td>ç”¨æˆ·å¤´åƒåœ°å€ï¼ˆå¤§å›¾ï¼‰ï¼Œ180Ã—180åƒç´ </td>
</tr>
<tr>
<td>avatar_hd</td>
<td>string</td>
<td>ç”¨æˆ·å¤´åƒåœ°å€ï¼ˆé«˜æ¸…ï¼‰ï¼Œé«˜æ¸…å¤´åƒåŸå›¾</td>
</tr>
<tr>
<td>verified_reason</td>
<td>string</td>
<td>è®¤è¯åŸå› </td>
</tr>
<tr>
<td>follow_me</td>
<td>boolean</td>
<td>è¯¥ç”¨æˆ·æ˜¯å¦å…³æ³¨å½“å‰ç™»å½•ç”¨æˆ·ï¼Œtrueï¼šæ˜¯ï¼Œfalseï¼šå¦</td>
</tr>
<tr>
<td>online_status</td>
<td>int</td>
<td>ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ï¼Œ0ï¼šä¸åœ¨çº¿ã€1ï¼šåœ¨çº¿</td>
</tr>
<tr>
<td>bi_followers_count</td>
<td>int</td>
<td>ç”¨æˆ·çš„äº’ç²‰æ•°</td>
</tr>
<tr>
<td>lang</td>
<td>string</td>
<td>ç”¨æˆ·å½“å‰çš„è¯­è¨€ç‰ˆæœ¬ï¼Œzh-cnï¼šç®€ä½“ä¸­æ–‡ï¼Œzh-twï¼šç¹ä½“ä¸­æ–‡ï¼Œenï¼šè‹±è¯­</td>
</tr>
</tbody></table>
<h2 id="å…¶å®åƒå¾®ä¿¡ç™»é™†ã€QQç™»é™†çš„åŸç†éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯ï¼š"><a href="#å…¶å®åƒå¾®ä¿¡ç™»é™†ã€QQç™»é™†çš„åŸç†éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯ï¼š" class="headerlink" title="å…¶å®åƒå¾®ä¿¡ç™»é™†ã€QQç™»é™†çš„åŸç†éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯ï¼š"></a>å…¶å®åƒå¾®ä¿¡ç™»é™†ã€QQç™»é™†çš„åŸç†éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯ï¼š</h2><p>1ã€è·å–ç”¨æˆ·æˆæƒï¼Œå–å¾—code</p>
<p>2ã€å°†codeå‘é€åˆ°æˆæƒæœåŠ¡å™¨è·å–Access Token</p>
<p>3ã€é€šè¿‡Access Tokenè°ƒå–APIæ¥å£è·å–ç”¨æˆ·ä¿¡æ¯</p>
<h2 id="ç¬¬ä¸‰æ–¹è´¦å·ç»‘å®šæµç¨‹"><a href="#ç¬¬ä¸‰æ–¹è´¦å·ç»‘å®šæµç¨‹" class="headerlink" title="ç¬¬ä¸‰æ–¹è´¦å·ç»‘å®šæµç¨‹"></a>ç¬¬ä¸‰æ–¹è´¦å·ç»‘å®šæµç¨‹</h2><h3 id="a-æœªç™»å½•"><a href="#a-æœªç™»å½•" class="headerlink" title="a)    æœªç™»å½•"></a>a)    æœªç™»å½•</h3><p><strong><img src="/2019/04/22/%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%AF%B9%E6%8E%A5QQ%E3%80%81%E5%BE%AE%E4%BF%A1%E3%80%81%E5%BE%AE%E5%8D%9A%E7%AD%89%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/150061410519672646.png" class="" title="ä¸‰æ–¹ç™»å½•æµç¨‹"></strong> </p>
<p>ç”¨æˆ·åœ¨ç™»å½•ç•Œé¢ç‚¹å‡»ç¬¬ä¸‰æ–¹è´¦å·ï¼Œæˆæƒé€šè¿‡åï¼Œæˆ‘ä»¬è·å¾—ç”¨æˆ·ç¬¬ä¸‰æ–¹è´¦å·çš„OpenIDï¼Œç”±æ­¤åˆ¤æ–­ç”¨æˆ·çš„ç¬¬ä¸‰æ–¹è´¦å·ä¹‹å‰æ˜¯å¦ç»‘å®šè¿‡ï¼Œå¦‚æœç»‘å®šè¿‡åˆ™ç›´æ¥ç™»å½•æˆåŠŸã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç»‘å®šè¿‡ï¼Œåˆ™è·³åˆ°è´¦å·ç»‘å®šé¡µé¢ã€‚è´¦å·ç»‘å®šé¡µé¢éœ€è¦åˆ†æˆå·²æœ‰è´¦å·ç›´æ¥ç»‘å®šï¼Œå’Œæ²¡æœ‰è´¦å·ï¼Œæ–°æ³¨å†Œè´¦å·è¿›è¡Œç»‘å®šä¸¤ç§æƒ…å†µã€‚</p>
<p>å½“ç”¨æˆ·å·²æœ‰è´¦å·æ—¶ï¼Œé€šè¿‡è¾“å…¥è´¦å·å¯†ç æ ¡éªŒèº«ä»½ï¼Œæ ¡éªŒé€šè¿‡åå³å¯ç»‘å®šæˆåŠŸ/ç™»å½•æˆåŠŸã€‚</p>
<p>å½“ç”¨æˆ·æ²¡æœ‰è´¦å·æ—¶ï¼Œç”¨æˆ·å¯é€šè¿‡æ³¨å†Œæ–°è´¦å·ï¼Œæ³¨å†ŒæˆåŠŸåå³å¯ç»‘å®šæˆåŠŸ/ç™»å½•æˆåŠŸã€‚</p>
<h3 id="b-ç™»å½•çŠ¶æ€"><a href="#b-ç™»å½•çŠ¶æ€" class="headerlink" title="b)    ç™»å½•çŠ¶æ€"></a>b)    ç™»å½•çŠ¶æ€</h3><p>åœ¨ä¸ªäººè´¦å·ä¸­å¿ƒé‡Œæä¾›ç»‘å®šç®¡ç†çš„åŠŸèƒ½å’Œç•Œé¢ï¼Œåœ¨ç”¨æˆ·å·²ç»ç™»å½•çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥ç»‘å®šç¬¬ä¸‰æ–¹è´¦å·ï¼Œåªè¦è·å¾—æˆæƒé€šè¿‡ï¼Œå³å¯ç»‘å®šæˆåŠŸã€‚ </p>
<h3 id="c-è§£ç»‘æµç¨‹"><a href="#c-è§£ç»‘æµç¨‹" class="headerlink" title="c)    è§£ç»‘æµç¨‹"></a>c)    è§£ç»‘æµç¨‹</h3><p><strong><img src="/2019/04/22/%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%AF%B9%E6%8E%A5QQ%E3%80%81%E5%BE%AE%E4%BF%A1%E3%80%81%E5%BE%AE%E5%8D%9A%E7%AD%89%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/150061415069006935.png" class="" title="è§£ç»‘æµç¨‹"></strong> </p>
<p>åœ¨ä¸ªäººè´¦å·ä¸­å¿ƒ&gt;ç»‘å®šç®¡ç†ä¸­ï¼Œå¯ä»¥å¯¹å·²ç»ç»‘å®šçš„ç¬¬ä¸‰æ–¹è´¦å·è¿›è¡Œè§£ç»‘æ“ä½œã€‚åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œç”±äºç”¨æˆ·é•¿æœŸä½¿ç”¨ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•ï¼Œå®é™…ä¸Šæ˜¯ç”±ç¬¬ä¸‰æ–¹è´¦å·æ‰¿æ‹…äº†æäº¤è´¦å·å’Œä¿æŠ¤è´¦å·å®‰å…¨çš„å·¥ä½œï¼Œå› æ­¤åœ¨è§£ç»‘ç¬¬ä¸‰æ–¹è´¦å·æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æé†’ç”¨æˆ·ï¼Œè§£ç»‘ä»¥ååªèƒ½é€šè¿‡æœ¬å¹³å°è´¦å·å¯†ç æ–¹å¼æ¥ç™»å½•ã€‚æœ€å¥½æ˜¯æç¤ºç”¨æˆ·è®°ä½å½“å‰è´¦å· </p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Web</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonå¯¹æ¥æ”¯ä»˜å®</title>
    <url>/2019/04/22/python%E5%AF%B9%E6%8E%A5%E6%94%AF%E4%BB%98%E5%AE%9D/</url>
    <content><![CDATA[<p>æ”¯ä»˜å®å¼€å‘ç½‘å€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ”¯ä»˜å®å¼€æ”¾å¹³å°ï¼š https:&#x2F;&#x2F;open.alipay.com&#x2F;platform&#x2F;home.htm</span><br><span class="line">æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒï¼š https:&#x2F;&#x2F;openhome.alipay.com&#x2F;platform&#x2F;appDaily.htm?tab&#x3D;info</span><br><span class="line">æ”¯ä»˜å®å¼€å‘è€…æ–‡æ¡£ï¼šhttps:&#x2F;&#x2F;openhome.alipay.com&#x2F;developmentDocument.htm</span><br><span class="line">ç”µè„‘ç½‘ç«™æ”¯ä»˜æµç¨‹ï¼šhttps:&#x2F;&#x2F;docs.open.alipay.com&#x2F;270</span><br><span class="line">ç”Ÿæˆç­¾åï¼šhttps:&#x2F;&#x2F;docs.open.alipay.com&#x2F;291&#x2F;106103&#x2F;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="åˆ›å»ºåº”ç”¨ï¼ˆè¿™é‡Œä½¿ç”¨æ²™ç®±ç¯å¢ƒæµ‹è¯•ï¼‰"><a href="#åˆ›å»ºåº”ç”¨ï¼ˆè¿™é‡Œä½¿ç”¨æ²™ç®±ç¯å¢ƒæµ‹è¯•ï¼‰" class="headerlink" title="åˆ›å»ºåº”ç”¨ï¼ˆè¿™é‡Œä½¿ç”¨æ²™ç®±ç¯å¢ƒæµ‹è¯•ï¼‰"></a><strong>åˆ›å»ºåº”ç”¨ï¼ˆè¿™é‡Œä½¿ç”¨æ²™ç®±ç¯å¢ƒæµ‹è¯•ï¼‰</strong></h3><p><strong>1ï¼‰æ²™ç®±ç¯å¢ƒè¯´æ˜</strong></p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€1. çº¿ä¸Šç¯å¢ƒéœ€è¦åˆ›å»ºåº”ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯ä¼ä¸šï¼Œæ²¡æœ‰èµ„è´¨ï¼Œæ‰€ä»¥åªèƒ½ç”³è¯·æ²™ç®±ç¯å¢ƒ</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€2. ç®€å•æ¥è®²æ²™ç®±ç¯å¢ƒå°±æ˜¯ç»™å¼€å‘è€…ä½¿ç”¨çš„æµ‹è¯•ç¯å¢ƒ</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€3. æ²™ç®±ç¯å¢ƒåœ°å€ï¼š<a href="https://openhome.alipay.com/platform/appDaily.htm?tab=info" target="_blank" rel="noopener">https://openhome.alipay.com/platform/appDaily.htm?tab=info</a></p>
<p> ã€€ã€€ã€€ã€€ã€€ã€€</p>
<p><strong><img src="/2019/04/22/python%E5%AF%B9%E6%8E%A5%E6%94%AF%E4%BB%98%E5%AE%9D/1080958-20200220223507691-831979751.png" class="" title="This is an test image"></strong> </p>
<p><strong>2ï¼‰æŒ‰ç…§å®˜æ–¹è¦æ±‚ç”Ÿæˆç§˜é’¥</strong> </p>
<p><strong>ç”Ÿæˆç§˜é’¥å‚è€ƒå®˜ç½‘ï¼š</strong><a href="https://docs.open.alipay.com/291/105971" target="_blank" rel="noopener">https://docs.open.alipay.com/291/105971</a>ã€€ </p>
<p><strong><img src="/2019/04/22/python%E5%AF%B9%E6%8E%A5%E6%94%AF%E4%BB%98%E5%AE%9D/1080958-20200220224215550-1818649484.png" class="" title="This is an test image"></strong> </p>
<p><strong>3ï¼‰æŠŠç”Ÿæˆçš„appå…¬é’¥ç²˜è´´åˆ°æ²™ç®±ç¯å¢ƒçš„appä¸­</strong> </p>
<p><strong><img src="/2019/04/22/python%E5%AF%B9%E6%8E%A5%E6%94%AF%E4%BB%98%E5%AE%9D/1080958-20200220224854732-1698182211.png" class="" title="This is an test image"></strong> </p>
<p><strong><img src="/2019/04/22/python%E5%AF%B9%E6%8E%A5%E6%94%AF%E4%BB%98%E5%AE%9D/1080958-20200220225205004-1139301747.png" class="" title="This is an test image"></strong> </p>
<h3 id="æ”¯ä»˜å®åŠ å¯†åŸç†"><a href="#æ”¯ä»˜å®åŠ å¯†åŸç†" class="headerlink" title="æ”¯ä»˜å®åŠ å¯†åŸç†"></a>æ”¯ä»˜å®åŠ å¯†åŸç†</h3><p><strong><img src="/2019/04/22/python%E5%AF%B9%E6%8E%A5%E6%94%AF%E4%BB%98%E5%AE%9D/1582267585674.png" class="" title="This is an test image"></strong> </p>
<h3 id="æ”¯ä»˜å®ä¿è¯æ¥å£æ•°æ®å®‰å…¨"><a href="#æ”¯ä»˜å®ä¿è¯æ¥å£æ•°æ®å®‰å…¨" class="headerlink" title="æ”¯ä»˜å®ä¿è¯æ¥å£æ•°æ®å®‰å…¨"></a>æ”¯ä»˜å®ä¿è¯æ¥å£æ•°æ®å®‰å…¨</h3><h4 id="1-1-æ•æ„Ÿä¿¡æ¯ä½¿ç”¨åœºæ™¯"><a href="#1-1-æ•æ„Ÿä¿¡æ¯ä½¿ç”¨åœºæ™¯" class="headerlink" title="1.1 æ•æ„Ÿä¿¡æ¯ä½¿ç”¨åœºæ™¯"></a>1.1 æ•æ„Ÿä¿¡æ¯ä½¿ç”¨åœºæ™¯</h4><p>æ•æ„Ÿä¿¡æ¯æŒ‡ç”¨æˆ·çš„ èº«ä»½è¯å·ã€é“¶è¡Œå¡å·ã€æ‰‹æœºå· ç­‰èº«ä»½ä¿¡æ¯ã€‚é‡è¦æ•æ„Ÿä¿¡ æ¯çš„è„±æ•è§„èŒƒå¦‚ä¸‹ã€‚</p>
<h5 id="1-1-1-æ•æ„Ÿä¿¡æ¯ç”¨äºå±•ç¤ºçš„åœºæ™¯"><a href="#1-1-1-æ•æ„Ÿä¿¡æ¯ç”¨äºå±•ç¤ºçš„åœºæ™¯" class="headerlink" title="1.1.1. æ•æ„Ÿä¿¡æ¯ç”¨äºå±•ç¤ºçš„åœºæ™¯"></a>1.1.1. æ•æ„Ÿä¿¡æ¯ç”¨äºå±•ç¤ºçš„åœºæ™¯</h5><p>åŸåˆ™ï¼šæ•æ„Ÿä¿¡æ¯çš„å±•ç¤ºè¯·ä¸¥æ ¼æŒ‰ç…§è„±æ•è§„èŒƒè¿›è¡Œè„±æ• è¯´æ˜ï¼šè„±æ•çš„é€»è¾‘å¿… é¡»åœ¨æœåŠ¡ç«¯å®Œæˆï¼Œä¸èƒ½ä½¿ç”¨ Javascript åœ¨å®¢æˆ·ç«¯è¿›è¡Œè„±æ•ï¼ŒåŒ…æ‹¬ä»£ç æ³¨ é‡Šã€éšè—åŸŸã€url å‚æ•°ã€cookies ç­‰å¤„çš„æ•°æ®ä¹Ÿå¿…é¡»è„±æ•ã€‚ è¯´æ˜ï¼šä¸èƒ½ä½¿ç”¨ å¯é€†çš„ç¼–ç /åŠ å¯†æ–¹å¼ï¼Œå¦‚ base64 ç¼–ç ç­‰ä»£æ›¿è„±æ•è§„èŒƒã€‚ è¯´æ˜ï¼šè‹¥æ•æ„Ÿä¿¡ æ¯æ˜æ–‡å±•ç¤ºåœ¨åº”ç”¨ä¸­ï¼Œæ²¡æœ‰æŒ‰ç…§è„±æ•è§„èŒƒå®Œæˆè„±æ•ã€‚æ”¯ä»˜å®å¼€æ”¾å¹³å°å°†æœ‰ æƒæš‚åœæ•æ„Ÿæ•°æ®ç›¸å…³æ¥å£çš„å¼€æ”¾ã€‚</p>
<h5 id="1-1-2-æ•æ„Ÿä¿¡æ¯ç”¨äºèº«ä»½æ ¡éªŒçš„åœºæ™¯"><a href="#1-1-2-æ•æ„Ÿä¿¡æ¯ç”¨äºèº«ä»½æ ¡éªŒçš„åœºæ™¯" class="headerlink" title="1.1.2. æ•æ„Ÿä¿¡æ¯ç”¨äºèº«ä»½æ ¡éªŒçš„åœºæ™¯"></a>1.1.2. æ•æ„Ÿä¿¡æ¯ç”¨äºèº«ä»½æ ¡éªŒçš„åœºæ™¯</h5><p>åŸåˆ™ï¼šä¸è¦ç›´æ¥å°†æ•æ„Ÿä¿¡æ¯çš„æ˜æ–‡ä¿¡æ¯åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´ä¼ é€’ è¯´æ˜ï¼š å¯ä»¥å°†æ•æ„Ÿä¿¡æ¯åœ¨æœåŠ¡ç«¯å…³è”åˆ°ç”¨æˆ·æ ‡è¯† IDï¼Œåœ¨å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·æ ‡è¯† ID å¹¶æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ ¹æ® ID å–å‡ºå¯¹åº”ä¿¡æ¯åè¿›è¡Œæ ¡éªŒã€‚ è¯´æ˜ï¼šå¦‚æœ æœåŠ¡ç«¯æ²¡æœ‰ç”¨æˆ·æ ‡è¯† ID çš„æœºåˆ¶ï¼ŒåŒæ—¶ä¹Ÿå¿…é¡»åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´ä¼ é€’æ• æ„Ÿä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ AES128 å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†åä¼ è¾“ï¼Œå¹¶ä¸”ä¸èƒ½å°†è§£å¯† å¯†é’¥ä¼ è¾“ç»™ç”¨æˆ·ç«¯ã€‚ 1.2. HTML é¡µé¢æ¸²æŸ“<br>åŸåˆ™ï¼šæ‰€æœ‰åœ¨é¡µé¢æ¸²æŸ“çš„æ•æ„Ÿæ•°æ® (èº«ä»½è¯ã€é“¶è¡Œå¡å·ã€æ‰‹æœºå·) å¿…é¡»è¿›è¡Œ è„±æ•<br>åŸåˆ™ï¼šç¦æ­¢åœ¨ Cookie ä¸­ æ˜æ–‡å†™å…¥ æ•æ„Ÿæ•°æ®<br>åŸåˆ™ï¼šç¦æ­¢å‘ HTML é¡µé¢è¾“å‡ºæœªç»å®‰å…¨è¿‡æ»¤æˆ–æœªæ­£ç¡®è½¬ä¹‰çš„ç”¨æˆ·æ•°æ®<br>åŸåˆ™ï¼šHTML é¡µé¢åŠ¨æ€è¾“å‡º JSONã€JavaScript å¿…é¡»å¯¹å…¶ä¸­çš„å­—ç¬¦ä¸²å€¼åš XSS é˜²å¾¡å¤„ç†<br>åŸåˆ™ï¼šé»˜è®¤è®¾ç½® HTTP Header ä¸­çš„ HttpOnly å±æ€§ä¸º true<br>åŸåˆ™ï¼šå¦‚æœç½‘ç«™ä½¿ç”¨ HTTPS åè®®ï¼Œé»˜è®¤è®¾ç½® HTTP Header ä¸­çš„ secure å±æ€§ä¸º true</p>
<h4 id="1-3-æ¥å£è°ƒç”¨æ“ä½œ"><a href="#1-3-æ¥å£è°ƒç”¨æ“ä½œ" class="headerlink" title="1.3. æ¥å£è°ƒç”¨æ“ä½œ"></a>1.3. æ¥å£è°ƒç”¨æ“ä½œ</h4><p>åŸåˆ™ï¼šAJAX æ¥å£å¿…é¡»æ‰§è¡Œ CSRF è¿‡æ»¤<br>åŸåˆ™ï¼šAJAX æ¥å£è¾“å‡º JSON å­—ç¬¦ä¸²ç¦æ­¢é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥æ„é€ ï¼Œä¸”è¾“å‡ºçš„ JSON éœ€è¦ç»è¿‡å®‰å…¨è¿‡æ»¤<br>åŸåˆ™ï¼šAJAX æ¥å£è¿”å›å¤´å¿…é¡»è®¾ç½® Content-Type ä¸º application/json;charset=utf-8 </p>
<h4 id="1-4-è¡¨å•æäº¤æ“ä½œ"><a href="#1-4-è¡¨å•æäº¤æ“ä½œ" class="headerlink" title="1.4. è¡¨å•æäº¤æ“ä½œ"></a>1.4. è¡¨å•æäº¤æ“ä½œ</h4><p>åŸåˆ™ï¼šç»Ÿä¸€ä½¿ç”¨ POST æ–¹å¼æäº¤è¡¨å• è¯´æ˜ï¼šGet è¯·æ±‚å¯ä»¥é€šè¿‡æ„é€  img ç­‰ æ ‡ç­¾å‘èµ·ï¼Œé€ æˆ CSRF<br>åŸåˆ™ï¼šForm è¡¨å•æäº¤å¿…é¡»æ‰§è¡Œ CSRF è¿‡æ»¤<br>åŸåˆ™ï¼šç”¨æˆ·è¾“å…¥çš„å¯Œæ–‡æœ¬æµè§ˆå™¨å±•ç¤ºä¹‹å‰å¿…é¡»ç”±æœåŠ¡å™¨ç«¯åšå®‰å…¨è¿‡æ»¤ </p>
<h4 id="1-5-æ•°æ®åº“æ“ä½œ"><a href="#1-5-æ•°æ®åº“æ“ä½œ" class="headerlink" title="1.5. æ•°æ®åº“æ“ä½œ"></a>1.5. æ•°æ®åº“æ“ä½œ</h4><p>åŸåˆ™ï¼šç”¨æˆ·å¯†ç å­˜å‚¨é¡»åŠ ç›å­˜å‚¨ï¼Œå„ç”¨æˆ·ç›å€¼ä¸åŒ åŸåˆ™ï¼šè‹¥æ¶‰åŠè¯ä»¶å·ç­‰ æ•æ„Ÿä¿¡æ¯çš„å­˜å‚¨ï¼Œé¡»ä½¿ç”¨ AES-128 ç®—æ³•åŠ å¯†å­˜å‚¨ åŸåˆ™ï¼šç¼–å†™çš„ SQL å¿…é¡» é¢„ç¼–è¯‘ï¼Œä¸å…è®¸é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼åˆæˆ è¯´æ˜ï¼šéƒ¨åˆ†ç‰¹æ®Šåœºæ™¯ï¼Œå¿…é¡»é€š è¿‡æ‹¼æ¥åˆæˆï¼Œåˆ™æ‹¼æ¥çš„å˜é‡å¿…é¡»ç»è¿‡å¤„ç†ï¼Œåªå…è®¸ [a-zA-Z0-9_-.]ï¼‹ å­—ç¬¦ã€‚ </p>
<h4 id="1-6-URL-é‡å®šå‘"><a href="#1-6-URL-é‡å®šå‘" class="headerlink" title="1.6. URL é‡å®šå‘"></a>1.6. URL é‡å®šå‘</h4><p>åŸåˆ™ï¼šURL é‡å®šå‘çš„ç›®æ ‡åœ°å€å¿…é¡»æ‰§è¡Œç™½åå•è¿‡æ»¤ 1.7. è·¨åŸŸæ“ä½œ </p>
<h4 id="1-7-1-JSONP-è·¨åŸŸ"><a href="#1-7-1-JSONP-è·¨åŸŸ" class="headerlink" title="1.7.1. JSONP è·¨åŸŸ"></a>1.7.1. JSONP è·¨åŸŸ</h4><p>åŸåˆ™ï¼šJSONP æ¥å£ Callback å¿…é¡»éªŒè¯æœ‰æ•ˆæ€§ åŸåˆ™ï¼šJSONP æ¥å£è¾“å‡º JSON å­—ç¬¦ä¸²ç¦æ­¢é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥æ„é€ ï¼Œä¸”è¾“å‡ºçš„ JSON éœ€è¦ç»è¿‡å®‰å…¨è¿‡æ»¤ è¯´ æ˜ï¼šå‚è€ƒç« èŠ‚ 2.1 è·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æ¼æ´ åŸåˆ™ï¼šJSONP æ¥å£å¿…é¡»å¯¹ REFERER è¿›è¡Œç™½åå•æ ¡éªŒï¼Œæˆ–æ‰§è¡Œ CSRF æ£€æŸ¥ åŸåˆ™ï¼šJSONP æ¥å£è¿”å›å¤´å¿… é¡»æ­£ç¡®è®¾ç½® Content-Type ä¸º application/javascript;charset=utf-8</p>
<h4 id="1-7-2-CORS-è·¨åŸŸ"><a href="#1-7-2-CORS-è·¨åŸŸ" class="headerlink" title="1.7.2. CORS è·¨åŸŸ"></a>1.7.2. CORS è·¨åŸŸ</h4><p>åŸåˆ™ï¼šæ”¯æŒ CORS è·¨åŸŸçš„æ¥å£ï¼Œè¿”å›å¤´ Access-Control-Allow-Origin å¿…é¡» ä½¿ç”¨ç™½åå•éªŒè¯ï¼Œç¦æ­¢ç›´æ¥è¿”å›*</p>
<h4 id="1-8-æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½"><a href="#1-8-æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½" class="headerlink" title="1.8. æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½"></a>1.8. æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½</h4><p>åŸåˆ™ï¼šé™åˆ¶å¯ä¸‹è½½æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸ºé¢„æœŸèŒƒå›´ï¼Œå¹¶é€šè¿‡æŒ‡å®šæ–‡ä»¶ç¼–å·çš„æ–¹ å¼æ¥å®šä½å¾…ä¸‹è½½æ–‡ä»¶</p>
<p>åŸåˆ™ï¼šä¿å­˜ä¸Šä¼ æ–‡ä»¶çš„ç›®å½•ä¸æä¾›ç›´æ¥è®¿é—® åŸåˆ™ï¼šå¯¹ä¸Šä¼ æ–‡ä»¶çš„å¤§å°å’Œç±» å‹è¿›è¡Œæ ¡éªŒï¼Œå®šä¹‰ä¸Šä¼ æ–‡ä»¶ç±»å‹ç™½åå• </p>
<h4 id="1-9-åŠ å¯†ä¸ç­¾å"><a href="#1-9-åŠ å¯†ä¸ç­¾å" class="headerlink" title="1.9. åŠ å¯†ä¸ç­¾å"></a>1.9. åŠ å¯†ä¸ç­¾å</h4><p><strong><img src="/2019/04/22/python%E5%AF%B9%E6%8E%A5%E6%94%AF%E4%BB%98%E5%AE%9D/1582513156(1).png" class="" title="This is an test image"></strong> </p>
]]></content>
  </entry>
  <entry>
    <title>Git</title>
    <url>/2019/04/19/Git/</url>
    <content><![CDATA[<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><p>Gitæ˜¯ä¸€ä¸ª<strong>å…è´¹çš„å¼€æº</strong>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ—¨åœ¨å¿«é€Ÿé«˜æ•ˆåœ°å¤„ç†ä»å°å‹åˆ°å¤§å‹é¡¹ç›®çš„æ‰€æœ‰äº‹åŠ¡ã€‚</p>
<p>Gitæ˜“äºå­¦ä¹ ï¼Œ å åœ°é¢ç§¯å°ï¼Œå…·æœ‰é—ªç”µèˆ¬å¿«é€Ÿçš„æ€§èƒ½ã€‚å®ƒè¶…è¶Šäº†Subversionï¼ŒCVSï¼ŒPerforceå’ŒClearCaseç­‰SCMå·¥å…·ï¼Œå…·æœ‰å»‰ä»·æœ¬åœ°åˆ†æ”¯ï¼Œä¾¿æ·çš„<strong>ä¸´æ—¶åŒºåŸŸ</strong>å’Œ<strong>å¤šä¸ªå·¥ä½œæµç¨‹</strong>ç­‰åŠŸèƒ½</p>
<a id="more"></a>

<h2 id="gitæµç¨‹"><a href="#gitæµç¨‹" class="headerlink" title="gitæµç¨‹"></a>gitæµç¨‹</h2><p><strong><img src="/2019/04/19/Git/git%E6%B5%81%E7%A8%8B%E5%9B%BE.png" class="" title="gitæµç¨‹å›¾"></strong> </p>
<ul>
<li><code>workspace</code>ï¼šå·¥ä½œåŒº </li>
<li><code>Index/Stage</code>ï¼šæš‚å­˜åŒº </li>
<li><code>Repository</code>ï¼šä»“åº“åŒº/æœ¬åœ°ä»“åº“</li>
<li><code>Remote</code>ï¼šè¿œç¨‹ä»“åº“</li>
</ul>
<h2 id="SVNå’ŒGitçš„åŒºåˆ«"><a href="#SVNå’ŒGitçš„åŒºåˆ«" class="headerlink" title="SVNå’ŒGitçš„åŒºåˆ«"></a>SVNå’ŒGitçš„åŒºåˆ«</h2><ul>
<li><code>SVN</code></li>
</ul>
<blockquote>
<p>SVNæ˜¯é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç‰ˆæœ¬åº“æ˜¯é›†ä¸­æ”¾åœ¨ä¸­å¤®æœåŠ¡å™¨çš„ã€è€Œå¹²æ´»çš„æ—¶å€™ï¼Œç”¨çš„éƒ½æ˜¯è‡ªå·±çš„ç”µè„‘</p>
<p>é¦–å…ˆè¦ä»ä¸­å¤®æœåŠ¡å™¨å“ªé‡Œå¾—åˆ°æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç„¶åå¹²æ´»ï¼Œå¹²å®Œåï¼Œéœ€è¦æŠŠè‡ªå·±åšå®Œçš„æ´»æ¨é€åˆ°ä¸­å¤®æœåŠ¡å™¨</p>
<p>é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ˜¯å¿…é¡»è”ç½‘æ‰èƒ½å·¥ä½œï¼Œå¦‚æœåœ¨å±€åŸŸç½‘è¿˜å¯ä»¥ï¼Œå¸¦å®½å¤Ÿå¤§ï¼Œé€Ÿåº¦å¤Ÿå¿«ï¼Œå¦‚æœåœ¨äº’è”ç½‘ä¸‹ï¼Œå¦‚æœç½‘é€Ÿæ…¢çš„è¯ï¼Œå°±çº³é—·äº†</p>
</blockquote>
<ul>
<li><code>Git</code></li>
</ul>
<blockquote>
<p>Gitæ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œé‚£ä¹ˆå®ƒå°±æ²¡æœ‰ä¸­å¤®æœåŠ¡å™¨çš„ï¼Œæ¯ä¸ªäººçš„ç”µè„‘å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“</p>
<p>è¿™å·¥ä½œçš„æ—¶å€™å°±ä¸éœ€è¦è”ç½‘äº†ï¼Œå› ä¸ºç‰ˆæœ¬éƒ½æ˜¯åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šã€‚æ—¢ç„¶æ¯ä¸ªäººçš„ç”µè„‘éƒ½æœ‰ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œé‚£å¤šä¸ªäººå¦‚ä½•åä½œå‘¢ï¼Ÿæ¯”å¦‚è¯´è‡ªå·±åœ¨ç”µè„‘ä¸Šæ”¹äº†æ–‡ä»¶Aï¼Œå…¶ä»–äººä¹Ÿåœ¨ç”µè„‘ä¸Šæ”¹äº†æ–‡ä»¶Aï¼Œè¿™æ—¶ï¼Œä½ ä»¬ä¸¤ä¹‹é—´åªéœ€æŠŠå„è‡ªçš„ä¿®æ”¹æ¨é€ç»™å¯¹æ–¹ï¼Œå°±å¯ä»¥äº’ç›¸çœ‹åˆ°å¯¹æ–¹çš„ä¿®æ”¹äº†</p>
<p>Gitåœ¨æœ¬åœ°ç£ç›˜ä¸Šå°±ä¿å­˜ç€æ‰€æœ‰æœ‰å…³å½“å‰é¡¹ç›®çš„å†å²æ›´æ–°ï¼Œå¹¶ä¸”Gitä¸­çš„ç»å¤§å¤šæ•°æ“ä½œéƒ½åªéœ€è¦è®¿é—®æœ¬åœ°æ–‡ä»¶å’Œèµ„æºï¼Œä¸ç”¨è¿ç½‘ï¼Œæ‰€ä»¥å¤„ç†èµ·æ¥é€Ÿåº¦é£å¿«</p>
<p>ç”¨SVNçš„è¯ï¼Œæ²¡æœ‰ç½‘ç»œæˆ–è€…æ–­å¼€VPNä½ å°±æ— æ³•åšä»»ä½•äº‹æƒ…</p>
<p>ä½†ç”¨Gitçš„è¯ï¼Œå°±ç®—ä½ åœ¨é£æœºæˆ–è€…ç«è½¦ä¸Šï¼Œéƒ½å¯ä»¥éå¸¸æ„‰å¿«åœ°é¢‘ç¹æäº¤æ›´æ–°ï¼Œç­‰åˆ°äº†æœ‰ç½‘ç»œçš„æ—¶å€™å†ä¸Šä¼ åˆ°<strong>è¿œç¨‹çš„é•œåƒä»“åº“</strong>ã€‚æ¢ä½œå…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œè¿™ä¹ˆåšå‡ ä¹ä¸å¯èƒ½ï¼ŒæŠ‘æˆ–æ˜¯éå¸¸éº»çƒ¦</p>
</blockquote>
<h2 id="Gitæ“ä½œ"><a href="#Gitæ“ä½œ" class="headerlink" title="Gitæ“ä½œ"></a>Gitæ“ä½œ</h2><p><strong>1. åˆ›å»ºgitç‰ˆæœ¬åº“</strong><br>ã€€ã€€ã€€ã€€1ã€ç‰ˆæœ¬åº“åˆåä»“åº“ï¼Œè‹±æ–‡årepositoryï¼Œä½ å¯ä»¥ç®€å•ç†è§£æˆä¸€ä¸ªç›®å½•ï¼Œ<br>ã€€ã€€ã€€ã€€2ã€è¿™ä¸ªç›®å½•é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥è¢«Gitç®¡ç†èµ·æ¥ï¼Œæ¯ä¸ªæ–‡ä»¶çš„ä¿®æ”¹ã€åˆ é™¤ï¼ŒGitéƒ½èƒ½è·Ÿè¸ªï¼Œä»¥ä¾¿ä»»ä½•æ—¶åˆ»éƒ½å¯ä»¥è¿½è¸ªå†å²ï¼Œæˆ–è€…åœ¨å°†æ¥æŸä¸ªæ—¶åˆ»å¯ä»¥â€œè¿˜åŸâ€ã€‚<br>ã€€ã€€ã€€ã€€3ã€æ‰€ä»¥ï¼Œåˆ›å»ºä¸€ä¸ªç‰ˆæœ¬åº“éå¸¸ç®€å•ï¼Œé¦–å…ˆï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„åœ°æ–¹ï¼Œåˆ›å»ºä¸€ä¸ªç©ºç›®<br>ã€€ã€€ã€€ã€€4ã€ç¬é—´Gitå°±æŠŠä»“åº“å»ºå¥½äº†ï¼Œè€Œä¸”å‘Šè¯‰ä½ æ˜¯ä¸€ä¸ªç©ºçš„ä»“åº“ï¼ˆempty Git repositoryï¼‰<br>ã€€ã€€ã€€ã€€5ã€ç»†å¿ƒçš„è¯»è€…å¯ä»¥å‘ç°å½“å‰ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª.gitçš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ˜¯Gitæ¥è·Ÿè¸ªç®¡ç†ç‰ˆæœ¬åº“çš„ï¼Œæ²¡äº‹åƒä¸‡ä¸è¦æ‰‹åŠ¨ä¿®æ”¹è¿™ä¸ªç›®å½•é‡Œé¢çš„æ–‡ä»¶ï¼Œä¸ç„¶æ”¹ä¹±äº†ï¼Œå°±æŠŠGitä»“åº“ç»™ç ´åäº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ã€€ã€€mkdir s15_gitpro                 #å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®</span><br><span class="line">ã€€ã€€cd s15_gitpro&#x2F;                   #åˆ‡æ¢åˆ°è¿™ä¸ªé¡¹ç›®ç›®å½•</span><br><span class="line">ã€€ã€€git init                         #åˆå§‹åŒ–è¿™ä¸ª</span><br></pre></td></tr></table></figure>





<p><strong>2. å·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»£ç ä»“åº“</strong></p>
<p>ã€€ã€€ã€€ã€€1ã€<strong>å·¥ä½œåŒºï¼š</strong> å°±æ˜¯ä½ åœ¨ç”µè„‘ä¸Šçœ‹åˆ°çš„ç›®å½•ï¼Œæ¯”å¦‚ç›®å½•ä¸‹testgité‡Œçš„æ–‡ä»¶(.gitéšè—ç›®å½•ç‰ˆæœ¬åº“é™¤å¤–)ã€‚<br>ã€€ã€€ã€€ã€€2ã€<strong>æš‚å­˜åŒº :</strong>  æš‚å­˜åŒºå°±æ˜¯æ–‡ä»¶å¤¹ .gitä¸­çš„ä¸€ä¸ªå°éƒ¨åˆ†ï¼ˆ.gitæ–‡ä»¶å¤¹å°±æ˜¯ç‰ˆæœ¬åº“ï¼‰<br>ã€€ã€€ã€€ã€€3ã€<strong>ç‰ˆæœ¬åº“ï¼š</strong>å·¥ä½œåŒºæœ‰ä¸€ä¸ªéšè—ç›®å½•.git,è¿™ä¸ªä¸å±äºå·¥ä½œåŒºï¼Œè¿™æ˜¯ç‰ˆæœ¬åº“ï¼Œ  ç‰ˆæœ¬åº“ä¸­è¿˜æœ‰Gitä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ç¬¬ä¸€ä¸ªåˆ†æ”¯master,ä»¥åŠæŒ‡å‘masterçš„ä¸€ä¸ªæŒ‡é’ˆHEAD</p>
<p>ã€€ã€€ã€€ã€€<strong>4ã€ æŠŠæ–‡ä»¶æ·»åŠ åˆ°ç‰ˆæœ¬åº“åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.	vim Readme	#å·¥ä½œåŒºï¼ˆWorking Zoneï¼‰ æ¯”å¦‚åœ¨mkdir s15_gitproä¸‹æ‰§è¡Œåˆ›å»ºæ–‡ä»¶å‘½ä»¤</span><br><span class="line"></span><br><span class="line">2. 	git add		#æš‚å­˜åŒºï¼ˆStage zoneï¼‰</span><br><span class="line"></span><br><span class="line">3.	git commit   	#ä»£ç ä»“åº“ï¼ˆRepository masterï¼‰ åªæœ‰æäº¤åˆ°ä»£ç åº“æ‰èƒ½è¢«gitç®¡ç†</span><br></pre></td></tr></table></figure>





<p><strong>3. æœ¬åœ°gitåŸºæœ¬å‘½ä»¤</strong></p>
<p>ã€€ã€€ã€€ã€€<strong>1ã€å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“</strong>ã€€ã€€ã€€ã€€ã€€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git add Readme		#æŒ‡å®šå°†Readmeæ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº</span><br><span class="line"></span><br><span class="line">git add . 		#å°†å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å…¨éƒ¨æ·»åŠ åˆ°æš‚å­˜åŒº</span><br><span class="line"></span><br><span class="line">git status		#æŸ¥çœ‹æ›´æ”¹äº†å“ªäº›ï¼Œåˆ›å»ºäº†å“ªäº›ï¼Œå“ªäº›æ²¡æœ‰æ·»åŠ åˆ°ä»“åº“ï¼Œå“ªäº›æ·»åŠ åˆ°äº†ä»“åº“</span><br><span class="line"></span><br><span class="line">git status diff readme		#æŸ¥çœ‹readmeæ–‡ä»¶å…·ä½“ä¿®æ”¹äº†å“ªäº›</span><br><span class="line"></span><br><span class="line">git commit -m &quot;commit tag&quot;		# git commitå‘Šè¯‰Gitï¼ŒæŠŠæ–‡ä»¶æäº¤åˆ°ä»“åº“-måé¢è¾“å…¥çš„æ˜¯æœ¬æ¬¡æäº¤çš„è¯´æ˜(ç‰ˆæœ¬åå­—)</span><br></pre></td></tr></table></figure>

<p>ã€€ã€€ã€€    <strong>è¯´æ˜ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ã€€# æ‰§è¡Œgit commit å‘½ä»¤æ—¶å¿…é¡»é…ç½®ç”¨æˆ·ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">git config --global user.name &quot;Tom Git&quot;</span><br><span class="line"></span><br><span class="line">git config --global user.email tom@example.com</span><br></pre></td></tr></table></figure>



<p>ã€€ã€€ã€€ã€€<strong>2ã€å›æ»š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git log		#æŸ¥çœ‹æ‰€æœ‰æäº¤åˆ°ä»“åº“çš„ç‰ˆæœ¬è®°å½•:   git log -2</span><br><span class="line"></span><br><span class="line">git reflog		#æŸ¥çœ‹æ‰€æœ‰æ“ä½œè®°å½•ï¼ˆçŠ¶æ€çš„md5å€¼å’Œæ”¹å˜çš„å€¼ï¼‰</span><br><span class="line"></span><br><span class="line">git reset --hard d9e0ed0		#å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼ˆd9e0ed0æ˜¯åˆ›å»ºç‰ˆæœ¬çš„MD5å€¼å¾—å‰6ä½æˆ–è€…7ä½ï¼‰</span><br><span class="line"></span><br><span class="line">git reset --hard HEAD^		#å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šè¿™æ ·å¯ä»¥å›åˆ°ç¬¬ä¸€æ¬¡æäº¤åˆ°ä»“åº“çš„çŠ¶æ€ï¼Œä½†å†ä½¿ç”¨git logçœ‹ä¸åˆ°å…¶ä»–å‡ æ¬¡çš„md5å€¼äº†</span><br></pre></td></tr></table></figure>

<p>ã€€ã€€ã€€ã€€<strong>3ã€æ’¤é”€ä¿®æ”¹</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim Readme	#æˆ‘ä»¬åœ¨Readmeæ–‡ä»¶ä¸­å†™äº†ä¸€äº›é”™è¯¯çš„ä»£ç </span><br><span class="line"></span><br><span class="line">git add . 	#ç„¶ååˆä¸€ä¸å°å¿ƒå°†æ–‡ä»¶ä»å·¥ä½œåŒºæäº¤åˆ°äº†stageåŒº</span><br><span class="line"></span><br><span class="line">git reset HEAD Readme		#å°†Readmeä¸­åˆšæäº¤åˆ° stageåŒº çš„ä»£ç æ’¤å›åˆ°å·¥ä½œåŒº</span><br><span class="line"></span><br><span class="line">git status		#æŸ¥çœ‹ç›®å‰å·¥ä½œåŒºçŠ¶æ€</span><br><span class="line"></span><br><span class="line">git checkout -- Readme		#å°†Readmeåœ¨å·¥ä½œåŒºé”™è¯¯çš„ä»£ç ä¸¢å¼ƒ</span><br></pre></td></tr></table></figure>

<p>ã€€ã€€ã€€ã€€<strong>4ã€åˆ é™¤æ“ä½œï¼ˆä¸¤ç§æ–¹æ³•ï¼‰</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•1ï¼šè¿™ç§æ–¹æ³•éœ€è¦æ‰§è¡Œgit add .  </span><br><span class="line"></span><br><span class="line">        rm Readme</span><br><span class="line"></span><br><span class="line">        git add .</span><br><span class="line"></span><br><span class="line">        git commit -m &quot;delete file by git rm&quot;</span><br><span class="line"></span><br><span class="line">        git reset --hard HEAD^</span><br><span class="line"></span><br><span class="line">æ–¹æ³•2ï¼šè¿™ç§æ–¹æ³•å¯ä»¥çœå»æ‰§è¡Œgit add .</span><br><span class="line"></span><br><span class="line">        git rm Readme</span><br><span class="line"></span><br><span class="line">        git commit -m &quot;delete file by git rm&quot;</span><br><span class="line"></span><br><span class="line">        git reset --hard HEAD^</span><br><span class="line"></span><br><span class="line">        æ³¨ï¼š åœ¨æ²¡æœ‰git commitå‰ï¼Œä½¿ç”¨ git checkout -- Readme å¯ä»¥æ¢å¤åˆ é™¤çš„æ–‡ä»¶ï¼ˆReadmeï¼‰</span><br></pre></td></tr></table></figure>

<p>ã€€ã€€ã€€ã€€<strong>5ã€å¼ºåˆ¶ä½¿ç”¨masterè¦†ç›–æœ¬åœ°ä»£ç </strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git fetch --all</span><br><span class="line"></span><br><span class="line">$ git reset --hard origin&#x2F;master</span><br><span class="line"></span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºRediså®ç°çš„å•ç‚¹ç™»å½•</title>
    <url>/2019/02/24/%E5%9F%BA%E4%BA%8ERedis%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/</url>
    <content><![CDATA[<h3 id="ä¼ ç»Ÿçš„ç™»å½•æ–¹å¼"><a href="#ä¼ ç»Ÿçš„ç™»å½•æ–¹å¼" class="headerlink" title="ä¼ ç»Ÿçš„ç™»å½•æ–¹å¼"></a>ä¼ ç»Ÿçš„ç™»å½•æ–¹å¼</h3><p><strong><img src="/2019/02/24/%E5%9F%BA%E4%BA%8ERedis%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/20200219132402516.png" class="" title="ä¼ ç»Ÿç™»å½•"></strong> </p>
<a id="more"></a>

<p>å¤§å®¶å¯ä»¥çœ‹åˆ°æœ€åçš„ç”¨æˆ·ä¿¡æ¯ æ˜¯å­˜å‚¨åˆ° session ä¸­çš„ã€‚</p>
<p>ç°åœ¨æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ æœåŠ¡å™¨ä¸­çš„sessionä¸æ˜¯å…±äº«çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®çš„é‡çº§å¾ˆå¤§éœ€è¦åˆ†å¸ƒå¼æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨æˆ·é«˜é¢‘ç‡çš„æ“ä½œç™»å½•åŠŸèƒ½ã€‚è¿™å¯¹äºç”¨æˆ·ä½“éªŒæ¥è¯´æ˜¯æ®‹å¿çš„ï¼Œä¹Ÿæ˜¯è‡´å‘½çš„ã€‚</p>
<p>ä¼ ç»Ÿç™»å½•é—®é¢˜ï¼š</p>
<p>sessioné»˜è®¤æ˜¯å­˜å‚¨åœ¨å½“å‰æœåŠ¡å™¨çš„å†…å­˜ä¸­ï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œé‚£ä¹ˆåªæœ‰ç™»å½•é‚£å°æœºå™¨çš„å†…å­˜ä¸­æ‰æœ‰è¿™ä¸ªsession<br>æ¯”å¦‚è¯´æˆ‘åœ¨Aæœºå™¨ç™»å½•ï¼ŒBæœºå™¨æ˜¯æ²¡æœ‰è¿™ä¸ªsessionå­˜åœ¨çš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°éªŒè¯<br>å¦‚ä½•è§£å†³ï¼š</p>
<p>ä¸ç®¡åœ¨é‚£ä¸€å°webæœåŠ¡å™¨ç™»å½•ï¼Œéƒ½ä¼šæŠŠtokenå€¼å­˜æ”¾åˆ°æˆ‘ä»¬çš„ä¸€ä¸ªé›†ä¸­ç®¡ç†çš„redisæœåŠ¡å™¨ä¸­<br>ä½†å®¢æˆ·ç«¯æºå¸¦tokenéªŒè¯çš„æ—¶å€™ï¼Œä¼šå…ˆä»redisä¸­è·å–ï¼Œå°±å®ç°å•ç‚¹ç™»å½•</p>
<p><strong><img src="/2019/02/24/%E5%9F%BA%E4%BA%8ERedis%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/20200219133905743.png" class="" title="rediså®ç°å•ç‚¹ç™»å½•"></strong> </p>
<p>åŸºäºrediså®ç°çš„å•ç‚¹ç™»å½•è¿™å¥—æ–¹æ¡ˆæ¯”SSO CASæ¥è¯´æ¯”è¾ƒç®€å•ï¼Œå®¹æ˜“ä¸Šæ‰‹ï¼Œä¸»è¦æ˜¯ä¾èµ–æ¯ä¸ªåº”ç”¨çš„æ‹¦æˆªå™¨å’Œrediså®ç°å•ç‚¹ç™»å½•</p>
<p>å•ç‚¹ç™»å½•ï¼š<br>æœ‰ä¸€ä¸ªç‹¬ç«‹çš„è®¤è¯ä¸­å¿ƒï¼Œåªæœ‰è®¤è¯ä¸­å¿ƒæ‰èƒ½æ¥å—ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ç­‰ä¿¡æ¯è¿›è¡Œè®¤è¯ï¼Œå…¶ä»–ç³»ç»Ÿä¸æä¾›ç™»å½•å…¥å£ï¼Œåªæ¥å—è®¤è¯ä¸­å¿ƒçš„é—´æ¥æˆæƒã€‚é—´æ¥æˆæƒé€šè¿‡ä»¤ç‰Œå®ç°ï¼Œå½“ç”¨æˆ·æä¾›çš„ç”¨æˆ·åå’Œå¯†ç é€šè¿‡è®¤è¯ä¸­å¿ƒè®¤è¯åï¼Œè®¤è¯ä¸­å¿ƒä¼šåˆ›å»ºæˆæƒä»¤ç‰Œï¼Œåœ¨æ¥ä¸‹æ¥çš„è·³è½¬è¿‡ç¨‹ä¸­ï¼Œæˆæƒä»¤ç‰Œä½œä¸ºå‚æ•°å‘é€ç»™å„ä¸ªå­ç³»ç»Ÿï¼Œå­ç³»ç»Ÿæ‹¿åˆ°ä»¤ç‰Œå³å¾—åˆ°äº†æˆæƒï¼Œç„¶ååˆ›å»ºå±€éƒ¨ä¼šè¯ã€‚</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºJWTæŠ€æœ¯åŠRSAéå¯¹ç§°åŠ å¯†å®ç°çœŸæ­£æ— çŠ¶æ€çš„å•ç‚¹ç™»å½•</title>
    <url>/2019/02/23/%E5%9F%BA%E4%BA%8EJWT%E6%8A%80%E6%9C%AF%E5%8F%8ARSA%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%AE%9E%E7%8E%B0%E7%9C%9F%E6%AD%A3%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/</url>
    <content><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯JWT"><a href="#ä»€ä¹ˆæ˜¯JWT" class="headerlink" title="ä»€ä¹ˆæ˜¯JWT?"></a>ä»€ä¹ˆæ˜¯JWT?</h2><p>JWT(JSON Web Token) æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘çš„ã€è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºä½œä¸ºJSONå¯¹è±¡åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚è¯¥ä¿¡æ¯å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚ </p>
<a id="more"></a>

<h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><ul>
<li>ä¸€æ¬¡æ€§éªŒè¯ï¼š<br> æ¯”å¦‚ç”¨æˆ·æ³¨å†Œåéœ€è¦å‘ä¸€å°é‚®ä»¶è®©å…¶æ¿€æ´»è´¦æˆ·ï¼Œé€šå¸¸é‚®ä»¶ä¸­éœ€è¦æœ‰ä¸€ä¸ªé“¾æ¥ï¼Œè¿™ä¸ªé“¾æ¥éœ€è¦å…·å¤‡ä»¥ä¸‹çš„ç‰¹æ€§ï¼šèƒ½å¤Ÿæ ‡è¯†ç”¨æˆ·ï¼Œè¯¥é“¾æ¥å…·æœ‰æ—¶æ•ˆæ€§ï¼ˆé€šå¸¸åªå…è®¸å‡ å°æ—¶ä¹‹å†…æ¿€æ´»ï¼‰ï¼Œä¸èƒ½è¢«ç¯¡æ”¹ä»¥æ¿€æ´»å…¶ä»–å¯èƒ½çš„è´¦æˆ·â€¦è¿™ç§åœºæ™¯å°±å’Œ jwt çš„ç‰¹æ€§éå¸¸è´´è¿‘ï¼Œjwt çš„ payload ä¸­å›ºå®šçš„å‚æ•°ï¼šiss ç­¾å‘è€…å’Œ exp è¿‡æœŸæ—¶é—´æ­£æ˜¯ä¸ºå…¶åšå‡†å¤‡çš„ã€‚</li>
<li>restful apiçš„æ— çŠ¶æ€è®¤è¯<br> ä½¿ç”¨ jwt æ¥åš restful api çš„èº«ä»½è®¤è¯ä¹Ÿæ˜¯å€¼å¾—æ¨å´‡çš„ä¸€ç§ä½¿ç”¨æ–¹æ¡ˆã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±äº« secretï¼›è¿‡æœŸæ—¶é—´ç”±æœåŠ¡ç«¯æ ¡éªŒï¼Œå®¢æˆ·ç«¯å®šæ—¶åˆ·æ–°ï¼›ç­¾åä¿¡æ¯ä¸å¯è¢«ä¿®æ”¹ã€‚spring security oauth jwt æä¾›äº†ä¸€å¥—å®Œæ•´çš„ jwt è®¤è¯ä½“ç³»ã€‚</li>
</ul>
<h2 id="JWTç»“æ„"><a href="#JWTç»“æ„" class="headerlink" title="JWTç»“æ„"></a>JWTç»“æ„</h2><p> JWTç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬ä¹‹é—´ç”¨åœ†ç‚¹(.)è¿æ¥ã€‚è¿™ä¸‰éƒ¨åˆ†åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><p>Header</p>
</li>
<li><p>Payload</p>
</li>
<li><p>Signature</p>
<p>å…·ä½“ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span><br></pre></td></tr></table></figure>

<h3 id="1ã€Header"><a href="#1ã€Header" class="headerlink" title="1ã€Header"></a>1ã€Header</h3><p>jwtçš„å¤´éƒ¨ç”±ä¸¤éƒ¨åˆ†ä¿¡æ¯ç»„æˆï¼š</p>
<ul>
<li>typeï¼šå£°æ˜ç±»å‹ï¼Œè¿™é‡Œæ˜¯jwt</li>
<li>algï¼šå£°æ˜åŠ å¯†çš„ç®—æ³• é€šå¸¸ç›´æ¥ä½¿ç”¨ HMAC SHA256</li>
</ul>
<p>å®Œæ•´çš„å¤´éƒ¨ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"type"</span>:<span class="string">"jwt"</span>,</span><br><span class="line">  <span class="string">"alg"</span>:<span class="string">"HS256"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹å¤´éƒ¨ä¿¡æ¯è¿›è¡ŒBase64ç¼–ç çš„å¾—åˆ°ç¬¬ä¸€éƒ¨åˆ†çš„ä¿¡æ¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><br></pre></td></tr></table></figure>



<h3 id="2ã€Payload"><a href="#2ã€Payload" class="headerlink" title="2ã€Payload"></a>2ã€Payload</h3><p>è½½è·å°±æ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹,å®ƒåŒ…å«å£°æ˜ï¼ˆè¦æ±‚ï¼‰ã€‚å£°æ˜æœ‰ä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li>registered claimsï¼šæ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ã€‚è¿™é‡Œæœ‰ä¸€ç»„é¢„å®šä¹‰çš„å£°æ˜ï¼Œå®ƒä»¬ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½†æ˜¯æ¨è</li>
<li>public claimsï¼šå…¬å…±çš„å£°æ˜</li>
<li>private claimsï¼šç§æœ‰çš„å£°æ˜</li>
</ul>
<p><strong>æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ (å»ºè®®ä½†ä¸å¼ºåˆ¶ä½¿ç”¨) ï¼š</strong></p>
<ul>
<li>iss: jwtç­¾å‘è€…</li>
<li>sub: jwtæ‰€é¢å‘çš„ç”¨æˆ·</li>
<li>aud: æ¥æ”¶jwtçš„ä¸€æ–¹</li>
<li>exp: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´</li>
<li>nbf: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„</li>
<li>iat: jwtçš„ç­¾å‘æ—¶é—´</li>
<li>jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»</li>
</ul>
<p><strong>å…¬å…±çš„å£°æ˜ ï¼š</strong></p>
<p>å…¬å…±çš„å£°æ˜å¯ä»¥æ·»åŠ ä»»ä½•çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ·»åŠ ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯.ä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†.</p>
<p><strong>ç§æœ‰çš„å£°æ˜ ï¼š</strong></p>
<p>ç§æœ‰å£°æ˜æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…æ‰€å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œä¸€èˆ¬ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºbase64æ˜¯å¯¹ç§°è§£å¯†çš„ï¼Œæ„å‘³ç€è¯¥éƒ¨åˆ†ä¿¡æ¯å¯ä»¥å½’ç±»ä¸ºæ˜æ–‡ä¿¡æ¯ã€‚</p>
<p>å¯¹Payloadè¿›è¡ŒBase64åŠ å¯†å°±å¾—åˆ°äº†JWTç¬¬äºŒéƒ¨åˆ†çš„å†…å®¹ã€‚</p>
<h3 id="3ã€signature"><a href="#3ã€signature" class="headerlink" title="3ã€signature"></a>3ã€signature</h3><p>JWTçš„ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­¾è¯ä¿¡æ¯ï¼Œè¿™ä¸ªç­¾è¯ä¿¡æ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>header (base64åçš„)</li>
<li>payload (base64åçš„)</li>
<li>secret</li>
</ul>
<p>ç¬¬ä¸‰éƒ¨åˆ†éœ€è¦base64åŠ å¯†åçš„headerå’Œbase64åŠ å¯†åçš„payloadä½¿ç”¨ <code>.</code> è¿æ¥ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡headerä¸­å£°æ˜çš„åŠ å¯†æ–¹å¼è¿›è¡ŒåŠ ç›secretç»„åˆåŠ å¯†ï¼Œç„¶åå°±æ„æˆäº†JWTçš„ç¬¬ä¸‰éƒ¨åˆ†ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong><br> secretæ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯çš„ï¼ŒJWTçš„ç­¾å‘ç”Ÿæˆä¹Ÿæ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œsecretå°±æ˜¯ç”¨æ¥è¿›è¡ŒJWTçš„ç­¾å‘å’ŒJWTçš„éªŒè¯ï¼Œæ‰€ä»¥ï¼Œå®ƒå°±æ˜¯ä½ æœåŠ¡ç«¯çš„ç§é’¥ï¼Œåœ¨ä»»ä½•åœºæ™¯éƒ½ä¸åº”è¯¥æµéœ²å‡ºå»ã€‚ä¸€æ—¦å®¢æˆ·ç«¯å¾—çŸ¥è¿™ä¸ªsecret, é‚£å°±æ„å‘³ç€å®¢æˆ·ç«¯æ˜¯å¯ä»¥è‡ªæˆ‘ç­¾å‘JWTäº†ã€‚</p>
<h2 id="JWTã€OAuth2ã€Sessionå¯¹æ¯”"><a href="#JWTã€OAuth2ã€Sessionå¯¹æ¯”" class="headerlink" title="JWTã€OAuth2ã€Sessionå¯¹æ¯”"></a>JWTã€OAuth2ã€Sessionå¯¹æ¯”</h2><h3 id="1ã€ä¼ ç»Ÿçš„sessionè®¤è¯"><a href="#1ã€ä¼ ç»Ÿçš„sessionè®¤è¯" class="headerlink" title="1ã€ä¼ ç»Ÿçš„sessionè®¤è¯"></a>1ã€ä¼ ç»Ÿçš„sessionè®¤è¯</h3><p>httpåè®®æœ¬èº«æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼Œè€Œè¿™å°±æ„å‘³ç€å¦‚æœç”¨æˆ·å‘æˆ‘ä»¬çš„åº”ç”¨æä¾›äº†ç”¨æˆ·åå’Œå¯†ç æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œç”¨æˆ·è¿˜è¦å†ä¸€æ¬¡è¿›è¡Œç”¨æˆ·è®¤è¯æ‰è¡Œï¼Œå› ä¸ºæ ¹æ®httpåè®®ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œæ‰€ä»¥ä¸ºäº†è®©æˆ‘ä»¬çš„åº”ç”¨èƒ½è¯†åˆ«æ˜¯å“ªä¸ªç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªèƒ½åœ¨æœåŠ¡å™¨å­˜å‚¨ä¸€ä»½ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯ï¼Œè¿™ä»½ç™»å½•ä¿¡æ¯ä¼šåœ¨å“åº”æ—¶ä¼ é€’ç»™æµè§ˆå™¨ï¼Œå‘Šè¯‰å…¶ä¿å­˜ä¸ºcookie,ä»¥ä¾¿ä¸‹æ¬¡è¯·æ±‚æ—¶å‘é€ç»™æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨å°±èƒ½è¯†åˆ«è¯·æ±‚æ¥è‡ªå“ªä¸ªç”¨æˆ·äº†,è¿™å°±æ˜¯ä¼ ç»Ÿçš„åŸºäºsessionè®¤è¯ã€‚</p>
<p>ä½†æ˜¯è¿™ç§åŸºäºsessionçš„è®¤è¯ä½¿åº”ç”¨æœ¬èº«å¾ˆéš¾å¾—åˆ°æ‰©å±•ï¼Œéšç€ä¸åŒå®¢æˆ·ç«¯ç”¨æˆ·çš„å¢åŠ ï¼Œç‹¬ç«‹çš„æœåŠ¡å™¨å·²æ— æ³•æ‰¿è½½æ›´å¤šçš„ç”¨æˆ·ï¼Œè€Œè¿™æ—¶å€™åŸºäºsessionè®¤è¯åº”ç”¨çš„é—®é¢˜å°±ä¼šæš´éœ²å‡ºæ¥ï¼š</p>
<ul>
<li>Session: æ¯ä¸ªç”¨æˆ·ç»è¿‡æˆ‘ä»¬çš„åº”ç”¨è®¤è¯ä¹‹åï¼Œæˆ‘ä»¬çš„åº”ç”¨éƒ½è¦åœ¨æœåŠ¡ç«¯åšä¸€æ¬¡è®°å½•ï¼Œä»¥æ–¹ä¾¿ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚çš„é‰´åˆ«ï¼Œé€šå¸¸è€Œè¨€sessionéƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œéšç€è®¤è¯ç”¨æˆ·çš„å¢å¤šï¼ŒæœåŠ¡ç«¯çš„å¼€é”€ä¼šæ˜æ˜¾å¢å¤§</li>
<li>æ‰©å±•æ€§: ç”¨æˆ·è®¤è¯ä¹‹åï¼ŒæœåŠ¡ç«¯åšè®¤è¯è®°å½•ï¼Œå¦‚æœè®¤è¯çš„è®°å½•è¢«ä¿å­˜åœ¨å†…å­˜ä¸­çš„è¯ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚è¿˜å¿…é¡»è¦è¯·æ±‚åœ¨è¿™å°æœåŠ¡å™¨ä¸Š,è¿™æ ·æ‰èƒ½æ‹¿åˆ°æˆæƒçš„èµ„æºï¼Œè¿™æ ·åœ¨åˆ†å¸ƒå¼çš„åº”ç”¨ä¸Šï¼Œç›¸åº”çš„é™åˆ¶äº†è´Ÿè½½å‡è¡¡å™¨çš„èƒ½åŠ›ã€‚è¿™ä¹Ÿæ„å‘³ç€é™åˆ¶äº†åº”ç”¨çš„æ‰©å±•èƒ½åŠ›</li>
<li>CSRF: å› ä¸ºæ˜¯åŸºäºcookieæ¥è¿›è¡Œç”¨æˆ·è¯†åˆ«çš„, cookieå¦‚æœè¢«æˆªè·ï¼Œç”¨æˆ·å°±ä¼šå¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»</li>
</ul>
<h3 id="2ã€åŸºäºtokençš„é‰´æƒæœºåˆ¶"><a href="#2ã€åŸºäºtokençš„é‰´æƒæœºåˆ¶" class="headerlink" title="2ã€åŸºäºtokençš„é‰´æƒæœºåˆ¶"></a>2ã€åŸºäºtokençš„é‰´æƒæœºåˆ¶</h3><p>JWTå’ŒOAuth2éƒ½æ˜¯åŸºäºtokençš„é‰´æƒæœºåˆ¶ã€‚åŸºäºtokençš„é‰´æƒæœºåˆ¶ç±»ä¼¼äºhttpåè®®ä¹Ÿæ˜¯æ— çŠ¶æ€çš„ï¼Œå®ƒä¸éœ€è¦åœ¨æœåŠ¡ç«¯å»ä¿ç•™ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯æˆ–è€…ä¼šè¯ä¿¡æ¯ã€‚è¿™å°±æ„å‘³ç€åŸºäºtokenè®¤è¯æœºåˆ¶çš„åº”ç”¨ä¸éœ€è¦å»è€ƒè™‘ç”¨æˆ·åœ¨å“ªä¸€å°æœåŠ¡å™¨ç™»å½•äº†ï¼Œè¿™å°±ä¸ºåº”ç”¨çš„æ‰©å±•æä¾›äº†ä¾¿åˆ©ã€‚</p>
<p>å…¶åŸºæœ¬çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”¨æˆ·ä½¿ç”¨ç”¨æˆ·åå¯†ç æ¥è¯·æ±‚æœåŠ¡å™¨</li>
<li>æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ç”¨æˆ·çš„ä¿¡æ¯</li>
<li>æœåŠ¡å™¨é€šè¿‡éªŒè¯å‘é€ç»™ç”¨æˆ·ä¸€ä¸ªtoken</li>
<li>å®¢æˆ·ç«¯å­˜å‚¨tokenï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶é™„é€ä¸Šè¿™ä¸ªtokenå€¼</li>
<li>æœåŠ¡ç«¯éªŒè¯tokenå€¼ï¼Œå¹¶è¿”å›æ•°æ®</li>
</ol>
<p>è¿™ä¸ªtokenå¿…é¡»è¦åœ¨æ¯æ¬¡è¯·æ±‚æ—¶ä¼ é€’ç»™æœåŠ¡ç«¯ï¼Œå®ƒåº”è¯¥ä¿å­˜åœ¨è¯·æ±‚å¤´é‡Œï¼Œ å¦å¤–ï¼ŒæœåŠ¡ç«¯è¦æ”¯æŒCORS(è·¨æ¥æºèµ„æºå…±äº«)ç­–ç•¥ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨æœåŠ¡ç«¯è¿™ä¹ˆåšå°±å¯ä»¥äº†<code>Access-Control-Allow-Origin: *</code>ã€‚</p>
<h3 id="3ã€JWT-è®¤è¯åè®®ä¸-OAuth2-0-æˆæƒæ¡†æ¶ä¸æ°å½“æ¯”è¾ƒ"><a href="#3ã€JWT-è®¤è¯åè®®ä¸-OAuth2-0-æˆæƒæ¡†æ¶ä¸æ°å½“æ¯”è¾ƒ" class="headerlink" title="3ã€JWT è®¤è¯åè®®ä¸ OAuth2.0 æˆæƒæ¡†æ¶ä¸æ°å½“æ¯”è¾ƒ"></a>3ã€JWT è®¤è¯åè®®ä¸ OAuth2.0 æˆæƒæ¡†æ¶ä¸æ°å½“æ¯”è¾ƒ</h3><p>ä¹‹æ‰€ä»¥è¯´æ˜¯ä¸æ°å½“ï¼Œæ˜¯å› ä¸ºJWTå’ŒOAuth2æ˜¯å®Œå…¨ä¸é€šè¿‡çš„æ¦‚å¿µã€‚æ—¢ç„¶ JWT å’Œ OAuth2 æ²¡æœ‰å¯æ¯”æ€§ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æŠŠè¿™ä¸¤ä¸ªæ”¾åœ¨ä¸€èµ·è¯´å‘¢ï¼Ÿå¾ˆå¤šæƒ…å†µä¸‹ï¼Œåœ¨è®¨è®ºOAuth2çš„å®ç°æ—¶ï¼Œä¼šæŠŠJSON Web Tokenä½œä¸ºä¸€ç§è®¤è¯æœºåˆ¶ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»–ä»¬ä¼šç»å¸¸ä¸€èµ·å‡ºç°ã€‚</p>
<ol>
<li>JWT æ˜¯ä¸€ç§è®¤è¯åè®®<br> JWTæä¾›äº†ä¸€ç§ç”¨äºå‘å¸ƒæ¥å…¥ä»¤ç‰Œï¼ˆAccess Token),å¹¶å¯¹å‘å¸ƒçš„ç­¾åæ¥å…¥ä»¤ç‰Œè¿›è¡ŒéªŒè¯çš„æ–¹æ³•ã€‚ ä»¤ç‰Œï¼ˆTokenï¼‰æœ¬èº«åŒ…å«äº†ä¸€ç³»åˆ—å£°æ˜ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®è¿™äº›å£°æ˜é™åˆ¶ç”¨æˆ·å¯¹èµ„æºçš„è®¿é—®ã€‚</li>
<li>OAuth2 æ˜¯ä¸€ç§æˆæƒæ¡†æ¶<br> OAuth2æ˜¯ä¸€ç§æˆæƒæ¡†æ¶ï¼Œæä¾›äº†ä¸€å¥—è¯¦ç»†çš„æˆæƒæœºåˆ¶ã€‚ç”¨æˆ·æˆ–åº”ç”¨å¯ä»¥é€šè¿‡å…¬å¼€çš„æˆ–ç§æœ‰çš„è®¾ç½®ï¼Œæˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®ç‰¹å®šèµ„æºã€‚</li>
<li>JWT ä½¿ç”¨åœºæ™¯<br> JWT çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºä½¿ç”¨æ— çŠ¶æ€ã€å¯æ‰©å±•çš„æ–¹å¼å¤„ç†åº”ç”¨ä¸­çš„ç”¨æˆ·ä¼šè¯ã€‚æœåŠ¡ç«¯å¯ä»¥é€šè¿‡å†…åµŒçš„å£°æ˜ä¿¡æ¯ï¼Œå¾ˆå®¹æ˜“åœ°è·å–ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å»è®¿é—®ç”¨æˆ·æˆ–ä¼šè¯çš„æ•°æ®åº“ã€‚åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼çš„é¢å‘æœåŠ¡çš„æ¡†æ¶ä¸­ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœç³»ç»Ÿä¸­éœ€è¦ä½¿ç”¨é»‘åå•å®ç°é•¿æœŸæœ‰æ•ˆçš„ Token åˆ·æ–°æœºåˆ¶ï¼Œè¿™ç§æ— çŠ¶æ€çš„ä¼˜åŠ¿å°±ä¸æ˜æ˜¾äº†ã€‚</li>
</ol>
<ul>
<li>ä¼˜åŠ¿<ul>
<li>å¿«é€Ÿå¼€å‘</li>
<li>ä¸éœ€è¦ Cookie</li>
<li>JSON åœ¨ç§»åŠ¨ç«¯çš„å¹¿æ³›åº”ç”¨</li>
<li>ä¸ä¾èµ–äºç¤¾äº¤ç™»å½•</li>
<li>ç›¸å¯¹ç®€å•çš„æ¦‚å¿µç†è§£</li>
</ul>
</li>
<li>é™åˆ¶<ul>
<li>Tokenæœ‰é•¿åº¦é™åˆ¶</li>
<li>Tokenä¸èƒ½æ’¤é”€</li>
<li>éœ€è¦ Token æœ‰å¤±æ•ˆæ—¶é—´é™åˆ¶ï¼ˆexpï¼‰</li>
</ul>
</li>
</ul>
<ol>
<li>OAuth2 ä½¿ç”¨åœºæ™¯<br> å¦‚æœä¸ä»‹æ„APIçš„ä½¿ç”¨ä¾èµ–äºå¤–éƒ¨çš„ç¬¬ä¸‰æ–¹è®¤è¯æä¾›è€…ï¼Œä½ å¯ä»¥ç®€å•åœ°æŠŠè®¤è¯å·¥ä½œç•™ç»™è®¤è¯æœåŠ¡å•†å»åšã€‚ä¹Ÿå°±æ˜¯å¸¸è§çš„ï¼Œå»è®¤è¯æœåŠ¡å•†ï¼ˆæ¯”å¦‚ Facebookï¼‰é‚£é‡Œæ³¨å†Œä½ çš„åº”ç”¨ï¼Œç„¶åè®¾ç½®éœ€è¦è®¿é—®çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚ç”µå­é‚®ç®±ã€å§“åç­‰ã€‚å½“ç”¨æˆ·è®¿é—®ç«™ç‚¹çš„æ³¨å†Œé¡µé¢æ—¶ï¼Œä¼šçœ‹åˆ°è¿æ¥åˆ°ç¬¬ä¸‰æ–¹æä¾›å•†çš„å…¥å£ã€‚ç”¨æˆ·ç‚¹å‡»ä»¥åè¢«é‡å®šå‘åˆ°å¯¹åº”çš„è®¤è¯æœåŠ¡å•†ç½‘ç«™ï¼Œè·å¾—ç”¨æˆ·çš„æˆæƒåå°±å¯ä»¥è®¿é—®åˆ°éœ€è¦çš„ä¿¡æ¯ï¼Œç„¶åé‡å®šå‘å›æ¥ã€‚</li>
</ol>
<ul>
<li>ä¼˜åŠ¿<ul>
<li>å¿«é€Ÿå¼€å‘</li>
<li>å®æ–½ä»£ç é‡å°</li>
<li>ç»´æŠ¤å·¥ä½œå‡å°‘</li>
<li>å¯ä»¥å’Œ JWT åŒæ—¶ä½¿ç”¨</li>
<li>å¯é’ˆå¯¹ä¸åŒåº”ç”¨æ‰©å±•</li>
</ul>
</li>
<li>é™åˆ¶<ul>
<li>æ¡†æ¶æ²‰é‡</li>
</ul>
</li>
</ul>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p> åœ¨webæ¡†æ¶Djangoä¸­çš„å…·ä½“åº”ç”¨:</p>
<p> å®‰è£…pyjwt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install pyjwt</span><br></pre></td></tr></table></figure>



<p> ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç”Ÿæˆä¸€ä¸ªtoken</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">encoded_jwt = jwt.encode(&#123;<span class="string">'username'</span>:<span class="string">'admin'</span>,<span class="string">'site'</span>:<span class="string">'https://v3u.cn'</span>&#125;,<span class="string">'secret_key'</span>,algorithm=<span class="string">'HS256'</span>)</span><br></pre></td></tr></table></figure>



<p> å°†è¿™ä¸ªtokenäº¤ç»™å‰ç«¯ï¼Œä»¥åå‰ç«¯è®¿é—®ä»»æ„æ¥å£éƒ½å°†åœ¨headeré‡Œå¸¦ç€è¿™ä¸ªä»¤ç‰Œ(token)ï¼Œç”¨æ¥åšè®¤è¯ï¼Œç„¶åæˆ‘ä»¬è‚¯å®šä¸èƒ½æ¯ä¸€ä¸ªè§†å›¾æ–¹æ³•éƒ½åšéªŒè¯ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è£…é¥°å™¨åšä¸€ä¸ªç»Ÿä¸€ç”¨æˆ·è®¤è¯æ¨¡å— </p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰éªŒè¯è£…é¥°å™¨</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth_required</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(view_func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">_wrapped_view</span><span class="params">(self,request, *args, **kwargs)</span>:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                auth = request.META.get(<span class="string">'HTTP_AUTHORIZATION'</span>).split()</span><br><span class="line">            <span class="keyword">except</span> AttributeError:</span><br><span class="line">                <span class="keyword">return</span> HttpResponse(<span class="string">'æ²¡æƒé™'</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                dict = jwt.decode(auth[<span class="number">1</span>], settings.SECRET_KEY, algorithms=[<span class="string">'HS256'</span>])</span><br><span class="line">                username = dict.get(<span class="string">'data'</span>).get(<span class="string">'username'</span>)</span><br><span class="line">            <span class="keyword">except</span> jwt.ExpiredSignatureError:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"status_code"</span>: <span class="number">401</span>, <span class="string">"message"</span>: <span class="string">"Token expired"</span>&#125;)</span><br><span class="line">            <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"status_code"</span>: <span class="number">401</span>, <span class="string">"message"</span>: <span class="string">"Invalid token"</span>&#125;)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"status_code"</span>: <span class="number">401</span>, <span class="string">"message"</span>: <span class="string">"Can not get user object"</span>&#125;)</span><br><span class="line">            <span class="keyword">return</span> view_func(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _wrapped_view</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„jwtç”¨æˆ·è®¤è¯æ–¹æ³•å°±å†™å¥½äº† </p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>websocket</title>
    <url>/2019/02/22/websocket/</url>
    <content><![CDATA[<h3 id="websocketæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#websocketæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="websocketæ˜¯ä»€ä¹ˆï¼Ÿ"></a>websocketæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>webSocketæ˜¯ä¸€ç§åœ¨å•ä¸ªTCPè¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡çš„åè®® </p>
<p>webSocketä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢å˜å¾—æ›´åŠ ç®€å•ï¼Œå…è®¸æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ã€‚åœ¨WebSocket APIä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ </p>
<a id="more"></a>

<h3 id="websocketä¸httpçš„åŒºåˆ«"><a href="#websocketä¸httpçš„åŒºåˆ«" class="headerlink" title="websocketä¸httpçš„åŒºåˆ«"></a>websocketä¸httpçš„åŒºåˆ«</h3><ul>
<li>httpè¯·æ±‚å»ºç«‹è¿æ¥åªèƒ½å‘é€ä¸€æ¬¡è¯·æ±‚,ä¸èƒ½æœ‰æœåŠ¡å™¨ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€è¯·æ±‚</li>
<li>websocketå»ºç«‹çš„é•¿è¿æ¥ï¼Œä¸€æ¬¡è¿æ¥ï¼Œåç»­ä¸€ç›´é€šä¿¡ï¼Œè¿™æ ·èŠ‚çœèµ„æºï¼Œå¯ä»¥æœ‰å®¢æˆ·ç«¯å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ç«¯</li>
</ul>
<h3 id="è¿œå¤æ—¶æœŸçš„è§£å†³æ–¹æ¡ˆ"><a href="#è¿œå¤æ—¶æœŸçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è¿œå¤æ—¶æœŸçš„è§£å†³æ–¹æ¡ˆ"></a>è¿œå¤æ—¶æœŸçš„è§£å†³æ–¹æ¡ˆ</h3><p>ç°åœ¨ï¼Œå¾ˆå¤šç½‘ç«™ä¸ºäº†å®ç°æ¨é€æŠ€æœ¯ï¼Œæ‰€ç”¨çš„æŠ€æœ¯éƒ½æ˜¯è½®è¯¢ã€‚è½®è¯¢æ˜¯åœ¨ç‰¹å®šçš„çš„æ—¶é—´é—´éš”ï¼ˆå¦‚æ¯1ç§’ï¼‰ï¼Œç”±æµè§ˆå™¨å¯¹æœåŠ¡å™¨å‘å‡ºHTTPè¯·æ±‚ï¼Œç„¶åç”±æœåŠ¡å™¨è¿”å›æœ€æ–°çš„æ•°æ®ç»™å®¢æˆ·ç«¯çš„æµè§ˆå™¨ã€‚è¿™ç§ä¼ ç»Ÿçš„æ¨¡å¼å¸¦æ¥å¾ˆæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå³æµè§ˆå™¨éœ€è¦ä¸æ–­çš„å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œç„¶è€ŒHTTPè¯·æ±‚å¯èƒ½åŒ…å«è¾ƒé•¿çš„å¤´éƒ¨ï¼Œå…¶ä¸­çœŸæ­£æœ‰æ•ˆçš„æ•°æ®å¯èƒ½åªæ˜¯å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¾ç„¶è¿™æ ·ä¼šæµªè´¹å¾ˆå¤šçš„å¸¦å®½ç­‰èµ„æºã€‚<br>è€Œæ¯”è¾ƒæ–°çš„æŠ€æœ¯å»åšè½®è¯¢çš„æ•ˆæœæ˜¯Cometã€‚è¿™ç§æŠ€æœ¯è™½ç„¶å¯ä»¥åŒå‘é€šä¿¡ï¼Œä½†ä¾ç„¶éœ€è¦åå¤å‘å‡ºè¯·æ±‚ã€‚è€Œä¸”åœ¨Cometä¸­ï¼Œæ™®éé‡‡ç”¨çš„é•¿é“¾æ¥ï¼Œä¹Ÿä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHTML5å®šä¹‰äº†WebSocketåè®®ï¼Œèƒ½æ›´å¥½çš„èŠ‚çœæœåŠ¡å™¨èµ„æºå’Œå¸¦å®½ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ›´å®æ—¶åœ°è¿›è¡Œé€šè®¯</p>
<p>è½®è¯¢æ˜¯å‡ ä¸ªæ„æ€ï¼Ÿ</p>
<p>è½®è¯¢æ˜¯æœ€åŸå§‹çš„å®ç°å®æ—¶Webåº”ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚è½®è¯¢æŠ€æœ¯è¦æ±‚å®¢æˆ·ç«¯ä»¥è®¾å®šçš„æ—¶é—´é—´éš”å‘¨æœŸæ€§åœ°å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œé¢‘ç¹åœ°æŸ¥è¯¢æ˜¯å¦æœ‰æ–°çš„æ•°æ®æ”¹åŠ¨ã€‚æ˜æ˜¾åœ°ï¼Œè¿™ç§æ–¹æ³•ä¼šå¯¼è‡´è¿‡å¤šä¸å¿…è¦çš„è¯·æ±‚ï¼Œæµªè´¹æµé‡å’ŒæœåŠ¡å™¨èµ„æºã€‚æ€»ä¹‹å°±æ˜¯ä¸€ç§lowåˆ°çˆ†ç‚¸çš„åŸå§‹ä½œåŠæ°´å¹³çš„æŠ€æœ¯ã€‚</p>
<h3 id="websocketçš„åº”ç”¨åœºæ™¯"><a href="#websocketçš„åº”ç”¨åœºæ™¯" class="headerlink" title="websocketçš„åº”ç”¨åœºæ™¯"></a>websocketçš„åº”ç”¨åœºæ™¯</h3><ul>
<li><strong>èŠå¤©è½¯ä»¶ï¼š</strong>æœ€è‘—åçš„å°±æ˜¯å¾®ä¿¡ï¼ŒQQï¼Œè¿™ä¸€ç±»ç¤¾äº¤èŠå¤©çš„app</li>
<li><strong>å¼¹å¹•ï¼š</strong>å„ç§ç›´æ’­çš„å¼¹å¹•çª—å£</li>
<li><strong>åœ¨çº¿æ•™è‚²ï¼š</strong>å¯ä»¥è§†é¢‘èŠå¤©ã€å³æ—¶èŠå¤©ä»¥åŠå…¶ä¸åˆ«äººåˆä½œä¸€èµ·åœ¨ç½‘ä¸Šè®¨è®ºé—®é¢˜â€¦</li>
</ul>
<h3 id="websocketçš„åŸç†"><a href="#websocketçš„åŸç†" class="headerlink" title="websocketçš„åŸç†"></a>websocketçš„åŸç†</h3><ul>
<li>websocketé¦–å…ˆå€ŸåŠ©httpåè®®ï¼ˆé€šè¿‡åœ¨httpå¤´éƒ¨è®¾ç½®å±æ€§ï¼Œè¯·æ±‚å’ŒæœåŠ¡å™¨è¿›è¡Œåè®®å‡çº§ï¼Œå‡çº§åè®®ä¸ºwebsocketçš„åº”ç”¨å±‚åè®®ï¼‰</li>
<li>å»ºç«‹å¥½å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®æµï¼Œæ•°æ®æµä¹‹é—´åº•å±‚è¿˜æ˜¯ä¾é TCPåè®®ï¼›</li>
<li>websocketä¼šæ¥ç€ä½¿ç”¨è¿™æ¡å»ºç«‹å¥½çš„æ•°æ®æµå’ŒæœåŠ¡å™¨ä¹‹é—´ä¿æŒé€šä¿¡ï¼›</li>
<li>ç”±äºå¤æ‚çš„ç½‘ç»œç¯å¢ƒï¼Œæ•°æ®æµå¯èƒ½ä¼šæ–­å¼€ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åœ¨onFailureæˆ–è€…onClosingå›è°ƒæ–¹æ³•ä¸­ï¼Œå®ç°é‡è¿</li>
</ul>
<h3 id="websocketçš„å¿ƒè·³åŒ…"><a href="#websocketçš„å¿ƒè·³åŒ…" class="headerlink" title="websocketçš„å¿ƒè·³åŒ…"></a>websocketçš„å¿ƒè·³åŒ…</h3><h3 id="websocketçš„å®ç°"><a href="#websocketçš„å®ç°" class="headerlink" title="websocketçš„å®ç°"></a>websocketçš„å®ç°</h3><p>æœ¬æ–‡é€šè¿‡åŸºäºdwebsocketåº“æ¥å°†socketåµŒå…¥åˆ°djangoæœåŠ¡ä¸­ï¼Œä½¿å…¶æœåŠ¡å…¼å…·httpåè®®å’Œsocketåè®®ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶å‰åç«¯é€šä¿¡ï¼Œåç«¯ä¸»åŠ¨æ¨é€ç­‰åŠŸèƒ½</p>
<p>å®‰è£…dwebsocketåº“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple dwebsocket</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰è§†å›¾æ–‡ä»¶çš„é€»è¾‘views.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¯¼å…¥websocketè£…é¥°å™¨</span></span><br><span class="line"><span class="keyword">from</span> dwebsocket.decorators <span class="keyword">import</span> accept_websocket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¥æ”¶å‰ç«¯ä¿¡æ¯</span></span><br><span class="line"><span class="meta">@accept_websocket</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_socket</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.is_websocket():</span><br><span class="line">        <span class="keyword">for</span> message <span class="keyword">in</span> request.websocket:</span><br><span class="line">            c=str(message,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">            print(c)</span><br><span class="line">            request.websocket.send(message)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸»åŠ¨æ¨é€æ¶ˆæ¯</span></span><br><span class="line"><span class="meta">@accept_websocket</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_websocket</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.is_websocket():</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            time.sleep(<span class="number">1</span>) <span class="comment">## å‘å‰ç«¯å‘é€æ—¶é—´</span></span><br><span class="line">            dit = &#123;</span><br><span class="line">                <span class="string">'time'</span>:time.strftime(<span class="string">'%Y.%m.%d %H:%M:%S'</span>,time.localtime(time.time()))</span><br><span class="line">            &#125;</span><br><span class="line">            request.websocket.send(json.dumps(dit))</span><br></pre></td></tr></table></figure>

<p>è·¯ç”±é…ç½®urls.py</p>
<figure class="highlight django"><table><tr><td class="code"><pre><span class="line"><span class="xml">#websocket</span></span><br><span class="line"><span class="xml">path('socket_test',TemplateView.as_view(template_name='md_admin/socket.html')),</span></span><br><span class="line"><span class="xml">path('websocket_test',TemplateView.as_view(template_name='md_admin/socket_push.html')),</span></span><br><span class="line"><span class="xml">path('test_socket',test_socket),</span></span><br><span class="line"><span class="xml">path('test_websocket',test_websocket),</span></span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å‰ç«¯å‘é€æ¶ˆæ¯çš„é¡µé¢ socket.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Chat Room<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"chat-message-input"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"100"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"chat-message-submit"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Send"</span> <span class="attr">onclick</span>=<span class="string">'sendmessage()'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="actionscript">   <span class="comment">//ç”Ÿæˆsocketå¯¹è±¡</span></span></span><br><span class="line"><span class="javascript">   <span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">"ws:"</span> + <span class="built_in">window</span>.location.host + <span class="string">"/md_admin/test_socket"</span>);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            socket.onopen = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'WebSocket open'</span>);<span class="comment">//æˆåŠŸè¿æ¥ä¸ŠWebsocket</span></span></span><br><span class="line">            &#125;;</span><br><span class="line"><span class="actionscript">            socket.onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'message: '</span> + e.data);<span class="comment">//æ‰“å°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®</span></span></span><br><span class="line">            &#125;;</span><br><span class="line"><span class="actionscript">            socket.onclose=<span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="actionscript">              socket.close(); <span class="comment">//å…³é—­TCPè¿æ¥</span></span></span><br><span class="line">            &#125;;</span><br><span class="line">            if (socket.readyState == WebSocket.OPEN)&#123;</span><br><span class="line">            socket.onopen();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.s = socket;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">sendmessage</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.s.send(<span class="built_in">document</span>.getElementById(<span class="string">"chat-message-input"</span>).value);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>ç„¶åå†å®šä¹‰ä¸€ä¸ªé¡µé¢ï¼Œæµ‹è¯•åå°çš„ä¸»åŠ¨æ¨é€socket_push.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Chat Room<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="actionscript">   <span class="comment">//ç”Ÿæˆsocketå¯¹è±¡</span></span></span><br><span class="line"><span class="javascript">   <span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">"ws:"</span> + <span class="built_in">window</span>.location.host + <span class="string">"/md_admin/test_websocket"</span>);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            socket.onopen = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'WebSocket open'</span>);<span class="comment">//æˆåŠŸè¿æ¥ä¸ŠWebsocket</span></span></span><br><span class="line">            &#125;;</span><br><span class="line"><span class="actionscript">            socket.onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'message: '</span> + e.data);<span class="comment">//æ‰“å°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®</span></span></span><br><span class="line">            &#125;;</span><br><span class="line"><span class="actionscript">            socket.onclose=<span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="actionscript">              socket.close(); <span class="comment">//å…³é—­TCPè¿æ¥</span></span></span><br><span class="line">            &#125;;</span><br><span class="line">            if (socket.readyState == WebSocket.OPEN)&#123;</span><br><span class="line">            socket.onopen();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå‰åç«¯æ— è®ºæ˜¯å‰ç«¯å‘é€æ¶ˆæ¯ï¼Œè¿˜æ˜¯åç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯ï¼Œå…¨éƒ¨åŸºäºwebsocketï¼Œå®ç°äº†çœŸæ­£æ„ä¹‰ä¸Šçš„å®æ—¶é€šä¿¡</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨vueé¡¹ç›®ä¸­ä½¿ç”¨md5åŠ å¯†çš„æ–¹æ³•</title>
    <url>/2019/02/06/%E5%9C%A8vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8md5%E5%8A%A0%E5%AF%86%E7%9A%84%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h4 id="npmå®‰è£…ï¼š"><a href="#npmå®‰è£…ï¼š" class="headerlink" title="npmå®‰è£…ï¼š"></a>npmå®‰è£…ï¼š</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">npm install --save js-md5</span><br></pre></td></tr></table></figure>

<h4 id="1-åœ¨éœ€è¦ä½¿ç”¨çš„é¡¹ç›®æ–‡ä»¶ä¸­å¼•å…¥ï¼š"><a href="#1-åœ¨éœ€è¦ä½¿ç”¨çš„é¡¹ç›®æ–‡ä»¶ä¸­å¼•å…¥ï¼š" class="headerlink" title="1.åœ¨éœ€è¦ä½¿ç”¨çš„é¡¹ç›®æ–‡ä»¶ä¸­å¼•å…¥ï¼š"></a>1.åœ¨éœ€è¦ä½¿ç”¨çš„é¡¹ç›®æ–‡ä»¶ä¸­å¼•å…¥ï¼š</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import md5 from &#39;js-md5&#39;;</span><br></pre></td></tr></table></figure>

<h5 id="ä½¿ç”¨ï¼š"><a href="#ä½¿ç”¨ï¼š" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">md5(&#39;hello world&#39;)  &#x2F;&#x2F; 5eb63bbbe01eeed093cb22bb8f5acdc3</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h4 id="2-æˆ–è€…åœ¨main-jsæ–‡ä»¶ä¸­å°†md5è½¬æ¢æˆvueåŸå‹ï¼š"><a href="#2-æˆ–è€…åœ¨main-jsæ–‡ä»¶ä¸­å°†md5è½¬æ¢æˆvueåŸå‹ï¼š" class="headerlink" title="2.æˆ–è€…åœ¨main.jsæ–‡ä»¶ä¸­å°†md5è½¬æ¢æˆvueåŸå‹ï¼š"></a>2.æˆ–è€…åœ¨main.jsæ–‡ä»¶ä¸­å°†md5è½¬æ¢æˆvueåŸå‹ï¼š</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import md5 from &#39;js-md5&#39;;</span><br><span class="line">Vue.prototype.$md5 &#x3D; md5;</span><br></pre></td></tr></table></figure>

<h5 id="ä½¿ç”¨ï¼š-1"><a href="#ä½¿ç”¨ï¼š-1" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">this.$md5(&#39;hello world&#39;) &#x2F;&#x2F; 5eb63bbbe01eeed093cb22bb8f5acdc3</span><br></pre></td></tr></table></figure>

<p><strong>vueä½¿ç”¨md5åŠ å¯†çš„å®ä¾‹ä»£ç </strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import crypto from &#39;crypto&#39;</span><br><span class="line">export default &#123;</span><br><span class="line"> name: &#39;HelloWorld&#39;,</span><br><span class="line"> data () &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">   msg: &#39;Welcome to Your Vue.js App&#39;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> mounted()&#123;</span><br><span class="line">  this.getmd5(&quot;aaa&quot;);</span><br><span class="line"> &#125;,</span><br><span class="line"> methods:&#123;</span><br><span class="line">  getmd5(str)&#123;</span><br><span class="line">      var a;</span><br><span class="line">      var md5 &#x3D; crypto.createHash(&quot;md5&quot;);</span><br><span class="line">      &#x2F;&#x2F;update(&quot;ä¸­æ–‡&quot;, &quot;utf8&quot;)</span><br><span class="line">      md5.update(str);</span><br><span class="line">      var a &#x3D; md5.digest(&#39;hex&#39;);</span><br><span class="line">      console.log(a);</span><br><span class="line">      &#x2F;&#x2F;47bce5c74f589f4867dbd57e9ca9f808</span><br><span class="line">      return a;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>TCPä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</title>
    <url>/2018/08/11/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/</url>
    <content><![CDATA[<img src="/2018/08/11/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/f58f6ad856c6802b636d20d8f5ba2c3e.png" class="">

<a id="more"></a>

<h2 id="ä¸‰æ¬¡æ¡æ‰‹-å»ºç«‹TCPè¿æ¥"><a href="#ä¸‰æ¬¡æ¡æ‰‹-å»ºç«‹TCPè¿æ¥" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹-å»ºç«‹TCPè¿æ¥"></a>ä¸‰æ¬¡æ¡æ‰‹-å»ºç«‹TCPè¿æ¥</h2><img src="/2018/08/11/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/824317-20161211213831272-742191218.png" class="">

<ol>
<li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClientå°†æ ‡å¿—ä½SYNç½®ä¸º1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=xï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒClientè¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…Serverç¡®è®¤ã€‚ </li>
</ol>
<ol start="2">
<li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šServeræ”¶åˆ°æ•°æ®åŒ…åç”±æ ‡å¿—ä½SYN=1çŸ¥é“Clientè¯·æ±‚å»ºç«‹è¿æ¥ï¼ŒServerå°†æ ‡å¿—ä½SYNå’ŒACKéƒ½ç½®ä¸º1ï¼Œack=x+1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=yï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Clientä»¥ç¡®è®¤è¿æ¥è¯·æ±‚ï¼ŒServerè¿›å…¥SYN_RCVDçŠ¶æ€ã€‚ </li>
</ol>
<ol start="3">
<li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClientæ”¶åˆ°ç¡®è®¤åï¼Œæ£€æŸ¥ackæ˜¯å¦ä¸ºx+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™å°†æ ‡å¿—ä½ACKç½®ä¸º1ï¼Œack=y+1ï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒServeræ£€æŸ¥ackæ˜¯å¦ä¸ºy+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™è¿æ¥å»ºç«‹æˆåŠŸï¼ŒClientå’ŒServerè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼ŒéšåClientä¸Serverä¹‹é—´å¯ä»¥å¼€å§‹ä¼ è¾“æ•°æ®äº†ã€‚</li>
</ol>
<h2 id="ä¸‰æ¬¡æ¡æ‰‹ä¸­ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢"><a href="#ä¸‰æ¬¡æ¡æ‰‹ä¸­ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹ä¸­ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢"></a><strong>ä¸‰æ¬¡æ¡æ‰‹ä¸­ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢</strong></h2><p>ä¸‰æ¬¡æ¡æ‰‹èƒ½ç¡®è®¤åŒå‘æ”¶å‘åŠŸèƒ½éƒ½æ­£å¸¸ï¼Œç¼ºä¸€ä¸å¯ã€‚<br> ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClientä»€ä¹ˆéƒ½ä¸èƒ½ç¡®è®¤ï¼›Serverç¡®è®¤äº†å¯¹æ–¹å‘é€æ­£å¸¸ã€‚<br> ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šClientç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Serverç¡®è®¤äº†ï¼šè‡ªå·±æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€æ­£å¸¸ã€‚<br> ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClientç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Serverç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€æ¥æ”¶æ­£å¸¸ã€‚</p>
<p> ä¸‰æ¬¡æ¡æ‰‹çš„å¦ä¸€ä¸ªç›®æ ‡æ˜¯ç¡®è®¤ç¡®è®¤åŒæ–¹éƒ½æ”¯æŒTCPï¼Œå‘ŠçŸ¥å¯¹æ–¹ç”¨TCPä¼ è¾“ã€‚<br> ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šServerçŒœæµ‹Clientå¯èƒ½è¦å»ºç«‹TCPè¯·æ±‚ï¼Œä½†ä¸ç¡®å®šï¼Œå› ä¸ºä¹Ÿå¯èƒ½æ˜¯Clientä¹±å‘äº†ä¸€ä¸ªæ•°æ®åŒ…ç»™è‡ªå·±ã€‚<br> ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šé€šè¿‡ack=x+1ï¼ŒClientçŸ¥é“Serveræ˜¯æ”¯æŒTCPçš„ï¼Œä¸”ç†è§£äº†è‡ªå·±è¦å»ºç«‹TCPè¿æ¥çš„æ„å›¾ã€‚<br> ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šé€šè¿‡ack=y+1ï¼ŒServerçŸ¥é“Clientæ˜¯æ”¯æŒTCPçš„ï¼Œä¸”ç¡®å®æ˜¯è¦å»ºç«‹TCPè¿æ¥ã€‚</p>
<h2 id="ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥äº†æ€ä¹ˆåŠ"><a href="#ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥äº†æ€ä¹ˆåŠ" class="headerlink" title="ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥äº†æ€ä¹ˆåŠ"></a><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥äº†æ€ä¹ˆåŠ</strong></h2><p> å½“clientä¸serverçš„ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥äº†ä¹‹åï¼Œå³clientå‘é€è‡³serverçš„ç¡®è®¤å»ºç«‹è¿æ¥æŠ¥æ–‡æ®µæœªèƒ½åˆ°è¾¾serverï¼Œserveråœ¨ç­‰å¾…clientå›å¤ACKçš„è¿‡ç¨‹ä¸­è¶…æ—¶äº†ï¼Œé‚£ä¹ˆserverä¼šå‘clientå‘é€ä¸€ä¸ªRTSæŠ¥æ–‡æ®µå¹¶è¿›å…¥å…³é—­çŠ¶æ€ï¼Œå³ï¼šå¹¶ä¸ç­‰å¾…clientç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ACKåŒ…é‡ä¼ ï¼Œç›´æ¥å…³é—­è¿æ¥è¯·æ±‚ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æ³›æ´ªæ”»å‡»ï¼Œå³åäººä¼ªé€ è®¸å¤šIPå‘serverå‘é€è¿æ¥è¯·æ±‚ï¼Œä»è€Œå°†serverçš„æœªè¿æ¥é˜Ÿåˆ—å¡æ»¡ï¼Œæµªè´¹serverçš„èµ„æºã€‚</p>
<h2 id="ä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆç¼ºé™·å¯ä»¥è¢«é»‘å®¢åˆ©ç”¨ï¼Œç”¨æ¥å¯¹æœåŠ¡å™¨è¿›è¡Œæ”»å‡»"><a href="#ä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆç¼ºé™·å¯ä»¥è¢«é»‘å®¢åˆ©ç”¨ï¼Œç”¨æ¥å¯¹æœåŠ¡å™¨è¿›è¡Œæ”»å‡»" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆç¼ºé™·å¯ä»¥è¢«é»‘å®¢åˆ©ç”¨ï¼Œç”¨æ¥å¯¹æœåŠ¡å™¨è¿›è¡Œæ”»å‡»"></a><strong>ä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆç¼ºé™·å¯ä»¥è¢«é»‘å®¢åˆ©ç”¨ï¼Œç”¨æ¥å¯¹æœåŠ¡å™¨è¿›è¡Œæ”»å‡»</strong></h2><p>åœ¨ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒServerå‘é€SYN-ACKä¹‹åï¼Œæ”¶åˆ°Clientçš„ACKä¹‹å‰çš„TCPè¿æ¥ç§°ä¸ºåŠè¿æ¥ï¼ˆhalf-open connectï¼‰ï¼Œæ­¤æ—¶Serverå¤„äºSYN_RCVDçŠ¶æ€ï¼Œå½“æ”¶åˆ°ACKåï¼ŒServerè½¬å…¥ESTABLISHEDçŠ¶æ€ã€‚SYNæ”»å‡»å°±æ˜¯Clientåœ¨çŸ­æ—¶é—´å†…ä¼ªé€ å¤§é‡ä¸å­˜åœ¨çš„IPåœ°å€ï¼Œå¹¶å‘Serverä¸æ–­åœ°å‘é€SYNåŒ…ï¼ŒServerå›å¤ç¡®è®¤åŒ…ï¼Œå¹¶ç­‰å¾…Clientçš„ç¡®è®¤ï¼Œç”±äºæºåœ°å€æ˜¯ä¸å­˜åœ¨çš„ï¼Œå› æ­¤ï¼ŒServeréœ€è¦ä¸æ–­é‡å‘ç›´è‡³è¶…æ—¶ï¼Œè¿™äº›ä¼ªé€ çš„SYNåŒ…å°†äº§æ—¶é—´å ç”¨æœªè¿æ¥é˜Ÿåˆ—ï¼Œå¯¼è‡´æ­£å¸¸çš„SYNè¯·æ±‚å› ä¸ºé˜Ÿåˆ—æ»¡è€Œè¢«ä¸¢å¼ƒï¼Œä»è€Œå¼•èµ·ç½‘ç»œå µå¡ç”šè‡³ç³»ç»Ÿç˜«ç—ªã€‚SYNæ”»å‡»æ—¶ä¸€ç§å…¸å‹çš„DDOSæ”»å‡»ï¼Œæ£€æµ‹SYNæ”»å‡»çš„æ–¹å¼éå¸¸ç®€å•ï¼Œå³å½“Serverä¸Šæœ‰å¤§é‡åŠè¿æ¥çŠ¶æ€ä¸”æºIPåœ°å€æ˜¯éšæœºçš„ï¼Œåˆ™å¯ä»¥æ–­å®šé­åˆ°SYNæ”»å‡»äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">netstat -nap | grep SYN_RECV</span><br></pre></td></tr></table></figure>



<h3 id="æ€ä¹ˆé˜²èŒƒè¿™ç§æ”»å‡»ï¼Ÿ"><a href="#æ€ä¹ˆé˜²èŒƒè¿™ç§æ”»å‡»ï¼Ÿ" class="headerlink" title="æ€ä¹ˆé˜²èŒƒè¿™ç§æ”»å‡»ï¼Ÿ"></a><strong>æ€ä¹ˆé˜²èŒƒè¿™ç§æ”»å‡»ï¼Ÿ</strong></h3><ol>
<li>ç¼©çŸ­æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯SYNæŠ¥æ–‡ä¹‹åçš„ç­‰å¾…è¿æ¥æ—¶é—´ï¼Œå³SYN timeoutæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯serveræ¥æ”¶åˆ°SYNæŠ¥æ–‡æ®µï¼Œåˆ°æœ€åæ”¾å¼ƒæ­¤è¿æ¥è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œå°†SYN timeoutè®¾ç½®çš„æ›´ä½ï¼Œä¾¿å¯ä»¥æˆå€çš„å‡å°‘serverçš„è´Ÿè·ï¼Œä½†æ˜¯è¿‡ä½çš„SYN timeoutå¯èƒ½ä¼šå½±å“æ­£å¸¸çš„TCPè¿æ¥çš„å»ºç«‹ï¼Œä¸€æ—¦ç½‘ç»œä¸é€šç•…ä¾¿å¯èƒ½å¯¼è‡´clientè¿æ¥è¯·æ±‚å¤±è´¥</li>
<li><strong>SYN cookie + SYN proxy æ— ç¼é›†æˆï¼ˆè¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼‰</strong><ul>
<li>SYN cookieï¼šå½“serveræ¥æ”¶åˆ°clientçš„SYNä¹‹åï¼Œä¸ç«‹å³åˆ†é…èµ„æºï¼Œè€Œæ˜¯æ ¹æ®clientå‘é€è¿‡æ¥çš„SYNåŒ…è®¡ç®—å‡ºä¸€ä¸ªcookieå€¼ï¼Œè¿™ä¸ªcookieå€¼ç”¨æ¥å­˜å‚¨serverè¿”å›ç»™clientçš„SYN+ACKæ•°æ®åŒ…ä¸­çš„åˆå§‹åºåˆ—å·ï¼Œå½“clientè¿”å›ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ACKåŒ…ä¹‹åè¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ ¡éªŒæˆåŠŸåˆ™serveråˆ†é…èµ„æºï¼Œå»ºç«‹è¿æ¥ã€‚</li>
<li>SYN proxyä»£ç†ï¼Œä½œä¸ºserverä¸clientè¿æ¥çš„ä»£ç†ï¼Œä»£æ›¿serverä¸clientå»ºç«‹ä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥ï¼ŒåŒæ—¶SYN proxyä¸clientå»ºç«‹å¥½äº†ä¸‰æ¬¡æ¡æ‰‹è¿æ¥ä¹‹åï¼Œç¡®ä¿æ˜¯æ­£å¸¸çš„TCPè¿æ¥ï¼Œè€Œä¸æ˜¯TCPæ³›æ´ªæ”»å‡»ï¼Œé‚£ä¹ˆSYN proxyå°±ä¸serverå»ºç«‹ä¸‰æ¬¡æ¡æ‰‹è¿æ¥ï¼Œä½œä¸ºä»£ç†ï¼ˆç½‘å…³ï¼Ÿï¼‰æ¥è¿é€šclientä¸serverã€‚ï¼ˆç±»ä¼¼VPNäº†è§£ä¸€ä¸‹ï¼‰</li>
</ul>
</li>
</ol>
<h2 id="å››æ¬¡æŒ¥æ‰‹-æ–­å¼€è¿æ¥"><a href="#å››æ¬¡æŒ¥æ‰‹-æ–­å¼€è¿æ¥" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹-æ–­å¼€è¿æ¥"></a>å››æ¬¡æŒ¥æ‰‹-æ–­å¼€è¿æ¥</h2><img src="/2018/08/11/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/888866620_gaitubao_823x571.png" class="">

<ol>
<li>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šClientå‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­Clientåˆ°Serverçš„æ•°æ®ä¼ é€ï¼ŒClientè¿›å…¥FIN_WAIT_1çŠ¶æ€ã€‚ </li>
<li>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šServeræ”¶åˆ°FINåï¼Œå‘é€ä¸€ä¸ªACKç»™Clientï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼ˆä¸SYNç›¸åŒï¼Œä¸€ä¸ªFINå ç”¨ä¸€ä¸ªåºå·ï¼‰ï¼ŒServerè¿›å…¥CLOSE_WAITçŠ¶æ€ã€‚ </li>
<li>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šServerå‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­Serveråˆ°Clientçš„æ•°æ®ä¼ é€ï¼ŒServerè¿›å…¥LAST_ACKçŠ¶æ€ã€‚ </li>
<li>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šClientæ”¶åˆ°FINåï¼ŒClientè¿›å…¥TIME_WAITçŠ¶æ€ï¼Œæ¥ç€å‘é€ä¸€ä¸ªACKç»™Serverï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼ŒServerè¿›å…¥CLOSEDçŠ¶æ€ï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ã€‚ </li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹"><a href="#ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹"></a><strong>ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹</strong></h2><ol>
<li>serverå‘é€FINæ•°æ®åŒ…å¹¶æºå¸¦ACKè‡³clientä¹‹åç›´æ¥æ–­å¼€è¿æ¥ï¼Œå¦‚æœclientæ²¡æœ‰æ”¶åˆ°è¿™ä¸ªFINæ•°æ®åŒ…ï¼Œé‚£ä¹ˆclientä¼šä¸€ç›´å¤„äºç­‰å¾…å…³é—­çŠ¶æ€ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿TCPåè®®æ˜¯é¢å‘è¿æ¥å®‰å…¨æœ‰ä¿è¯çš„ã€‚</li>
<li>ä¸Šé¢è§£é‡Šäº†ä¸ºä»€ä¹ˆä¸æ˜¯ä¸‰æ¬¡æŒ¥æ‰‹ï¼ŒåŒç†ï¼Œä¸¤æ¬¡æŒ¥æ‰‹ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ã€‚ä¸èƒ½ä¿è¯serverä¸clientéƒ½èƒ½æ­£ç¡®å…³é—­è¿æ¥é‡Šæ”¾èµ„æºï¼Œè€Œä¸ä¼šé€ æˆèµ„æºæµªè´¹ã€‚</li>
</ol>
<h2 id="å››æ¬¡æŒ¥æ‰‹ä¹‹åclientä¸ºä»€ä¹ˆè¿˜è¦ç­‰å¾…2MSLçš„æ—¶é—´æ‰é‡Šæ”¾èµ„æºå…³é—­è¿æ¥ï¼Ÿ"><a href="#å››æ¬¡æŒ¥æ‰‹ä¹‹åclientä¸ºä»€ä¹ˆè¿˜è¦ç­‰å¾…2MSLçš„æ—¶é—´æ‰é‡Šæ”¾èµ„æºå…³é—­è¿æ¥ï¼Ÿ" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹ä¹‹åclientä¸ºä»€ä¹ˆè¿˜è¦ç­‰å¾…2MSLçš„æ—¶é—´æ‰é‡Šæ”¾èµ„æºå…³é—­è¿æ¥ï¼Ÿ"></a><strong>å››æ¬¡æŒ¥æ‰‹ä¹‹åclientä¸ºä»€ä¹ˆè¿˜è¦ç­‰å¾…2MSLçš„æ—¶é—´æ‰é‡Šæ”¾èµ„æºå…³é—­è¿æ¥ï¼Ÿ</strong></h2><ol>
<li>å¦‚æœclientç¬¬å››æ¬¡æŒ¥æ‰‹çš„ç¡®è®¤æŠ¥æ–‡æ®µæ²¡æœ‰è¢«serveræ¥æ”¶ï¼Œé‚£ä¹ˆserverä¾¿ä¼šé‡å‘ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„FINæŠ¥æ–‡æ®µï¼Œå› æ­¤clientè¦åœç•™2MSLçš„æ—¶é•¿æ¥å¤„ç†å¯èƒ½ä¼šé‡å¤æ”¶åˆ°çš„æŠ¥æ–‡æ®µã€‚</li>
<li>è®©ä¹‹å‰å»ºç«‹çš„client-serveré€šä¿¡è¿‡ç¨‹ä¸­æˆ–è€…æ˜¯æŒ¥æ‰‹è¿‡ç¨‹ä¸­ç”±äºç½‘ç»œä¸é€šç•…äº§ç”Ÿçš„æ»ç•™æŠ¥æ–‡æ®µå¤±æ•ˆã€‚å¦‚æœä¸ç­‰å¾…2MSLï¼Œé‚£ä¹ˆå»ºç«‹æ–°è¿æ¥ä¹‹åï¼Œå¯èƒ½ä¼šæ”¶åˆ°ä¸Šä¸€æ¬¡è¿æ¥çš„æ—§æŠ¥æ–‡æ®µï¼Œå¯èƒ½ä¼šé€ æˆæ··ä¹±ã€‚</li>
</ol>
<h2 id="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠ"><a href="#å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠ" class="headerlink" title="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠ"></a>å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠ</h2><p>TCPè¿˜è®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75ç§’é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚ </p>
]]></content>
      <categories>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP/UDP</title>
    <url>/2018/08/10/TCP-UDP/</url>
    <content><![CDATA[<h2 id="TCP-IPç½‘ç»œæ¨¡å‹"><a href="#TCP-IPç½‘ç»œæ¨¡å‹" class="headerlink" title="TCP/IPç½‘ç»œæ¨¡å‹"></a>TCP/IPç½‘ç»œæ¨¡å‹</h2><p>è®¡ç®—æœºä¸ç½‘ç»œè®¾å¤‡è¦ç›¸äº’é€šä¿¡ï¼ŒåŒæ–¹å°±å¿…é¡»åŸºäºç›¸åŒçš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œå¦‚ä½•æ¢æµ‹åˆ°é€šä¿¡ç›®æ ‡ã€ç”±å“ªä¸€è¾¹å…ˆå‘èµ·é€šä¿¡ã€ä½¿ç”¨å“ªç§è¯­è¨€è¿›è¡Œé€šä¿¡ã€æ€æ ·ç»“æŸé€šä¿¡ç­‰è§„åˆ™éƒ½éœ€è¦äº‹å…ˆç¡®å®šã€‚ä¸åŒçš„ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿä¹‹é—´çš„é€šä¿¡ï¼Œæ‰€æœ‰çš„è¿™ä¸€åˆ‡éƒ½éœ€è¦ä¸€ç§è§„åˆ™ã€‚è€Œæˆ‘ä»¬å°±æŠŠè¿™ç§è§„åˆ™ç§°ä¸ºåè®®ï¼ˆprotocolï¼‰ã€‚</p>
<a id="more"></a>

<p>TCP/IP æ˜¯äº’è”ç½‘ç›¸å…³çš„å„ç±»åè®®æ—çš„æ€»ç§°ï¼Œæ¯”å¦‚ï¼šTCPï¼ŒUDPï¼ŒIPï¼ŒFTPï¼ŒHTTPï¼ŒICMPï¼ŒSMTP ç­‰éƒ½å±äº TCP/IP æ—å†…çš„åè®®ã€‚</p>
<p>TCP/IPæ¨¡å‹æ˜¯äº’è”ç½‘çš„åŸºç¡€ï¼Œå®ƒæ˜¯ä¸€ç³»åˆ—ç½‘ç»œåè®®çš„æ€»ç§°ã€‚è¿™äº›åè®®å¯ä»¥åˆ’åˆ†ä¸ºå››å±‚ï¼Œåˆ†åˆ«ä¸ºé“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ã€‚</p>
<ul>
<li>é“¾è·¯å±‚ï¼šè´Ÿè´£å°è£…å’Œè§£å°è£…IPæŠ¥æ–‡ï¼Œå‘é€å’Œæ¥å—ARP/RARPæŠ¥æ–‡ç­‰ã€‚</li>
<li>ç½‘ç»œå±‚ï¼šè´Ÿè´£è·¯ç”±ä»¥åŠæŠŠåˆ†ç»„æŠ¥æ–‡å‘é€ç»™ç›®æ ‡ç½‘ç»œæˆ–ä¸»æœºã€‚</li>
<li>ä¼ è¾“å±‚ï¼šè´Ÿè´£å¯¹æŠ¥æ–‡è¿›è¡Œåˆ†ç»„å’Œé‡ç»„ï¼Œå¹¶ä»¥TCPæˆ–UDPåè®®æ ¼å¼å°è£…æŠ¥æ–‡ã€‚</li>
<li>åº”ç”¨å±‚ï¼šè´Ÿè´£å‘ç”¨æˆ·æä¾›åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚HTTPã€FTPã€Telnetã€DNSã€SMTPç­‰ã€‚</li>
</ul>
<img src="/2018/08/10/TCP-UDP/2019-03-21-01.png" class="">  

<p>åœ¨ç½‘ç»œä½“ç³»ç»“æ„ä¸­ç½‘ç»œé€šä¿¡çš„å»ºç«‹å¿…é¡»æ˜¯åœ¨é€šä¿¡åŒæ–¹çš„å¯¹ç­‰å±‚è¿›è¡Œï¼Œä¸èƒ½äº¤é”™ã€‚ åœ¨æ•´ä¸ªæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•°æ®åœ¨å‘é€ç«¯æ—¶ç»è¿‡å„å±‚æ—¶éƒ½è¦é™„åŠ ä¸Šç›¸åº”å±‚çš„åè®®å¤´å’Œåè®®å°¾ï¼ˆä»…æ•°æ®é“¾è·¯å±‚éœ€è¦å°è£…åè®®å°¾ï¼‰éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¦å¯¹æ•°æ®è¿›è¡Œåè®®å°è£…ï¼Œä»¥æ ‡è¯†å¯¹åº”å±‚æ‰€ç”¨çš„é€šä¿¡åè®®ã€‚æ¥ä¸‹å»ä»‹ç»TCP/IP ä¸­æœ‰ä¸¤ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„ä¼ è¾“å±‚åè®®â€”-TCP å’Œ UDPã€‚ </p>
<h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><p>UDPåè®®å…¨ç§°æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œåœ¨ç½‘ç»œä¸­å®ƒä¸TCPåè®®ä¸€æ ·ç”¨äºå¤„ç†æ•°æ®åŒ…ï¼Œæ˜¯ä¸€ç§æ— è¿æ¥çš„åè®®ã€‚åœ¨OSIæ¨¡å‹ä¸­ï¼Œåœ¨ç¬¬å››å±‚â€”â€”ä¼ è¾“å±‚ï¼Œå¤„äºIPåè®®çš„ä¸Šä¸€å±‚ã€‚UDPæœ‰ä¸æä¾›æ•°æ®åŒ…åˆ†ç»„ã€ç»„è£…å’Œä¸èƒ½å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åºçš„ç¼ºç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŠ¥æ–‡å‘é€ä¹‹åï¼Œæ˜¯æ— æ³•å¾—çŸ¥å…¶æ˜¯å¦å®‰å…¨å®Œæ•´åˆ°è¾¾çš„ã€‚</p>
<p>å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<h4 id="1-é¢å‘æ— è¿æ¥"><a href="#1-é¢å‘æ— è¿æ¥" class="headerlink" title="1. é¢å‘æ— è¿æ¥"></a>1. é¢å‘æ— è¿æ¥</h4><p>é¦–å…ˆ UDP æ˜¯ä¸éœ€è¦å’Œ TCPä¸€æ ·åœ¨å‘é€æ•°æ®å‰è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„ï¼Œæƒ³å‘æ•°æ®å°±å¯ä»¥å¼€å§‹å‘é€äº†ã€‚å¹¶ä¸”ä¹Ÿåªæ˜¯æ•°æ®æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸ä¼šå¯¹æ•°æ®æŠ¥æ–‡è¿›è¡Œä»»ä½•æ‹†åˆ†å’Œæ‹¼æ¥æ“ä½œã€‚</p>
<p>å…·ä½“æ¥è¯´å°±æ˜¯ï¼š</p>
<ul>
<li>åœ¨å‘é€ç«¯ï¼Œåº”ç”¨å±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚çš„ UDP åè®®ï¼ŒUDP åªä¼šç»™æ•°æ®å¢åŠ ä¸€ä¸ª UDP å¤´æ ‡è¯†ä¸‹æ˜¯ UDP åè®®ï¼Œç„¶åå°±ä¼ é€’ç»™ç½‘ç»œå±‚äº†</li>
<li>åœ¨æ¥æ”¶ç«¯ï¼Œç½‘ç»œå±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚ï¼ŒUDP åªå»é™¤ IP æŠ¥æ–‡å¤´å°±ä¼ é€’ç»™åº”ç”¨å±‚ï¼Œä¸ä¼šä»»ä½•æ‹¼æ¥æ“ä½œ</li>
</ul>
<h4 id="2-æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½"><a href="#2-æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½" class="headerlink" title="2. æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½"></a>2. æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½</h4><p>UDP ä¸æ­¢æ”¯æŒä¸€å¯¹ä¸€çš„ä¼ è¾“æ–¹å¼ï¼ŒåŒæ ·æ”¯æŒä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ UDP æä¾›äº†å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½ã€‚ </p>
<h4 id="3-UDPæ˜¯é¢å‘æŠ¥æ–‡çš„"><a href="#3-UDPæ˜¯é¢å‘æŠ¥æ–‡çš„" class="headerlink" title="3. UDPæ˜¯é¢å‘æŠ¥æ–‡çš„"></a>3. UDPæ˜¯é¢å‘æŠ¥æ–‡çš„</h4><p>å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡ </p>
<h4 id="4-ä¸å¯é æ€§"><a href="#4-ä¸å¯é æ€§" class="headerlink" title="4. ä¸å¯é æ€§"></a>4. ä¸å¯é æ€§</h4><p>é¦–å…ˆä¸å¯é æ€§ä½“ç°åœ¨æ— è¿æ¥ä¸Šï¼Œé€šä¿¡éƒ½ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæƒ³å‘å°±å‘ï¼Œè¿™æ ·çš„æƒ…å†µè‚¯å®šä¸å¯é ã€‚</p>
<p>å¹¶ä¸”æ”¶åˆ°ä»€ä¹ˆæ•°æ®å°±ä¼ é€’ä»€ä¹ˆæ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¤‡ä»½æ•°æ®ï¼Œå‘é€æ•°æ®ä¹Ÿä¸ä¼šå…³å¿ƒå¯¹æ–¹æ˜¯å¦å·²ç»æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®äº†ã€‚</p>
<p>å†è€…ç½‘ç»œç¯å¢ƒæ—¶å¥½æ—¶åï¼Œä½†æ˜¯ UDP å› ä¸ºæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œä¸€ç›´ä¼šä»¥æ’å®šçš„é€Ÿåº¦å‘é€æ•°æ®ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶ä¸å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹å‘é€é€Ÿç‡è¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·å®ç°çš„å¼Šç«¯å°±æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ï¼Œä½†æ˜¯ä¼˜ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç”µè¯ä¼šè®®ï¼‰å°±éœ€è¦ä½¿ç”¨ UDP è€Œä¸æ˜¯ TCPã€‚</p>
<h4 id="5-å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚"><a href="#5-å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚" class="headerlink" title="5. å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚"></a>5. å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚</h4><img src="/2018/08/10/TCP-UDP/2019-03-21-03.png" class="">  

<p>UDP å¤´éƒ¨åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ•°æ®ï¼š </p>
<ul>
<li>ä¸¤ä¸ªåå…­ä½çš„ç«¯å£å·ï¼Œåˆ†åˆ«ä¸ºæºç«¯å£ï¼ˆå¯é€‰å­—æ®µï¼‰å’Œç›®æ ‡ç«¯å£</li>
<li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„é•¿åº¦</li>
<li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„æ£€éªŒå’Œï¼ˆIPv4 å¯é€‰ å­—æ®µï¼‰ï¼Œè¯¥å­—æ®µç”¨äºå‘ç°å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®ä¸­çš„é”™è¯¯</li>
</ul>
<p>å› æ­¤ UDP çš„å¤´éƒ¨å¼€é”€å°ï¼Œåªæœ‰å…«å­—èŠ‚ï¼Œç›¸æ¯” TCP çš„è‡³å°‘äºŒåå­—èŠ‚è¦å°‘å¾—å¤šï¼Œåœ¨ä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ </p>
<h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><p>å½“ä¸€å°è®¡ç®—æœºæƒ³è¦ä¸å¦ä¸€å°è®¡ç®—æœºé€šè®¯æ—¶ï¼Œä¸¤å°è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡éœ€è¦ç•…é€šä¸”å¯é ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ­£ç¡®æ”¶å‘æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ æƒ³æŸ¥çœ‹ç½‘é¡µæˆ–æŸ¥çœ‹ç”µå­é‚®ä»¶æ—¶ï¼Œå¸Œæœ›å®Œæ•´ä¸”æŒ‰é¡ºåºæŸ¥çœ‹ç½‘é¡µï¼Œè€Œä¸ä¸¢å¤±ä»»ä½•å†…å®¹ã€‚å½“ä½ ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œå¸Œæœ›è·å¾—çš„æ˜¯å®Œæ•´çš„æ–‡ä»¶ï¼Œè€Œä¸ä»…ä»…æ˜¯æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå¦‚æœæ•°æ®ä¸¢å¤±æˆ–ä¹±åºï¼Œéƒ½ä¸æ˜¯ä½ å¸Œæœ›å¾—åˆ°çš„ç»“æœï¼Œäºæ˜¯å°±ç”¨åˆ°äº†TCPã€‚</p>
<p>TCPåè®®å…¨ç§°æ˜¯ä¼ è¾“æ§åˆ¶åè®®æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ï¼Œç”± IETF çš„RFC 793å®šä¹‰ã€‚TCP æ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„æµåè®®ã€‚æµå°±æ˜¯æŒ‡ä¸é—´æ–­çš„æ•°æ®ç»“æ„ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ’æ°´ç®¡ä¸­çš„æ°´æµã€‚</p>
<h4 id="1-TCPè¿æ¥è¿‡ç¨‹"><a href="#1-TCPè¿æ¥è¿‡ç¨‹" class="headerlink" title="1. TCPè¿æ¥è¿‡ç¨‹"></a>1. TCPè¿æ¥è¿‡ç¨‹</h4><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°å»ºç«‹ä¸€ä¸ªTCPè¿æ¥çš„è¿‡ç¨‹ä¸ºï¼ˆä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼‰: </p>
<img src="/2018/08/10/TCP-UDP/2019-03-21-04.png" class="">  

<p><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong></p>
<p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è¯¥æŠ¥æ–‡æ®µä¸­åŒ…å«è‡ªèº«çš„æ•°æ®é€šè®¯åˆå§‹åºå·ã€‚è¯·æ±‚å‘é€åï¼Œå®¢æˆ·ç«¯ä¾¿è¿›å…¥ SYN-SENT çŠ¶æ€ã€‚</p>
<p><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong></p>
<p>æœåŠ¡ç«¯æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™ä¼šå‘é€ä¸€ä¸ªåº”ç­”ï¼Œè¯¥åº”ç­”ä¸­ä¹Ÿä¼šåŒ…å«è‡ªèº«çš„æ•°æ®é€šè®¯åˆå§‹åºå·ï¼Œå‘é€å®Œæˆåä¾¿è¿›å…¥ SYN-RECEIVED çŠ¶æ€ã€‚</p>
<p><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong></p>
<p>å½“å®¢æˆ·ç«¯æ”¶åˆ°è¿æ¥åŒæ„çš„åº”ç­”åï¼Œè¿˜è¦å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ã€‚å®¢æˆ·ç«¯å‘å®Œè¿™ä¸ªæŠ¥æ–‡æ®µåä¾¿è¿›å…¥ ESTABLISHED çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªåº”ç­”åä¹Ÿè¿›å…¥ ESTABLISHED çŠ¶æ€ï¼Œæ­¤æ—¶è¿æ¥å»ºç«‹æˆåŠŸã€‚</p>
<p>è¿™é‡Œå¯èƒ½å¤§å®¶ä¼šæœ‰ä¸ªç–‘æƒ‘ï¼šä¸ºä»€ä¹ˆ TCP å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡ï¼Ÿè¿™æ˜¯å› ä¸ºè¿™æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µè¢«æœåŠ¡ç«¯æ¥æ”¶çš„æƒ…å†µï¼Œä»è€Œäº§ç”Ÿé”™è¯¯ã€‚</p>
<h4 id="2-TCPæ–­å¼€é“¾æ¥"><a href="#2-TCPæ–­å¼€é“¾æ¥" class="headerlink" title="2. TCPæ–­å¼€é“¾æ¥"></a>2. TCPæ–­å¼€é“¾æ¥</h4><img src="/2018/08/10/TCP-UDP/2019-03-21-06.png" class="">  

<p>TCP æ˜¯å…¨åŒå·¥çš„ï¼Œåœ¨æ–­å¼€è¿æ¥æ—¶ä¸¤ç«¯éƒ½éœ€è¦å‘é€ FIN å’Œ ACKã€‚</p>
<p><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong></p>
<p>è‹¥å®¢æˆ·ç«¯ A è®¤ä¸ºæ•°æ®å‘é€å®Œæˆï¼Œåˆ™å®ƒéœ€è¦å‘æœåŠ¡ç«¯ B å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ã€‚</p>
<p><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong></p>
<p>B æ”¶åˆ°è¿æ¥é‡Šæ”¾è¯·æ±‚åï¼Œä¼šå‘Šè¯‰åº”ç”¨å±‚è¦é‡Šæ”¾ TCP é“¾æ¥ã€‚ç„¶åä¼šå‘é€ ACK åŒ…ï¼Œå¹¶è¿›å…¥ CLOSE_WAIT çŠ¶æ€ï¼Œæ­¤æ—¶è¡¨æ˜ A åˆ° B çš„è¿æ¥å·²ç»é‡Šæ”¾ï¼Œä¸å†æ¥æ”¶ A å‘çš„æ•°æ®äº†ã€‚ä½†æ˜¯å› ä¸º TCP è¿æ¥æ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥ B ä»æ—§å¯ä»¥å‘é€æ•°æ®ç»™ Aã€‚</p>
<p><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong></p>
<p>B å¦‚æœæ­¤æ—¶è¿˜æœ‰æ²¡å‘å®Œçš„æ•°æ®ä¼šç»§ç»­å‘é€ï¼Œå®Œæ¯•åä¼šå‘ A å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ï¼Œç„¶å B ä¾¿è¿›å…¥ LAST-ACK çŠ¶æ€ã€‚</p>
<p><strong>ç¬¬å››æ¬¡æ¡æ‰‹</strong></p>
<p>A æ”¶åˆ°é‡Šæ”¾è¯·æ±‚åï¼Œå‘ B å‘é€ç¡®è®¤åº”ç­”ï¼Œæ­¤æ—¶ A è¿›å…¥ TIME-WAIT çŠ¶æ€ã€‚è¯¥çŠ¶æ€ä¼šæŒç»­ 2MSLï¼ˆæœ€å¤§æ®µç”Ÿå­˜æœŸï¼ŒæŒ‡æŠ¥æ–‡æ®µåœ¨ç½‘ç»œä¸­ç”Ÿå­˜çš„æ—¶é—´ï¼Œè¶…æ—¶ä¼šè¢«æŠ›å¼ƒï¼‰ æ—¶é—´ï¼Œè‹¥è¯¥æ—¶é—´æ®µå†…æ²¡æœ‰ B çš„é‡å‘è¯·æ±‚çš„è¯ï¼Œå°±è¿›å…¥ CLOSED çŠ¶æ€ã€‚å½“ B æ”¶åˆ°ç¡®è®¤åº”ç­”åï¼Œä¹Ÿä¾¿è¿›å…¥ CLOSED çŠ¶æ€ã€‚</p>
<h4 id="3-TCPåè®®çš„ç‰¹ç‚¹"><a href="#3-TCPåè®®çš„ç‰¹ç‚¹" class="headerlink" title="3. TCPåè®®çš„ç‰¹ç‚¹"></a>3. TCPåè®®çš„ç‰¹ç‚¹</h4><ul>
<li><p>é¢å‘è¿æ¥</p>
<p>é¢å‘è¿æ¥ï¼Œæ˜¯æŒ‡å‘é€æ•°æ®ä¹‹å‰å¿…é¡»åœ¨ä¸¤ç«¯å»ºç«‹è¿æ¥ã€‚å»ºç«‹è¿æ¥çš„æ–¹æ³•æ˜¯â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œè¿™æ ·èƒ½å»ºç«‹å¯é çš„è¿æ¥ã€‚å»ºç«‹è¿æ¥ï¼Œæ˜¯ä¸ºæ•°æ®çš„å¯é ä¼ è¾“æ‰“ä¸‹äº†åŸºç¡€ã€‚</p>
</li>
<li><p>ä»…æ”¯æŒå•æ’­ä¼ è¾“ </p>
</li>
</ul>
<p>æ¯æ¡TCPä¼ è¾“è¿æ¥åªèƒ½æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼Œåªèƒ½è¿›è¡Œç‚¹å¯¹ç‚¹çš„æ•°æ®ä¼ è¾“ï¼Œä¸æ”¯æŒå¤šæ’­å’Œå¹¿æ’­ä¼ è¾“æ–¹å¼ã€‚</p>
<ul>
<li>é¢å‘å­—èŠ‚æµ</li>
</ul>
<p>TCPä¸åƒUDPä¸€æ ·é‚£æ ·ä¸€ä¸ªä¸ªæŠ¥æ–‡ç‹¬ç«‹åœ°ä¼ è¾“ï¼Œè€Œæ˜¯åœ¨ä¸ä¿ç•™æŠ¥æ–‡è¾¹ç•Œçš„æƒ…å†µä¸‹ä»¥å­—èŠ‚æµæ–¹å¼è¿›è¡Œä¼ è¾“ã€‚</p>
<ul>
<li><p>å¯é ä¼ è¾“</p>
<p>å¯¹äºå¯é ä¼ è¾“ï¼Œåˆ¤æ–­ä¸¢åŒ…ï¼Œè¯¯ç é çš„æ˜¯TCPçš„æ®µç¼–å·ä»¥åŠç¡®è®¤å·ã€‚TCPä¸ºäº†ä¿è¯æŠ¥æ–‡ä¼ è¾“çš„å¯é ï¼Œå°±ç»™æ¯ä¸ªåŒ…ä¸€ä¸ªåºå·ï¼ŒåŒæ—¶åºå·ä¹Ÿä¿è¯äº†ä¼ é€åˆ°æ¥æ”¶ç«¯å®ä½“çš„åŒ…çš„æŒ‰åºæ¥æ”¶ã€‚ç„¶åæ¥æ”¶ç«¯å®ä½“å¯¹å·²æˆåŠŸæ”¶åˆ°çš„å­—èŠ‚å‘å›ä¸€ä¸ªç›¸åº”çš„ç¡®è®¤(ACK)ï¼›å¦‚æœå‘é€ç«¯å®ä½“åœ¨åˆç†çš„å¾€è¿”æ—¶å»¶(RTT)å†…æœªæ”¶åˆ°ç¡®è®¤ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®ï¼ˆå‡è®¾ä¸¢å¤±äº†ï¼‰å°†ä¼šè¢«é‡ä¼ ã€‚</p>
</li>
<li><p>æä¾›æ‹¥å¡æ§åˆ¶</p>
</li>
</ul>
<p>å½“ç½‘ç»œå‡ºç°æ‹¥å¡çš„æ—¶å€™ï¼ŒTCPèƒ½å¤Ÿå‡å°å‘ç½‘ç»œæ³¨å…¥æ•°æ®çš„é€Ÿç‡å’Œæ•°é‡ï¼Œç¼“è§£æ‹¥å¡</p>
<ul>
<li>TCPæä¾›å…¨åŒå·¥é€šä¿¡</li>
</ul>
<p>TCPå…è®¸é€šä¿¡åŒæ–¹çš„åº”ç”¨ç¨‹åºåœ¨ä»»ä½•æ—¶å€™éƒ½èƒ½å‘é€æ•°æ®ï¼Œå› ä¸ºTCPè¿æ¥çš„ä¸¤ç«¯éƒ½è®¾æœ‰ç¼“å­˜ï¼Œç”¨æ¥ä¸´æ—¶å­˜æ”¾åŒå‘é€šä¿¡çš„æ•°æ®ã€‚å½“ç„¶ï¼ŒTCPå¯ä»¥ç«‹å³å‘é€ä¸€ä¸ªæ•°æ®æ®µï¼Œä¹Ÿå¯ä»¥ç¼“å­˜ä¸€æ®µæ—¶é—´ä»¥ä¾¿ä¸€æ¬¡å‘é€æ›´å¤šçš„æ•°æ®æ®µï¼ˆæœ€å¤§çš„æ•°æ®æ®µå¤§å°å–å†³äºMSSï¼‰  </p>
<h2 id="TCPå’ŒUDPçš„æ¯”è¾ƒ"><a href="#TCPå’ŒUDPçš„æ¯”è¾ƒ" class="headerlink" title="TCPå’ŒUDPçš„æ¯”è¾ƒ"></a>TCPå’ŒUDPçš„æ¯”è¾ƒ</h2><h4 id="1-å¯¹æ¯”"><a href="#1-å¯¹æ¯”" class="headerlink" title="1. å¯¹æ¯”"></a>1. å¯¹æ¯”</h4><table>
<thead>
<tr>
<th></th>
<th>UDP</th>
<th>TCP</th>
</tr>
</thead>
<tbody><tr>
<td>æ˜¯å¦è¿æ¥</td>
<td>æ— è¿æ¥</td>
<td>é¢å‘è¿æ¥</td>
</tr>
<tr>
<td>æ˜¯å¦å¯é </td>
<td>ä¸å¯é ä¼ è¾“ï¼Œä¸ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</td>
<td>å¯é ä¼ è¾“ï¼Œä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</td>
</tr>
<tr>
<td>è¿æ¥å¯¹è±¡ä¸ªæ•°</td>
<td>æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šäº¤äº’é€šä¿¡</td>
<td>åªèƒ½æ˜¯ä¸€å¯¹ä¸€é€šä¿¡</td>
</tr>
<tr>
<td>ä¼ è¾“æ–¹å¼</td>
<td>é¢å‘æŠ¥æ–‡</td>
<td>é¢å‘å­—èŠ‚æµ</td>
</tr>
<tr>
<td>é¦–éƒ¨å¼€é”€</td>
<td>é¦–éƒ¨å¼€é”€å°ï¼Œä»…8å­—èŠ‚</td>
<td>é¦–éƒ¨æœ€å°20å­—èŠ‚ï¼Œæœ€å¤§60å­—èŠ‚</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>é€‚ç”¨äºå®æ—¶åº”ç”¨ï¼ˆIPç”µè¯ã€è§†é¢‘ä¼šè®®ã€ç›´æ’­ç­‰ï¼‰</td>
<td>é€‚ç”¨äºè¦æ±‚å¯é ä¼ è¾“çš„åº”ç”¨ï¼Œä¾‹å¦‚æ–‡ä»¶ä¼ è¾“</td>
</tr>
</tbody></table>
<h4 id="2-æ€»ç»“"><a href="#2-æ€»ç»“" class="headerlink" title="2. æ€»ç»“"></a>2. æ€»ç»“</h4><ul>
<li>TCPå‘ä¸Šå±‚æä¾›é¢å‘è¿æ¥çš„å¯é æœåŠ¡ ï¼ŒUDPå‘ä¸Šå±‚æä¾›æ— è¿æ¥ä¸å¯é æœåŠ¡ã€‚</li>
<li>è™½ç„¶ UDP å¹¶æ²¡æœ‰ TCP ä¼ è¾“æ¥çš„å‡†ç¡®ï¼Œä½†æ˜¯ä¹Ÿèƒ½åœ¨å¾ˆå¤šå®æ—¶æ€§è¦æ±‚é«˜çš„åœ°æ–¹æœ‰æ‰€ä½œä¸º</li>
<li>å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚é«˜ï¼Œé€Ÿåº¦å¯ä»¥ç›¸å¯¹è¾ƒæ…¢çš„ï¼Œå¯ä»¥é€‰ç”¨TCP</li>
</ul>
<h2 id="TCPçš„å®šæ—¶å™¨"><a href="#TCPçš„å®šæ—¶å™¨" class="headerlink" title="TCPçš„å®šæ—¶å™¨"></a>TCPçš„å®šæ—¶å™¨</h2><p><strong>é‡ä¼ å®šæ—¶å™¨</strong>ï¼šå‰æ–‡ä¸­ä¿è¯TCPå¯é ä¼ è¾“çš„è¶…æ—¶é‡ä¼ æœºåˆ¶ä½¿ç”¨çš„å®šæ—¶å™¨ï¼Œå½“å‘é€æŠ¥æ–‡åå¼€å§‹è®¡æ—¶ï¼Œè‹¥æ²¡æœ‰åœ¨å®šæ—¶å™¨ç»“æŸå‰æ”¶åˆ°ACKåŒ…ï¼Œåˆ™ä»£è¡¨æ•°æ®ä¸¢å¤±ï¼Œè¿›è¡Œé‡ä¼ ï¼Œé¿å…é™·å…¥æ— é™ç­‰å¾…ã€‚</p>
<p><strong>åšæŒå®šæ—¶å™¨</strong>ï¼šå¯¹ä»˜é›¶çª—å£é€šçŸ¥è®¾ç«‹ã€‚ä»¥æ»‘åŠ¨çª—å£ä¸ºä¾‹ï¼Œå½“ä»é›¶çª—å£æ¢å¤æ—¶ï¼Œæ¥å—ç«¯å‘é€ä¸€ä¸ªéé›¶çš„ACKåŒ…ï¼Œè€ŒACKåŒ…æ²¡æœ‰å¯¹åº”çš„å“åº”ï¼Œè‹¥æ­¤ACKåŒ…ä¸¢å¤±ï¼Œåˆ™å‘é€ç«¯ä»è®¤ä¸ºä¸ºé›¶çª—å£çŠ¶æ€ï¼Œè€Œæ¥æ”¶ç«¯ä¸ä¼šé‡æ–°å‘é€éé›¶çš„ACKåŒ…ï¼Œåˆ™é™·å…¥æ­»å¾ªç¯çŠ¶æ€ã€‚è§£å†³æ–¹æ³•å°±æ˜¯åœ¨å‘é€ç«¯ç¡®è®¤çª—å£ä¸º0æ—¶å®åŠ›è¯¥è®¡æ—¶å™¨ï¼Œè®¡æ—¶ç»“æŸå‘é€æ¢æµ‹æŠ¥æ–‡å‘ŠçŸ¥æ¥æ”¶ç«¯é‡å‘ACKåŒ…ï¼Œå¹¶æ¯ä¸ªä¸€æ®µæ—¶é—´å°†è¯¥è®¡æ—¶å™¨é‡ç½®å“¦ï¼Œç›´è‡³å‡ºç°éé›¶çª—å£ã€‚</p>
<p><strong>ä¿æ´»è®¡æ—¶å™¨</strong>ï¼šé˜²æ­¢TCPè¿æ¥å‡ºç°é•¿æ—¶é—´çš„ç©ºé—²ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºä¸¤ä¸ªå°æ—¶ã€‚å¦‚æœæŸç«¯å› ä¸ºå‡ºç°äº†æ•…éšœï¼Œä¸¤ä¸ªå°æ—¶åå¦ä¸€ç«¯å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ï¼ˆæ¯ä¸ªé—´éš”ä¸€æ®µæ—¶é—´ï¼‰æ²¡æœ‰æ”¶åˆ°å›å¤åˆ™ç›´æ¥æ–­å¼€TCPè¿æ¥ï¼Œè€Œéé€šè¿‡å››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥ã€‚</p>
<p><strong>æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨</strong>ï¼šTCPè¿æ¥æ–­å¼€æ—¶å››æ¬¡æŒ¥æ‰‹ä½¿ç”¨çš„è®¡æ—¶å™¨ã€‚å³ç­‰å¾…2MSLåå…³é—­ä¸»åŠ¨å…³é—­ä¸€ç«¯çš„è¿æ¥ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¯´UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ï¼ŒTCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¯´UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ï¼ŒTCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ï¼ŒTCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¯´UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ï¼ŒTCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Ÿ</h2><p>è¿™è¦ä»å®ƒä»¬çš„å·¥ä½œç‰¹ç‚¹æ¥è°ˆèµ·äº†ï¼š </p>
<p>UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ï¼Œå‘é€æ–¹çš„UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œä¸åˆå¹¶ï¼Œä¸æ‹†åˆ†ï¼Œåªæ˜¯åœ¨å…¶ä¸Šé¢çŸ¥åŠ ä¸Šé¦–éƒ¨åå°±äº¤ç»™äº†ä¸‹é¢çš„ç½‘ç»œå±‚ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºåº”ç”¨å±‚äº¤ç»™UDPå¤šé•¿çš„æŠ¥æ–‡é“ï¼Œå®ƒç»Ÿç»Ÿå‘é€ï¼Œä¸€æ¬¡å‘é€ä¸€ä¸ªã€‚è€Œå¯¹æ¥æ”¶æ–¹ï¼Œæ¥åˆ°åç›´æ¥å»é™¤é¦–éƒ¨ï¼Œäº¤ç»™ä¸Šé¢çš„åº”ç”¨å±‚å°±å®Œæˆä»»åŠ¡äº†ã€‚å› æ­¤ï¼Œå®ƒéœ€è¦åº”ç”¨å±‚æ§åˆ¶æŠ¥æ–‡çš„å¤§å° </p>
<p>TCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œå®ƒæŠŠä¸Šé¢åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æ•°æ®çœ‹æˆæ— ç»“æ„çš„å­—èŠ‚æµæ¥å‘é€ï¼Œå¯ä»¥æƒ³è±¡æˆæµæ°´å½¢å¼çš„ï¼Œå‘é€æ–¹TCPä¼šå°†æ•°æ®æ”¾å…¥â€œè“„æ°´æ± â€ï¼ˆå›ç¼“å­˜åŒºï¼‰ï¼Œç­‰åˆ°å¯ä»¥å‘é€çš„æ—¶å€™å°±å‘é€ï¼Œä¸èƒ½å‘é€å°±ç­‰ç€ï¼ŒTCPä¼šæ ¹æ®å½“å‰ç½‘ç»œçš„æ‹¥å¡çŠ¶æ€æ¥ç¡®å®šæ¯ä¸ªæŠ¥æ–‡æ®µçš„å¤§å°ã€‚ </p>
]]></content>
      <categories>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos7ä¸‹å®‰è£…Redis</title>
    <url>/2018/06/21/Centos7%E4%B8%8B%E5%AE%89%E8%A3%85redis/</url>
    <content><![CDATA[<h2 id="ä¸€ã€å®‰è£…redis"><a href="#ä¸€ã€å®‰è£…redis" class="headerlink" title="ä¸€ã€å®‰è£…redis"></a>ä¸€ã€å®‰è£…redis</h2><h3 id="ç¬¬ä¸€æ­¥ï¼šä¸‹è½½rediså®‰è£…åŒ…"><a href="#ç¬¬ä¸€æ­¥ï¼šä¸‹è½½rediså®‰è£…åŒ…" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šä¸‹è½½rediså®‰è£…åŒ…"></a>ç¬¬ä¸€æ­¥ï¼šä¸‹è½½rediså®‰è£…åŒ…</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis<span class="number">-4.0</span><span class="number">.6</span>.tar.gz</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 local]<span class="comment"># wget http://download.redis.io/releases/redis-4.0.6.tar.gz</span></span><br><span class="line">-<span class="number">-2017</span><span class="number">-12</span><span class="number">-13</span> <span class="number">12</span>:<span class="number">35</span>:<span class="number">12</span>--  http://download.redis.io/releases/redis<span class="number">-4.0</span><span class="number">.6</span>.tar.gz</span><br><span class="line">Resolving download.redis.io (download.redis.io)... <span class="number">109.74</span><span class="number">.203</span><span class="number">.151</span></span><br><span class="line">Connecting to download.redis.io (download.redis.io)|<span class="number">109.74</span><span class="number">.203</span><span class="number">.151</span>|:<span class="number">80.</span>.. connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line">Length: <span class="number">1723533</span> (<span class="number">1.6</span>M) [application/x-gzip]</span><br><span class="line">Saving to: â€˜redis<span class="number">-4.0</span><span class="number">.6</span>.tar.gzâ€™</span><br><span class="line"></span><br><span class="line">100%[==========================================================================================================&gt;] 1,723,533    608KB/s   in 2.8s   </span><br><span class="line"></span><br><span class="line"><span class="number">2017</span><span class="number">-12</span><span class="number">-13</span> <span class="number">12</span>:<span class="number">35</span>:<span class="number">15</span> (<span class="number">608</span> KB/s) - â€˜redis<span class="number">-4.0</span><span class="number">.6</span>.tar.gzâ€™ saved [<span class="number">1723533</span>/<span class="number">1723533</span>]</span><br></pre></td></tr></table></figure>



<h3 id="ç¬¬äºŒæ­¥ï¼šè§£å‹å‹ç¼©åŒ…"><a href="#ç¬¬äºŒæ­¥ï¼šè§£å‹å‹ç¼©åŒ…" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šè§£å‹å‹ç¼©åŒ…"></a>ç¬¬äºŒæ­¥ï¼šè§£å‹å‹ç¼©åŒ…</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tar -zxvf redis<span class="number">-4.0</span><span class="number">.6</span>.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 local]<span class="comment"># tar -zxvf redis-4.0.6.tar.gz</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰æ­¥ï¼šyumå®‰è£…gccä¾èµ–"><a href="#ç¬¬ä¸‰æ­¥ï¼šyumå®‰è£…gccä¾èµ–" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šyumå®‰è£…gccä¾èµ–"></a>ç¬¬ä¸‰æ­¥ï¼šyumå®‰è£…gccä¾èµ–</h3><p>yum install gcc</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@iZwz991stxdwj560bfmadtZ local]# yum install gcc</span><br></pre></td></tr></table></figure>

<p>é‡åˆ°é€‰æ‹©,è¾“å…¥yå³å¯</p>
<h3 id="ç¬¬å››æ­¥ï¼šè·³è½¬åˆ°redisè§£å‹ç›®å½•ä¸‹"><a href="#ç¬¬å››æ­¥ï¼šè·³è½¬åˆ°redisè§£å‹ç›®å½•ä¸‹" class="headerlink" title="ç¬¬å››æ­¥ï¼šè·³è½¬åˆ°redisè§£å‹ç›®å½•ä¸‹"></a>ç¬¬å››æ­¥ï¼šè·³è½¬åˆ°redisè§£å‹ç›®å½•ä¸‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 local]<span class="comment"># cd redis-4.0.6</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äº”æ­¥ï¼šç¼–è¯‘å®‰è£…"><a href="#ç¬¬äº”æ­¥ï¼šç¼–è¯‘å®‰è£…" class="headerlink" title="ç¬¬äº”æ­¥ï¼šç¼–è¯‘å®‰è£…"></a>ç¬¬äº”æ­¥ï¼šç¼–è¯‘å®‰è£…</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 redis<span class="number">-4.0</span><span class="number">.6</span>]<span class="comment"># make MALLOC=libc</span></span><br></pre></td></tr></table></figure>

<p>å°†/usr/local/redis-4.0.6/srcç›®å½•ä¸‹çš„æ–‡ä»¶åŠ åˆ°/usr/local/binç›®å½•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 redis<span class="number">-4.0</span><span class="number">.6</span>]<span class="comment"># cd src &amp;&amp; make install</span></span><br><span class="line">    CC Makefile.dep</span><br><span class="line"></span><br><span class="line">Hint: It<span class="string">'s a good idea to run '</span>make test<span class="string">' ;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€å¯åŠ¨redisçš„ä¸‰ç§æ–¹å¼"><a href="#äºŒã€å¯åŠ¨redisçš„ä¸‰ç§æ–¹å¼" class="headerlink" title="äºŒã€å¯åŠ¨redisçš„ä¸‰ç§æ–¹å¼"></a>äºŒã€å¯åŠ¨redisçš„ä¸‰ç§æ–¹å¼</h2><p>å…ˆåˆ‡æ¢åˆ°redis srcç›®å½•ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@iZwz991stxdwj560bfmadtZ redis<span class="number">-4.0</span><span class="number">.6</span>]<span class="comment"># cd src</span></span><br></pre></td></tr></table></figure>

<h3 id="1ã€ç›´æ¥å¯åŠ¨redis"><a href="#1ã€ç›´æ¥å¯åŠ¨redis" class="headerlink" title="1ã€ç›´æ¥å¯åŠ¨redis"></a>1ã€ç›´æ¥å¯åŠ¨redis</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 src]<span class="comment"># ./redis-server</span></span><br><span class="line"><span class="number">18685</span>:C <span class="number">13</span> Dec <span class="number">12</span>:<span class="number">56</span>:<span class="number">12.507</span> <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line"><span class="number">18685</span>:C <span class="number">13</span> Dec <span class="number">12</span>:<span class="number">56</span>:<span class="number">12.507</span> <span class="comment"># Redis version=4.0.6, bits=64, commit=00000000, modified=0, pid=18685, just started</span></span><br><span class="line"><span class="number">18685</span>:C <span class="number">13</span> Dec <span class="number">12</span>:<span class="number">56</span>:<span class="number">12.507</span> <span class="comment"># Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf</span></span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ <span class="string">''</span>-._                                             </span><br><span class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis <span class="number">4.0</span><span class="number">.6</span> (<span class="number">00000000</span>/<span class="number">0</span>) <span class="number">64</span> bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._                                   </span><br><span class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in standalone mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|'</span>` _.-<span class="string">'|     Port: 6379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-'</span>    |     PID: <span class="number">18685</span></span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |           http://redis.io        </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |                                  </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span>                                   </span><br><span class="line">      `-._    `-.__.-<span class="string">'    _.-'</span>                                       </span><br><span class="line">          `-._        _.-<span class="string">'                                           </span></span><br><span class="line"><span class="string">              `-.__.-'</span>                                               </span><br><span class="line"></span><br><span class="line"><span class="number">18685</span>:M <span class="number">13</span> Dec <span class="number">12</span>:<span class="number">56</span>:<span class="number">12.508</span> <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line"><span class="number">18685</span>:M <span class="number">13</span> Dec <span class="number">12</span>:<span class="number">56</span>:<span class="number">12.508</span> <span class="comment"># Server initialized</span></span><br><span class="line"><span class="number">18685</span>:M <span class="number">13</span> Dec <span class="number">12</span>:<span class="number">56</span>:<span class="number">12.508</span> <span class="comment"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.</span></span><br><span class="line"><span class="number">18685</span>:M <span class="number">13</span> Dec <span class="number">12</span>:<span class="number">56</span>:<span class="number">12.508</span> <span class="comment"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span></span><br><span class="line"><span class="number">18685</span>:M <span class="number">13</span> Dec <span class="number">12</span>:<span class="number">56</span>:<span class="number">12.508</span> * Ready to accept connections</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šå›¾ï¼šrediså¯åŠ¨æˆåŠŸï¼Œä½†æ˜¯è¿™ç§å¯åŠ¨æ–¹å¼éœ€è¦ä¸€ç›´æ‰“å¼€çª—å£ï¼Œä¸èƒ½è¿›è¡Œå…¶ä»–æ“ä½œï¼Œä¸å¤ªæ–¹ä¾¿ã€‚</p>
<p>æŒ‰ ctrl + cå¯ä»¥å…³é—­çª—å£ã€‚</p>
<h3 id="2ã€ä»¥åå°è¿›ç¨‹æ–¹å¼å¯åŠ¨redis"><a href="#2ã€ä»¥åå°è¿›ç¨‹æ–¹å¼å¯åŠ¨redis" class="headerlink" title="2ã€ä»¥åå°è¿›ç¨‹æ–¹å¼å¯åŠ¨redis"></a>2ã€ä»¥åå°è¿›ç¨‹æ–¹å¼å¯åŠ¨redis</h3><p>ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹redis.confæ–‡ä»¶</p>
<p>å°†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure>



<p>ä¿®æ”¹ä¸º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>

<p>ã€€</p>
<p>ç¬¬äºŒæ­¥ï¼šæŒ‡å®šredis.confæ–‡ä»¶å¯åŠ¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 src]<span class="comment"># ./redis-server /usr/local/redis-4.0.6/redis.conf </span></span><br><span class="line"><span class="number">18713</span>:C <span class="number">13</span> Dec <span class="number">13</span>:<span class="number">07</span>:<span class="number">41.109</span> <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line"><span class="number">18713</span>:C <span class="number">13</span> Dec <span class="number">13</span>:<span class="number">07</span>:<span class="number">41.109</span> <span class="comment"># Redis version=4.0.6, bits=64, commit=00000000, modified=0, pid=18713, just started</span></span><br><span class="line"><span class="number">18713</span>:C <span class="number">13</span> Dec <span class="number">13</span>:<span class="number">07</span>:<span class="number">41.109</span> <span class="comment"># Configuration loaded</span></span><br></pre></td></tr></table></figure>





<p>ç¬¬ä¸‰æ­¥ï¼šå…³é—­redisè¿›ç¨‹</p>
<p>é¦–å…ˆä½¿ç”¨ps -aux | grep redisæŸ¥çœ‹redisè¿›ç¨‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 src]<span class="comment"># ps -aux | grep redis</span></span><br><span class="line">root     18714  0.0  0.1 141752  2008 ?        Ssl  13:07   0:00 ./redis-server 127.0.0.1:6379</span><br><span class="line">root     <span class="number">18719</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">112644</span>   <span class="number">968</span> pts/<span class="number">0</span>    R+   <span class="number">13</span>:<span class="number">09</span>   <span class="number">0</span>:<span class="number">00</span> grep --color=auto redis</span><br></pre></td></tr></table></figure>



<p>ä½¿ç”¨killå‘½ä»¤æ€æ­»è¿›ç¨‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 src]<span class="comment"># kill 18714</span></span><br></pre></td></tr></table></figure>

<h3 id="3ã€è®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨"><a href="#3ã€è®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="3ã€è®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨"></a>3ã€è®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨</h3><p>1ã€åœ¨/etcç›®å½•ä¸‹æ–°å»ºredisç›®å½•</p>
<p>mkdir redis</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 etc]<span class="comment"># mkdir redis</span></span><br></pre></td></tr></table></figure>



<p>2ã€å°†/usr/local/redis-4.0.6/redis.conf æ–‡ä»¶å¤åˆ¶ä¸€ä»½åˆ°/etc/redisç›®å½•ä¸‹ï¼Œå¹¶å‘½åä¸º6379.confã€€ã€€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 redis]<span class="comment"># cp /usr/local/redis-4.0.6/redis.conf /etc/redis/6379.conf</span></span><br></pre></td></tr></table></figure>



<p>3ã€å°†redisçš„å¯åŠ¨è„šæœ¬å¤åˆ¶ä¸€ä»½æ”¾åˆ°/etc/init.dç›®å½•ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 init.d]<span class="comment"># cp /usr/local/redis-4.0.6/utils/redis_init_script /etc/init.d/redisd</span></span><br></pre></td></tr></table></figure>



<p>4ã€è®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨</p>
<p>å…ˆåˆ‡æ¢åˆ°/etc/init.dç›®å½•ä¸‹</p>
<p>ç„¶åæ‰§è¡Œè‡ªå¯å‘½ä»¤</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 init.d]<span class="comment"># chkconfig redisd on</span></span><br><span class="line">service redisd does <span class="keyword">not</span> support chkconfig</span><br></pre></td></tr></table></figure>



<p>çœ‹ç»“æœæ˜¯redisdä¸æ”¯æŒchkconfig</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>ä½¿ç”¨vimç¼–è¾‘redisdæ–‡ä»¶ï¼Œåœ¨ç¬¬ä¸€è¡ŒåŠ å…¥å¦‚ä¸‹ä¸¤è¡Œæ³¨é‡Šï¼Œä¿å­˜é€€å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># chkconfig:   2345 90 10</span></span><br><span class="line"><span class="comment"># description:  Redis is a persistent key-value database</span></span><br></pre></td></tr></table></figure>

<p>æ³¨é‡Šçš„æ„æ€æ˜¯ï¼ŒredisæœåŠ¡å¿…é¡»åœ¨è¿è¡Œçº§2ï¼Œ3ï¼Œ4ï¼Œ5ä¸‹è¢«å¯åŠ¨æˆ–å…³é—­ï¼Œå¯åŠ¨çš„ä¼˜å…ˆçº§æ˜¯90ï¼Œå…³é—­çš„ä¼˜å…ˆçº§æ˜¯10ã€‚</p>
 <img src="/2018/06/21/Centos7%E4%B8%8B%E5%AE%89%E8%A3%85redis/818973-20171213132912738-1132742812.png" class="">  



<p>å†æ¬¡æ‰§è¡Œå¼€æœºè‡ªå¯å‘½ä»¤ï¼ŒæˆåŠŸ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 init.d]<span class="comment"># chkconfig redisd on</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¯ä»¥ç›´æ¥å·²æœåŠ¡çš„å½¢å¼å¯åŠ¨å’Œå…³é—­redisäº† </p>
<p>å¯åŠ¨ï¼š</p>
<p>service redisd startã€€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># service redisd start</span></span><br><span class="line">Starting Redis server...</span><br><span class="line"><span class="number">2288</span>:C <span class="number">13</span> Dec <span class="number">13</span>:<span class="number">51</span>:<span class="number">38.087</span> <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line"><span class="number">2288</span>:C <span class="number">13</span> Dec <span class="number">13</span>:<span class="number">51</span>:<span class="number">38.087</span> <span class="comment"># Redis version=4.0.6, bits=64, commit=00000000, modified=0, pid=2288, just started</span></span><br><span class="line"><span class="number">2288</span>:C <span class="number">13</span> Dec <span class="number">13</span>:<span class="number">51</span>:<span class="number">38.087</span> <span class="comment"># Configuration loaded</span></span><br></pre></td></tr></table></figure>

<p>å…³é—­ï¼š</p>
<p>æ–¹æ³•1ï¼šservice redisd stop</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># service redisd stop</span></span><br><span class="line">Stopping ...</span><br><span class="line">Redis stopped</span><br></pre></td></tr></table></figure>



<p>æ–¹æ³•2ï¼šredis-cli SHUTDOWN</p>
<h2 id="ä¸‰ã€å‚è€ƒèµ„æ–™"><a href="#ä¸‰ã€å‚è€ƒèµ„æ–™" class="headerlink" title="ä¸‰ã€å‚è€ƒèµ„æ–™"></a>ä¸‰ã€å‚è€ƒèµ„æ–™</h2><p>å¦‚æœå‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># service redisd start</span></span><br><span class="line">/var/run/redis_6379.pid exists, process <span class="keyword">is</span> already running <span class="keyword">or</span> crashed</span><br></pre></td></tr></table></figure>

<p>ç§‘å­¦çš„å¤„ç†åŠæ³•2ç§</p>
<p>1ï¼šå¯ç”¨å®‰è£…æ–‡ä»¶å¯åŠ¨     redis-server /etc/redis/6379.conf</p>
<p>2ï¼šshutdown -r now è½¯é‡å¯è®©ç³»ç»Ÿè‡ªåŠ¨æ¢å¤ä¸‹å°±è¡Œäº†</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos7ä¸‹å®‰è£…MySQL</title>
    <url>/2018/06/20/Centos7%E4%B8%8B%E5%AE%89%E8%A3%85MySQL/</url>
    <content><![CDATA[<p>é¦–å…ˆå‡†å¤‡ä¸€å°Centos7çš„æœåŠ¡å™¨</p>
<h3 id="1ã€ä¸‹è½½å¹¶å®‰è£…MySQLå®˜æ–¹çš„-Yum-Repository"><a href="#1ã€ä¸‹è½½å¹¶å®‰è£…MySQLå®˜æ–¹çš„-Yum-Repository" class="headerlink" title="1ã€ä¸‹è½½å¹¶å®‰è£…MySQLå®˜æ–¹çš„ Yum Repository"></a>1ã€ä¸‹è½½å¹¶å®‰è£…MySQLå®˜æ–¹çš„ Yum Repository</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># wget -i -c http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæç¤ºwgetå‘½ä»¤ä¸å­˜åœ¨ï¼Œå…ˆæ‰§è¡Œ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">yum -y install wget</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤å°±ç›´æ¥ä¸‹è½½äº†å®‰è£…ç”¨çš„Yum Repositoryï¼Œå¤§æ¦‚25KBçš„æ ·å­ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥yumå®‰è£…äº†ã€‚ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># yum -y install mysql57-community-release-el7-10.noarch.rpm</span></span><br></pre></td></tr></table></figure>



<p>ä¹‹åå°±å¼€å§‹å®‰è£…MySQLæœåŠ¡å™¨ã€‚ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># yum -y install mysql-community-server</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ­¥å¯èƒ½ä¼šèŠ±äº›æ—¶é—´ï¼Œå®‰è£…å®Œæˆåå°±ä¼šè¦†ç›–æ‰ä¹‹å‰çš„mariadbã€‚ </p>
  

<p>è‡³æ­¤MySQLå°±å®‰è£…å®Œæˆäº†ï¼Œç„¶åæ˜¯å¯¹MySQLçš„ä¸€äº›è®¾ç½®ã€‚ </p>
<h3 id="2ã€MySQLæ•°æ®åº“è®¾ç½®"><a href="#2ã€MySQLæ•°æ®åº“è®¾ç½®" class="headerlink" title="2ã€MySQLæ•°æ®åº“è®¾ç½®"></a>2ã€MySQLæ•°æ®åº“è®¾ç½®</h3><p>é¦–å…ˆå¯åŠ¨MySQL </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># systemctl start  mysqld.service</span></span><br></pre></td></tr></table></figure>

<p>  æŸ¥çœ‹MySQLè¿è¡ŒçŠ¶æ€ï¼Œè¿è¡ŒçŠ¶æ€å¦‚å›¾ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># systemctl status mysqld.service</span></span><br></pre></td></tr></table></figure>

  

<p>æ­¤æ—¶MySQLå·²ç»å¼€å§‹æ­£å¸¸è¿è¡Œï¼Œä¸è¿‡è¦æƒ³è¿›å…¥MySQLè¿˜å¾—å…ˆæ‰¾å‡ºæ­¤æ—¶rootç”¨æˆ·çš„å¯†ç ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥åœ¨æ—¥å¿—æ–‡ä»¶ä¸­æ‰¾å‡ºå¯†ç ï¼š </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># grep "password" /var/log/mysqld.log</span></span><br></pre></td></tr></table></figure>

 

<p> å¦‚ä¸‹å‘½ä»¤è¿›å…¥æ•°æ®åº“ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mysql -uroot -p</span></span><br></pre></td></tr></table></figure>

<p>  è¾“å…¥åˆå§‹å¯†ç ï¼Œæ­¤æ—¶ä¸èƒ½åšä»»ä½•äº‹æƒ…ï¼Œå› ä¸ºMySQLé»˜è®¤å¿…é¡»ä¿®æ”¹å¯†ç ä¹‹åæ‰èƒ½æ“ä½œæ•°æ®åº“ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mysql&gt; ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'new password'</span>;</span><br></pre></td></tr></table></figure>

<p>  è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œæ–°å¯†ç è®¾ç½®çš„æ—¶å€™å¦‚æœè®¾ç½®çš„è¿‡äºç®€å•ä¼šæŠ¥é”™ï¼š</p>
 

<p>åŸå› æ˜¯å› ä¸ºMySQLæœ‰å¯†ç è®¾ç½®çš„è§„èŒƒï¼Œå…·ä½“æ˜¯ä¸validate_password_policyçš„å€¼æœ‰å…³ï¼š </p>
 

<p>  MySQLå®Œæ•´çš„åˆå§‹å¯†ç è§„åˆ™å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="string">'validate_password%'</span>;</span><br><span class="line">+--------------------------------------+-------+</span><br><span class="line">| Variable_name                        | Value |</span><br><span class="line">+--------------------------------------+-------+</span><br><span class="line">| validate_password_check_user_name    | OFF   |</span><br><span class="line">| validate_password_dictionary_file    |       |</span><br><span class="line">| validate_password_length             | <span class="number">4</span>     |</span><br><span class="line">| validate_password_mixed_case_count   | <span class="number">1</span>     |</span><br><span class="line">| validate_password_number_count       | <span class="number">1</span>     |</span><br><span class="line">| validate_password_policy             | LOW   |</span><br><span class="line">| validate_password_special_char_count | <span class="number">1</span>     |</span><br><span class="line">+--------------------------------------+-------+</span><br><span class="line"><span class="number">7</span> rows <span class="keyword">in</span> set (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<p>å¯†ç çš„é•¿åº¦æ˜¯ç”±validate_password_lengthå†³å®šçš„ï¼Œè€Œvalidate_password_lengthçš„è®¡ç®—å…¬å¼æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">validate_password_length = validate_password_number_count + validate_password_special_char_count + (<span class="number">2</span> * validate_password_mixed_case_count)</span><br></pre></td></tr></table></figure>



<p>æˆ‘çš„æ˜¯å·²ç»ä¿®æ”¹è¿‡çš„ï¼Œåˆå§‹æƒ…å†µä¸‹ç¬¬ä¸€ä¸ªçš„å€¼æ˜¯ONï¼Œvalidate_password_lengthæ˜¯8ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ä¿®æ”¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mysql&gt; set <span class="keyword">global</span> validate_password_policy=<span class="number">0</span>;</span><br><span class="line">mysql&gt; set <span class="keyword">global</span> validate_password_length=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>  è®¾ç½®ä¹‹åå°±æ˜¯æˆ‘ä¸Šé¢æŸ¥å‡ºæ¥çš„é‚£å‡ ä¸ªå€¼äº†ï¼Œæ­¤æ—¶å¯†ç å°±å¯ä»¥è®¾ç½®çš„å¾ˆç®€å•ï¼Œä¾‹å¦‚1234ä¹‹ç±»çš„ã€‚åˆ°æ­¤æ•°æ®åº“çš„å¯†ç è®¾ç½®å°±å®Œæˆäº†ã€‚</p>
<p>  ä½†æ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å› ä¸ºå®‰è£…äº†Yum Repositoryï¼Œä»¥åæ¯æ¬¡yumæ“ä½œéƒ½ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œéœ€è¦æŠŠè¿™ä¸ªå¸è½½æ‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># yum -y remove mysql57-community-release-el7-10.noarch</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸»ä»å¤åˆ¶</title>
    <url>/2018/06/18/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
    <content><![CDATA[<h2 id="MySQLä¸»ä»å¤åˆ¶åŸç†å›¾"><a href="#MySQLä¸»ä»å¤åˆ¶åŸç†å›¾" class="headerlink" title="MySQLä¸»ä»å¤åˆ¶åŸç†å›¾"></a>MySQLä¸»ä»å¤åˆ¶åŸç†å›¾</h2><img src="/2018/06/18/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/20190529071516_23557.png" class="">  

<a id="more"></a>

<h2 id="MySQLä¸»ä»å¤åˆ¶åŸç†"><a href="#MySQLä¸»ä»å¤åˆ¶åŸç†" class="headerlink" title="MySQLä¸»ä»å¤åˆ¶åŸç†"></a>MySQLä¸»ä»å¤åˆ¶åŸç†</h2><p>åˆ©ç”¨æ•°æ®åº“<strong>bin-log</strong>äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æœ‰æ•°æ®åº“æ“ä½œçš„æ‰€æœ‰SQLè¯­å¥</p>
<p>å¤åˆ¶è¯¥æ–‡ä»¶è‡³å…¶ä½™æ•°æ®åº“æœåŠ¡ä¸­å¹¶æ‰§è¡Œå³å¯</p>
<h2 id="MySQLä¸»ä»å¤åˆ¶è¿‡ç¨‹"><a href="#MySQLä¸»ä»å¤åˆ¶è¿‡ç¨‹" class="headerlink" title="MySQLä¸»ä»å¤åˆ¶è¿‡ç¨‹"></a>MySQLä¸»ä»å¤åˆ¶è¿‡ç¨‹</h2><p>1ã€MySQLçš„ä¸»ä»å¤åˆ¶æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å¤åˆ¶è¿‡ç¨‹ï¼ˆè™½ç„¶ä¸€èˆ¬æƒ…å†µä¸‹æ„Ÿè§‰æ˜¯å®æ—¶çš„ï¼‰ï¼Œæ•°æ®å°†ä»ä¸€ä¸ªMySQLæ•°æ®åº“ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºMasterï¼‰å¤åˆ¶åˆ°å¦ä¸€ä¸ªMySQLæ•°æ®åº“ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºSlaveï¼‰ï¼Œåœ¨Masterä¸Salveä¹‹é—´å®ç°æ•´ä¸ªä¸»ä»å¤åˆ¶çš„è¿‡ç¨‹æ˜¯ç”±ä¸‰ä¸ªçº¿ç¨‹å‚ä¸å®Œæˆçš„ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼ˆSQLçº¿ç¨‹å’ŒIOçº¿ç¨‹ï¼‰åœ¨Slaveç«¯ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ï¼ˆI/Oçº¿ç¨‹ï¼‰åœ¨Masterç«¯ã€‚</p>
<p>2ã€è¦å®ç°MySQLçš„ä¸»ä»å¤åˆ¶ï¼Œé¦–å…ˆå¿…é¡»æ‰“å¼€Masterç«¯çš„binlogè®°å½•åŠŸèƒ½ï¼Œå¦åˆ™å°±æ— æ³•å®ç°ã€‚å› ä¸ºæ•´ä¸ªå¤åˆ¶è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯Slaveä»Masterç«¯è·å–binlogæ—¥å¿—ï¼Œç„¶åå†åœ¨Slaveä¸Šä»¥ç›¸åŒé¡ºåºæ‰§è¡Œè·å–çš„binlogæ—¥å¿—ä¸­æ‰€è®°å½•çš„å„ç§SQLæ“ä½œã€‚æ³¨æ„binlogæ—¥å¿—åªè®°å½•å¢åˆ æ”¹ï¼ˆä¸è®°å½•æŸ¥è¯¢è¯­å¥ï¼‰</p>
<p>3ã€ä»åº“IOåœ¨ç¬¬ä¸€æ¬¡æŠŠä¿¡æ¯æ”¾å…¥åˆ°relayä¸­åä¼šè§¦å‘SQLçº¿ç¨‹ï¼Œç„¶ååè¾¹å°±äº¤ç»™SQLçº¿ç¨‹æ¥å¤„ç†ï¼ŒæŠŠbinlogæ–‡ä»¶ä¸­çš„SQLè¯­å¥è§£æå‡ºæ¥åå˜æˆSQLè¯­å¥æ”¾å…¥æ•°æ®åº“ä¸­</p>
<h2 id="ä¸ºä»€ä¹ˆè¦æ­å»ºä¸»ä»å¤åˆ¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æ­å»ºä¸»ä»å¤åˆ¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ­å»ºä¸»ä»å¤åˆ¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æ­å»ºä¸»ä»å¤åˆ¶ï¼Ÿ</h2><ol>
<li>æ„å»ºä¸»ä»çƒ­å¤‡ï¼Œå½“æŸå¤©æ•°æ®åº“å®•æœºæˆ–æˆ–æ•°æ®ä¸¢å¤±æƒ…å†µï¼Œå¯ä»¥æœ‰å¤‡ä»½æ•°æ®åº“ç»§ç»­å·¥ä½œ</li>
<li>é™ä½IOé¢‘æ¬¡ï¼Œå¤šåº“ä¹‹é—´å¯ä»¥åˆç†åˆ†é…è¯»å†™å‹åŠ›ï¼Œæé«˜å•ä¸ªæ•°æ®åº“æœåŠ¡çš„æ•°æ®åº“è®¿é—®å‹åŠ›</li>
<li>éš”ç¦»è¯»å†™ï¼Œåœ¨æŸäº›é”è¡¨æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿æ•°æ®åº“è¯»æ“ä½œç»§ç»­è¿›è¡Œ</li>
</ol>
<h2 id="é…ç½®MySQLä¸»ä»å¤åˆ¶"><a href="#é…ç½®MySQLä¸»ä»å¤åˆ¶" class="headerlink" title="é…ç½®MySQLä¸»ä»å¤åˆ¶"></a>é…ç½®MySQLä¸»ä»å¤åˆ¶</h2><p>é¦–å…ˆå‡†å¤‡ä¸¤å°Centos7çš„æœåŠ¡å™¨ï¼Œä¸€å°ä½œä¸ºä¸»æœº(master)ï¼Œä¸€å°ä½œä¸ºä»æœº(slave)ï¼Œéƒ½å®‰è£…å¥½mysql5.7ï¼Œå…·ä½“æ€æ ·å®‰è£…mysqlæœåŠ¡è¯·ç§»æ­¥ï¼š <a href="http://obsessed.top/2019/08/17/MySQLå®‰è£…ä¸åŸºæœ¬é…ç½®">http://obsessed.top/2019/08/17/MySQLå®‰è£…ä¸åŸºæœ¬é…ç½®</a></p>
<p>è¿›å…¥masteræœåŠ¡å™¨</p>
<p>ä¿®æ”¹mysqlé…ç½®æ–‡ä»¶ vim /etc/my.cnfï¼ŒåŠ å…¥å¦‚ä¸‹é…ç½®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">server-id=<span class="number">1</span></span><br><span class="line">innodb_flush_log_at_trx_commit=<span class="number">2</span></span><br><span class="line">sync_binlog=<span class="number">1</span></span><br><span class="line">log-bin=mysql-bin<span class="number">-1</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®è¯´æ˜ï¼š </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®ä¸»æœåŠ¡ çš„ID (idå¯ä»¥è‡ªå·±éšä¾¿è®¾ç½®ä½†æ˜¯è¦ä¿è¯å’Œslaveçš„idä¸ä¸€æ ·)</span></span><br><span class="line">server-id=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ä¸º1å½“ç„¶æ˜¯æœ€å®‰å…¨çš„ï¼Œä½†æ€§èƒ½ä¹Ÿæ˜¯æœ€å·®çš„ï¼ˆç›¸å¯¹å…¶ä»–ä¸¤ä¸ªå‚æ•°è€Œè¨€ï¼Œä½†ä¸æ˜¯ä¸èƒ½æ¥å—ï¼‰ã€‚å¦‚æœå¯¹æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§è¦æ±‚ä¸é«˜ï¼Œå®Œå…¨å¯ä»¥è®¾ä¸º2ï¼Œå¦‚æœåªæœ€æ±‚æ€§èƒ½ï¼Œä¾‹å¦‚é«˜å¹¶å‘å†™çš„æ—¥å¿—æœåŠ¡å™¨ï¼Œè®¾ä¸º0æ¥è·å¾—æ›´é«˜æ€§èƒ½</span></span><br><span class="line">innodb_flush_log_at_trx_commit=<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€å¯binlog å¿—åŒæ­¥åŠŸèƒ½</span></span><br><span class="line">sync_binlog=<span class="number">1</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#binlog æ—¥å¿—æ–‡ä»¶å</span></span><br><span class="line">log-bin=mysql-bin<span class="number">-200</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªè¡¨ç¤ºåªåŒæ­¥æŸä¸ªåº“ (å¦‚æœæ²¡æœ‰æ­¤é¡¹ï¼Œè¡¨ç¤ºåŒæ­¥æ‰€æœ‰çš„åº“)</span></span><br><span class="line">binlog-do-db=xxxx</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜åï¼Œé‡å¯mysql</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure>





<p>è¿›å…¥mysqlå‘½ä»¤è¡Œ mysql -uroot -pä½ çš„å¯†ç  </p>
<p>è¾“å…¥æˆæƒå‘½ä»¤ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">GRANT REPLICATION SLAVE ON *.* to <span class="string">'repl'</span>@<span class="string">'%'</span> identified by <span class="string">'Admin123!'</span>;</span><br></pre></td></tr></table></figure>

<p>æ„æ€æ˜¯æ‰€æœ‰slaveéƒ½å¯ä»¥é€šè¿‡è´¦å·replå’Œå¯†ç Admin123!æ¥åŒæ­¥masterçš„æ•°æ® </p>
<p>ç„¶åæŸ¥çœ‹masterçš„çŠ¶æ€ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>

<img src="/2018/06/18/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/2019052222.png" class="">  

<p>æŠŠfileåˆ—å’ŒPositionåˆ—è®°å½•ä¸‹æ¥ï¼Œä¸€ä¼šé…ç½®slaveè¦ç”¨åˆ° </p>
<p>æ­¤æ—¶Masterçš„é…ç½®å·²ç»æå®šï¼Œç™»å½•ä¸€ä¸‹ä»æœº(slave) </p>
<p>åŒç†ä¿®æ”¹slaveæœåŠ¡å™¨çš„mysqlé…ç½® vim /etc/my.cnf åŠ å…¥ä¸‹é¢çš„é…ç½®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯server-idä¸è¦å’Œmasterä¸€æ · </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">server-id=<span class="number">201</span> </span><br><span class="line">innodb_flush_log_at_trx_commit=<span class="number">2</span> </span><br><span class="line">sync_binlog=<span class="number">1</span> </span><br><span class="line">log-bin=mysql-bin<span class="number">-201</span></span><br></pre></td></tr></table></figure>

<p>ä¿å­˜åé‡å¯æœåŠ¡</p>
<p>è¿›å…¥mysqlå‘½ä»¤è¡Œ mysql -uroot -pä½ çš„å¯†ç </p>
<p>è¾“å…¥å‘½ä»¤ï¼š </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">change master to master_host=<span class="string">'39.106.228.179'</span>,master_user=<span class="string">'repl'</span> ,master_password=<span class="string">'Admin123!'</span>, master_log_file=<span class="string">'mysql-bin-1.000016'</span> ,master_log_pos=<span class="number">154</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">å‘½ä»¤è¯´æ˜ï¼š</span><br><span class="line"></span><br><span class="line">master_host: ä¸»æœºçš„ip</span><br><span class="line"></span><br><span class="line">master_user : ä¸»æœºæˆæƒçš„ç”¨æˆ·.</span><br><span class="line"></span><br><span class="line">master_password : ä¸»æœºæˆæƒæ—¶å€™å¡«å†™çš„å¯†ç </span><br><span class="line"></span><br><span class="line">master_log_file : ä¸»æœºshow master status;ä¸­çš„File</span><br><span class="line"></span><br><span class="line">master_log_pos: ä¸»æœºshow master status;ä¸­çš„Position.</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥å‘½ä»¤å¯åŠ¨slave </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æŸ¥çœ‹slaveçš„çŠ¶æ€: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">show slave status G;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æµ‹è¯•ä¸€ä¸‹å¯¹masterè¿›è¡Œå†™å…¥ï¼Œçœ‹çœ‹salveæ˜¯å¦å¯ä»¥åŒæ­¥æ•°æ®äº† </p>
<p>MySQLçš„ä¸»ä»å¤åˆ¶åŠŸèƒ½æœ‰ä¸€å®šçš„å»¶è¿Ÿæ€§ï¼Œå¦‚æœå¯¹æ•°æ®å®æ—¶ä¸€è‡´æ€§çš„è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ä¸æ¨èä½¿ç”¨ã€‚ </p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLæ•°æ®åº“æ­»é”</title>
    <url>/2018/05/26/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E6%AD%BB%E9%94%81/</url>
    <content><![CDATA[<h2 id="MySQLæ•°æ®åº“æ­»é”çš„äº§ç”ŸåŸå› åŠè§£å†³åŠæ³•"><a href="#MySQLæ•°æ®åº“æ­»é”çš„äº§ç”ŸåŸå› åŠè§£å†³åŠæ³•" class="headerlink" title="MySQLæ•°æ®åº“æ­»é”çš„äº§ç”ŸåŸå› åŠè§£å†³åŠæ³•"></a>MySQLæ•°æ®åº“æ­»é”çš„äº§ç”ŸåŸå› åŠè§£å†³åŠæ³•</h2><p>åœ¨æ•°æ®åº“ä¸­æœ‰ä¸¤ç§åŸºæœ¬çš„é”ç±»å‹ï¼šæ’å®ƒé”ï¼ˆExclusive Locksï¼Œå³Xé”ï¼‰å’Œå…±äº«é”ï¼ˆShare Locksï¼Œå³Sé”ï¼‰ã€‚å½“æ•°æ®å¯¹è±¡è¢«åŠ ä¸Šæ’å®ƒé”æ—¶ï¼Œå…¶ä»–çš„äº‹åŠ¡ä¸èƒ½å¯¹å®ƒè¯»å–å’Œä¿®æ”¹ã€‚åŠ äº†å…±äº«é”çš„æ•°æ®å¯¹è±¡å¯ä»¥è¢«å…¶ä»–äº‹åŠ¡è¯»å–ï¼Œä½†ä¸èƒ½ä¿®æ”¹ã€‚æ•°æ®åº“åˆ©ç”¨è¿™ä¸¤ ç§åŸºæœ¬çš„é”ç±»å‹æ¥å¯¹æ•°æ®åº“çš„äº‹åŠ¡è¿›è¡Œå¹¶å‘æ§åˆ¶ã€‚ </p>
<a id="more"></a>

<h4 id="æ­»é”çš„ç¬¬ä¸€ç§æƒ…å†µ"><a href="#æ­»é”çš„ç¬¬ä¸€ç§æƒ…å†µ" class="headerlink" title="æ­»é”çš„ç¬¬ä¸€ç§æƒ…å†µ"></a><strong>æ­»é”çš„ç¬¬ä¸€ç§æƒ…å†µ</strong></h4><p>ä¸€ä¸ªç”¨æˆ·A è®¿é—®è¡¨A(é”ä½äº†è¡¨A),ç„¶ååˆè®¿é—®è¡¨Bï¼›å¦ä¸€ä¸ªç”¨æˆ·B è®¿é—®è¡¨B(é”ä½äº†è¡¨B)ï¼Œç„¶åä¼å›¾è®¿é—®è¡¨Aï¼›è¿™æ—¶ç”¨æˆ·Aç”±äºç”¨æˆ·Bå·²ç»é”ä½è¡¨Bï¼Œå®ƒå¿…é¡»ç­‰å¾…ç”¨æˆ·Bé‡Šæ”¾è¡¨Bæ‰èƒ½ç»§ç»­ï¼ŒåŒæ ·ç”¨æˆ·Bè¦ç­‰ç”¨æˆ·Aé‡Šæ”¾è¡¨Aæ‰èƒ½ç»§ç»­ï¼Œè¿™å°±æ­»é”å°±äº§ç”Ÿäº†ã€‚</p>
<h4 id="æ­»é”çš„ç¬¬äºŒç§æƒ…å†µ"><a href="#æ­»é”çš„ç¬¬äºŒç§æƒ…å†µ" class="headerlink" title="æ­»é”çš„ç¬¬äºŒç§æƒ…å†µ"></a><strong>æ­»é”çš„ç¬¬äºŒç§æƒ…å†µ</strong></h4><p>ç”¨æˆ·AæŸ¥è¯¢ä¸€æ¡çºªå½•ï¼Œç„¶åä¿®æ”¹è¯¥æ¡çºªå½•ï¼›è¿™æ—¶ç”¨æˆ·Bä¿®æ”¹è¯¥æ¡çºªå½•ï¼Œè¿™æ—¶ç”¨æˆ·Açš„äº‹åŠ¡é‡Œé”çš„æ€§è´¨ç”±æŸ¥è¯¢çš„å…±äº«é”ä¼å›¾ä¸Šå‡åˆ°ç‹¬å é”ï¼Œè€Œç”¨æˆ·Bé‡Œçš„ç‹¬å é”ç”±äºA æœ‰å…±äº«é”å­˜åœ¨æ‰€ä»¥å¿…é¡»ç­‰Aé‡Šæ”¾æ‰å…±äº«é”ï¼Œè€ŒAç”±äºBçš„ç‹¬å é”è€Œæ— æ³•ä¸Šå‡çš„ç‹¬å é”ä¹Ÿå°±ä¸å¯èƒ½é‡Šæ”¾å…±äº«é”ï¼Œäºæ˜¯å‡ºç°äº†æ­»é”ã€‚è¿™ç§æ­»é”æ¯”è¾ƒéšè”½ï¼Œä½†åœ¨ç¨å¤§ç‚¹çš„é¡¹ ç›®ä¸­ç»å¸¸å‘ç”Ÿã€‚å¦‚åœ¨æŸé¡¹ç›®ä¸­ï¼Œé¡µé¢ä¸Šçš„æŒ‰é’®ç‚¹å‡»åï¼Œæ²¡æœ‰ä½¿æŒ‰é’®ç«‹åˆ»å¤±æ•ˆï¼Œä½¿å¾—ç”¨æˆ·ä¼šå¤šæ¬¡å¿«é€Ÿç‚¹å‡»åŒä¸€æŒ‰é’®ï¼Œè¿™æ ·åŒä¸€æ®µä»£ç å¯¹æ•°æ®åº“åŒä¸€æ¡è®°å½•è¿›è¡Œå¤šæ¬¡æ“ ä½œï¼Œå¾ˆå®¹æ˜“å°±å‡ºç°è¿™ç§æ­»é”çš„æƒ…å†µã€‚</p>
<h4 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h4><p>1ã€å¯¹äºæŒ‰é’®ç­‰æ§ä»¶ï¼Œç‚¹å‡»åä½¿å…¶ç«‹åˆ»å¤±æ•ˆï¼Œä¸è®©ç”¨æˆ·é‡å¤ç‚¹å‡»ï¼Œé¿å…åŒæ—¶å¯¹åŒä¸€æ¡è®°å½•æ“ä½œã€‚ </p>
<p>2.ä½¿ç”¨ä¹è§‚é”è¿›è¡Œæ§åˆ¶ã€‚ ä¹è§‚é”è®¤ä¸ºæ•°æ®ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ä¸ä¼šåŠ é”ï¼Œä½†æ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶ä¼šå¯¹æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥æ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œåˆ™è¿›è¡Œæ›´æ–°ï¼Œå¦åˆ™ä¸è¿›è¡Œæ›´æ–° </p>
<p>3ã€ä½¿ç”¨æ‚²è§‚é”è¿›è¡Œæ§åˆ¶ ã€‚å¦‚æœé‡‡ç”¨æ‚²è§‚é”æœºåˆ¶ï¼Œä¹Ÿå°±æ„å‘³ç€æ•´ä¸ªæ“ä½œè¿‡ç¨‹ä¸­ï¼Œæ•°æ®åº“è®°å½•å§‹ç»ˆå¤„äºåŠ é”çŠ¶æ€ï¼Œå¦‚æœé¢å¯¹æˆç™¾ä¸Šåƒä¸ªå¹¶å‘ï¼Œè¿™æ ·çš„æƒ…å†µå°†å¯¼è‡´ç¾éš¾æ€§çš„åæœã€‚æ‰€ä»¥ï¼Œé‡‡ç”¨æ‚²è§‚é”è¿›è¡Œæ§åˆ¶æ—¶ä¸€å®šè¦è€ƒè™‘æ¸…æ¥š </p>
<h3 id="å¦‚ä½•å®ç°ä¹è§‚é”"><a href="#å¦‚ä½•å®ç°ä¹è§‚é”" class="headerlink" title="å¦‚ä½•å®ç°ä¹è§‚é”"></a>å¦‚ä½•å®ç°ä¹è§‚é”</h3><h4 id="æ–¹å¼1ï¼šç‰ˆæœ¬å·æœºåˆ¶"><a href="#æ–¹å¼1ï¼šç‰ˆæœ¬å·æœºåˆ¶" class="headerlink" title="æ–¹å¼1ï¼šç‰ˆæœ¬å·æœºåˆ¶"></a>æ–¹å¼1ï¼šç‰ˆæœ¬å·æœºåˆ¶</h4><p>ç»™è¡¨å¢åŠ ä¸€ä¸ª <code>version</code> ç‰ˆæœ¬å·å­—æ®µï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¯»å–æ•°æ®æ—¶ï¼Œå°†æ•°æ®çš„ç‰ˆæœ¬å·æ•°æ®ä¸€åŒè¯»å‡ºï¼›</li>
<li>æ•°æ®æ¯æ¬¡å‘ç”Ÿæ›´æ–°æ—¶ï¼Œå°†ç‰ˆæœ¬å·åŠ  1ï¼›</li>
<li>æäº¤æ•°æ®æ—¶ï¼Œå°†å½“å‰ç‰ˆæœ¬å·ä¸ä¹‹å‰è¯»å‡ºçš„ç‰ˆæœ¬å·è¿›è¡Œå¯¹æ¯”ã€‚è‹¥ç›¸åŒï¼Œåˆ™æ›´æ–°ï¼›å¦åˆ™ï¼Œæ›´æ–°å¤±è´¥ã€‚</li>
</ul>
<h4 id="æ–¹å¼2ï¼šè®°å½•æ—¶é—´æˆ³"><a href="#æ–¹å¼2ï¼šè®°å½•æ—¶é—´æˆ³" class="headerlink" title="æ–¹å¼2ï¼šè®°å½•æ—¶é—´æˆ³"></a>æ–¹å¼2ï¼šè®°å½•æ—¶é—´æˆ³</h4><p>åŸç†ä¸æ–¹å¼ä¸€ç›¸åŒï¼Œç»™è¡¨å¢åŠ ä¸€ä¸ªè®°å½•æ“ä½œçš„æ—¶é—´æˆ³å­—æ®µï¼Œå½“å‘ç”Ÿæ•°æ®æ›´æ–°æ—¶ï¼Œå°†å½“å‰æ—¶é—´æˆ³ä¸æ›´æ–°å‰è·å–çš„æ—¶é—´æˆ³è¿›è¡Œå¯¹æ¯”ï¼Œè‹¥ç›¸åŒï¼Œåˆ™å…è®¸æ›´æ–°ï¼Œä¸”åŒæ—¶æ›´æ–°æ“ä½œæ—¶é—´æˆ³å­—æ®µï¼Œå¦åˆ™æ›´æ–°å¤±è´¥ã€‚</p>
<h4 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h4><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul>
<li>ä¸ä¼šå‘ç”Ÿä»»ä½•é”å’Œæ­»é”</li>
<li>å¯å¢åŠ ååé‡</li>
<li>é¿å…äº†é•¿äº‹åŠ¡ä¸­çš„æ•°æ®åº“åŠ é”å¼€é”€</li>
</ul>
<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><p>å¯¹äºå†™å¤šçš„åœºæ™¯å¹¶ä¸é€‚ç”¨ï¼Œå› ä¸ºå½“å†™æ“ä½œéå¸¸é¢‘ç¹æ—¶ï¼Œæ›´æ–°å¤±è´¥çš„å‡ ç‡å°±è¶Šå¤§ï¼Œä¸Šå±‚é€»è¾‘è¿›è¡Œretryçš„æ¬¡æ•°ä¹Ÿä¼šå¢å¤šï¼Œä»è€Œé™ä½äº†ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>DRFæ¡†æ¶æä¾›æ ‡å‡†RESTful APIæ¥å£</title>
    <url>/2018/04/24/DRF%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E6%A0%87%E5%87%86RESTfulAPI%E6%8E%A5%E5%8F%A3/</url>
    <content><![CDATA[<h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯RESTful"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯RESTful" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯RESTful"></a>ä¸€ã€ä»€ä¹ˆæ˜¯RESTful</h2><p>RESTfulä¸æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§æ¥å£è§„èŒƒï¼Œä¸»è¦è§„èŒƒåŒ…æ‹¬ï¼š1.è¯·æ±‚æ–¹å¼ã€2.çŠ¶æ€ç ã€3ã€urlè§„èŒƒã€4ã€ä¼ å‚è§„èŒƒ</p>
<ul>
<li>è¯·æ±‚æ–¹å¼method<ul>
<li>GET      ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼ˆä¸€é¡¹æˆ–å¤šé¡¹ï¼‰</li>
<li>POST    ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æº</li>
<li>PUT      ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰</li>
<li>PATCH  ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜çš„å±æ€§ï¼‰</li>
<li>DELETE ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æº</li>
</ul>
</li>
</ul>
<p>â€‹    <a id="more"></a></p>
<ul>
<li><strong>çŠ¶æ€ç </strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'''1. 2XXè¯·æ±‚æˆåŠŸ'''</span></span><br><span class="line"><span class="comment"># 200 è¯·æ±‚æˆåŠŸï¼Œä¸€èˆ¬ç”¨äºGETä¸POSTè¯·æ±‚</span></span><br><span class="line"><span class="comment"># 201 Created - [POST/PUT/PATCH]ï¼šç”¨æˆ·æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚</span></span><br><span class="line"><span class="comment"># 202 Accepted - [*]ï¼šè¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å·²ç»è¿›å…¥åå°æ’é˜Ÿï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰</span></span><br><span class="line"><span class="comment"># 204 NO CONTENT - [DELETE]ï¼šç”¨æˆ·åˆ é™¤æ•°æ®æˆåŠŸã€‚</span></span><br><span class="line"><span class="string">'''2. 3XXé‡å®šå‘'''</span></span><br><span class="line"><span class="comment"># 301 NO CONTENT - æ°¸ä¹…é‡å®šå‘</span></span><br><span class="line"><span class="comment"># 302 NO CONTENT - ä¸´æ—¶é‡å®šå‘</span></span><br><span class="line"><span class="string">'''3. 4XXå®¢æˆ·ç«¯é”™è¯¯'''</span></span><br><span class="line"><span class="comment"># 400 INVALID REQUEST - [POST/PUT/PATCH]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ã€‚</span></span><br><span class="line"><span class="comment"># 401 Unauthorized - [*]ï¼šè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># 403 Forbidden - [*] è¡¨ç¤ºç”¨æˆ·å¾—åˆ°æˆæƒï¼ˆä¸401é”™è¯¯ç›¸å¯¹ï¼‰ï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚</span></span><br><span class="line"><span class="comment"># 404 NOT FOUND - [*]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ã€‚</span></span><br><span class="line"><span class="comment"># 406 Not Acceptable - [GET]ï¼šç”¨æˆ·è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ï¼ˆæ¯”å¦‚ç”¨æˆ·è¯·æ±‚JSONæ ¼å¼ï¼Œä½†æ˜¯åªæœ‰XMLæ ¼å¼ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># 410 Gone -[GET]ï¼šç”¨æˆ·è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚</span></span><br><span class="line"><span class="comment"># 422 Unprocesable entity - [POST/PUT/PATCH] å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚</span></span><br><span class="line"><span class="string">'''4. 5XXæœåŠ¡ç«¯é”™è¯¯'''</span></span><br><span class="line"><span class="comment"># 500 INTERNAL SERVER ERROR - [*]ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</span></span><br><span class="line"><span class="comment"># 501 Not Implemented     æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„åŠŸèƒ½ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</span></span><br></pre></td></tr></table></figure>

<ul>
<li>é¢å‘èµ„æºç¼–ç¨‹ï¼š è·¯å¾„ï¼Œè§†ç½‘ç»œä¸Šä»»ä½•ä¸œè¥¿éƒ½æ˜¯èµ„æºï¼Œå‡ä½¿ç”¨åè¯è¡¨ç¤ºï¼ˆå¯å¤æ•°ï¼‰<ul>
<li>æ‰€æœ‰è¯·æ±‚å®é™…æ“ä½œçš„éƒ½æ˜¯æ•°æ®åº“ä¸­çš„è¡¨ï¼Œæ¯ä¸€ä¸ªè¡¨å½“åšä¸€ä¸ªèµ„æº</li>
<li>èµ„æºæ˜¯ä¸€ä¸ªåç§°ï¼Œæ‰€ä»¥RESTfulè§„èŒƒä¸­URLåªèƒ½æœ‰åç§°æˆ–åè¯çš„å¤æ•°å½¢å¼</li>
</ul>
</li>
</ul>
<h2 id="äºŒã€djangoçš„DRF"><a href="#äºŒã€djangoçš„DRF" class="headerlink" title="äºŒã€djangoçš„DRF"></a>äºŒã€djangoçš„DRF</h2><h3 id="1ã€è®¤è¯å’Œæƒé™"><a href="#1ã€è®¤è¯å’Œæƒé™" class="headerlink" title="1ã€è®¤è¯å’Œæƒé™"></a>1ã€è®¤è¯å’Œæƒé™</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoViewSet</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    authentication_classes = [authentication.IsAuthenticated,]  <span class="comment"># ç”¨æˆ·è®¤è¯æ¨¡å—</span></span><br><span class="line">    permission_classes = (authentication.IsOwnerOrReadOnly,)    <span class="comment"># ç”¨æˆ·æˆæƒæ¨¡å—</span></span><br></pre></td></tr></table></figure>

<p>urls.pyï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,re_path,include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    re_path(<span class="string">r'users/'</span>,include((<span class="string">'users.urls'</span>, <span class="string">'users'</span>), namespace=<span class="string">'users'</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>users/urls.pyï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,re_path,include</span><br><span class="line"><span class="keyword">from</span> users <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r'info'</span>, views.UserInfoViewSet.as_view(), name=<span class="string">'user'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>users/views.pyï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> common.auth <span class="keyword">import</span> authentication</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoViewSet</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    authentication_classes = [authentication.IsAuthenticated,]</span><br><span class="line">    permission_classes = (authentication.IsOwnerOrReadOnly,)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(UserInfoViewSet, self).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        result = &#123;</span><br><span class="line">            <span class="string">'status'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'data'</span>: <span class="string">'response data'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(result, status=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        result = &#123;</span><br><span class="line">            <span class="string">'status'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'data'</span>: <span class="string">'response data'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(result, status=<span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<p>comm\auth\authentiication.pyï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> authentication</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> exceptions</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IsOwnerOrReadOnly</span><span class="params">(permissions.BasePermission)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:  <span class="comment"># è¿™é‡Œæš‚ä¸”ä¸è¿›è¡Œæƒé™éªŒè¯</span></span><br><span class="line">            <span class="keyword">raise</span> exceptions.ParseError(<span class="string">'æ‚¨æ²¡æœ‰æ“ä½œçš„æƒé™'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IsAuthenticated</span><span class="params">(authentication.BaseAuthentication)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        auth = request.META.get(<span class="string">'HTTP_AUTHORIZATION'</span>, <span class="literal">None</span>)  <span class="comment"># è·å– headerä¸­çš„ Authorization</span></span><br><span class="line">        <span class="keyword">if</span> auth <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> exceptions.NotAuthenticated()</span><br><span class="line"></span><br><span class="line">        <span class="string">'''è¿™é‡Œåº”è¯¥æ˜¯éªŒè¯tokenæ˜¯å¦åˆæ³•é€»è¾‘'''</span></span><br><span class="line">        <span class="comment"># token = Token.objects.filter(key=auth)</span></span><br><span class="line">        <span class="comment"># try:</span></span><br><span class="line">        <span class="comment">#     request.user = token[0].user</span></span><br><span class="line">        <span class="comment"># except IndexError:</span></span><br><span class="line">        <span class="comment">#     raise exceptions.NotAuthenticated('Invalid input Authenticated')</span></span><br><span class="line">        <span class="keyword">return</span> (request, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate_header</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        msg = <span class="string">'Invalid token.Please get token first'</span></span><br><span class="line">        <span class="keyword">return</span> exceptions.NotAuthenticated(msg)</span><br></pre></td></tr></table></figure>



<h3 id="2ã€åºåˆ—åŒ–"><a href="#2ã€åºåˆ—åŒ–" class="headerlink" title="2ã€åºåˆ—åŒ–"></a>2ã€åºåˆ—åŒ–</h3><p>users/model.pyï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br><span class="line">    ut = models.ForeignKey(to=<span class="string">'UserType'</span>, on_delete=models.CASCADE)</span><br><span class="line">    gp = models.ManyToManyField(to=<span class="string">'UserGroup'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserType</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    type_name = models.CharField(max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.type_name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserGroup</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    group = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.group</span><br></pre></td></tr></table></figure>

<p>users/serializers.pyï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> users.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    name = serializers.CharField(min_length=<span class="number">3</span>,max_length=<span class="number">20</span>)                <span class="comment"># æ˜¾ç¤ºæ™®é€šå­—æ®µ</span></span><br><span class="line">    ut_id = serializers.IntegerField(write_only=<span class="literal">True</span>)                      <span class="comment"># å¤–é”®çº¦æŸï¼Œå…³è”å­—æ®µè¦å®šä¹‰</span></span><br><span class="line">    ut = serializers.CharField(source=<span class="string">'ut.type_name'</span>,required=<span class="literal">False</span>)      <span class="comment"># æ˜¾ç¤ºä¸€å¯¹å¤šå­—æ®µåç§°</span></span><br><span class="line">    gp = serializers.SerializerMethodField(read_only=<span class="literal">True</span>)                 <span class="comment"># è‡ªå®šä¹‰æ˜¾ç¤ºï¼ˆæ˜¾ç¤ºå¤šå¯¹å¤šï¼‰</span></span><br><span class="line">    xxx = serializers.CharField(source=<span class="string">'name'</span>,required=<span class="literal">False</span>)              <span class="comment"># ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ˜¾ç¤ºå­—æ®µåç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'''PrimaryKeyRelatedFieldå’ŒStringRelatedFieldï¼šå¯ä»¥ç”¨å¯¹ ä¸€å¯¹å¤š å’Œ å¤šå¯¹å¤š å…³è”å¯¹è±¡åºåˆ—åŒ–'''</span></span><br><span class="line">    <span class="comment"># gp = serializers.PrimaryKeyRelatedField(read_only=True, many=True)</span></span><br><span class="line">    <span class="comment"># gp = serializers.StringRelatedField(read_only=True,many=True)</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰æ˜¾ç¤º å¤šå¯¹å¤š å­—æ®µ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_gp</span><span class="params">(self,row)</span>:</span></span><br><span class="line">        <span class="string">'''row: ä¼ è¿‡æ¥çš„æ­£æ˜¯ UserInfoè¡¨çš„å¯¹è±¡'''</span></span><br><span class="line">        gp_obj_list = row.gp.all().values(<span class="string">'id'</span>,<span class="string">'group'</span>)  <span class="comment"># è·å–ç”¨æˆ·æ‰€æœ‰ç»„</span></span><br><span class="line">        <span class="keyword">return</span> gp_obj_list</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰åˆ›å»ºè¯­æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, validated_data)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> UserInfo.objects.create(**validated_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰æ›´æ–°æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, instance, validated_data)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> validated_data.get(<span class="string">'name'</span>):</span><br><span class="line">            instance.name = validated_data[<span class="string">'name'</span>]</span><br><span class="line">        <span class="keyword">if</span> validated_data.get(<span class="string">'ut_id'</span>):</span><br><span class="line">            instance.ut_id = validated_data[<span class="string">'ut_id'</span>]</span><br><span class="line">        instance.save()</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰å•ä¸€å­—æ®µéªŒè¯çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_name</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value == <span class="string">'root'</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">'ä¸èƒ½åˆ›å»ºrootç®¡ç†å‘˜è´¦å·'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰å¤šå­—æ®µéªŒè¯æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, attrs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> attrs[<span class="string">'name'</span>] == <span class="string">'admin'</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">'ä¸èƒ½åˆ›å»ºadminç”¨æˆ·'</span>)</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€å¯¹å¤šåºåˆ—åŒ–ï¼ˆåå‘æŸ¥æ‰¾ï¼‰</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTypeSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    type_name = serializers.CharField()</span><br><span class="line">    <span class="comment"># æ³•1ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šæ­¤å­—æ®µå°†è¢«åºåˆ—åŒ–ä¸ºå…³è”å¯¹è±¡çš„ä¸»é”®</span></span><br><span class="line">    userinfo_set = serializers.PrimaryKeyRelatedField(read_only=<span class="literal">True</span>, many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ³•2ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šæ­¤å­—æ®µå°†è¢«åºåˆ—åŒ–ä¸ºå…³è”å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ï¼ˆå³__str__æ–¹æ³•çš„è¿”å›å€¼ï¼‰</span></span><br><span class="line">    <span class="comment"># userinfo_set = serializers.StringRelatedField(read_only=True,many=True)</span></span><br><span class="line">    <span class="comment"># æ³•3ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šä½¿ç”¨å…³è”å¯¹è±¡çš„åºåˆ—åŒ–å™¨</span></span><br><span class="line">    <span class="comment"># userinfo_set = UserInfoSerializer(many=True)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šå¯¹å¤šåºåˆ—åŒ–ï¼ˆåå‘ï¼‰</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserGroupSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    group = serializers.CharField()</span><br><span class="line">    <span class="comment"># æ³•1ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šæ­¤å­—æ®µå°†è¢«åºåˆ—åŒ–ä¸ºå…³è”å¯¹è±¡çš„ä¸»é”®</span></span><br><span class="line">    <span class="comment"># userinfo_set = serializers.PrimaryKeyRelatedField(read_only=True, many=True)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ³•2ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šæ­¤å­—æ®µå°†è¢«åºåˆ—åŒ–ä¸ºå…³è”å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ï¼ˆå³__str__æ–¹æ³•çš„è¿”å›å€¼ï¼‰</span></span><br><span class="line">    <span class="comment"># userinfo_set = serializers.StringRelatedField(read_only=True,many=True)</span></span><br><span class="line">    <span class="comment"># æ³•3ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šä½¿ç”¨å…³è”å¯¹è±¡çš„åºåˆ—åŒ–å™¨</span></span><br><span class="line">    <span class="comment"># userinfo_set = UserInfoSerializer(many=True)</span></span><br></pre></td></tr></table></figure>

<p><strong>åºåˆ—åŒ–ï¼ˆæ­£å‘æŸ¥æ‰¾ï¼‰</strong> </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> users.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    name = serializers.CharField(min_length=<span class="number">3</span>,max_length=<span class="number">20</span>)               <span class="comment"># æ˜¾ç¤ºæ™®é€šå­—æ®µ</span></span><br><span class="line">    ut = serializers.CharField(source=<span class="string">'ut.type_name'</span>,required=<span class="literal">False</span>)       <span class="comment"># æ˜¾ç¤ºä¸€å¯¹å¤šå­—æ®µåç§°</span></span><br><span class="line">    gp = serializers.SerializerMethodField(read_only=<span class="literal">True</span>)                 <span class="comment"># è‡ªå®šä¹‰æ˜¾ç¤ºï¼ˆæ˜¾ç¤ºå¤šå¯¹å¤šï¼‰</span></span><br><span class="line">    xxx = serializers.CharField(source=<span class="string">'name'</span>,required=<span class="literal">False</span>)              <span class="comment"># ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ˜¾ç¤ºå­—æ®µåç§°</span></span><br><span class="line">    ut_id = serializers.IntegerField(write_only=<span class="literal">True</span>)                      <span class="comment"># ä¸€å¯¹å¤šå…³è”å­—æ®µå®šä¹‰(å¤–é”®çº¦æŸ)</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'''PrimaryKeyRelatedFieldå’ŒStringRelatedFieldï¼šå¯ä»¥ç”¨å¯¹ ä¸€å¯¹å¤š å’Œ å¤šå¯¹å¤š å…³è”å¯¹è±¡åºåˆ—åŒ–'''</span></span><br><span class="line">    <span class="comment"># gp = serializers.PrimaryKeyRelatedField(read_only=True, many=True)</span></span><br><span class="line">    <span class="comment"># gp = serializers.StringRelatedField(read_only=True,many=True)</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰æ˜¾ç¤º å¤šå¯¹å¤š å­—æ®µ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_gp</span><span class="params">(self,row)</span>:</span></span><br><span class="line">        <span class="string">'''row: ä¼ è¿‡æ¥çš„æ­£æ˜¯ UserInfoè¡¨çš„å¯¹è±¡'''</span></span><br><span class="line">        gp_obj_list = row.gp.all().values(<span class="string">'id'</span>,<span class="string">'group'</span>)  <span class="comment"># è·å–ç”¨æˆ·æ‰€æœ‰ç»„</span></span><br><span class="line">        <span class="keyword">return</span> gp_obj_list</span><br></pre></td></tr></table></figure>

<p><strong>åºåˆ—åŒ–ï¼ˆåå‘æŸ¥æ‰¾ï¼‰</strong> </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTypeSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    type_name = serializers.CharField()</span><br><span class="line">    <span class="comment"># æ³•1ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šæ­¤å­—æ®µå°†è¢«åºåˆ—åŒ–ä¸ºå…³è”å¯¹è±¡çš„ä¸»é”®</span></span><br><span class="line">    userinfo_set = serializers.PrimaryKeyRelatedField(read_only=<span class="literal">True</span>, many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ³•2ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šæ­¤å­—æ®µå°†è¢«åºåˆ—åŒ–ä¸ºå…³è”å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ï¼ˆå³__str__æ–¹æ³•çš„è¿”å›å€¼ï¼‰</span></span><br><span class="line">    <span class="comment"># userinfo_set = serializers.StringRelatedField(read_only=True,many=True)</span></span><br><span class="line">    <span class="comment"># æ³•3ä¸€å¯¹å¤šå…³è”å¯¹è±¡åºåˆ—åŒ–ï¼šä½¿ç”¨å…³è”å¯¹è±¡çš„åºåˆ—åŒ–å™¨</span></span><br><span class="line">    <span class="comment"># userinfo_set = UserInfoSerializer(many=True)</span></span><br></pre></td></tr></table></figure>

<p><strong>è§†å›¾å‡½æ•°ä¸­ä½¿ç”¨åºåˆ—åŒ–</strong> </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoViewSet</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># ä¸€å¯¹å¤šã€å¤šå¯¹å¤šæŸ¥è¯¢éƒ½æ˜¯ä¸€æ ·çš„è¯­æ³•</span></span><br><span class="line">        obj = users_model.UserInfo.objects.all()</span><br><span class="line">        ser = serializers.UserInfoSerializer(instance=obj,many=<span class="literal">True</span>)  <span class="comment"># å…³è”æ•°æ®å¤šæ¡</span></span><br><span class="line">        <span class="comment"># ser = serializers.UserInfoSerializer(instance=obj[0])       # å…³è”æ•°æ®ä¸€æ¡</span></span><br><span class="line">        <span class="keyword">return</span> Response(ser.data, status=<span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ååºåˆ—åŒ–ä¿å­˜æ•°æ®</strong> </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'''åˆ›å»ºç”¨æˆ·'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">    ser = serializers.UserInfoSerializer(data=request.data)</span><br><span class="line">    <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">        ser.save()</span><br><span class="line">        <span class="keyword">return</span> Response(data=ser.data, status=<span class="number">201</span>)</span><br><span class="line">    <span class="keyword">return</span> Response(data=ser.errors,status=<span class="number">400</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3ã€ç‰ˆæœ¬å·"><a href="#3ã€ç‰ˆæœ¬å·" class="headerlink" title="3ã€ç‰ˆæœ¬å·"></a>3ã€ç‰ˆæœ¬å·</h3><h3 id="4ã€é™æµ"><a href="#4ã€é™æµ" class="headerlink" title="4ã€é™æµ"></a>4ã€é™æµ</h3>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäº Django çš„åå°ç®¡ç†å¹³å°ï¼Œé‡‡ç”¨ RBAC æƒé™ç®¡ç†æœºåˆ¶</title>
    <url>/2018/04/22/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h2 id="ä¸€ã€RBACæ¦‚è¿°"><a href="#ä¸€ã€RBACæ¦‚è¿°" class="headerlink" title="ä¸€ã€RBACæ¦‚è¿°"></a>ä¸€ã€RBACæ¦‚è¿°</h2><p>RBAC(Role-Based Access Control,åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶)ï¼Œé€šè¿‡è§’è‰²ç»‘å®šæƒé™ï¼Œç„¶åç»™ç”¨æˆ·åˆ’åˆ†è§’è‰²ã€‚</p>
<p>ä»ä¼ä¸šçš„è§’åº¦æ¥è¯´ï¼ŒåŸºæœ¬ä¸Šæ˜¯æŒ‰ç…§è§’è‰²æ¥åˆ’åˆ†èŒèƒ½ã€‚æ¯”å¦‚ï¼ŒCEOï¼Œå…·æœ‰å…¬å¸å…¨å±€çš„æƒé™ï¼›éƒ¨é—¨ç»ç†ï¼Œå…·æœ‰éƒ¨é—¨å…¨å±€çš„æƒé™ï¼›éƒ¨é—¨ä¸»ç®¡ï¼Œå…·æœ‰éƒ¨é—¨éƒ¨åˆ†çš„æƒé™ï¼›æ™®é€šå‘˜å·¥ï¼Œå…·æœ‰éƒ¨é—¨ä¸€å°éƒ¨åˆ†æƒé™ã€‚</p>
<p>ä¸åŒçš„è§’è‰²ï¼Œèƒ½å¤Ÿè·å–çš„èµ„æºæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥RBACå°±æ˜¯æŒ‰ç…§è¿™ä¸ªæ€ç»´ä¸ºå…¬å¸å»ºè®¾æƒé™ç³»ç»Ÿã€‚</p>
<p>è§’è‰²çš„å¼•å…¥ï¼Œè®©æƒé™ç®¡ç†éå¸¸çµæ´»ã€‚</p>
<p>ä¾‹å¦‚ï¼šæŸä¸ªå‘˜å·¥è¦ç¦»èŒäº†ï¼Œæ›¿æ¢ä»–çš„æ˜¯ä¸€ä¸ªæ–°å‘˜å·¥ï¼Œè¿™æ—¶ä½ éœ€è¦ä¸€ä¸€çš„å‘Šè¯‰è¯¥æ–°å‘˜å·¥ä»–åº”è¯¥åšä»€ä¹ˆï¼Œä»–ä¸èƒ½åšä»€ä¹ˆï¼Œå½“å·¥ä½œé¡¹éå¸¸å¤šçš„æ—¶å€™ï¼Œè¿™å°†æ˜¯éå¸¸ç¹ççš„è¿‡ç¨‹ï¼Œä¸”éå¸¸å®¹æ˜“å‡ºé”™ã€‚å¦‚æœä½ æŠŠè¿™ä¸ªèŒä½å®šä¹‰ä¸ºæŸä¸ªè§’è‰²ï¼Œä¸”ä¸ºè¿™ä¸ªè§’è‰²åˆ†é…å›ºå®šçš„æƒé™ï¼Œä¸ç®¡æ¥å¤šå°‘æ–°äººï¼Œä¸ç®¡ä»€ä¹ˆèŒä½ï¼Œåªè¦ä»–å¯¹å·å…¥åº§ï¼Œæƒé™è‡ªç„¶å°±æ ¹æ®è§’è‰²åˆ†é…å¥½ã€‚å½“æ–°å‘˜å·¥å‡èŒåï¼Œæ¯”å¦‚å‡èŒæˆä¸»ç®¡æˆ–ç»ç†ï¼Œä½ è¿™æ—¶åªæ˜¯è§’è‰²å˜æ¢ï¼Œæƒé™è‡ªåŠ¨åˆ†é…ç»™ä»–ã€‚</p>
<a id="more"></a>

<h2 id="äºŒã€æµç¨‹å›¾"><a href="#äºŒã€æµç¨‹å›¾" class="headerlink" title="äºŒã€æµç¨‹å›¾"></a>äºŒã€æµç¨‹å›¾</h2><p><strong><img src="/2018/04/22/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6/462684-20190129231355786-1268233138.png" class="" title="This is an test image"></strong> </p>
<p>1ã€äººå‘˜å±äºæŸä¸ªè§’è‰²ï¼Œé¦–å…ˆç»™ä»–åˆ†é…è§’è‰²ï¼Œä¾‹å¦‚ï¼šæ€»ç›‘ã€ç»ç†ã€ä¸»ç®¡ã€åŠ©ç†ç­‰ï¼›</p>
<p>2ã€äººå‘˜èµ‹äºˆè§’è‰²åï¼Œåˆ™ç»™ä»–åˆ†é…æƒé™ï¼Œä¸åŒçš„è§’è‰²ï¼Œè§„å®šæœ‰ä¸åŒçš„æƒé™ã€‚æ¯”å¦‚ï¼šæ€»ç›‘çº§åˆ«ï¼Œèƒ½å¤Ÿå¢åˆ æ”¹æŸ¥ï¼Œæ— æ‰€ä¸èƒ½ï¼›è€Œç»ç†çº§åˆ«ï¼Œåªèƒ½å¢æ”¹æŸ¥ï¼Œå¦‚æœéœ€è¦åˆ é™¤ï¼Œåˆ™éœ€è¦æ€»ç›‘å®¡æ‰¹ï¼›ä¸»ç®¡åªæœ‰å¢åŠ å’ŒæŸ¥çœ‹ï¼Œä¿®æ”¹éœ€è¦å‘ç»ç†ç”³è¯·ï¼Œè®©ç»ç†å®¡æ‰¹ã€‚</p>
<p>3ã€ä¸åŒçš„æƒé™ï¼Œå®é™…ä¸Šæ˜¯å¯¹åº”æ•°æ®åº“ä¸­çš„æŸå¼ è¡¨ï¼Œä¹Ÿå°±æ˜¯Djangoä¸­çš„æŸä¸ªmodelã€‚</p>
<h2 id="ä¸‰ã€å®ç°è¿‡ç¨‹"><a href="#ä¸‰ã€å®ç°è¿‡ç¨‹" class="headerlink" title="ä¸‰ã€å®ç°è¿‡ç¨‹"></a>ä¸‰ã€å®ç°è¿‡ç¨‹</h2><p><strong><img src="/2018/04/22/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6/462684-20190129231837693-35611593.png" class="" title="This is an test image"></strong> </p>
<p>1ã€äººå‘˜ç™»å½•åï¼Œå…ˆéªŒè¯ç”¨æˆ·æ˜¯å¦OKï¼›</p>
<p>2ã€éªŒè¯ç”¨æˆ·OKåï¼Œåˆ™æ ¹æ®äººå‘˜å±äºä»€ä¹ˆè§’è‰²ï¼Œè¿›è¡Œæƒé™è·å–ï¼Œå¹¶å†™å…¥sessionä¸­ï¼›</p>
<p>3ã€ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œè¿›å…¥indexé¡µé¢ï¼Œåˆ™æ ¹æ®ç”¨æˆ·sessionä¸­çš„æƒé™ï¼Œå±•ç¤ºä¸åŒçš„é¡µé¢ï¼Œæ­£æ‰€è°“ï¼šåƒäººåƒé¢ï¼›</p>
<p>4ã€ç”¨æˆ·æ ¹æ®ä¸åŒçš„é¡µé¢ï¼Œè¿›è¡Œä¸åŒçš„æ“ä½œã€‚</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Paginatoråˆ†é¡µå™¨</title>
    <url>/2018/04/10/Paginator%E5%88%86%E9%A1%B5%E5%99%A8/</url>
    <content><![CDATA[<h3 id="Paginatoråˆ†é¡µç»„ä»¶"><a href="#Paginatoråˆ†é¡µç»„ä»¶" class="headerlink" title="Paginatoråˆ†é¡µç»„ä»¶"></a>Paginatoråˆ†é¡µç»„ä»¶</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</span><br></pre></td></tr></table></figure>
 <a id="more"></a>
<ul>
<li><h3 id="åˆ†é¡µå¯¹è±¡å†…ç½®å±æ€§"><a href="#åˆ†é¡µå¯¹è±¡å†…ç½®å±æ€§" class="headerlink" title="åˆ†é¡µå¯¹è±¡å†…ç½®å±æ€§"></a>åˆ†é¡µå¯¹è±¡å†…ç½®å±æ€§</h3></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">all_ &#x3D; models.objects.all()</span><br><span class="line">p &#x3D; Paginator(all_, 10)</span><br><span class="line"># åˆ†é¡µall_æ•°æ®ï¼Œæ¯é¡µæ˜¾ç¤º10æ¡æ•°æ®</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p.count # æ€»æ•°æ®é‡</span><br><span class="line">p.num_pages() # åˆ†é¡µæ•°</span><br><span class="line">p.page_range() # åˆ—è¡¨å½¢å¼è¿”å›å½“å‰å¯æœ‰çš„é¡µæ•° [1,2,3]</span><br><span class="line">page_1 &#x3D; p.page(1) # é€‰æ‹©ç¬¬ä¸€é¡µï¼Œè¿”å›ç¬¬ä¸€é¡µæ•°æ®å¯¹è±¡</span><br><span class="line">page_1.object_list # è¿”å›ç¬¬ä¸€é¡µæ‰€æœ‰æ•°æ®</span><br><span class="line">for var in page_1:</span><br><span class="line">    print(var)</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br><span class="line">...</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¯¼å…¥djangoçš„Paginator</span></span><br><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pagi</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,requests)</span>:</span></span><br><span class="line">        index = requests.GET.get(<span class="string">'page'</span>)</span><br><span class="line">        course = Course.objects.all()</span><br><span class="line">        pages = Paginator(course,<span class="number">2</span>)         <span class="comment">#å®ä¾‹åŒ–åˆ†é¡µå™¨</span></span><br><span class="line">        pages_index = pages.page(index)</span><br><span class="line">        res = &#123;&#125;</span><br><span class="line">        res[<span class="string">'total'</span>] = pages.count</span><br><span class="line">        res[<span class="string">'size'</span>] = <span class="number">2</span></span><br><span class="line">        <span class="comment">#åºåˆ—åŒ–è¿”å›Jsonæ•°æ®</span></span><br><span class="line">        res[<span class="string">'data'</span>] = CourseSer(pages_index,many=<span class="literal">True</span>).data</span><br><span class="line">        <span class="keyword">return</span> Response(res)</span><br></pre></td></tr></table></figure>











]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django</title>
    <url>/2018/04/08/Django/</url>
    <content><![CDATA[<h2 id="å¦‚ä½•ä½¿ç”¨ImageFieldä¸Šä¼ å›¾ç‰‡"><a href="#å¦‚ä½•ä½¿ç”¨ImageFieldä¸Šä¼ å›¾ç‰‡" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ImageFieldä¸Šä¼ å›¾ç‰‡"></a>å¦‚ä½•ä½¿ç”¨ImageFieldä¸Šä¼ å›¾ç‰‡</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">#models</span></span><br><span class="line">img = models.ImageField(verbose_name=<span class="string">'æè¿°å›¾ç‰‡'</span>,upload_to=<span class="string">'media'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#settings</span></span><br><span class="line">MEDIA_URL = <span class="string">'/media/'</span></span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR,<span class="string">'media'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®°å¾—formè¡¨å•å†™enctype</span></span><br><span class="line">&lt;form action=<span class="string">""</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt; </span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<a id="more"></a>


<h2 id="é…ç½®è·¨åŸŸ"><a href="#é…ç½®è·¨åŸŸ" class="headerlink" title="é…ç½®è·¨åŸŸ"></a>é…ç½®è·¨åŸŸ</h2><h3 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'corsheaders.middleware.CorsMiddleware'</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 'django.middleware.csrf.CsrfViewMiddleware',</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span></span><br></pre></td></tr></table></figure>







<h2 id="Django-é…ç½®MySQLæ•°æ®åº“"><a href="#Django-é…ç½®MySQLæ•°æ®åº“" class="headerlink" title="Django é…ç½®MySQLæ•°æ®åº“"></a>Django é…ç½®MySQLæ•°æ®åº“</h2><h3 id="åœ¨settings-pyä¸­é…ç½®"><a href="#åœ¨settings-pyä¸­é…ç½®" class="headerlink" title="åœ¨settings.pyä¸­é…ç½®"></a>åœ¨settings.pyä¸­é…ç½®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import pymysqlã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€# é…ç½®MySQL</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line">DATABASES &#x3D; &#123;</span><br><span class="line">    &#39;default&#39;: &#123;</span><br><span class="line">        &#39;ENGINE&#39;: &#39;django.db.backends.mysql&#39;,   # æ•°æ®åº“å¼•æ“</span><br><span class="line">        &#39;NAME&#39;: &#39;django&#39;,         # ä½ è¦å­˜å‚¨æ•°æ®çš„åº“åï¼Œäº‹å…ˆè¦åˆ›å»ºä¹‹</span><br><span class="line">        &#39;USER&#39;: &#39;root&#39;,         # æ•°æ®åº“ç”¨æˆ·å</span><br><span class="line">        &#39;PASSWORD&#39;: &#39;&#39;,     # å¯†ç </span><br><span class="line">        &#39;HOST&#39;: &#39;localhost&#39;,    # ä¸»æœº</span><br><span class="line">        &#39;PORT&#39;: &#39;3306&#39;,         # æ•°æ®åº“ä½¿ç”¨çš„ç«¯å£</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®åº“ç»“æ„è¿ç§»"><a href="#æ•°æ®åº“ç»“æ„è¿ç§»" class="headerlink" title="æ•°æ®åº“ç»“æ„è¿ç§»"></a>æ•°æ®åº“ç»“æ„è¿ç§»</h3><p>Python3ä¸æ”¯æŒMySQLdbï¼Œå¯ç”¨pymysqlä»£æ›¿ã€‚</p>
<p>1.é¦–å…ˆï¼Œåœ¨Pythonè™šæ‹Ÿç¯å¢ƒä¸‹å®‰è£…pymysqlï¼špip install pymysqlã€‚</p>
<p>2.ç„¶åï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„<em>init</em>.pyï¼ˆå®é™…ä¸Šä¹Ÿå¯ä»¥æ·»åŠ åˆ°settings.pyä¸­ï¼Œå¦‚ä¸Šã€‚ï¼‰æ·»åŠ å¦‚ä¸‹ä»£ç å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<p>3.å†è€…ï¼Œåœ¨Terminalä¸­æ‰§è¡Œæ•°æ®åº“è¿ç§»å‘½ä»¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>






<h2 id="å¯†ç åŠ å¯†"><a href="#å¯†ç åŠ å¯†" class="headerlink" title="å¯†ç åŠ å¯†"></a>å¯†ç åŠ å¯†</h2><h4 id="md5åŠ å¯†"><a href="#md5åŠ å¯†" class="headerlink" title="md5åŠ å¯†"></a>md5åŠ å¯†</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">form hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_md5</span><span class="params">(str_)</span>:</span></span><br><span class="line">    m = md5()</span><br><span class="line">    m.update(str_)</span><br><span class="line">    <span class="keyword">return</span> m.hexdigest()</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">password = get_md5(str(password).encode())</span><br></pre></td></tr></table></figure>

<h4 id="hexdigestå’Œdigestçš„åŒºåˆ«"><a href="#hexdigestå’Œdigestçš„åŒºåˆ«" class="headerlink" title="hexdigestå’Œdigestçš„åŒºåˆ«"></a>hexdigestå’Œdigestçš„åŒºåˆ«</h4><p>hexdigestç”Ÿæˆåå…­è¿›åˆ¶çš„md5å€¼,digestç”ŸæˆäºŒè¿›åˆ¶çš„md5å€¼</p>
<h3 id="djangoè‡ªå¸¦çš„hashers"><a href="#djangoè‡ªå¸¦çš„hashers" class="headerlink" title="djangoè‡ªå¸¦çš„hashers"></a>djangoè‡ªå¸¦çš„hashers</h3><h4 id="å¼•å…¥æ¨¡å—"><a href="#å¼•å…¥æ¨¡å—" class="headerlink" title="å¼•å…¥æ¨¡å—"></a>å¼•å…¥æ¨¡å—</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.hashers <span class="keyword">import</span> make_password,check_password</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡åŠ å¯†ç”Ÿæˆçš„å¯†ç éƒ½ä¸ä¸€æ ·ï¼Œæ‰€æœ‰éœ€è¦ä½¿ç”¨check_passwordæ¥è¿›è¡Œè§£å¯†</p>
<h4 id="åŠ å¯†andè§£å¯†"><a href="#åŠ å¯†andè§£å¯†" class="headerlink" title="åŠ å¯†andè§£å¯†"></a>åŠ å¯†andè§£å¯†</h4><p>åŠ å¯†              make_password(password)</p>
<p>è§£å¯†           check_password(å¯†æ–‡,æ˜æ–‡)</p>
<h2 id="djangoè¿æ¥MySQLæ•°æ®åº“"><a href="#djangoè¿æ¥MySQLæ•°æ®åº“" class="headerlink" title="djangoè¿æ¥MySQLæ•°æ®åº“"></a>djangoè¿æ¥MySQLæ•°æ®åº“</h2><h4 id="åœ¨settings-pyä¸­é…ç½®-1"><a href="#åœ¨settings-pyä¸­é…ç½®-1" class="headerlink" title="åœ¨settings.pyä¸­é…ç½®"></a>åœ¨settings.pyä¸­é…ç½®</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>:<span class="string">'åº“å'</span>,</span><br><span class="line">        <span class="string">'USER'</span>:<span class="string">'root'</span>,			<span class="comment">#æ•°æ®åº“ç”¨æˆ·å</span></span><br><span class="line">    	<span class="string">'PASSWORD'</span>:<span class="string">''</span>,		    <span class="comment">#å¯†ç </span></span><br><span class="line">        <span class="string">'HOST'</span>:<span class="string">'localhost'</span>,      <span class="comment">#ä¸»æœº</span></span><br><span class="line">        <span class="string">'PORT'</span>:<span class="string">'3306'</span>			<span class="comment">#æ•°æ®åº“ä½¿ç”¨çš„ç«¯å£å·</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„init-pyæ·»åŠ å¦‚ä¸‹ä»£ç "><a href="#åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„init-pyæ·»åŠ å¦‚ä¸‹ä»£ç " class="headerlink" title="åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„init.pyæ·»åŠ å¦‚ä¸‹ä»£ç "></a>åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„init.pyæ·»åŠ å¦‚ä¸‹ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<h4 id="æŠŠä»SQLiteä¸­æŠŠæ•°æ®å¯¼å…¥åˆ°MySQLä¸­"><a href="#æŠŠä»SQLiteä¸­æŠŠæ•°æ®å¯¼å…¥åˆ°MySQLä¸­" class="headerlink" title="æŠŠä»SQLiteä¸­æŠŠæ•°æ®å¯¼å…¥åˆ°MySQLä¸­"></a>æŠŠä»SQLiteä¸­æŠŠæ•°æ®å¯¼å…¥åˆ°MySQLä¸­</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å½“Djangoæ•°æ®åº“é…ç½®ä¸ºSQLite3æ—¶</span></span><br><span class="line"><span class="comment">#åœ¨cmdè¾“å…¥ï¼š</span></span><br><span class="line">python manage.py dumpdata &gt; data.json</span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQLå¯¼å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">#å½“Djangoæ•°æ®åº“é…ç½®ä¸ºMySQLæ—¶ï¼Œè¿ç§»å‡ºè¡¨æ ¼</span></span><br><span class="line"><span class="comment">#åœ¨cmdè¾“å…¥ï¼š</span></span><br><span class="line">python manage.py loaddate data.json</span><br></pre></td></tr></table></figure>





<h2 id="åè§£æ"><a href="#åè§£æ" class="headerlink" title="åè§£æ"></a>åè§£æ</h2><h3 id="1-å®šä¹‰ï¼š"><a href="#1-å®šä¹‰ï¼š" class="headerlink" title="1.å®šä¹‰ï¼š"></a>1.å®šä¹‰ï¼š</h3><p>éšç€åŠŸèƒ½çš„å¢åŠ ä¼šå‡ºç°æ›´å¤šçš„è§†å›¾ï¼Œå¯èƒ½ä¹‹å‰é…ç½®çš„æ­£åˆ™è¡¨è¾¾å¼ä¸å¤Ÿå‡†ç¡®ï¼Œäºæ˜¯å°±è¦ä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸€æ—¦ä¿®æ”¹äº†ï¼Œä¹‹å‰æ‰€æœ‰å¯¹åº”çš„è¶…é“¾æ¥éƒ½è¦ä¿®æ”¹ï¼ŒçœŸæ˜¯ä¸€ä»¶éº»çƒ¦çš„äº‹æƒ…ï¼Œè€Œä¸”å¯èƒ½è¿˜ä¼šæ¼æ‰ä¸€äº›è¶…é“¾æ¥å¿˜è®°ä¿®æ”¹ï¼Œæœ‰åŠæ³•è®©é“¾æ¥æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼åŠ¨æ€ç”Ÿæˆå—ï¼Ÿ å°±æ˜¯ç”¨åå‘è§£æçš„åŠæ³•ã€‚</p>
<h3 id="2-åº”ç”¨èŒƒå›´ï¼š"><a href="#2-åº”ç”¨èŒƒå›´ï¼š" class="headerlink" title="2.åº”ç”¨èŒƒå›´ï¼š"></a>2.åº”ç”¨èŒƒå›´ï¼š</h3><p>â€¢ æ¨¡æ¿ä¸­çš„è¶…é“¾æ¥</p>
<p>â€¢ è§†å›¾ä¸­çš„é‡å®šå‘</p>
<h3 id="3-ä½¿ç”¨"><a href="#3-ä½¿ç”¨" class="headerlink" title="3.ä½¿ç”¨"></a>3.ä½¿ç”¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url.pyä¸­é…åˆ¶</span><br><span class="line">app_name &#x3D; &#39;shop&#39;</span><br><span class="line"></span><br><span class="line">re_path(&#39;detail&#x2F;(\d)$&#39;,views.details,name&#x3D;&#39;detail&#39;)</span><br><span class="line">templateä¸­ä½¿ç”¨</span><br><span class="line">&lt;a href&#x3D;&quot;&#123;% url &#39;shop:detail&#39; 3 %&#125;&quot;&gt;list&lt;&#x2F;a&gt;</span><br><span class="line"></span><br><span class="line">Viewsä¸­ä½¿ç”¨</span><br><span class="line">from django.urls import reverse</span><br><span class="line">return HttpResponseRedirect(reverse(&quot;shop:detail&quot;,args&#x3D;[pk],kwargs&#x3D;&#123;&#39;body&#39;:&quot;email body&quot;&#125;))</span><br></pre></td></tr></table></figure>




<h2 id="å¦‚ä½•å°†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è½¬æ¢ä¸ºjsonæ•°æ®å‘é€åˆ°å‰å°"><a href="#å¦‚ä½•å°†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è½¬æ¢ä¸ºjsonæ•°æ®å‘é€åˆ°å‰å°" class="headerlink" title="å¦‚ä½•å°†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è½¬æ¢ä¸ºjsonæ•°æ®å‘é€åˆ°å‰å°"></a>å¦‚ä½•å°†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è½¬æ¢ä¸ºjsonæ•°æ®å‘é€åˆ°å‰å°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é€šè¿‡å¯¹è¡¨valuesæŸ¥è¯¢å¯¹ç»“æœé›†è¿›è¡Œlistè½¬æ¢ä¹Ÿæ˜¯jsonç±»å‹</span></span><br><span class="line">json_ = &#123;&#125;</span><br><span class="line">data = models.Goods.objects.values()</span><br><span class="line">json_data = list(data)</span><br><span class="line"><span class="keyword">return</span> Response(&#123;   </span><br><span class="line">            <span class="string">'data'</span>:json_data</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå¯¼å…¥æœºåˆ¶</title>
    <url>/2018/04/02/Python%E5%AF%BC%E5%85%A5%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h2 id="å¯¼å…¥æœºåˆ¶æ¢ç©¶"><a href="#å¯¼å…¥æœºåˆ¶æ¢ç©¶" class="headerlink" title="å¯¼å…¥æœºåˆ¶æ¢ç©¶"></a>å¯¼å…¥æœºåˆ¶æ¢ç©¶</h2><p>Python æä¾›äº† import è¯­å¥æ¥å®ç°ç±»åº“çš„å¼•ç”¨ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œä¸€è¡Œ <code>from package import module as mymodule</code> å‘½ä»¤æ—¶ï¼ŒPythonè§£é‡Šå™¨ä¼šæŸ¥æ‰¾package è¿™ä¸ªåŒ…çš„moduleæ¨¡å—ï¼Œå¹¶å°†è¯¥æ¨¡å—ä½œä¸º mymodule å¼•å…¥åˆ°å½“å‰çš„å·¥ä½œç©ºé—´ã€‚æ‰€ä»¥importè¯­å¥ä¸»è¦æ˜¯åšäº†äºŒä»¶äº‹ï¼š </p>
<ol>
<li>æŸ¥æ‰¾ç›¸åº”çš„module</li>
<li>åŠ è½½moduleåˆ°local namespace</li>
</ol>
<a id="more"></a>

<p>åœ¨importçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦æ˜¯å®Œæˆäº†æŸ¥æ‰¾è¦å¼•å…¥æ¨¡å—çš„åŠŸèƒ½ã€‚æŸ¥æ‰¾æ—¶é¦–å…ˆæ£€æŸ¥ sys.modules (ä¿å­˜äº†ä¹‹å‰importçš„ç±»åº“çš„ç¼“å­˜ï¼‰ï¼Œå¦‚æœmoduleæ²¡æœ‰è¢«æ‰¾åˆ°ï¼Œåˆ™æŒ‰ç…§ä¸‹é¢çš„æœç´¢è·¯å¾„æŸ¥æ‰¾æ¨¡å—ï¼š </p>
<ol>
<li>.py æ‰€åœ¨æ–‡ä»¶çš„ç›®å½•</li>
<li>PYTHONPATH ä¸­çš„ç›®å½•</li>
<li>pythonå®‰è£…ç›®å½•ï¼ŒUNIXä¸‹ï¼Œé»˜è®¤è·¯å¾„ä¸€èˆ¬ä¸º/usr/local/lib/python/</li>
<li>3.x ä¸­.pth æ–‡ä»¶å†…å®¹ã€</li>
</ol>
<p>å…¶å¤§è‡´è¿‡ç¨‹å¯ä»¥ç®€åŒ–ä¸ºï¼š </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">import</span><span class="params">(module_name)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.modules:</span><br><span class="line">        <span class="keyword">return</span> sys.modules[module_name]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        module_path = find(module_name)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> module_path:</span><br><span class="line">            module = load(module_path)</span><br><span class="line">            sys.modules[module_name] = module</span><br><span class="line">            <span class="keyword">return</span> module</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ImportError</span><br></pre></td></tr></table></figure>

<h2 id="æ¨¡å—å¯¼å…¥é”™è¯¯"><a href="#æ¨¡å—å¯¼å…¥é”™è¯¯" class="headerlink" title="æ¨¡å—å¯¼å…¥é”™è¯¯"></a>æ¨¡å—å¯¼å…¥é”™è¯¯</h2><p>åœ¨å¯¼å…¥æ¨¡å—æ–¹é¢ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼š </p>
<ul>
<li>å¾ªç¯å¯¼å…¥ï¼ˆcircular importsï¼‰</li>
<li>è¦†ç›–å¯¼å…¥ï¼ˆShadowed importsï¼‰</li>
</ul>
<h3 id="å¾ªç¯å¯¼å…¥"><a href="#å¾ªç¯å¯¼å…¥" class="headerlink" title="å¾ªç¯å¯¼å…¥"></a>å¾ªç¯å¯¼å…¥</h3><p>å¦‚æœä½ åˆ›å»ºä¸¤ä¸ªæ¨¡å—ï¼ŒäºŒè€…ç›¸äº’å¯¼å…¥å¯¹æ–¹ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šå‡ºç°<code>å¾ªç¯å¯¼å…¥</code>ã€‚ä¾‹å¦‚åˆ›å»º a.pyå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> b</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"in a_test"</span></span><br><span class="line">    <span class="keyword">print</span> b.x</span><br><span class="line"> </span><br><span class="line">a_test()</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨åŒä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºå¦ä¸€ä¸ªæ¨¡å—ï¼Œå°†å…¶å‘½åä¸ºb.py </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> a</span><br><span class="line">x = <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'In test_b'</span></span><br><span class="line">    a.a_test()</span><br><span class="line"> </span><br><span class="line">b_test()</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬å¯¼å…¥ a æ¨¡å—æ—¶ï¼Œä¼šå¼•å‘AttributeErrorï¼Œè¿™æ˜¯å› ä¸ºå¯¼å…¥aæ—¶ï¼Œåœ¨å¼€å§‹æ—¶å¯¼å…¥ b æ¨¡å—ï¼Œè€Œ b æ¨¡å—è°ƒç”¨ b_test æ—¶éœ€è¦açš„ a_testï¼Œè¿™æ—¶å€™ a æ¨¡å—çš„ a_test å¹¶æ²¡æœ‰æˆåŠŸåŠ è½½ã€‚</p>
<p>æ³¨æ„ä¸æ˜¯æ‰€æœ‰çš„äº’ç›¸å¯¼å…¥éƒ½ä¼šå¼•å‘ AttributeErrorï¼Œ<a href="https://docs.python.org/2/faq/programming.html#what-are-the-best-practices-for-using-import-in-a-module" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>è¿™æ ·è¯´ï¼š</p>
<blockquote>
<p>Circular imports are fine where both modules use the â€œimport â€ form of import. They fail when the 2nd module wants to grab a name out of the first (â€œfrom module import nameâ€) and the import is at the top level. Thatâ€™s because names in the 1st are not yet available, because the first module is busy importing the 2nd.</p>
</blockquote>
<p>ç»§ç»­ä»¥ä¸Šé¢çš„ä¸¤ä¸ªæ¨¡å—ä¸ºä¾‹ï¼Œå¦‚æœå°† a.py å’Œ b.py æ”¹ä¸ºä¸‹é¢ä»£ç ï¼Œå°±ä¸ä¼šå‡ºç°å¾ªç¯å¯¼å…¥çš„é”™è¯¯ï¼š</p>
<p>a.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> b</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"in a_test"</span></span><br><span class="line">    <span class="keyword">print</span> b.x</span><br><span class="line">a_test()</span><br></pre></td></tr></table></figure>

<p>b.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> a</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'In test_b'</span></span><br><span class="line">    a.a_test()</span><br><span class="line">b_test()</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œå…ˆå¯¼å…¥ aï¼Œå†å¯¼å…¥ b çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> a</span><br><span class="line">In test_b</span><br><span class="line"><span class="keyword">in</span> a_test</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="keyword">in</span> a_test</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> b</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="è¦†ç›–å¯¼å…¥"><a href="#è¦†ç›–å¯¼å…¥" class="headerlink" title="è¦†ç›–å¯¼å…¥"></a>è¦†ç›–å¯¼å…¥</h3><p>å½“åˆ›å»ºçš„æ¨¡å—ä¸æ ‡å‡†åº“ä¸­çš„æ¨¡å—åŒåæ—¶ï¼Œå¦‚æœå¯¼å…¥è¿™ä¸ªæ¨¡å—ï¼Œå°±ä¼šå‡ºç°è¦†ç›–å¯¼å…¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåˆ›å»ºä¸€ä¸ªåå«math.pyçš„æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square_root</span><span class="params">(number)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> math.sqrt(number)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä½ ä¼šå¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼ˆtracebackï¼‰ï¼šAttributeError: module â€˜mathâ€™ has no attribute â€˜sqrtâ€™ã€‚è¿™æ˜¯å› ä¸ºè¿è¡Œè¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼ŒPythonè§£é‡Šå™¨é¦–å…ˆåœ¨å½“å‰è¿è¡Œè„šæœ¬æ‰€å¤„çš„çš„æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾åå«mathçš„æ¨¡å—ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè§£é‡Šå™¨æ‰¾åˆ°äº†æˆ‘ä»¬æ­£åœ¨æ‰§è¡Œçš„æ¨¡å—ï¼Œè¯•å›¾å¯¼å…¥å®ƒã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ¨¡å—ä¸­å¹¶æ²¡æœ‰å«sqrtçš„å‡½æ•°æˆ–å±æ€§ï¼Œæ‰€ä»¥å°±æŠ›å‡ºäº†AttributeErrorã€‚</p>
<h2 id="æ¨¡å—ä¸åŒ…"><a href="#æ¨¡å—ä¸åŒ…" class="headerlink" title="æ¨¡å—ä¸åŒ…"></a>æ¨¡å—ä¸åŒ…</h2><p>åœ¨äº†è§£ import ä¹‹å‰ï¼Œæœ‰ä¸¤ä¸ªæ¦‚å¿µå¿…é¡»æä¸€ä¸‹ï¼š </p>
<ul>
<li>æ¨¡å—: ä¸€ä¸ª <code>.py</code> æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼ˆmoduleï¼‰</li>
<li>åŒ…: <code>__init__.py</code> æ–‡ä»¶æ‰€åœ¨ç›®å½•å°±æ˜¯åŒ…ï¼ˆpackageï¼‰</li>
</ul>
<p>å½“ç„¶ï¼Œè¿™åªæ˜¯æç®€ç‰ˆçš„æ¦‚å¿µã€‚å®é™…ä¸ŠåŒ…æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å—ï¼Œè€Œä»»ä½•å®šä¹‰äº† <code>__path__</code> å±æ€§çš„æ¨¡å—éƒ½è¢«å½“åšåŒ…ã€‚åªä¸è¿‡ï¼Œå’±ä»¬æ—¥å¸¸ä½¿ç”¨ä¸­å¹¶ä¸éœ€è¦çŸ¥é“è¿™äº›ã€‚ </p>
<h2 id="ä¸¤ç§å½¢å¼çš„-import"><a href="#ä¸¤ç§å½¢å¼çš„-import" class="headerlink" title="ä¸¤ç§å½¢å¼çš„ import"></a>ä¸¤ç§å½¢å¼çš„ import</h2><p><code>import</code> æœ‰ä¸¤ç§å½¢å¼ï¼š </p>
<ul>
<li><code>import ...</code></li>
<li><code>from ... import ...</code></li>
</ul>
<p>ä¸¤è€…æœ‰ç€å¾ˆç»†å¾®çš„åŒºåˆ«ï¼Œå…ˆçœ‹å‡ è¡Œä»£ç ã€‚ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_lowercase</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> string.ascii_lowercase</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œåå‘ç°æœ€åä¸€è¡Œä»£ç æŠ¥é”™ï¼š<code>ImportError: No module named ascii_lowercase</code>ï¼Œæ„æ€æ˜¯ï¼šâ€œæ‰¾ä¸åˆ°å« ascii_lowercase çš„æ¨¡å—â€ã€‚ç¬¬ 1 è¡Œå’Œç¬¬ 3 è¡Œçš„åŒºåˆ«åªåœ¨äºæœ‰æ²¡æœ‰ <code>from</code>ï¼Œç¿»ç¿»<a href="https://docs.python.org/2/reference/simple_stmts.html#import" target="_blank" rel="noopener">è¯­æ³•å®šä¹‰</a>å‘ç°æœ‰è¿™æ ·çš„è§„åˆ™ï¼š </p>
<ul>
<li><code>import ...</code> åé¢åªèƒ½æ˜¯æ¨¡å—æˆ–åŒ…</li>
<li><code>from ... import ...</code> ä¸­ï¼Œ<code>from</code> åé¢åªèƒ½æ˜¯æ¨¡å—æˆ–åŒ…ï¼Œ<code>import</code> åé¢å¯ä»¥æ˜¯ä»»ä½•å˜é‡</li>
</ul>
<p>å¯ä»¥ç®€å•çš„è®°æˆï¼šç¬¬ä¸€ä¸ªç©ºåªèƒ½å¡«æ¨¡å—æˆ–åŒ…ï¼Œç¬¬äºŒä¸ªç©ºå¡«å•¥éƒ½è¡Œã€‚ </p>
<h2 id="ç›¸å¯¹-import-ä¸-ç»å¯¹-import"><a href="#ç›¸å¯¹-import-ä¸-ç»å¯¹-import" class="headerlink" title="ç›¸å¯¹ import ä¸ ç»å¯¹ import"></a>ç›¸å¯¹ import ä¸ ç»å¯¹ import</h2><h3 id="ç›¸å¯¹-import"><a href="#ç›¸å¯¹-import" class="headerlink" title="ç›¸å¯¹ import"></a>ç›¸å¯¹ import</h3><p>å½“é¡¹ç›®è§„æ¨¡å˜å¤§ï¼Œä»£ç å¤æ‚åº¦ä¸Šå‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæŠŠä¸€ä¸ªä¸€ä¸ªçš„ <code>.py</code> æ–‡ä»¶ç»„ç»‡æˆä¸€ä¸ªåŒ…ï¼Œè®©é¡¹ç›®ç»“æ„æ›´åŠ æ¸…æ™°ã€‚è¿™æ—¶å€™ import åˆä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªå…¸å‹åŒ…çš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„ï¼š </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">string/</span><br><span class="line">â”œâ”€â”€ __init__.py</span><br><span class="line">â”œâ”€â”€ find.py</span><br><span class="line">â””â”€â”€ foo.py</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ <code>string/foo.py</code> çš„ä»£ç å¦‚ä¸‹ ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># string/foo.py</span></span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> find</span><br><span class="line">print(find)</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆ <code>python string/foo.py</code> çš„è¿è¡Œç»“æœä¼šæ˜¯ä¸‹é¢çš„å“ªä¸€ä¸ªå‘¢ï¼Ÿ </p>
<ul>
<li><code>&lt;module &#39;string.find&#39; from &#39;string/find.py&#39;&gt;</code></li>
<li><code>&lt;function find at 0x123456789&gt;</code></li>
</ul>
<h3 id="ç»å¯¹-import"><a href="#ç»å¯¹-import" class="headerlink" title="ç»å¯¹ import"></a>ç»å¯¹ import</h3><p>ç»å¯¹ import å’Œç›¸å¯¹ import å¾ˆå¥½åŒºåˆ†ï¼Œå› ä¸ºä»è¡Œä¸ºä¸Šæ¥çœ‹ï¼Œç»å¯¹ import ä¼šé€šè¿‡æœç´¢ <code>sys.path</code> æ¥æŸ¥æ‰¾æ¨¡å—ï¼›å¦ä¸€æ–¹é¢ï¼Œé™¤äº†ç›¸å¯¹ import å°±åªå‰©ç»å¯¹ import äº†å˜› :) ä¹Ÿå°±æ˜¯è¯´ï¼š </p>
<ul>
<li>æ‰€æœ‰çš„ <code>import ...</code> éƒ½æ˜¯ç»å¯¹ import</li>
<li>æ‰€æœ‰çš„ <code>from XXX import ...</code> éƒ½æ˜¯ç»å¯¹ import</li>
</ul>
<p>ä¸è¿‡ï¼Œç¬¬ 2 ç‚¹åªå¯¹ 2.7 åŠå…¶ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬ 3.xï¼‰æˆç«‹å–”ï¼å¦‚æœæ˜¯ 2.7 ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œå¾—ä½¿ç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import</span><br></pre></td></tr></table></figure>

<h3 id="ä¸¤è€…çš„å·®å¼‚"><a href="#ä¸¤è€…çš„å·®å¼‚" class="headerlink" title="ä¸¤è€…çš„å·®å¼‚"></a>ä¸¤è€…çš„å·®å¼‚</h3><p>é¦–å…ˆï¼Œç»å¯¹ import æ˜¯ Python é»˜è®¤çš„ import æ–¹å¼ï¼Œå…¶åŸå› æœ‰ä¸¤ç‚¹ï¼š </p>
<ul>
<li>ç»å¯¹ import æ¯”ç›¸å¯¹ import ä½¿ç”¨æ›´é¢‘ç¹</li>
<li>ç»å¯¹ import èƒ½å®ç°ç›¸å¯¹ import çš„æ‰€æœ‰åŠŸèƒ½</li>
</ul>
<p>å…¶æ¬¡ï¼Œä¸¤è€…æœç´¢æ¨¡å—çš„æ–¹å¼ä¸ä¸€æ ·ï¼š </p>
<ul>
<li>å¯¹äºç›¸å¯¹ importï¼Œé€šè¿‡æŸ¥çœ‹ <code>__name__</code> å˜é‡ï¼Œåœ¨ã€ŒåŒ…å±‚çº§ã€ï¼ˆpackage hierarchyï¼‰ä¸­æœç´¢</li>
<li>å¯¹äºç»å¯¹ importï¼Œå½“ä¸å¤„äºåŒ…å±‚çº§ä¸­æ—¶ï¼Œæœç´¢ <code>sys.path</code></li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python2ä¸python3çš„åŒºåˆ«</title>
    <url>/2018/03/20/python2%E4%B8%8Epython3%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">https://c.runoob.com/compile/<span class="number">6</span>			<span class="comment">#åœ¨çº¿ç¼–è¯‘å™¨æ”¯æŒpython2å’Œpython3</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="1ã€pythonè§£é‡Šå™¨é»˜è®¤ç¼–ç "><a href="#1ã€pythonè§£é‡Šå™¨é»˜è®¤ç¼–ç " class="headerlink" title="1ã€pythonè§£é‡Šå™¨é»˜è®¤ç¼–ç "></a>1ã€pythonè§£é‡Šå™¨é»˜è®¤ç¼–ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#python2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getdefaultencoding()</span><br><span class="line"><span class="string">'ascii'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#python3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getdefaultencoding()</span><br><span class="line"><span class="string">'utf-8'</span></span><br></pre></td></tr></table></figure>

<p>åœ¨Python 2ä¸­ï¼Œå¦‚æœä»£ç ä¸­åŒ…å«éè‹±æ–‡å­—ç¬¦ï¼Œéœ€è¦åœ¨ä»£ç æ–‡ä»¶çš„æœ€å¼€å§‹å£°æ˜ç¼–ç ï¼Œå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br></pre></td></tr></table></figure>

<p>åœ¨Python 3ä¸­ï¼Œé»˜è®¤çš„å­—ç¬¦ä¸²å°±æ˜¯Unicodeï¼Œå°±çœå»äº†è¿™ä¸ªéº»çƒ¦ï¼Œä¸‹é¢çš„ä»£ç åœ¨Python 3å¯ä»¥æ­£å¸¸åœ°è¿è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">"ä½ å¥½"</span></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<ul>
<li>python2 è§£é‡Šå™¨é»˜è®¤ç¼–ç ï¼šascii</li>
<li>python3 è§£é‡Šå™¨é»˜è®¤ç¼–ç ï¼šutf-8</li>
</ul>
<h2 id="2ã€inputå‡½æ•°"><a href="#2ã€inputå‡½æ•°" class="headerlink" title="2ã€inputå‡½æ•°"></a>2ã€inputå‡½æ•°</h2><p>åœ¨python2ä¸­inputæ˜¯å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ä½œä¸º<strong>è¡¨è¾¾å¼</strong>æ¥å¯¹å¾…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">content = input(<span class="string">"è¯·è¾“å…¥æ‚¨çš„å†…å®¹ï¼š"</span>)</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">è¯·è¾“å…¥æ‚¨çš„å†…å®¹: <span class="number">100</span>+<span class="number">200</span></span><br><span class="line"><span class="number">300</span></span><br></pre></td></tr></table></figure>



<p>åœ¨python3ä¸­inputæ˜¯å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ä½œä¸º<strong>å­—ç¬¦ä¸²</strong>æ¥å¯¹å¾…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">content = input(<span class="string">"è¯·è¾“å…¥æ‚¨çš„å†…å®¹ï¼š"</span>)</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">è¯·è¾“å…¥æ‚¨çš„å†…å®¹: <span class="number">100</span>+<span class="number">200</span></span><br><span class="line"><span class="number">100</span>+<span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æƒ³ä½¿<strong>python2</strong>å»å®ç°<strong>python3</strong>çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨python2ä¸­é€šè¿‡<strong>input</strong>è¾“å…¥ä¹Ÿå®ç°ç»Ÿä¸€ä½œä¸ºâ€œå­—ç¬¦ä¸²â€çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨<strong>input</strong>äº†ï¼Œè€Œåº”è¯¥å»ä½¿ç”¨<strong>raw_input</strong>ã€‚ ä½†æ˜¯åœ¨python3ä¸­æ²¡æœ‰<strong>raw_input</strong>å‡½æ•°</p>
<h2 id="3ã€printå‡½æ•°"><a href="#3ã€printå‡½æ•°" class="headerlink" title="3ã€printå‡½æ•°"></a>3ã€printå‡½æ•°</h2><p>Python 2ä¸­printæ˜¯<strong>è¯­å¥</strong>ï¼ˆstatementï¼‰ï¼ŒPython 3ä¸­printåˆ™å˜æˆäº†<strong>å‡½æ•°</strong>ã€‚åœ¨Python 3ä¸­è°ƒç”¨printéœ€è¦åŠ ä¸Šæ‹¬å·ï¼Œä¸åŠ æ‹¬å·ä¼šæŠ¥SyntaxError </p>
<p><strong>Python 2</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">"hello world"</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hello world</span><br></pre></td></tr></table></figure>

<p><strong>Python 3</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">"hello world"</span>)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hello world</span><br></pre></td></tr></table></figure>

<p>python3</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">"hello world"</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"hello world"</span></span><br><span class="line">                      ^</span><br><span class="line">SyntaxError: Missing parentheses <span class="keyword">in</span> call to <span class="string">'print'</span></span><br></pre></td></tr></table></figure>



<h2 id="4ã€æ•´æ•°ç›¸é™¤"><a href="#4ã€æ•´æ•°ç›¸é™¤" class="headerlink" title="4ã€æ•´æ•°ç›¸é™¤"></a>4ã€æ•´æ•°ç›¸é™¤</h2><p>åœ¨Python 2ä¸­ï¼Œ3/2çš„ç»“æœæ˜¯æ•´æ•°ï¼Œåœ¨Python 3ä¸­ï¼Œç»“æœåˆ™æ˜¯æµ®ç‚¹æ•° </p>
<p>Python 2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">'3 / 2 ='</span>, <span class="number">3</span> / <span class="number">2</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'3 / 2.0 ='</span>, <span class="number">3</span> / <span class="number">2.0</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">3</span> / <span class="number">2</span> = <span class="number">1</span></span><br><span class="line"><span class="number">3</span> / <span class="number">2.0</span> = <span class="number">1.5</span></span><br></pre></td></tr></table></figure>

<p>Python 3</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'3 / 2 ='</span>, <span class="number">3</span> / <span class="number">2</span>)</span><br><span class="line">print(<span class="string">'3 / 2.0 ='</span>, <span class="number">3</span> / <span class="number">2.0</span>)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">3</span> / <span class="number">2</span> = <span class="number">1.5</span></span><br><span class="line"><span class="number">3</span> / <span class="number">2.0</span> = <span class="number">1.5</span></span><br></pre></td></tr></table></figure>



<h2 id="5ã€å¼‚å¸¸å¤„ç†"><a href="#5ã€å¼‚å¸¸å¤„ç†" class="headerlink" title="5ã€å¼‚å¸¸å¤„ç†"></a>5ã€å¼‚å¸¸å¤„ç†</h2><p>Python 2ä¸­æ•è·å¼‚å¸¸ä¸€èˆ¬ç”¨ä¸‹é¢çš„è¯­æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="number">1</span>/<span class="number">0</span> </span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError, e:</span><br><span class="line">    <span class="keyword">print</span> str(e)</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="number">1</span>/<span class="number">0</span> </span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">print</span> str(e)</span><br></pre></td></tr></table></figure>

<p><strong>Python 3ä¸­ä¸å†æ”¯æŒå‰ä¸€ç§è¯­æ³•ï¼Œå¿…é¡»ä½¿ç”¨aså…³é”®å­—ã€‚</strong></p>
<h2 id="6ã€range-xrange"><a href="#6ã€range-xrange" class="headerlink" title="6ã€range / xrange"></a>6ã€range / xrange</h2><ul>
<li>python2ï¼š<ul>
<li>xrangeï¼šä¸ä¼šåœ¨å†…å­˜ä¸­ç«‹å³åˆ›å»ºï¼Œè€Œæ˜¯åœ¨å¾ªç¯æ—¶ï¼Œè¾¹å¾ªç¯è¾¹åˆ›å»º</li>
<li>rangeï¼šåœ¨å†…å­˜ç«‹å³æŠŠæ‰€æœ‰çš„å€¼åˆ›å»º</li>
</ul>
</li>
<li>python3ï¼š <ul>
<li>åªæœ‰rangeï¼Œç›¸å½“äºpython2ä¸­çš„xrange</li>
<li>rangeï¼šä¸ä¼šåœ¨å†…å­˜ä¸­ç«‹å³åˆ›å»ºï¼Œè€Œæ˜¯åœ¨å¾ªç¯æ—¶ï¼Œè¾¹å¾ªç¯è¾¹åˆ›å»º</li>
</ul>
</li>
</ul>
<h2 id="7ã€åŒ…çš„å®šä¹‰"><a href="#7ã€åŒ…çš„å®šä¹‰" class="headerlink" title="7ã€åŒ…çš„å®šä¹‰"></a>7ã€åŒ…çš„å®šä¹‰</h2><ul>
<li>python2ï¼šæ–‡ä»¶å¤¹ä¸­å¿…é¡»æœ‰<code>__init__.py</code>æ–‡ä»¶</li>
</ul>
<ul>
<li>python3ï¼šä¸éœ€è¦æœ‰<code>__init__.py</code>æ–‡ä»¶</li>
</ul>
<h2 id="8ã€map-å‡½æ•°"><a href="#8ã€map-å‡½æ•°" class="headerlink" title="8ã€map å‡½æ•°"></a>8ã€map å‡½æ•°</h2><p>python2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x*x</span><br><span class="line">print(map(f, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]))</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br></pre></td></tr></table></figure>

<p>python3</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x*x</span><br><span class="line">print(map(f, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]))</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;map object at <span class="number">0x7f39cebe1f60</span>&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>python2ï¼šè¿”å›åˆ—è¡¨ï¼Œç›´æ¥åˆ›å»ºå€¼ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å–å€¼</li>
<li>python3ï¼šè¿”å›è¿­ä»£å™¨ï¼Œä¸ç›´æ¥åˆ›å»ºå€¼ï¼Œé€šè¿‡å¾ªç¯ï¼Œè¾¹å¾ªç¯è¾¹åˆ›å»º</li>
</ul>
<h2 id="9ã€classç±»"><a href="#9ã€classç±»" class="headerlink" title="9ã€classç±»"></a>9ã€classç±»</h2><p>åœ¨<strong>Python2</strong>ä¸­ï¼Œ<strong>åŸºç±»object</strong>ä¹¦å†™ä¸å¦ ä¼šå¯¹ç»“æœé€ æˆå¾ˆå¤§çš„å½±å“ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹æ¶‰åŠåˆ°<strong>æ–°å¼ç±»ã€ç»å…¸ç±»</strong>çš„é—®é¢˜ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">åœ¨Python <span class="number">3.</span>xä¸­å–æ¶ˆäº†ç»å…¸ç±»ï¼Œé»˜è®¤éƒ½æ˜¯æ–°å¼ç±»ï¼Œå¹¶ä¸”ä¸å¿…æ˜¾å¼çš„ç»§æ‰¿objectï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span><span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">()</span>:</span><span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span><span class="keyword">pass</span></span><br><span class="line">ä¸‰ç§å†™æ³•å¹¶æ— åŒºåˆ«ï¼Œæ¨èç¬¬ä¸€ç§</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä½†æ˜¯åœ¨Python2.xä¸­ï¼Œé»˜è®¤éƒ½æ˜¯ç»å…¸ç±»ï¼Œåªæœ‰æ˜¾å¼ç»§æ‰¿äº†objectæ‰æ˜¯æ–°å¼ç±»ï¼Œå³ï¼š</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span><span class="keyword">pass</span> æ–°å¼ç±»å†™æ³•</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">()</span>:</span><span class="keyword">pass</span> ç»å…¸ç±»å†™æ³•</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span><span class="keyword">pass</span> ç»å…¸ç±»å†™æ³•</span><br></pre></td></tr></table></figure>

<img src="/2018/03/20/python2%E4%B8%8Epython3%E7%9A%84%E5%8C%BA%E5%88%AB/image-20200310084245988.png" class="">  

<p>ä¸Šä»£ç ï¼š</p>
<p>python2ä¸­çš„æ·±åº¦ä¼˜å…ˆ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'D'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(D)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># def talk(self):</span></span><br><span class="line">    <span class="comment">#     print('B')</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(D)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(B,C)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a.talk()</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">D</span><br></pre></td></tr></table></figure>

<p>python2ä¸­å¹¿åº¦ä¼˜å…ˆå’Œpython3</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'D'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(D)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># def talk(self):</span></span><br><span class="line">    <span class="comment">#     print('B')</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(D)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(B,C)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a.talk()</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">C</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonåŸºç¡€</title>
    <url>/2018/03/19/python%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="ä¸isçš„åŒºåˆ«"><a href="#ä¸isçš„åŒºåˆ«" class="headerlink" title="==ä¸isçš„åŒºåˆ«"></a>==ä¸isçš„åŒºåˆ«</h2><p>åœ¨Pythonä¸­ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ã€‚</p>
<p>Pythonä¸­å¯¹è±¡åŒ…å«çš„ä¸‰ä¸ªåŸºæœ¬è¦ç´ ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>id(èº«ä»½æ ‡è¯†)</li>
<li>type(æ•°æ®ç±»å‹)</li>
<li>value(å€¼)</li>
</ol>
<a id="more"></a>

<p>å¯¹è±¡ä¹‹é—´æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰å¯ä»¥ç”¨ == ï¼Œä¹Ÿå¯ä»¥ç”¨ is ã€‚ </p>
<p>is æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„idå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¹Ÿå°±æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚</p>
<p>== æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼Œé»˜è®¤ä¼šè°ƒç”¨å¯¹è±¡çš„ <strong>eq</strong> æ–¹æ³•ã€‚</p>
<p>== æ˜¯pythonæ ‡å‡†æ“ä½œç¬¦ä¸­çš„æ¯”è¾ƒæ“ä½œç¬¦ï¼Œç”¨æ¥æ¯”è¾ƒåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b <span class="keyword">is</span> a </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b == a</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a[:]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b <span class="keyword">is</span> a</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b == a</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>





<h2 id="æ·±æµ…æ‹·è´"><a href="#æ·±æµ…æ‹·è´" class="headerlink" title="æ·±æµ…æ‹·è´"></a>æ·±æµ…æ‹·è´</h2><p><strong>æµ…æ‹·è´</strong></p>
<p>æµ…æ‹·è´æ˜¯å¯¹äºä¸€ä¸ªå¯¹è±¡çš„é¡¶å±‚æ‹·è´ï¼Œé€šä¿—çš„ç†è§£æ˜¯ï¼šæ‹·è´äº†å¼•ç”¨ï¼Œå¹¶æ²¡æœ‰æ‹·è´å†…å®¹ </p>
<p><strong>æ·±æ‹·è´</strong></p>
<p>æ‹·è´ä¼šå®Œå…¨å¤åˆ¶åŸå˜é‡ç›¸å…³çš„æ‰€æœ‰æ•°æ®ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€å¥—å®Œå…¨ä¸€æ ·çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå˜é‡ä¸­ä»»æ„ä¸€ä¸ªä¿®æ”¹éƒ½ä¸ä¼šå½±å“å…¶ä»–å˜é‡ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">sourceList = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]]</span><br><span class="line">copyList = copy.copy(sourceList)</span><br><span class="line">deepcopyList = copy.deepcopy(sourceList)</span><br><span class="line"></span><br><span class="line">sourceList[<span class="number">3</span>][<span class="number">0</span>]=<span class="number">100</span></span><br><span class="line"></span><br><span class="line">print(sourceList)           <span class="comment"># [1, 2, 3, [100, 5, 6]]</span></span><br><span class="line">print(copyList)             <span class="comment"># [1, 2, 3, [100, 5, 6]]</span></span><br><span class="line">print(deepcopyList)         <span class="comment"># [1, 2, 3, [4, 5, 6]]</span></span><br></pre></td></tr></table></figure>



<h2 id="Pythonåƒåœ¾å›æ”¶æœºåˆ¶"><a href="#Pythonåƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="Pythonåƒåœ¾å›æ”¶æœºåˆ¶"></a>Pythonåƒåœ¾å›æ”¶æœºåˆ¶</h2><h3 id="1ã€å¼•ç”¨è®¡æ•°"><a href="#1ã€å¼•ç”¨è®¡æ•°" class="headerlink" title="1ã€å¼•ç”¨è®¡æ•°"></a><strong>1ã€å¼•ç”¨è®¡æ•°</strong></h3><p><strong>1ã€åŸç†</strong></p>
<ul>
<li>å½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è¢«åˆ›å»ºæˆ–è€…å¤åˆ¶æ—¶ï¼Œå¯¹è±¡çš„å¼•ç”¨è®¡æ•°åŠ 1ï¼›å½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è¢«é”€æ¯æ—¶ï¼Œå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡1</li>
<li>å½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡å°‘ä¸º0æ—¶ï¼Œå°±æ„å‘³ç€å¯¹è±¡å·²ç»å†æ²¡æœ‰è¢«ä½¿ç”¨äº†ï¼Œå¯ä»¥å°†å…¶å†…å­˜é‡Šæ”¾æ‰</li>
</ul>
<p><strong>2ã€ä¼˜ç‚¹</strong></p>
<ul>
<li>å¼•ç”¨è®¡æ•°æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹ï¼Œå³å®æ—¶æ€§ï¼Œä»»ä½•å†…å­˜ï¼Œä¸€æ—¦æ²¡æœ‰æŒ‡å‘å®ƒçš„å¼•ç”¨ï¼Œå°±ä¼šè¢«ç«‹å³å›æ”¶ï¼Œè€Œå…¶ä»–çš„åƒåœ¾æ”¶é›†æŠ€æœ¯å¿…é¡»åœ¨æŸç§ç‰¹æ®Šæ¡ä»¶ä¸‹æ‰èƒ½è¿›è¡Œæ— æ•ˆå†…å­˜çš„å›æ”¶</li>
</ul>
<p><strong>3ã€ç¼ºç‚¹</strong></p>
<ul>
<li>å¼•ç”¨è®¡æ•°æœºåˆ¶æ‰€å¸¦æ¥çš„ç»´æŠ¤å¼•ç”¨è®¡æ•°çš„é¢å¤–æ“ä½œä¸Pythonè¿è¡Œä¸­æ‰€è¿›è¡Œçš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œå¼•ç”¨èµ‹å€¼çš„æ¬¡æ•°æ˜¯æˆæ­£æ¯”çš„ï¼ˆç»´æŠ¤å¼•ç”¨è®¡æ•°æ¶ˆè€—èµ„æºï¼‰ </li>
<li>åŒæ—¶ï¼Œå› ä¸ºå¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œæ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨éƒ½ä¸ä¼šä¸º0ï¼Œæ‰€ä»¥è¿™äº›å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜å§‹ç»ˆéƒ½ä¸ä¼šè¢«é‡Šæ”¾æ‰ </li>
</ul>
<h3 id="2ã€æ ‡è®°â€”æ¸…é™¤"><a href="#2ã€æ ‡è®°â€”æ¸…é™¤" class="headerlink" title="2ã€æ ‡è®°â€”æ¸…é™¤"></a>2ã€æ ‡è®°â€”æ¸…é™¤</h3><p><strong>1ã€è¯´æ˜</strong></p>
<ul>
<li>å®ƒåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€é˜¶æ®µæ˜¯æ ‡è®°é˜¶æ®µï¼ŒGCä¼šæŠŠæ‰€æœ‰çš„æ´»åŠ¨å¯¹è±¡æ‰“ä¸Šæ ‡è®°ï¼Œç¬¬äºŒé˜¶æ®µæ˜¯æŠŠé‚£äº›æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡éæ´»åŠ¨å¯¹è±¡è¿›è¡Œå›æ”¶</li>
<li>å¯¹è±¡ä¹‹é—´é€šè¿‡å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰è¿åœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªæœ‰å‘å›¾ </li>
<li>ä»æ ¹å¯¹è±¡ï¼ˆroot objectï¼‰å‡ºå‘ï¼Œæ²¿ç€æœ‰å‘è¾¹éå†å¯¹è±¡ï¼Œå¯è¾¾çš„ï¼ˆreachableï¼‰å¯¹è±¡æ ‡è®°ä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å°±æ˜¯è¦è¢«æ¸…é™¤çš„éæ´»åŠ¨å¯¹è±¡ã€‚æ ¹å¯¹è±¡å°±æ˜¯å…¨å±€å˜é‡ã€è°ƒç”¨æ ˆã€å¯„å­˜å™¨ã€‚</li>
</ul>
<p><strong>2ã€ç¼ºç‚¹</strong></p>
<ul>
<li>æ ‡è®°æ¸…é™¤ç®—æ³•ä½œä¸ºPythonçš„è¾…åŠ©åƒåœ¾æ”¶é›†æŠ€æœ¯ï¼Œä¸»è¦å¤„ç†çš„æ˜¯ä¸€äº›å®¹å™¨å¯¹è±¡ï¼Œæ¯”å¦‚listã€dictã€tupleç­‰ã€‚å› ä¸ºå¯¹äºå­—ç¬¦ä¸²ã€æ•°å€¼å¯¹è±¡æ˜¯ä¸å¯èƒ½é€ æˆå¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</li>
<li>æ¸…é™¤éæ´»åŠ¨çš„å¯¹è±¡å‰å®ƒå¿…é¡»é¡ºåºæ‰«ææ•´ä¸ªå †å†…å­˜ï¼Œå“ªæ€•åªå‰©ä¸‹å°éƒ¨åˆ†æ´»åŠ¨å¯¹è±¡ä¹Ÿè¦æ‰«ææ‰€æœ‰å¯¹è±¡ã€‚</li>
</ul>
<h3 id="3ã€åˆ†ä»£å›æ”¶"><a href="#3ã€åˆ†ä»£å›æ”¶" class="headerlink" title="3ã€åˆ†ä»£å›æ”¶"></a>3ã€åˆ†ä»£å›æ”¶</h3><ul>
<li>åˆ†ä»£å›æ”¶æ˜¯å»ºç«‹åœ¨æ ‡è®°æ¸…é™¤æŠ€æœ¯åŸºç¡€ä¹‹ä¸Šçš„ï¼Œæ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ“ä½œæ–¹å¼</li>
<li>Pythonå°†å†…å­˜åˆ†ä¸ºäº†3â€œä»£â€ï¼Œåˆ†åˆ«ä¸ºå¹´è½»ä»£ï¼ˆç¬¬0ä»£ï¼‰ã€ä¸­å¹´ä»£ï¼ˆç¬¬1ä»£ï¼‰ã€è€å¹´ä»£ï¼ˆç¬¬2ä»£ï¼‰</li>
<li>ä»–ä»¬å¯¹åº”çš„æ˜¯3ä¸ªé“¾è¡¨ï¼Œå®ƒä»¬çš„åƒåœ¾æ”¶é›†é¢‘ç‡ä¸å¯¹è±¡çš„å­˜æ´»æ—¶é—´çš„å¢å¤§è€Œå‡å°</li>
<li>æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šåˆ†é…åœ¨å¹´è½»ä»£ï¼Œå¹´è½»ä»£é“¾è¡¨çš„æ€»æ•°è¾¾åˆ°ä¸Šé™æ—¶ï¼ŒPythonåƒåœ¾æ”¶é›†æœºåˆ¶å°±ä¼šè¢«è§¦å‘</li>
<li>æŠŠé‚£äº›å¯ä»¥è¢«å›æ”¶çš„å¯¹è±¡å›æ”¶æ‰ï¼Œè€Œé‚£äº›ä¸ä¼šå›æ”¶çš„å¯¹è±¡å°±ä¼šè¢«ç§»åˆ°ä¸­å¹´ä»£å»ï¼Œä¾æ­¤ç±»æ¨</li>
<li>è€å¹´ä»£ä¸­çš„å¯¹è±¡æ˜¯å­˜æ´»æ—¶é—´æœ€ä¹…çš„å¯¹è±¡ï¼Œç”šè‡³æ˜¯å­˜æ´»äºæ•´ä¸ªç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸå†…</li>
</ul>
<h2 id="withä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶"><a href="#withä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶" class="headerlink" title="withä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶"></a>withä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶</h2><h3 id="ä»€ä¹ˆæ˜¯withè¯­å¥"><a href="#ä»€ä¹ˆæ˜¯withè¯­å¥" class="headerlink" title="ä»€ä¹ˆæ˜¯withè¯­å¥"></a>ä»€ä¹ˆæ˜¯withè¯­å¥</h3><ol>
<li>withæ˜¯ä¸€ç§ä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼Œç›®çš„åœ¨äºä»æµç¨‹å›¾ä¸­æŠŠ try,except å’Œfinally å…³é”®å­—å’Œèµ„æºåˆ†é…é‡Šæ”¾ç›¸å…³ä»£ç ç»Ÿç»Ÿå»æ‰ï¼Œç®€åŒ–tryâ€¦.exceptâ€¦.finlallyçš„å¤„ç†æµç¨‹</li>
<li>æ‰€ä»¥ä½¿ç”¨withå¤„ç†çš„å¯¹è±¡å¿…é¡»æœ‰enter()å’Œexit()è¿™ä¸¤ä¸ªæ–¹æ³•<ul>
<li>withé€šè¿‡enteræ–¹æ³•åˆå§‹åŒ–ï¼ˆenteræ–¹æ³•åœ¨è¯­å¥ä½“æ‰§è¡Œä¹‹å‰è¿›å…¥è¿è¡Œï¼‰</li>
<li>ç„¶ååœ¨exitä¸­åšå–„åä»¥åŠå¤„ç†å¼‚å¸¸ï¼ˆexit()æ–¹æ³•åœ¨è¯­å¥ä½“æ‰§è¡Œå®Œæ¯•é€€å‡ºåè¿è¡Œï¼‰</li>
</ul>
</li>
</ol>
<h3 id="with"><a href="#with" class="headerlink" title="with"></a>with</h3><ul>
<li>with è¯­å¥é€‚ç”¨äºå¯¹èµ„æºè¿›è¡Œè®¿é—®çš„åœºåˆï¼Œç¡®ä¿ä¸ç®¡ä½¿ç”¨è¿‡ç¨‹ä¸­æ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œå¿…è¦çš„â€œæ¸…ç†â€æ“ä½œï¼Œé‡Šæ”¾èµ„æº </li>
<li>æ¯”å¦‚æ–‡ä»¶ä½¿ç”¨åè‡ªåŠ¨å…³é—­ã€çº¿ç¨‹ä¸­é”çš„è‡ªåŠ¨è·å–å’Œé‡Šæ”¾ç­‰ã€‚</li>
</ul>
<h3 id="withå¤„ç†æ–‡ä»¶æ“ä½œçš„å®ä¾‹"><a href="#withå¤„ç†æ–‡ä»¶æ“ä½œçš„å®ä¾‹" class="headerlink" title="withå¤„ç†æ–‡ä»¶æ“ä½œçš„å®ä¾‹"></a>withå¤„ç†æ–‡ä»¶æ“ä½œçš„å®ä¾‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'/etc/passwd'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        print(line)</span><br><span class="line">  <span class="comment"># è¿™æ®µä»£ç çš„ä½œç”¨ï¼šæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼ŒæŠŠæ–‡ä»¶å¯¹è±¡èµ‹å€¼ç»™fï¼Œç„¶åç”¨è¿­ä»£å™¨éå†æ–‡ä»¶ä¸­æ¯ä¸€è¡Œï¼Œå½“å®Œæˆæ—¶ï¼Œå…³é—­æ–‡ä»¶ï¼›</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># è€Œæ— è®ºåœ¨è¿™æ®µä»£ç çš„ä»»ä½•åœ°æ–¹ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ­¤æ—¶æ–‡ä»¶ä»ä¼šè¢«å…³é—­ã€‚</span></span><br></pre></td></tr></table></figure>

<h2 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h2><h3 id="mapå‡½æ•°"><a href="#mapå‡½æ•°" class="headerlink" title="mapå‡½æ•°"></a>mapå‡½æ•°</h3><p>å°†ç¬¬ä¸€ä¸ªå‚æ•° function ä¾æ¬¡ä½œç”¨åœ¨å‚æ•°å¯è¿­ä»£å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œåœ¨python3ä¸­è¿”å›åŒ…å«æ¯æ¬¡ function å‡½æ•°è¿”å›å€¼çš„æ–°è¿­ä»£å™¨ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">map(function,iterable)</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x*x</span><br><span class="line">r = map(f, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line">print(list(r))</span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br></pre></td></tr></table></figure>



<h3 id="filterå‡½æ•°"><a href="#filterå‡½æ•°" class="headerlink" title="filterå‡½æ•°"></a>filterå‡½æ•°</h3><p>filter()æ¥æ”¶ä¸€ä¸ªå‡½æ•°function å’Œä¸€ä¸ªlistï¼Œè¿™ä¸ªfunction çš„ä½œç”¨æ˜¯å¯¹listçš„æ¯ä¸ªå…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œè¿”å›Trueæˆ–Falseï¼Œfilter()æ ¹æ®åˆ¤æ–­ç»“æœè‡ªåŠ¨è¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›ç”±ç¬¦åˆæ¡ä»¶å…ƒç´ ç»„æˆçš„æ–°listã€‚ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">filter(function, iterable)</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_contain_s</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'E'</span> <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">result = filter(is_contain_s, [<span class="string">'sTEst'</span>, <span class="string">'abc'</span>, <span class="string">'str'</span>, <span class="string">' '</span>, <span class="string">'END'</span>])</span><br><span class="line">print(list(result))</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">[<span class="string">'sTEst'</span>, <span class="string">'END'</span>]</span><br></pre></td></tr></table></figure>





<h3 id="reduceå‡½æ•°"><a href="#reduceå‡½æ•°" class="headerlink" title="reduceå‡½æ•°"></a>reduceå‡½æ•°</h3><p>reduce()å‡½æ•°ä¹Ÿæ¥æ”¶ä¸€ä¸ªå‡½æ•°function, å’Œä¸€ä¸ªlistã€‚ä½†reduce()ä¼ å…¥çš„å‡½æ•°å¿…é¡»æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œreduce()å¯¹listçš„æ¯ä¸ªå…ƒç´ åå¤è°ƒç”¨å‡½æ•°function, å¹¶è¿”å›æœ€ç»ˆç»“æœå€¼ã€‚ </p>
<p>åœ¨Python3é‡Œï¼Œreduce()å‡½æ•°å·²ç»è¢«ä»å…¨å±€åå­—ç©ºé—´é‡Œç§»é™¤äº†ï¼Œå®ƒç°åœ¨è¢«æ”¾ç½®åœ¨fucntoolsæ¨¡å—é‡Œï¼Œ è¦ä½¿ç”¨çš„è¯è¦ å…ˆå¼•å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce </span><br><span class="line">reduce(function, iterable)</span><br></pre></td></tr></table></figure>



<p>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">result = reduce(f, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>])</span><br><span class="line">print(result)</span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line"><span class="number">25</span></span><br></pre></td></tr></table></figure>



<h3 id="sortedå‡½æ•°"><a href="#sortedå‡½æ•°" class="headerlink" title="sortedå‡½æ•°"></a>sortedå‡½æ•°</h3><p>å¯¹æ‰€æœ‰å¯è¿­ä»£çš„å¯¹è±¡è¿›è¡Œæ’åºæ“ä½œ </p>
<p>å¯¹äºlistä¹Ÿå¯ä»¥ä½¿ç”¨<code>list.sort()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¿®æ”¹åŸå§‹çš„ listï¼ˆè¿”å›å€¼ä¸ºNoneï¼‰ã€‚é€šå¸¸è¿™ä¸ªæ–¹æ³•ä¸å¦‚<code>sorted()</code>æ–¹ä¾¿-å¦‚æœä½ ä¸éœ€è¦åŸå§‹çš„ listï¼Œ<code>list.sort()</code>æ–¹æ³•æ•ˆç‡ä¼šç¨å¾®é«˜ä¸€äº›ã€‚ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sorted(iterable, key=<span class="literal">None</span>, reverse=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>iterable â€“ å¯è¿­ä»£å¯¹è±¡</li>
<li>key â€“ ä¸»è¦æ˜¯ç”¨æ¥è¿›è¡Œæ¯”è¾ƒçš„å…ƒç´ ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå…·ä½“çš„å‡½æ•°çš„å‚æ•°å°±æ˜¯å–è‡ªäºå¯è¿­ä»£å¯¹è±¡ä¸­ï¼ŒæŒ‡å®šå¯è¿­ä»£å¯¹è±¡ä¸­çš„ä¸€ä¸ªå…ƒç´ æ¥è¿›è¡Œæ’åº</li>
<li>reverse â€“ æ’åºè§„åˆ™ï¼Œreverse = True é™åº ï¼Œ reverse = False å‡åºï¼ˆé»˜è®¤ï¼‰</li>
</ul>
<p>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;example_list = [<span class="number">5</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(example_list, reverse=<span class="literal">True</span>)</span><br><span class="line">[<span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>saltstackå®‰è£…</title>
    <url>/2018/03/12/saltstack%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="1-å‡†å¤‡è™šæ‹Ÿç¯å¢ƒ"><a href="#1-å‡†å¤‡è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="1.  å‡†å¤‡è™šæ‹Ÿç¯å¢ƒ"></a>1.  å‡†å¤‡è™šæ‹Ÿç¯å¢ƒ</h2><ol>
<li>åœ¨VMwareä¸­åˆ›å»ºä¸€ä¸ªä¸­åˆ›å»ºä¸€ä¸ªCentOS 64ä½çš„æ“ä½œç³»ç»Ÿ</li>
<li>åœ¨é…ç½®æ—¶ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„IP</li>
</ol>
<a id="more"></a>

<h2 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2.  é…ç½®"></a>2.  é…ç½®</h2><ol>
<li><h3 id="é…ç½®ç½‘å¡"><a href="#é…ç½®ç½‘å¡" class="headerlink" title="é…ç½®ç½‘å¡"></a><strong>é…ç½®ç½‘å¡</strong></h3><p>â€‹    vi /etc/sysconfig/network-scripts/ifcfg-eth0 </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">BOOTPROTO=static <span class="comment">#dhcpæ”¹ä¸ºstaticï¼ˆä¿®æ”¹ï¼‰</span></span><br><span class="line">ONBOOT=yes <span class="comment">#å¼€æœºå¯ç”¨æœ¬é…ç½®ï¼Œä¸€èˆ¬åœ¨æœ€åä¸€è¡Œï¼ˆä¿®æ”¹ï¼‰</span></span><br><span class="line"> </span><br><span class="line">IPADDR=<span class="number">192.168</span><span class="number">.179</span><span class="number">.111</span> <span class="comment">#é™æ€IPï¼ˆå¢åŠ ï¼‰</span></span><br><span class="line">GATEWAY=<span class="number">192.168</span><span class="number">.179</span><span class="number">.2</span> <span class="comment">#é»˜è®¤ç½‘å…³ï¼Œè™šæ‹Ÿæœºå®‰è£…çš„è¯ï¼Œé€šå¸¸æ˜¯2ï¼Œä¹Ÿå°±æ˜¯VMnet8çš„ç½‘å…³è®¾ç½®ï¼ˆå¢åŠ ï¼‰</span></span><br><span class="line">NETMASK=<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="comment">#å­ç½‘æ©ç ï¼ˆå¢åŠ ï¼‰</span></span><br><span class="line">DNS1=<span class="number">192.168</span><span class="number">.179</span><span class="number">.2</span> <span class="comment">#DNS é…ç½®ï¼Œè™šæ‹Ÿæœºå®‰è£…çš„è¯ï¼ŒDNSå°±ç½‘å…³å°±è¡Œï¼Œå¤šä¸ªDNSç½‘å€çš„è¯å†å¢åŠ ï¼ˆå¢åŠ ï¼‰</span></span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="é‡å¯ç½‘å¡"><a href="#é‡å¯ç½‘å¡" class="headerlink" title="é‡å¯ç½‘å¡"></a>é‡å¯ç½‘å¡</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="éšä¾¿æ‰¾ä¸ªåŸŸåpingä¸€ä¸‹æµ‹è¯•DNSæ˜¯å¦OK"><a href="#éšä¾¿æ‰¾ä¸ªåŸŸåpingä¸€ä¸‹æµ‹è¯•DNSæ˜¯å¦OK" class="headerlink" title="éšä¾¿æ‰¾ä¸ªåŸŸåpingä¸€ä¸‹æµ‹è¯•DNSæ˜¯å¦OK"></a>éšä¾¿æ‰¾ä¸ªåŸŸåpingä¸€ä¸‹æµ‹è¯•DNSæ˜¯å¦OK</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ping baidu.com</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="è®¾ç½®ä¸»æœºå"><a href="#è®¾ç½®ä¸»æœºå" class="headerlink" title="è®¾ç½®ä¸»æœºå"></a><strong>è®¾ç½®ä¸»æœºå</strong></h3><p>vi /etc/hostname</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">linux-node1.example.com				<span class="comment">#ä¸ºä¸»æœºå</span></span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="è®¾ç½®ä¸»æœºåè§£æ"><a href="#è®¾ç½®ä¸»æœºåè§£æ" class="headerlink" title="è®¾ç½®ä¸»æœºåè§£æ"></a>è®¾ç½®ä¸»æœºåè§£æ</h3><p>vi /etc/hosts </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.56</span><span class="number">.11</span> linux-node1 linux-node1.example.com</span><br><span class="line"></span><br><span class="line"><span class="number">192.168</span><span class="number">.56</span><span class="number">.12</span> linux-node2 linux-node2.example.com</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="å®‰è£…æœ€æ–°epel-yumæº"><a href="#å®‰è£…æœ€æ–°epel-yumæº" class="headerlink" title="å®‰è£…æœ€æ–°epel yumæº"></a><strong>å®‰è£…æœ€æ–°epel yumæº</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­¤åœ°å€ä¸­æœ‰å„ç§æºï¼ˆhttps://opsx.alibaba.com/mirrorï¼‰</span></span><br><span class="line">rpm -ivh https://mirrors.aliyun.com/epel/epel-release-latest<span class="number">-7.</span>noarch.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="yumå®‰è£…-ä¸€äº›åŸºç¡€åŒ…"><a href="#yumå®‰è£…-ä¸€äº›åŸºç¡€åŒ…" class="headerlink" title="yumå®‰è£… ä¸€äº›åŸºç¡€åŒ…"></a><strong>yumå®‰è£… ä¸€äº›åŸºç¡€åŒ…</strong></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install net-tools vim lrzsz tree screen lsof tcpdump nc mtr nmap</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="å…³é—­selinux"><a href="#å…³é—­selinux" class="headerlink" title="å…³é—­selinux"></a><strong>å…³é—­selinux</strong></h3><p>vim /etc/selinux/config </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELINUX&#x3D;disabled</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="é‡å¯ç³»ç»Ÿ"><a href="#é‡å¯ç³»ç»Ÿ" class="headerlink" title="é‡å¯ç³»ç»Ÿ"></a><strong>é‡å¯ç³»ç»Ÿ</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">yum update -y &amp;&amp; reboot          <span class="comment"># å‡çº§æ‰€æœ‰åŒ…åŒæ—¶ä¹Ÿå‡çº§è½¯ä»¶å’Œç³»ç»Ÿå†…æ ¸, å¹¶é‡å¯</span></span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="ç¡®è®¤æ˜¯å¦ä¸€äº›æœåŠ¡æ˜¯å¦å·²æŒ‰è®¡åˆ’å…³é—­"><a href="#ç¡®è®¤æ˜¯å¦ä¸€äº›æœåŠ¡æ˜¯å¦å·²æŒ‰è®¡åˆ’å…³é—­" class="headerlink" title="ç¡®è®¤æ˜¯å¦ä¸€äº›æœåŠ¡æ˜¯å¦å·²æŒ‰è®¡åˆ’å…³é—­"></a><strong>ç¡®è®¤æ˜¯å¦ä¸€äº›æœåŠ¡æ˜¯å¦å·²æŒ‰è®¡åˆ’å…³é—­</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">getenforce          <span class="comment"># selinuxæ˜¯å¦å…³é—­</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --state         <span class="comment"># é˜²ç«å¢™æ˜¯å¦å…³é—­</span></span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="é™„å¸¦å…³äºCentOS7é˜²ç«å¢™çš„å‘½ä»¤"><a href="#é™„å¸¦å…³äºCentOS7é˜²ç«å¢™çš„å‘½ä»¤" class="headerlink" title="é™„å¸¦å…³äºCentOS7é˜²ç«å¢™çš„å‘½ä»¤"></a>é™„å¸¦å…³äºCentOS7é˜²ç«å¢™çš„å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. ä½¿ç”¨å‘½ä»¤ï¼šfirewall-cmd --state     			æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span><br><span class="line">		running			#ä»£è¡¨å¼€å¯</span><br><span class="line">2. ä½¿ç”¨å‘½ä»¤ï¼šsystemctl stop firewalld.service	 	å…³é—­è¿è¡Œçš„é˜²ç«å¢™</span><br><span class="line">		not running		#ä»£è¡¨å…³é—­</span><br><span class="line">3. æ³¨æ„  å‰é¢çš„æ–¹æ³•ï¼Œä¸€æ—¦é‡å¯æ“ä½œç³»ç»Ÿï¼Œé˜²ç«å¢™å°±è‡ªåŠ¨å¼€å¯äº†</span><br><span class="line"></span><br><span class="line">4. è¾“å…¥å‘½ä»¤ï¼šsystemctl disable firewalld.service		ç¦æ­¢é˜²ç«å¢™æœåŠ¡å™¨è‡ªåŠ¨å¯åŠ¨</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-å…‹éš†ä¸€å°è™šæ‹Ÿæœº"><a href="#3-å…‹éš†ä¸€å°è™šæ‹Ÿæœº" class="headerlink" title="3.  å…‹éš†ä¸€å°è™šæ‹Ÿæœº"></a>3.  å…‹éš†ä¸€å°è™šæ‹Ÿæœº</h2><p>   <strong>æ³¨ï¼š</strong>å…‹éš†è™šæ‹Ÿæœºå¿…é¡»è¦å…ˆå…³é—­ï¼ˆshutdownï¼‰ </p>
<ol>
<li><h3 id="å³é”®-â€˜ç®¡ç†â€™-â€”â€“-gt-â€˜å…‹éš†â€™"><a href="#å³é”®-â€˜ç®¡ç†â€™-â€”â€“-gt-â€˜å…‹éš†â€™" class="headerlink" title="å³é”®    â€˜ç®¡ç†â€™    â€”â€“&gt;    â€˜å…‹éš†â€™"></a>å³é”®    â€˜ç®¡ç†â€™    â€”â€“&gt;    â€˜å…‹éš†â€™</h3></li>
<li><h3 id="é€‰æ‹©ä»é‚£ä¸ªçŠ¶æ€å…‹éš†"><a href="#é€‰æ‹©ä»é‚£ä¸ªçŠ¶æ€å…‹éš†" class="headerlink" title="é€‰æ‹©ä»é‚£ä¸ªçŠ¶æ€å…‹éš†"></a>é€‰æ‹©ä»é‚£ä¸ªçŠ¶æ€å…‹éš†</h3></li>
<li><h3 id="å…‹éš†çŠ¶æ€-åˆ›å»ºå®Œæ•´å…‹éš†"><a href="#å…‹éš†çŠ¶æ€-åˆ›å»ºå®Œæ•´å…‹éš†" class="headerlink" title="å…‹éš†çŠ¶æ€(åˆ›å»ºå®Œæ•´å…‹éš†)"></a>å…‹éš†çŠ¶æ€(åˆ›å»ºå®Œæ•´å…‹éš†)</h3></li>
<li><h3 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h3></li>
<li><h3 id="æ–°å»ºè™šæ‹Ÿæœºåç§°"><a href="#æ–°å»ºè™šæ‹Ÿæœºåç§°" class="headerlink" title="æ–°å»ºè™šæ‹Ÿæœºåç§°"></a>æ–°å»ºè™šæ‹Ÿæœºåç§°</h3></li>
<li><h3 id="ç‚¹å‡»â€™å®Œæˆâ€™å³å®Œæˆå¯¹è™šæ‹Ÿæœºçš„å…‹éš†"><a href="#ç‚¹å‡»â€™å®Œæˆâ€™å³å®Œæˆå¯¹è™šæ‹Ÿæœºçš„å…‹éš†" class="headerlink" title="ç‚¹å‡»â€™å®Œæˆâ€™å³å®Œæˆå¯¹è™šæ‹Ÿæœºçš„å…‹éš†"></a>ç‚¹å‡»â€™å®Œæˆâ€™å³å®Œæˆå¯¹è™šæ‹Ÿæœºçš„å…‹éš†</h3></li>
<li><h3 id="å¯¹è™šæ‹Ÿæœºnode2è¿›è¡Œä¸€äº›ç®€å•çš„é…ç½®"><a href="#å¯¹è™šæ‹Ÿæœºnode2è¿›è¡Œä¸€äº›ç®€å•çš„é…ç½®" class="headerlink" title="å¯¹è™šæ‹Ÿæœºnode2è¿›è¡Œä¸€äº›ç®€å•çš„é…ç½®"></a>å¯¹è™šæ‹Ÿæœºnode2è¿›è¡Œä¸€äº›ç®€å•çš„é…ç½®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;hostname       # 1ã€ä¿®æ”¹ä¸»æœºå</span><br><span class="line"></span><br><span class="line">	linux-node2.example.com</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0 </span><br><span class="line"></span><br><span class="line">	IPADDR&#x3D;192.168.179.111 #é™æ€IPï¼ˆä¿®æ”¹ï¼‰</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0ã€€</span><br><span class="line"></span><br><span class="line">	IPADDR&#x3D;192.168.56.12</span><br><span class="line"></span><br><span class="line">reboot			#é‡å¯è™šæ‹Ÿæœº</span><br></pre></td></tr></table></figure>

<h2 id="4-å®‰è£…"><a href="#4-å®‰è£…" class="headerlink" title="4.  å®‰è£…"></a>4.  å®‰è£…</h2><ol>
<li><h3 id="åœ¨node1-ä¸­å®‰è£…saltstack-master-å’Œ-minion"><a href="#åœ¨node1-ä¸­å®‰è£…saltstack-master-å’Œ-minion" class="headerlink" title="åœ¨node1 ä¸­å®‰è£…saltstack master å’Œ minion"></a><strong>åœ¨node1 ä¸­å®‰è£…saltstack master å’Œ minion</strong></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install https:&#x2F;&#x2F;repo.saltstack.com&#x2F;yum&#x2F;redhat&#x2F;salt-repo-latest-2.el7.noarch.rpm </span><br><span class="line"></span><br><span class="line">yum -y install salt-master salt-minion</span><br><span class="line"></span><br><span class="line">    &#x2F;etc&#x2F;salt&#x2F;masterï¼ˆmasteré…ç½®æ–‡ä»¶ï¼‰</span><br><span class="line"></span><br><span class="line">    &#x2F;etc&#x2F;salt&#x2F;minionï¼ˆminioné…ç½®æ–‡ä»¶ï¼‰</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="node2-ä¸­å®‰è£…saltstack-minion"><a href="#node2-ä¸­å®‰è£…saltstack-minion" class="headerlink" title="node2 ä¸­å®‰è£…saltstack minion"></a>node2 ä¸­å®‰è£…<strong>saltstack minion</strong></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install https:&#x2F;&#x2F;repo.saltstack.com&#x2F;yum&#x2F;redhat&#x2F;salt-repo-latest-2.el7.noarch.rpm </span><br><span class="line"></span><br><span class="line">yum -y install salt-minion</span><br><span class="line"></span><br><span class="line">	&#x2F;etc&#x2F;salt&#x2F;minionï¼ˆminioné…ç½®æ–‡ä»¶ï¼‰</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="åœ¨linux-node1ä¸­é…ç½®-salt-minion"><a href="#åœ¨linux-node1ä¸­é…ç½®-salt-minion" class="headerlink" title="åœ¨linux-node1ä¸­é…ç½® salt-minion"></a><strong>åœ¨linux-node1ä¸­é…ç½® salt-minion</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vim /etc/salt/minion</span><br><span class="line"></span><br><span class="line">    <span class="comment">#master: salt   ä¿®æ”¹ä¸ºï¼ˆmaster: 192.168.56.11ï¼‰ ----ã€‹é…ç½®master IP</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#id:           ä¿®æ”¹ä¸ºï¼ˆid: linux-node1.example.comï¼‰   ---ã€‹å‘Šè¯‰masterè‡ªå·±æ˜¯è°ï¼Œé»˜è®¤ä¼šè¯»å–å½“å‰ä¸»æœºå</span></span><br><span class="line">    </span><br><span class="line">æ³¨ï¼šsaltstackæ˜¯ä»¥ä¸»æœºååŒºåˆ†ä¸åŒ agent éœ€ä¿è¯ä¸»æœºåå”¯ä¸€</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="åœ¨node2ä¸­é…ç½®-salt-minion"><a href="#åœ¨node2ä¸­é…ç½®-salt-minion" class="headerlink" title="åœ¨node2ä¸­é…ç½® salt-minion"></a>åœ¨node2ä¸­é…ç½® salt-minion</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vim /etc/salt/minion</span><br><span class="line"></span><br><span class="line">    <span class="comment">#master: salt   ä¿®æ”¹ä¸ºï¼ˆmaster: 192.168.56.11ï¼‰ ----ã€‹é…ç½®master IP</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#id:           ä¿®æ”¹ä¸ºï¼ˆid: linux-node2.example.comï¼‰   ---ã€‹å‘Šè¯‰masterè‡ªå·±æ˜¯è°ï¼Œé»˜è®¤ä¼šè¯»å–å½“å‰ä¸»æœºå</span></span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="å¯åŠ¨node1ä¸­salt-maser-å’Œ-salt-minion"><a href="#å¯åŠ¨node1ä¸­salt-maser-å’Œ-salt-minion" class="headerlink" title="å¯åŠ¨node1ä¸­salt-maser å’Œ salt-minion"></a><strong>å¯åŠ¨node1ä¸­salt-maser å’Œ salt-minion</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">systemctl start salt-master       <span class="comment"># å¯åŠ¨salt-master</span></span><br><span class="line"></span><br><span class="line">systemctl enable salt-master       <span class="comment"># è®¾ç½®salt-masterå¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">systemctl start salt-minion        <span class="comment"># å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">systemctl enable salt-minion     <span class="comment"># å¼€æœºè‡ªå¯åŠ¨</span></span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="å¯åŠ¨node2ä¸­salt-minion"><a href="#å¯åŠ¨node2ä¸­salt-minion" class="headerlink" title="å¯åŠ¨node2ä¸­salt-minion"></a><strong>å¯åŠ¨node2ä¸­salt-minion</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">systemctl start salt-minion        <span class="comment"># å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">systemctl enable salt-minion      <span class="comment"># å¼€æœºè‡ªå¯åŠ¨</span></span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">salt-key             <span class="comment"># åœ¨masterä¸­æŸ¥çœ‹æ‰€æœ‰keyçš„çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">salt-key -a linux-node1.example.com      <span class="comment"># è®¤è¯ linux-node1.example.comçš„key</span></span><br><span class="line"></span><br><span class="line">salt-key -A          <span class="comment"># ä¸€æ¬¡æ€§è®¤è¯æ‰€æœ‰key</span></span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="è¿œç¨‹æ‰§è¡Œ"><a href="#è¿œç¨‹æ‰§è¡Œ" class="headerlink" title="è¿œç¨‹æ‰§è¡Œ"></a>è¿œç¨‹æ‰§è¡Œ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">salt  \*  test.ping         <span class="comment"># æµ‹è¯•saltstack minionä¸masterçš„è¿é€šæ€§</span></span><br><span class="line"></span><br><span class="line">salt \* cmd.run <span class="string">'df -h'</span>     <span class="comment"># åœ¨æ‰€æœ‰minionä¸­æ‰¹é‡æ‰§è¡Œ df -h å‘½ä»¤</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>saltstack</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³Hexoå›¾ç‰‡é—®é¢˜</title>
    <url>/2018/02/01/%E8%A7%A3%E5%86%B3Hexo%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<html><head></head><body></body></html><html><head></head><body><p>æœ€è¿‘æ­å»ºhexoåšå®¢æ—¶é‡åˆ°äº†å›¾ç‰‡éƒ¨ç½²åä¸æ˜¾ç¤ºçš„é—®é¢˜ï¼Œç»è¿‡ä¸Šç½‘æŸ¥é˜…åå¯ä»¥æ­£å¸¸æ˜¾ç¤º</p>
<p>è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š </p>
<ol>
<li><p>åœ¨æ ¹ç›®å½•ä¸‹é…ç½®æ–‡ä»¶<code>_config.yml</code> ä¸­æœ‰ <code>post_asset_folder:falseæ”¹ä¸ºtrue</code>ã€‚è¿™æ ·åœ¨å»ºç«‹æ–‡ä»¶æ—¶ï¼Œ<code>Hexo</code>ä¼šè‡ªåŠ¨å»ºç«‹ä¸€ä¸ªä¸æ–‡ç« åŒåçš„æ–‡ä»¶å¤¹ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠä¸è¯¥æ–‡ç« ç›¸å…³çš„æ‰€æœ‰èµ„æºï¼ˆå›¾ç‰‡ï¼‰éƒ½æ”¾åˆ°é‚£ä¸ªæ–‡ä»¶å¤¹é‡Œæ–¹ä¾¿åé¢å¼•ç”¨ã€‚å¦‚è¿™é‡Œæˆ‘æ”¾äº†ä¸€å¼ test.pngçš„å›¾ç‰‡ã€‚ </p>
</li>
<li><p>git bashå®‰è£…æ’ä»¶ï¼šnpm install  <a href="https://github.com/7ym0n/hexo-asset-image" target="_blank" rel="noopener">https://github.com/7ym0n/hexo-asset-image</a> â€“saveï¼ˆè¿™æ˜¯ä¸ªä¿®æ”¹è¿‡çš„æ’ä»¶ï¼Œç»æµ‹è¯•æ— é—®é¢˜ï¼‰ï¼Œä½¿ç”¨è¿™ä¸ªæ’ä»¶æ¥å¼•å…¥å›¾ç‰‡ï¼Œè€Œä¸æ˜¯ç½‘ä¸Šé‚£äº›æ–¹æ³•é‡Œè¯´çš„ç”¨ä¼ ç»Ÿmdè¯­æ³•ç›¸å¯¹è·¯å¾„çš„æ–¹æ³•ã€‚ </p>
</li>
<li><p>æ’å…¥å›¾ç‰‡æ—¶ç”¨è¿™ç§æ–¹å¼ï¼š</p>
<p><strong><img src="/2018/02/01/%E8%A7%A3%E5%86%B3Hexo%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/test.png" class title="This is an test image"></strong></p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">{% asset_img test.png This is an test image %}</span><br></pre></td></tr></tbody></table></figure>



</li>
</ol>
<p>   â€‹        <strong>å…¶ä¸­test.pngå°±æ˜¯ä½ è¦å¼•ç”¨çš„å›¾ç‰‡ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯test.pngï¼Œåé¢çš„This is an test imageæ˜¯å›¾ç‰‡æè¿°ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹ã€‚</strong> </p>
</body></html>]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
</search>
